"""
Pydantic schemas for prediction database records.

Maps to the Supabase 'predictions' table columns:
    id          uuid        (auto)
    created_at  timestamptz (auto)
    smiles      text        NOT NULL
    model_type  text        NOT NULL
    result      float8      NOT NULL
    confidence  float8      nullable
    meta        jsonb       nullable
"""

from datetime import datetime
from typing import Any, Dict, Optional

from pydantic import BaseModel, ConfigDict, Field


class PredictionCreate(BaseModel):
    """
    Schema for inserting a new prediction into the 'predictions' table.

    Field names MUST match the Supabase column names exactly.

    Attributes:
        smiles: SMILES string of the molecule.
        model_type: ML model identifier (e.g. 'solubility').
        result: Raw prediction value from the model.
        confidence: Confidence / probability score (0-1).
        meta: Extra data (molecular_weight, unit, execution_time_ms, etc.).
    """

    model_config = ConfigDict(protected_namespaces=())

    smiles: str = Field(..., min_length=1, max_length=500)
    model_type: str = Field(..., description="ML model identifier")
    result: float = Field(..., description="Raw model prediction value")
    confidence: Optional[float] = Field(None, ge=0.0, le=1.0)
    meta: Optional[Dict[str, Any]] = Field(None, description="Extra metadata (unit, MW, etc.)")


class PredictionRecord(PredictionCreate):
    """
    Schema for a prediction record returned from the database.

    Extends PredictionCreate with server-generated fields.

    Attributes:
        id: Unique record UUID (auto-generated by Supabase).
        created_at: Timestamp of prediction (auto-generated by Supabase).
    """

    id: str
    created_at: datetime
