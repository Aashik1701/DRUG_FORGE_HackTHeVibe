var js=Object.defineProperty;var Hs=(K,C,f)=>C in K?js(K,C,{enumerable:!0,configurable:!0,writable:!0,value:f}):K[C]=f;var Rt=(K,C,f)=>Hs(K,typeof C!="symbol"?C+"":C,f);import{c as createLucideIcon,j as jsxDevRuntimeExports,k as Layers,f as Loader2,d as AlertTriangle}from"./index-CfBLcNG8.js";import{c as commonjsGlobal,r as reactExports}from"./vendor-D6EHgqcQ.js";import{Z as Zap}from"./zap-2iWcIBfO.js";/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Atom=createLucideIcon("Atom",[["circle",{cx:"12",cy:"12",r:"1",key:"41hilf"}],["path",{d:"M20.2 20.2c2.04-2.03.02-7.36-4.5-11.9-4.54-4.52-9.87-6.54-11.9-4.5-2.04 2.03-.02 7.36 4.5 11.9 4.54 4.52 9.87 6.54 11.9 4.5Z",key:"1l2ple"}],["path",{d:"M15.7 15.7c4.52-4.54 6.54-9.87 4.5-11.9-2.03-2.04-7.36-.02-11.9 4.5-4.52 4.54-6.54 9.87-4.5 11.9 2.03 2.04 7.36.02 11.9-4.5Z",key:"1wam0m"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Box=createLucideIcon("Box",[["path",{d:"M21 8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16Z",key:"hh9hay"}],["path",{d:"m3.3 7 8.7 5 8.7-5",key:"g66t2b"}],["path",{d:"M12 22V12",key:"d0xqtd"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Camera=createLucideIcon("Camera",[["path",{d:"M14.5 4h-5L7 7H4a2 2 0 0 0-2 2v9a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2V9a2 2 0 0 0-2-2h-3l-2.5-3z",key:"1tc9qg"}],["circle",{cx:"12",cy:"13",r:"3",key:"1vg3eu"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Circle=createLucideIcon("Circle",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Magnet=createLucideIcon("Magnet",[["path",{d:"m6 15-4-4 6.75-6.77a7.79 7.79 0 0 1 11 11L13 22l-4-4 6.39-6.36a2.14 2.14 0 0 0-3-3L6 15",key:"1i3lhw"}],["path",{d:"m5 8 4 4",key:"j6kj7e"}],["path",{d:"m12 15 4 4",key:"lnac28"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Minus=createLucideIcon("Minus",[["path",{d:"M5 12h14",key:"1ays0h"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Pause=createLucideIcon("Pause",[["rect",{width:"4",height:"16",x:"6",y:"4",key:"iffhe4"}],["rect",{width:"4",height:"16",x:"14",y:"4",key:"sjin7j"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Play=createLucideIcon("Play",[["polygon",{points:"5 3 19 12 5 21 5 3",key:"191637"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const RefreshCw=createLucideIcon("RefreshCw",[["path",{d:"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8",key:"v9h5vc"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}],["path",{d:"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16",key:"3uifl3"}],["path",{d:"M8 16H3v5",key:"1cv678"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const RotateCcw=createLucideIcon("RotateCcw",[["path",{d:"M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"1357e3"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ruler=createLucideIcon("Ruler",[["path",{d:"M21.3 15.3a2.4 2.4 0 0 1 0 3.4l-2.6 2.6a2.4 2.4 0 0 1-3.4 0L2.7 8.7a2.41 2.41 0 0 1 0-3.4l2.6-2.6a2.41 2.41 0 0 1 3.4 0Z",key:"icamh8"}],["path",{d:"m14.5 12.5 2-2",key:"inckbg"}],["path",{d:"m11.5 9.5 2-2",key:"fmmyf7"}],["path",{d:"m8.5 6.5 2-2",key:"vc6u1g"}],["path",{d:"m17.5 15.5 2-2",key:"wo5hmg"}]]);var _3Dmol={exports:{}};/*!
 * 3dmol v2.5.4
 * JavaScript/TypeScript molecular visualization library
 * Author: David Koes and contributors
 */(function(module,exports){(function(C,f){module.exports=f()})(commonjsGlobal,()=>(()=>{var __webpack_modules__={"./node_modules/iobuffer/lib-esm/IOBuffer.js"(K,C,f){f.r(C),f.d(C,{IOBuffer:()=>p});var E=f("./node_modules/iobuffer/lib-esm/text.js");const S=1024*8,w=(()=>{const x=new Uint8Array(4),M=new Uint32Array(x.buffer);return!((M[0]=1)&x[0])})(),O={int8:globalThis.Int8Array,uint8:globalThis.Uint8Array,int16:globalThis.Int16Array,uint16:globalThis.Uint16Array,int32:globalThis.Int32Array,uint32:globalThis.Uint32Array,uint64:globalThis.BigUint64Array,int64:globalThis.BigInt64Array,float32:globalThis.Float32Array,float64:globalThis.Float64Array};class p{constructor(M=S,m={}){Rt(this,"buffer");Rt(this,"byteLength");Rt(this,"byteOffset");Rt(this,"length");Rt(this,"offset");Rt(this,"lastWrittenByte");Rt(this,"littleEndian");Rt(this,"_data");Rt(this,"_mark");Rt(this,"_marks");let b=!1;typeof M=="number"?M=new ArrayBuffer(M):(b=!0,this.lastWrittenByte=M.byteLength);const _=m.offset?m.offset>>>0:0,g=M.byteLength-_;let v=_;(ArrayBuffer.isView(M)||M instanceof p)&&(M.byteLength!==M.buffer.byteLength&&(v=M.byteOffset+_),M=M.buffer),b?this.lastWrittenByte=g:this.lastWrittenByte=0,this.buffer=M,this.length=g,this.byteLength=g,this.byteOffset=v,this.offset=0,this.littleEndian=!0,this._data=new DataView(this.buffer,v,g),this._mark=0,this._marks=[]}available(M=1){return this.offset+M<=this.length}isLittleEndian(){return this.littleEndian}setLittleEndian(){return this.littleEndian=!0,this}isBigEndian(){return!this.littleEndian}setBigEndian(){return this.littleEndian=!1,this}skip(M=1){return this.offset+=M,this}back(M=1){return this.offset-=M,this}seek(M){return this.offset=M,this}mark(){return this._mark=this.offset,this}reset(){return this.offset=this._mark,this}pushMark(){return this._marks.push(this.offset),this}popMark(){const M=this._marks.pop();if(M===void 0)throw new Error("Mark stack empty");return this.seek(M),this}rewind(){return this.offset=0,this}ensureAvailable(M=1){if(!this.available(M)){const b=(this.offset+M)*2,_=new Uint8Array(b);_.set(new Uint8Array(this.buffer)),this.buffer=_.buffer,this.length=b,this.byteLength=b,this._data=new DataView(this.buffer)}return this}readBoolean(){return this.readUint8()!==0}readInt8(){return this._data.getInt8(this.offset++)}readUint8(){return this._data.getUint8(this.offset++)}readByte(){return this.readUint8()}readBytes(M=1){return this.readArray(M,"uint8")}readArray(M,m){const b=O[m].BYTES_PER_ELEMENT*M,_=this.byteOffset+this.offset,g=this.buffer.slice(_,_+b);if(this.littleEndian===w&&m!=="uint8"&&m!=="int8"){const r=new Uint8Array(this.buffer.slice(_,_+b));r.reverse();const e=new O[m](r.buffer);return this.offset+=b,e.reverse(),e}const v=new O[m](g);return this.offset+=b,v}readInt16(){const M=this._data.getInt16(this.offset,this.littleEndian);return this.offset+=2,M}readUint16(){const M=this._data.getUint16(this.offset,this.littleEndian);return this.offset+=2,M}readInt32(){const M=this._data.getInt32(this.offset,this.littleEndian);return this.offset+=4,M}readUint32(){const M=this._data.getUint32(this.offset,this.littleEndian);return this.offset+=4,M}readFloat32(){const M=this._data.getFloat32(this.offset,this.littleEndian);return this.offset+=4,M}readFloat64(){const M=this._data.getFloat64(this.offset,this.littleEndian);return this.offset+=8,M}readBigInt64(){const M=this._data.getBigInt64(this.offset,this.littleEndian);return this.offset+=8,M}readBigUint64(){const M=this._data.getBigUint64(this.offset,this.littleEndian);return this.offset+=8,M}readChar(){return String.fromCharCode(this.readInt8())}readChars(M=1){let m="";for(let b=0;b<M;b++)m+=this.readChar();return m}readUtf8(M=1){return(0,E.decode)(this.readBytes(M))}decodeText(M=1,m="utf8"){return(0,E.decode)(this.readBytes(M),m)}writeBoolean(M){return this.writeUint8(M?255:0),this}writeInt8(M){return this.ensureAvailable(1),this._data.setInt8(this.offset++,M),this._updateLastWrittenByte(),this}writeUint8(M){return this.ensureAvailable(1),this._data.setUint8(this.offset++,M),this._updateLastWrittenByte(),this}writeByte(M){return this.writeUint8(M)}writeBytes(M){this.ensureAvailable(M.length);for(let m=0;m<M.length;m++)this._data.setUint8(this.offset++,M[m]);return this._updateLastWrittenByte(),this}writeInt16(M){return this.ensureAvailable(2),this._data.setInt16(this.offset,M,this.littleEndian),this.offset+=2,this._updateLastWrittenByte(),this}writeUint16(M){return this.ensureAvailable(2),this._data.setUint16(this.offset,M,this.littleEndian),this.offset+=2,this._updateLastWrittenByte(),this}writeInt32(M){return this.ensureAvailable(4),this._data.setInt32(this.offset,M,this.littleEndian),this.offset+=4,this._updateLastWrittenByte(),this}writeUint32(M){return this.ensureAvailable(4),this._data.setUint32(this.offset,M,this.littleEndian),this.offset+=4,this._updateLastWrittenByte(),this}writeFloat32(M){return this.ensureAvailable(4),this._data.setFloat32(this.offset,M,this.littleEndian),this.offset+=4,this._updateLastWrittenByte(),this}writeFloat64(M){return this.ensureAvailable(8),this._data.setFloat64(this.offset,M,this.littleEndian),this.offset+=8,this._updateLastWrittenByte(),this}writeBigInt64(M){return this.ensureAvailable(8),this._data.setBigInt64(this.offset,M,this.littleEndian),this.offset+=8,this._updateLastWrittenByte(),this}writeBigUint64(M){return this.ensureAvailable(8),this._data.setBigUint64(this.offset,M,this.littleEndian),this.offset+=8,this._updateLastWrittenByte(),this}writeChar(M){return this.writeUint8(M.charCodeAt(0))}writeChars(M){for(let m=0;m<M.length;m++)this.writeUint8(M.charCodeAt(m));return this}writeUtf8(M){return this.writeBytes((0,E.encode)(M))}toArray(){return new Uint8Array(this.buffer,this.byteOffset,this.lastWrittenByte)}getWrittenByteLength(){return this.lastWrittenByte-this.byteOffset}_updateLastWrittenByte(){this.offset>this.lastWrittenByte&&(this.lastWrittenByte=this.offset)}}},"./node_modules/iobuffer/lib-esm/text.js"(K,C,f){f.r(C),f.d(C,{decode:()=>E,encode:()=>w});function E(O,p="utf8"){return new TextDecoder(p).decode(O)}const S=new TextEncoder;function w(O){return S.encode(O)}},"./node_modules/netcdfjs/lib-esm/data.js"(K,C,f){f.r(C),f.d(C,{nonRecord:()=>S,record:()=>w});var E=f("./node_modules/netcdfjs/lib-esm/types.js");function S(O,p){const x=(0,E.str2num)(p.type),M=p.size/(0,E.num2bytes)(x),m=new Array(M);for(let b=0;b<M;b++)m[b]=(0,E.readType)(O,x,1);return m}function w(O,p,x){const M=(0,E.str2num)(p.type),m=p.size?p.size/(0,E.num2bytes)(M):1,b=x.length,_=new Array(b),g=x.recordStep;if(g)for(let v=0;v<b;v++){const r=O.offset;_[v]=(0,E.readType)(O,M,m),O.seek(r+g)}else throw new Error("recordDimension.recordStep is undefined");return _}},"./node_modules/netcdfjs/lib-esm/header.js"(K,C,f){f.r(C),f.d(C,{header:()=>m});var E=f("./node_modules/netcdfjs/lib-esm/types.js"),S=f("./node_modules/netcdfjs/lib-esm/utils.js");const w=0,O=10,p=11,x=12,M=0;function m(v,r){const e={version:r},t={length:v.readUint32()},n=b(v);Array.isArray(n)||(t.id=n.recordId,t.name=n.recordName,e.dimensions=n.dimensions),e.globalAttributes=_(v);const o=g(v,t==null?void 0:t.id,r);return Array.isArray(o)||(e.variables=o.variables,t.recordStep=o.recordStep),e.recordDimension=t,e}function b(v){const r={};let e,t;const n=v.readUint32();let o;if(n===w)return(0,S.notNetcdf)(v.readUint32()!==w,"wrong empty tag for list of dimensions"),[];{(0,S.notNetcdf)(n!==O,"wrong tag for list of dimensions");const h=v.readUint32();o=new Array(h);for(let d=0;d<h;d++){const i=(0,S.readName)(v),s=v.readUint32();s===M&&(e=d,t=i),o[d]={name:i,size:s}}}return e!==void 0&&(r.recordId=e),t!==void 0&&(r.recordName=t),r.dimensions=o,r}function _(v){const r=v.readUint32();let e;if(r===w)return(0,S.notNetcdf)(v.readUint32()!==w,"wrong empty tag for list of attributes"),[];{(0,S.notNetcdf)(r!==x,"wrong tag for list of attributes");const t=v.readUint32();e=new Array(t);for(let n=0;n<t;n++){const o=(0,S.readName)(v),h=v.readUint32();(0,S.notNetcdf)(h<1||h>6,`non valid type ${h}`);const d=v.readUint32(),i=(0,E.readType)(v,h,d);(0,S.padding)(v),e[n]={name:o,type:(0,E.num2str)(h),value:i}}}return e}function g(v,r,e){const t=v.readUint32();let n=0,o;if(t===w)return(0,S.notNetcdf)(v.readUint32()!==w,"wrong empty tag for list of variables"),[];{(0,S.notNetcdf)(t!==p,"wrong tag for list of variables");const h=v.readUint32();o=new Array(h);for(let d=0;d<h;d++){const i=(0,S.readName)(v),s=v.readUint32(),a=new Array(s);for(let R=0;R<s;R++)a[R]=v.readUint32();const c=_(v),u=v.readUint32();(0,S.notNetcdf)(u<1&&u>6,`non valid type ${u}`);const A=v.readUint32();let L=v.readUint32();e===2&&((0,S.notNetcdf)(L>0,"offsets larger than 4GB not supported"),L=v.readUint32());let D=!1;typeof r<"u"&&a[0]===r&&(n+=A,D=!0),o[d]={name:i,dimensions:a,attributes:c,type:(0,E.num2str)(u),size:A,offset:L,record:D}}}return{variables:o,recordStep:n}}},"./node_modules/netcdfjs/lib-esm/index.js"(K,C,f){f.r(C),f.d(C,{NetCDFReader:()=>E.NetCDFReader});var E=f("./node_modules/netcdfjs/lib-esm/parser.js")},"./node_modules/netcdfjs/lib-esm/parser.js"(K,C,f){f.r(C),f.d(C,{NetCDFReader:()=>x});var E=f("./node_modules/iobuffer/lib-esm/IOBuffer.js"),S=f("./node_modules/netcdfjs/lib-esm/data.js"),w=f("./node_modules/netcdfjs/lib-esm/header.js"),O=f("./node_modules/netcdfjs/lib-esm/toString.js"),p=f("./node_modules/netcdfjs/lib-esm/utils.js");class x{constructor(m){this.toString=O.toString;const b=new E.IOBuffer(m);b.setBigEndian(),(0,p.notNetcdf)(b.readChars(3)!=="CDF","should start with CDF");const _=b.readByte();(0,p.notNetcdf)(_>2,"unknown version"),this.header=(0,w.header)(b,_),this.buffer=b}get version(){return this.header.version===1?"classic format":"64-bit offset format"}get recordDimension(){return this.header.recordDimension}get dimensions(){return this.header.dimensions}get globalAttributes(){return this.header.globalAttributes}getAttribute(m){const b=this.globalAttributes.find(_=>_.name===m);return b?b.value:null}getDataVariableAsString(m){const b=this.getDataVariable(m);return b?b.join(""):null}get variables(){return this.header.variables}getDataVariable(m){let b;if(typeof m=="string"?b=this.header.variables.find(_=>_.name===m):b=m,b===void 0)throw new Error("Not a valid NetCDF v3.x file: variable not found");return this.buffer.seek(b.offset),b.record?(0,S.record)(this.buffer,b,this.header.recordDimension):(0,S.nonRecord)(this.buffer,b)}dataVariableExists(m){return this.header.variables.find(_=>_.name===m)!==void 0}attributeExists(m){return this.globalAttributes.find(_=>_.name===m)!==void 0}}},"./node_modules/netcdfjs/lib-esm/toString.js"(K,C,f){f.r(C),f.d(C,{toString:()=>E});function E(){const S=[];S.push("DIMENSIONS");for(const O of this.dimensions)S.push(`  ${O.name.padEnd(30)} = size: ${O.size}`);S.push(""),S.push("GLOBAL ATTRIBUTES");for(const O of this.globalAttributes)S.push(`  ${O.name.padEnd(30)} = ${O.value}`);const w=JSON.parse(JSON.stringify(this.variables));S.push(""),S.push("VARIABLES:");for(const O of w){O.value=this.getDataVariable(O);let p=JSON.stringify(O.value);p.length>50&&(p=p.substring(0,50)),isNaN(O.value.length)||(p+=` (length: ${O.value.length})`),S.push(`  ${O.name.padEnd(30)} = ${p}`)}return S.join(`
`)}},"./node_modules/netcdfjs/lib-esm/types.js"(K,C,f){f.r(C),f.d(C,{num2bytes:()=>w,num2str:()=>S,readType:()=>x,str2num:()=>O});const E={BYTE:1,CHAR:2,SHORT:3,INT:4,FLOAT:5,DOUBLE:6};function S(m){switch(Number(m)){case E.BYTE:return"byte";case E.CHAR:return"char";case E.SHORT:return"short";case E.INT:return"int";case E.FLOAT:return"float";case E.DOUBLE:return"double";default:return"undefined"}}function w(m){switch(Number(m)){case E.BYTE:return 1;case E.CHAR:return 1;case E.SHORT:return 2;case E.INT:return 4;case E.FLOAT:return 4;case E.DOUBLE:return 8;default:return-1}}function O(m){switch(String(m)){case"byte":return E.BYTE;case"char":return E.CHAR;case"short":return E.SHORT;case"int":return E.INT;case"float":return E.FLOAT;case"double":return E.DOUBLE;default:return-1}}function p(m,b){if(m!==1){const _=new Array(m);for(let g=0;g<m;g++)_[g]=b();return _}else return b()}function x(m,b,_){switch(b){case E.BYTE:return Array.from(m.readBytes(_));case E.CHAR:return M(m.readChars(_));case E.SHORT:return p(_,m.readInt16.bind(m));case E.INT:return p(_,m.readInt32.bind(m));case E.FLOAT:return p(_,m.readFloat32.bind(m));case E.DOUBLE:return p(_,m.readFloat64.bind(m));default:throw new Error(`non valid type ${b}`)}}function M(m){return m.charCodeAt(m.length-1)===0?m.substring(0,m.length-1):m}},"./node_modules/netcdfjs/lib-esm/utils.js"(K,C,f){f.r(C),f.d(C,{notNetcdf:()=>E,padding:()=>S,readName:()=>w});function E(O,p){if(O)throw new TypeError(`Not a valid NetCDF v3.x file: ${p}`)}function S(O){O.offset%4!==0&&O.skip(4-O.offset%4)}function w(O){const p=O.readUint32(),x=O.readChars(p);return S(O),x}},"./node_modules/pako/dist/pako.esm.mjs"(K,C,f){f.r(C),f.d(C,{Deflate:()=>Wr,Inflate:()=>kr,constants:()=>Yr,default:()=>ks,deflate:()=>Nr,deflateRaw:()=>Gr,gzip:()=>Vr,inflate:()=>jr,inflateRaw:()=>Hr,ungzip:()=>Kr});/*! pako 2.1.0 https://github.com/nodeca/pako @license (MIT AND Zlib) */const E=4,S=0,w=1,O=2;function p(l){let N=l.length;for(;--N>=0;)l[N]=0}const x=0,M=1,m=2,b=3,_=258,g=29,v=256,r=v+1+g,e=30,t=19,n=2*r+1,o=15,h=16,d=7,i=256,s=16,a=17,c=18,u=new Uint8Array([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0]),A=new Uint8Array([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13]),L=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7]),D=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),R=512,P=new Array((r+2)*2);p(P);const z=new Array(e*2);p(z);const F=new Array(R);p(F);const B=new Array(_-b+1);p(B);const U=new Array(g);p(U);const W=new Array(e);p(W);function I(l,N,y,Z,Q){this.static_tree=l,this.extra_bits=N,this.extra_base=y,this.elems=Z,this.max_length=Q,this.has_stree=l&&l.length}let V,ee,te;function ae(l,N){this.dyn_tree=l,this.max_code=0,this.stat_desc=N}const re=l=>l<256?F[l]:F[256+(l>>>7)],fe=(l,N)=>{l.pending_buf[l.pending++]=N&255,l.pending_buf[l.pending++]=N>>>8&255},q=(l,N,y)=>{l.bi_valid>h-y?(l.bi_buf|=N<<l.bi_valid&65535,fe(l,l.bi_buf),l.bi_buf=N>>h-l.bi_valid,l.bi_valid+=y-h):(l.bi_buf|=N<<l.bi_valid&65535,l.bi_valid+=y)},oe=(l,N,y)=>{q(l,y[N*2],y[N*2+1])},be=(l,N)=>{let y=0;do y|=l&1,l>>>=1,y<<=1;while(--N>0);return y>>>1},ge=l=>{l.bi_valid===16?(fe(l,l.bi_buf),l.bi_buf=0,l.bi_valid=0):l.bi_valid>=8&&(l.pending_buf[l.pending++]=l.bi_buf&255,l.bi_buf>>=8,l.bi_valid-=8)},Le=(l,N)=>{const y=N.dyn_tree,Z=N.max_code,Q=N.stat_desc.static_tree,$=N.stat_desc.has_stree,Ee=N.stat_desc.extra_bits,me=N.stat_desc.extra_base,Ye=N.stat_desc.max_length;let le,Ae,ct,Ke,We,$e,Et=0;for(Ke=0;Ke<=o;Ke++)l.bl_count[Ke]=0;for(y[l.heap[l.heap_max]*2+1]=0,le=l.heap_max+1;le<n;le++)Ae=l.heap[le],Ke=y[y[Ae*2+1]*2+1]+1,Ke>Ye&&(Ke=Ye,Et++),y[Ae*2+1]=Ke,!(Ae>Z)&&(l.bl_count[Ke]++,We=0,Ae>=me&&(We=Ee[Ae-me]),$e=y[Ae*2],l.opt_len+=$e*(Ke+We),$&&(l.static_len+=$e*(Q[Ae*2+1]+We)));if(Et!==0){do{for(Ke=Ye-1;l.bl_count[Ke]===0;)Ke--;l.bl_count[Ke]--,l.bl_count[Ke+1]+=2,l.bl_count[Ye]--,Et-=2}while(Et>0);for(Ke=Ye;Ke!==0;Ke--)for(Ae=l.bl_count[Ke];Ae!==0;)ct=l.heap[--le],!(ct>Z)&&(y[ct*2+1]!==Ke&&(l.opt_len+=(Ke-y[ct*2+1])*y[ct*2],y[ct*2+1]=Ke),Ae--)}},pe=(l,N,y)=>{const Z=new Array(o+1);let Q=0,$,Ee;for($=1;$<=o;$++)Q=Q+y[$-1]<<1,Z[$]=Q;for(Ee=0;Ee<=N;Ee++){let me=l[Ee*2+1];me!==0&&(l[Ee*2]=be(Z[me]++,me))}},J=()=>{let l,N,y,Z,Q;const $=new Array(o+1);for(y=0,Z=0;Z<g-1;Z++)for(U[Z]=y,l=0;l<1<<u[Z];l++)B[y++]=Z;for(B[y-1]=Z,Q=0,Z=0;Z<16;Z++)for(W[Z]=Q,l=0;l<1<<A[Z];l++)F[Q++]=Z;for(Q>>=7;Z<e;Z++)for(W[Z]=Q<<7,l=0;l<1<<A[Z]-7;l++)F[256+Q++]=Z;for(N=0;N<=o;N++)$[N]=0;for(l=0;l<=143;)P[l*2+1]=8,l++,$[8]++;for(;l<=255;)P[l*2+1]=9,l++,$[9]++;for(;l<=279;)P[l*2+1]=7,l++,$[7]++;for(;l<=287;)P[l*2+1]=8,l++,$[8]++;for(pe(P,r+1,$),l=0;l<e;l++)z[l*2+1]=5,z[l*2]=be(l,5);V=new I(P,u,v+1,r,o),ee=new I(z,A,0,e,o),te=new I(new Array(0),L,0,t,d)},ce=l=>{let N;for(N=0;N<r;N++)l.dyn_ltree[N*2]=0;for(N=0;N<e;N++)l.dyn_dtree[N*2]=0;for(N=0;N<t;N++)l.bl_tree[N*2]=0;l.dyn_ltree[i*2]=1,l.opt_len=l.static_len=0,l.sym_next=l.matches=0},Me=l=>{l.bi_valid>8?fe(l,l.bi_buf):l.bi_valid>0&&(l.pending_buf[l.pending++]=l.bi_buf),l.bi_buf=0,l.bi_valid=0},Fe=(l,N,y,Z)=>{const Q=N*2,$=y*2;return l[Q]<l[$]||l[Q]===l[$]&&Z[N]<=Z[y]},ze=(l,N,y)=>{const Z=l.heap[y];let Q=y<<1;for(;Q<=l.heap_len&&(Q<l.heap_len&&Fe(N,l.heap[Q+1],l.heap[Q],l.depth)&&Q++,!Fe(N,Z,l.heap[Q],l.depth));)l.heap[y]=l.heap[Q],y=Q,Q<<=1;l.heap[y]=Z},Be=(l,N,y)=>{let Z,Q,$=0,Ee,me;if(l.sym_next!==0)do Z=l.pending_buf[l.sym_buf+$++]&255,Z+=(l.pending_buf[l.sym_buf+$++]&255)<<8,Q=l.pending_buf[l.sym_buf+$++],Z===0?oe(l,Q,N):(Ee=B[Q],oe(l,Ee+v+1,N),me=u[Ee],me!==0&&(Q-=U[Ee],q(l,Q,me)),Z--,Ee=re(Z),oe(l,Ee,y),me=A[Ee],me!==0&&(Z-=W[Ee],q(l,Z,me)));while($<l.sym_next);oe(l,i,N)},Ue=(l,N)=>{const y=N.dyn_tree,Z=N.stat_desc.static_tree,Q=N.stat_desc.has_stree,$=N.stat_desc.elems;let Ee,me,Ye=-1,le;for(l.heap_len=0,l.heap_max=n,Ee=0;Ee<$;Ee++)y[Ee*2]!==0?(l.heap[++l.heap_len]=Ye=Ee,l.depth[Ee]=0):y[Ee*2+1]=0;for(;l.heap_len<2;)le=l.heap[++l.heap_len]=Ye<2?++Ye:0,y[le*2]=1,l.depth[le]=0,l.opt_len--,Q&&(l.static_len-=Z[le*2+1]);for(N.max_code=Ye,Ee=l.heap_len>>1;Ee>=1;Ee--)ze(l,y,Ee);le=$;do Ee=l.heap[1],l.heap[1]=l.heap[l.heap_len--],ze(l,y,1),me=l.heap[1],l.heap[--l.heap_max]=Ee,l.heap[--l.heap_max]=me,y[le*2]=y[Ee*2]+y[me*2],l.depth[le]=(l.depth[Ee]>=l.depth[me]?l.depth[Ee]:l.depth[me])+1,y[Ee*2+1]=y[me*2+1]=le,l.heap[1]=le++,ze(l,y,1);while(l.heap_len>=2);l.heap[--l.heap_max]=l.heap[1],Le(l,N),pe(y,Ye,l.bl_count)},Se=(l,N,y)=>{let Z,Q=-1,$,Ee=N[0*2+1],me=0,Ye=7,le=4;for(Ee===0&&(Ye=138,le=3),N[(y+1)*2+1]=65535,Z=0;Z<=y;Z++)$=Ee,Ee=N[(Z+1)*2+1],!(++me<Ye&&$===Ee)&&(me<le?l.bl_tree[$*2]+=me:$!==0?($!==Q&&l.bl_tree[$*2]++,l.bl_tree[s*2]++):me<=10?l.bl_tree[a*2]++:l.bl_tree[c*2]++,me=0,Q=$,Ee===0?(Ye=138,le=3):$===Ee?(Ye=6,le=3):(Ye=7,le=4))},Ie=(l,N,y)=>{let Z,Q=-1,$,Ee=N[0*2+1],me=0,Ye=7,le=4;for(Ee===0&&(Ye=138,le=3),Z=0;Z<=y;Z++)if($=Ee,Ee=N[(Z+1)*2+1],!(++me<Ye&&$===Ee)){if(me<le)do oe(l,$,l.bl_tree);while(--me!==0);else $!==0?($!==Q&&(oe(l,$,l.bl_tree),me--),oe(l,s,l.bl_tree),q(l,me-3,2)):me<=10?(oe(l,a,l.bl_tree),q(l,me-3,3)):(oe(l,c,l.bl_tree),q(l,me-11,7));me=0,Q=$,Ee===0?(Ye=138,le=3):$===Ee?(Ye=6,le=3):(Ye=7,le=4)}},Re=l=>{let N;for(Se(l,l.dyn_ltree,l.l_desc.max_code),Se(l,l.dyn_dtree,l.d_desc.max_code),Ue(l,l.bl_desc),N=t-1;N>=3&&l.bl_tree[D[N]*2+1]===0;N--);return l.opt_len+=3*(N+1)+5+5+4,N},Oe=(l,N,y,Z)=>{let Q;for(q(l,N-257,5),q(l,y-1,5),q(l,Z-4,4),Q=0;Q<Z;Q++)q(l,l.bl_tree[D[Q]*2+1],3);Ie(l,l.dyn_ltree,N-1),Ie(l,l.dyn_dtree,y-1)},Ge=l=>{let N=4093624447,y;for(y=0;y<=31;y++,N>>>=1)if(N&1&&l.dyn_ltree[y*2]!==0)return S;if(l.dyn_ltree[9*2]!==0||l.dyn_ltree[10*2]!==0||l.dyn_ltree[13*2]!==0)return w;for(y=32;y<v;y++)if(l.dyn_ltree[y*2]!==0)return w;return S};let Ve=!1;const j=l=>{Ve||(J(),Ve=!0),l.l_desc=new ae(l.dyn_ltree,V),l.d_desc=new ae(l.dyn_dtree,ee),l.bl_desc=new ae(l.bl_tree,te),l.bi_buf=0,l.bi_valid=0,ce(l)},Y=(l,N,y,Z)=>{q(l,(x<<1)+(Z?1:0),3),Me(l),fe(l,y),fe(l,~y),y&&l.pending_buf.set(l.window.subarray(N,N+y),l.pending),l.pending+=y},X=l=>{q(l,M<<1,3),oe(l,i,P),ge(l)},_e=(l,N,y,Z)=>{let Q,$,Ee=0;l.level>0?(l.strm.data_type===O&&(l.strm.data_type=Ge(l)),Ue(l,l.l_desc),Ue(l,l.d_desc),Ee=Re(l),Q=l.opt_len+3+7>>>3,$=l.static_len+3+7>>>3,$<=Q&&(Q=$)):Q=$=y+5,y+4<=Q&&N!==-1?Y(l,N,y,Z):l.strategy===E||$===Q?(q(l,(M<<1)+(Z?1:0),3),Be(l,P,z)):(q(l,(m<<1)+(Z?1:0),3),Oe(l,l.l_desc.max_code+1,l.d_desc.max_code+1,Ee+1),Be(l,l.dyn_ltree,l.dyn_dtree)),ce(l),Z&&Me(l)},ue=(l,N,y)=>(l.pending_buf[l.sym_buf+l.sym_next++]=N,l.pending_buf[l.sym_buf+l.sym_next++]=N>>8,l.pending_buf[l.sym_buf+l.sym_next++]=y,N===0?l.dyn_ltree[y*2]++:(l.matches++,N--,l.dyn_ltree[(B[y]+v+1)*2]++,l.dyn_dtree[re(N)*2]++),l.sym_next===l.sym_end);var we=j,De=Y,G=_e,se=ue,ve=X,Te={_tr_init:we,_tr_stored_block:De,_tr_flush_block:G,_tr_tally:se,_tr_align:ve},ye=(l,N,y,Z)=>{let Q=l&65535|0,$=l>>>16&65535|0,Ee=0;for(;y!==0;){Ee=y>2e3?2e3:y,y-=Ee;do Q=Q+N[Z++]|0,$=$+Q|0;while(--Ee);Q%=65521,$%=65521}return Q|$<<16|0};const k=()=>{let l,N=[];for(var y=0;y<256;y++){l=y;for(var Z=0;Z<8;Z++)l=l&1?3988292384^l>>>1:l>>>1;N[y]=l}return N},Ce=new Uint32Array(k());var T=(l,N,y,Z)=>{const Q=Ce,$=Z+y;l^=-1;for(let Ee=Z;Ee<$;Ee++)l=l>>>8^Q[(l^N[Ee])&255];return l^-1},de={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"},he={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_MEM_ERROR:-4,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8};const{_tr_init:H,_tr_stored_block:ne,_tr_flush_block:xe,_tr_tally:je,_tr_align:ke}=Te,{Z_NO_FLUSH:Ne,Z_PARTIAL_FLUSH:Qe,Z_FULL_FLUSH:_t,Z_FINISH:et,Z_BLOCK:Ze,Z_OK:Xe,Z_STREAM_END:at,Z_STREAM_ERROR:nt,Z_DATA_ERROR:Mt,Z_BUF_ERROR:mt,Z_DEFAULT_COMPRESSION:it,Z_FILTERED:tt,Z_HUFFMAN_ONLY:qe,Z_RLE:vt,Z_FIXED:xt,Z_DEFAULT_STRATEGY:At,Z_UNKNOWN:Ct,Z_DEFLATED:Dt}=he,Pt=9,Yt=15,di=8,Mi=256+1+29,Xr=30,$r=19,Jr=2*Mi+1,Qr=15,lt=3,Ut=258,It=Ut+lt+1,qr=32,Zt=42,wi=57,Ci=69,Di=73,Ti=91,Li=103,Gt=113,ei=666,Tt=1,Xt=2,Vt=3,$t=4,en=3,kt=(l,N)=>(l.msg=de[N],N),Vi=l=>l*2-(l>4?9:0),Wt=l=>{let N=l.length;for(;--N>=0;)l[N]=0},tn=l=>{let N,y,Z,Q=l.w_size;N=l.hash_size,Z=N;do y=l.head[--Z],l.head[Z]=y>=Q?y-Q:0;while(--N);N=Q,Z=N;do y=l.prev[--Z],l.prev[Z]=y>=Q?y-Q:0;while(--N)};let Nt=(l,N,y)=>(N<<l.hash_shift^y)&l.hash_mask;const Lt=l=>{const N=l.state;let y=N.pending;y>l.avail_out&&(y=l.avail_out),y!==0&&(l.output.set(N.pending_buf.subarray(N.pending_out,N.pending_out+y),l.next_out),l.next_out+=y,N.pending_out+=y,l.total_out+=y,l.avail_out-=y,N.pending-=y,N.pending===0&&(N.pending_out=0))},Ot=(l,N)=>{xe(l,l.block_start>=0?l.block_start:-1,l.strstart-l.block_start,N),l.block_start=l.strstart,Lt(l.strm)},ut=(l,N)=>{l.pending_buf[l.pending++]=N},ti=(l,N)=>{l.pending_buf[l.pending++]=N>>>8&255,l.pending_buf[l.pending++]=N&255},Oi=(l,N,y,Z)=>{let Q=l.avail_in;return Q>Z&&(Q=Z),Q===0?0:(l.avail_in-=Q,N.set(l.input.subarray(l.next_in,l.next_in+Q),y),l.state.wrap===1?l.adler=ye(l.adler,N,Q,y):l.state.wrap===2&&(l.adler=T(l.adler,N,Q,y)),l.next_in+=Q,l.total_in+=Q,Q)},ki=(l,N)=>{let y=l.max_chain_length,Z=l.strstart,Q,$,Ee=l.prev_length,me=l.nice_match;const Ye=l.strstart>l.w_size-It?l.strstart-(l.w_size-It):0,le=l.window,Ae=l.w_mask,ct=l.prev,Ke=l.strstart+Ut;let We=le[Z+Ee-1],$e=le[Z+Ee];l.prev_length>=l.good_match&&(y>>=2),me>l.lookahead&&(me=l.lookahead);do if(Q=N,!(le[Q+Ee]!==$e||le[Q+Ee-1]!==We||le[Q]!==le[Z]||le[++Q]!==le[Z+1])){Z+=2,Q++;do;while(le[++Z]===le[++Q]&&le[++Z]===le[++Q]&&le[++Z]===le[++Q]&&le[++Z]===le[++Q]&&le[++Z]===le[++Q]&&le[++Z]===le[++Q]&&le[++Z]===le[++Q]&&le[++Z]===le[++Q]&&Z<Ke);if($=Ut-(Ke-Z),Z=Ke-Ut,$>Ee){if(l.match_start=N,Ee=$,$>=me)break;We=le[Z+Ee-1],$e=le[Z+Ee]}}while((N=ct[N&Ae])>Ye&&--y!==0);return Ee<=l.lookahead?Ee:l.lookahead},Jt=l=>{const N=l.w_size;let y,Z,Q;do{if(Z=l.window_size-l.lookahead-l.strstart,l.strstart>=N+(N-It)&&(l.window.set(l.window.subarray(N,N+N-Z),0),l.match_start-=N,l.strstart-=N,l.block_start-=N,l.insert>l.strstart&&(l.insert=l.strstart),tn(l),Z+=N),l.strm.avail_in===0)break;if(y=Oi(l.strm,l.window,l.strstart+l.lookahead,Z),l.lookahead+=y,l.lookahead+l.insert>=lt)for(Q=l.strstart-l.insert,l.ins_h=l.window[Q],l.ins_h=Nt(l,l.ins_h,l.window[Q+1]);l.insert&&(l.ins_h=Nt(l,l.ins_h,l.window[Q+lt-1]),l.prev[Q&l.w_mask]=l.head[l.ins_h],l.head[l.ins_h]=Q,Q++,l.insert--,!(l.lookahead+l.insert<lt)););}while(l.lookahead<It&&l.strm.avail_in!==0)},ji=(l,N)=>{let y=l.pending_buf_size-5>l.w_size?l.w_size:l.pending_buf_size-5,Z,Q,$,Ee=0,me=l.strm.avail_in;do{if(Z=65535,$=l.bi_valid+42>>3,l.strm.avail_out<$||($=l.strm.avail_out-$,Q=l.strstart-l.block_start,Z>Q+l.strm.avail_in&&(Z=Q+l.strm.avail_in),Z>$&&(Z=$),Z<y&&(Z===0&&N!==et||N===Ne||Z!==Q+l.strm.avail_in)))break;Ee=N===et&&Z===Q+l.strm.avail_in?1:0,ne(l,0,0,Ee),l.pending_buf[l.pending-4]=Z,l.pending_buf[l.pending-3]=Z>>8,l.pending_buf[l.pending-2]=~Z,l.pending_buf[l.pending-1]=~Z>>8,Lt(l.strm),Q&&(Q>Z&&(Q=Z),l.strm.output.set(l.window.subarray(l.block_start,l.block_start+Q),l.strm.next_out),l.strm.next_out+=Q,l.strm.avail_out-=Q,l.strm.total_out+=Q,l.block_start+=Q,Z-=Q),Z&&(Oi(l.strm,l.strm.output,l.strm.next_out,Z),l.strm.next_out+=Z,l.strm.avail_out-=Z,l.strm.total_out+=Z)}while(Ee===0);return me-=l.strm.avail_in,me&&(me>=l.w_size?(l.matches=2,l.window.set(l.strm.input.subarray(l.strm.next_in-l.w_size,l.strm.next_in),0),l.strstart=l.w_size,l.insert=l.strstart):(l.window_size-l.strstart<=me&&(l.strstart-=l.w_size,l.window.set(l.window.subarray(l.w_size,l.w_size+l.strstart),0),l.matches<2&&l.matches++,l.insert>l.strstart&&(l.insert=l.strstart)),l.window.set(l.strm.input.subarray(l.strm.next_in-me,l.strm.next_in),l.strstart),l.strstart+=me,l.insert+=me>l.w_size-l.insert?l.w_size-l.insert:me),l.block_start=l.strstart),l.high_water<l.strstart&&(l.high_water=l.strstart),Ee?$t:N!==Ne&&N!==et&&l.strm.avail_in===0&&l.strstart===l.block_start?Xt:($=l.window_size-l.strstart,l.strm.avail_in>$&&l.block_start>=l.w_size&&(l.block_start-=l.w_size,l.strstart-=l.w_size,l.window.set(l.window.subarray(l.w_size,l.w_size+l.strstart),0),l.matches<2&&l.matches++,$+=l.w_size,l.insert>l.strstart&&(l.insert=l.strstart)),$>l.strm.avail_in&&($=l.strm.avail_in),$&&(Oi(l.strm,l.window,l.strstart,$),l.strstart+=$,l.insert+=$>l.w_size-l.insert?l.w_size-l.insert:$),l.high_water<l.strstart&&(l.high_water=l.strstart),$=l.bi_valid+42>>3,$=l.pending_buf_size-$>65535?65535:l.pending_buf_size-$,y=$>l.w_size?l.w_size:$,Q=l.strstart-l.block_start,(Q>=y||(Q||N===et)&&N!==Ne&&l.strm.avail_in===0&&Q<=$)&&(Z=Q>$?$:Q,Ee=N===et&&l.strm.avail_in===0&&Z===Q?1:0,ne(l,l.block_start,Z,Ee),l.block_start+=Z,Lt(l.strm)),Ee?Vt:Tt)},Si=(l,N)=>{let y,Z;for(;;){if(l.lookahead<It){if(Jt(l),l.lookahead<It&&N===Ne)return Tt;if(l.lookahead===0)break}if(y=0,l.lookahead>=lt&&(l.ins_h=Nt(l,l.ins_h,l.window[l.strstart+lt-1]),y=l.prev[l.strstart&l.w_mask]=l.head[l.ins_h],l.head[l.ins_h]=l.strstart),y!==0&&l.strstart-y<=l.w_size-It&&(l.match_length=ki(l,y)),l.match_length>=lt)if(Z=je(l,l.strstart-l.match_start,l.match_length-lt),l.lookahead-=l.match_length,l.match_length<=l.max_lazy_match&&l.lookahead>=lt){l.match_length--;do l.strstart++,l.ins_h=Nt(l,l.ins_h,l.window[l.strstart+lt-1]),y=l.prev[l.strstart&l.w_mask]=l.head[l.ins_h],l.head[l.ins_h]=l.strstart;while(--l.match_length!==0);l.strstart++}else l.strstart+=l.match_length,l.match_length=0,l.ins_h=l.window[l.strstart],l.ins_h=Nt(l,l.ins_h,l.window[l.strstart+1]);else Z=je(l,0,l.window[l.strstart]),l.lookahead--,l.strstart++;if(Z&&(Ot(l,!1),l.strm.avail_out===0))return Tt}return l.insert=l.strstart<lt-1?l.strstart:lt-1,N===et?(Ot(l,!0),l.strm.avail_out===0?Vt:$t):l.sym_next&&(Ot(l,!1),l.strm.avail_out===0)?Tt:Xt},Qt=(l,N)=>{let y,Z,Q;for(;;){if(l.lookahead<It){if(Jt(l),l.lookahead<It&&N===Ne)return Tt;if(l.lookahead===0)break}if(y=0,l.lookahead>=lt&&(l.ins_h=Nt(l,l.ins_h,l.window[l.strstart+lt-1]),y=l.prev[l.strstart&l.w_mask]=l.head[l.ins_h],l.head[l.ins_h]=l.strstart),l.prev_length=l.match_length,l.prev_match=l.match_start,l.match_length=lt-1,y!==0&&l.prev_length<l.max_lazy_match&&l.strstart-y<=l.w_size-It&&(l.match_length=ki(l,y),l.match_length<=5&&(l.strategy===tt||l.match_length===lt&&l.strstart-l.match_start>4096)&&(l.match_length=lt-1)),l.prev_length>=lt&&l.match_length<=l.prev_length){Q=l.strstart+l.lookahead-lt,Z=je(l,l.strstart-1-l.prev_match,l.prev_length-lt),l.lookahead-=l.prev_length-1,l.prev_length-=2;do++l.strstart<=Q&&(l.ins_h=Nt(l,l.ins_h,l.window[l.strstart+lt-1]),y=l.prev[l.strstart&l.w_mask]=l.head[l.ins_h],l.head[l.ins_h]=l.strstart);while(--l.prev_length!==0);if(l.match_available=0,l.match_length=lt-1,l.strstart++,Z&&(Ot(l,!1),l.strm.avail_out===0))return Tt}else if(l.match_available){if(Z=je(l,0,l.window[l.strstart-1]),Z&&Ot(l,!1),l.strstart++,l.lookahead--,l.strm.avail_out===0)return Tt}else l.match_available=1,l.strstart++,l.lookahead--}return l.match_available&&(Z=je(l,0,l.window[l.strstart-1]),l.match_available=0),l.insert=l.strstart<lt-1?l.strstart:lt-1,N===et?(Ot(l,!0),l.strm.avail_out===0?Vt:$t):l.sym_next&&(Ot(l,!1),l.strm.avail_out===0)?Tt:Xt},rn=(l,N)=>{let y,Z,Q,$;const Ee=l.window;for(;;){if(l.lookahead<=Ut){if(Jt(l),l.lookahead<=Ut&&N===Ne)return Tt;if(l.lookahead===0)break}if(l.match_length=0,l.lookahead>=lt&&l.strstart>0&&(Q=l.strstart-1,Z=Ee[Q],Z===Ee[++Q]&&Z===Ee[++Q]&&Z===Ee[++Q])){$=l.strstart+Ut;do;while(Z===Ee[++Q]&&Z===Ee[++Q]&&Z===Ee[++Q]&&Z===Ee[++Q]&&Z===Ee[++Q]&&Z===Ee[++Q]&&Z===Ee[++Q]&&Z===Ee[++Q]&&Q<$);l.match_length=Ut-($-Q),l.match_length>l.lookahead&&(l.match_length=l.lookahead)}if(l.match_length>=lt?(y=je(l,1,l.match_length-lt),l.lookahead-=l.match_length,l.strstart+=l.match_length,l.match_length=0):(y=je(l,0,l.window[l.strstart]),l.lookahead--,l.strstart++),y&&(Ot(l,!1),l.strm.avail_out===0))return Tt}return l.insert=0,N===et?(Ot(l,!0),l.strm.avail_out===0?Vt:$t):l.sym_next&&(Ot(l,!1),l.strm.avail_out===0)?Tt:Xt},nn=(l,N)=>{let y;for(;;){if(l.lookahead===0&&(Jt(l),l.lookahead===0)){if(N===Ne)return Tt;break}if(l.match_length=0,y=je(l,0,l.window[l.strstart]),l.lookahead--,l.strstart++,y&&(Ot(l,!1),l.strm.avail_out===0))return Tt}return l.insert=0,N===et?(Ot(l,!0),l.strm.avail_out===0?Vt:$t):l.sym_next&&(Ot(l,!1),l.strm.avail_out===0)?Tt:Xt};function zt(l,N,y,Z,Q){this.good_length=l,this.max_lazy=N,this.nice_length=y,this.max_chain=Z,this.func=Q}const ii=[new zt(0,0,0,0,ji),new zt(4,4,8,4,Si),new zt(4,5,16,8,Si),new zt(4,6,32,32,Si),new zt(4,4,16,16,Qt),new zt(8,16,32,32,Qt),new zt(8,16,128,128,Qt),new zt(8,32,128,256,Qt),new zt(32,128,258,1024,Qt),new zt(32,258,258,4096,Qt)],sn=l=>{l.window_size=2*l.w_size,Wt(l.head),l.max_lazy_match=ii[l.level].max_lazy,l.good_match=ii[l.level].good_length,l.nice_match=ii[l.level].nice_length,l.max_chain_length=ii[l.level].max_chain,l.strstart=0,l.block_start=0,l.lookahead=0,l.insert=0,l.match_length=l.prev_length=lt-1,l.match_available=0,l.ins_h=0};function an(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=Dt,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new Uint16Array(Jr*2),this.dyn_dtree=new Uint16Array((2*Xr+1)*2),this.bl_tree=new Uint16Array((2*$r+1)*2),Wt(this.dyn_ltree),Wt(this.dyn_dtree),Wt(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new Uint16Array(Qr+1),this.heap=new Uint16Array(2*Mi+1),Wt(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new Uint16Array(2*Mi+1),Wt(this.depth),this.sym_buf=0,this.lit_bufsize=0,this.sym_next=0,this.sym_end=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}const ri=l=>{if(!l)return 1;const N=l.state;return!N||N.strm!==l||N.status!==Zt&&N.status!==wi&&N.status!==Ci&&N.status!==Di&&N.status!==Ti&&N.status!==Li&&N.status!==Gt&&N.status!==ei?1:0},Hi=l=>{if(ri(l))return kt(l,nt);l.total_in=l.total_out=0,l.data_type=Ct;const N=l.state;return N.pending=0,N.pending_out=0,N.wrap<0&&(N.wrap=-N.wrap),N.status=N.wrap===2?wi:N.wrap?Zt:Gt,l.adler=N.wrap===2?0:1,N.last_flush=-2,H(N),Xe},Ki=l=>{const N=Hi(l);return N===Xe&&sn(l.state),N},on=(l,N)=>ri(l)||l.state.wrap!==2?nt:(l.state.gzhead=N,Xe),Yi=(l,N,y,Z,Q,$)=>{if(!l)return nt;let Ee=1;if(N===it&&(N=6),Z<0?(Ee=0,Z=-Z):Z>15&&(Ee=2,Z-=16),Q<1||Q>Pt||y!==Dt||Z<8||Z>15||N<0||N>9||$<0||$>xt||Z===8&&Ee!==1)return kt(l,nt);Z===8&&(Z=9);const me=new an;return l.state=me,me.strm=l,me.status=Zt,me.wrap=Ee,me.gzhead=null,me.w_bits=Z,me.w_size=1<<me.w_bits,me.w_mask=me.w_size-1,me.hash_bits=Q+7,me.hash_size=1<<me.hash_bits,me.hash_mask=me.hash_size-1,me.hash_shift=~~((me.hash_bits+lt-1)/lt),me.window=new Uint8Array(me.w_size*2),me.head=new Uint16Array(me.hash_size),me.prev=new Uint16Array(me.w_size),me.lit_bufsize=1<<Q+6,me.pending_buf_size=me.lit_bufsize*4,me.pending_buf=new Uint8Array(me.pending_buf_size),me.sym_buf=me.lit_bufsize,me.sym_end=(me.lit_bufsize-1)*3,me.level=N,me.strategy=$,me.method=y,Ki(l)},ln=(l,N)=>Yi(l,N,Dt,Yt,di,At),hn=(l,N)=>{if(ri(l)||N>Ze||N<0)return l?kt(l,nt):nt;const y=l.state;if(!l.output||l.avail_in!==0&&!l.input||y.status===ei&&N!==et)return kt(l,l.avail_out===0?mt:nt);const Z=y.last_flush;if(y.last_flush=N,y.pending!==0){if(Lt(l),l.avail_out===0)return y.last_flush=-1,Xe}else if(l.avail_in===0&&Vi(N)<=Vi(Z)&&N!==et)return kt(l,mt);if(y.status===ei&&l.avail_in!==0)return kt(l,mt);if(y.status===Zt&&y.wrap===0&&(y.status=Gt),y.status===Zt){let Q=Dt+(y.w_bits-8<<4)<<8,$=-1;if(y.strategy>=qe||y.level<2?$=0:y.level<6?$=1:y.level===6?$=2:$=3,Q|=$<<6,y.strstart!==0&&(Q|=qr),Q+=31-Q%31,ti(y,Q),y.strstart!==0&&(ti(y,l.adler>>>16),ti(y,l.adler&65535)),l.adler=1,y.status=Gt,Lt(l),y.pending!==0)return y.last_flush=-1,Xe}if(y.status===wi){if(l.adler=0,ut(y,31),ut(y,139),ut(y,8),y.gzhead)ut(y,(y.gzhead.text?1:0)+(y.gzhead.hcrc?2:0)+(y.gzhead.extra?4:0)+(y.gzhead.name?8:0)+(y.gzhead.comment?16:0)),ut(y,y.gzhead.time&255),ut(y,y.gzhead.time>>8&255),ut(y,y.gzhead.time>>16&255),ut(y,y.gzhead.time>>24&255),ut(y,y.level===9?2:y.strategy>=qe||y.level<2?4:0),ut(y,y.gzhead.os&255),y.gzhead.extra&&y.gzhead.extra.length&&(ut(y,y.gzhead.extra.length&255),ut(y,y.gzhead.extra.length>>8&255)),y.gzhead.hcrc&&(l.adler=T(l.adler,y.pending_buf,y.pending,0)),y.gzindex=0,y.status=Ci;else if(ut(y,0),ut(y,0),ut(y,0),ut(y,0),ut(y,0),ut(y,y.level===9?2:y.strategy>=qe||y.level<2?4:0),ut(y,en),y.status=Gt,Lt(l),y.pending!==0)return y.last_flush=-1,Xe}if(y.status===Ci){if(y.gzhead.extra){let Q=y.pending,$=(y.gzhead.extra.length&65535)-y.gzindex;for(;y.pending+$>y.pending_buf_size;){let me=y.pending_buf_size-y.pending;if(y.pending_buf.set(y.gzhead.extra.subarray(y.gzindex,y.gzindex+me),y.pending),y.pending=y.pending_buf_size,y.gzhead.hcrc&&y.pending>Q&&(l.adler=T(l.adler,y.pending_buf,y.pending-Q,Q)),y.gzindex+=me,Lt(l),y.pending!==0)return y.last_flush=-1,Xe;Q=0,$-=me}let Ee=new Uint8Array(y.gzhead.extra);y.pending_buf.set(Ee.subarray(y.gzindex,y.gzindex+$),y.pending),y.pending+=$,y.gzhead.hcrc&&y.pending>Q&&(l.adler=T(l.adler,y.pending_buf,y.pending-Q,Q)),y.gzindex=0}y.status=Di}if(y.status===Di){if(y.gzhead.name){let Q=y.pending,$;do{if(y.pending===y.pending_buf_size){if(y.gzhead.hcrc&&y.pending>Q&&(l.adler=T(l.adler,y.pending_buf,y.pending-Q,Q)),Lt(l),y.pending!==0)return y.last_flush=-1,Xe;Q=0}y.gzindex<y.gzhead.name.length?$=y.gzhead.name.charCodeAt(y.gzindex++)&255:$=0,ut(y,$)}while($!==0);y.gzhead.hcrc&&y.pending>Q&&(l.adler=T(l.adler,y.pending_buf,y.pending-Q,Q)),y.gzindex=0}y.status=Ti}if(y.status===Ti){if(y.gzhead.comment){let Q=y.pending,$;do{if(y.pending===y.pending_buf_size){if(y.gzhead.hcrc&&y.pending>Q&&(l.adler=T(l.adler,y.pending_buf,y.pending-Q,Q)),Lt(l),y.pending!==0)return y.last_flush=-1,Xe;Q=0}y.gzindex<y.gzhead.comment.length?$=y.gzhead.comment.charCodeAt(y.gzindex++)&255:$=0,ut(y,$)}while($!==0);y.gzhead.hcrc&&y.pending>Q&&(l.adler=T(l.adler,y.pending_buf,y.pending-Q,Q))}y.status=Li}if(y.status===Li){if(y.gzhead.hcrc){if(y.pending+2>y.pending_buf_size&&(Lt(l),y.pending!==0))return y.last_flush=-1,Xe;ut(y,l.adler&255),ut(y,l.adler>>8&255),l.adler=0}if(y.status=Gt,Lt(l),y.pending!==0)return y.last_flush=-1,Xe}if(l.avail_in!==0||y.lookahead!==0||N!==Ne&&y.status!==ei){let Q=y.level===0?ji(y,N):y.strategy===qe?nn(y,N):y.strategy===vt?rn(y,N):ii[y.level].func(y,N);if((Q===Vt||Q===$t)&&(y.status=ei),Q===Tt||Q===Vt)return l.avail_out===0&&(y.last_flush=-1),Xe;if(Q===Xt&&(N===Qe?ke(y):N!==Ze&&(ne(y,0,0,!1),N===_t&&(Wt(y.head),y.lookahead===0&&(y.strstart=0,y.block_start=0,y.insert=0))),Lt(l),l.avail_out===0))return y.last_flush=-1,Xe}return N!==et?Xe:y.wrap<=0?at:(y.wrap===2?(ut(y,l.adler&255),ut(y,l.adler>>8&255),ut(y,l.adler>>16&255),ut(y,l.adler>>24&255),ut(y,l.total_in&255),ut(y,l.total_in>>8&255),ut(y,l.total_in>>16&255),ut(y,l.total_in>>24&255)):(ti(y,l.adler>>>16),ti(y,l.adler&65535)),Lt(l),y.wrap>0&&(y.wrap=-y.wrap),y.pending!==0?Xe:at)},fn=l=>{if(ri(l))return nt;const N=l.state.status;return l.state=null,N===Gt?kt(l,Mt):Xe},dn=(l,N)=>{let y=N.length;if(ri(l))return nt;const Z=l.state,Q=Z.wrap;if(Q===2||Q===1&&Z.status!==Zt||Z.lookahead)return nt;if(Q===1&&(l.adler=ye(l.adler,N,y,0)),Z.wrap=0,y>=Z.w_size){Q===0&&(Wt(Z.head),Z.strstart=0,Z.block_start=0,Z.insert=0);let Ye=new Uint8Array(Z.w_size);Ye.set(N.subarray(y-Z.w_size,y),0),N=Ye,y=Z.w_size}const $=l.avail_in,Ee=l.next_in,me=l.input;for(l.avail_in=y,l.next_in=0,l.input=N,Jt(Z);Z.lookahead>=lt;){let Ye=Z.strstart,le=Z.lookahead-(lt-1);do Z.ins_h=Nt(Z,Z.ins_h,Z.window[Ye+lt-1]),Z.prev[Ye&Z.w_mask]=Z.head[Z.ins_h],Z.head[Z.ins_h]=Ye,Ye++;while(--le);Z.strstart=Ye,Z.lookahead=lt-1,Jt(Z)}return Z.strstart+=Z.lookahead,Z.block_start=Z.strstart,Z.insert=Z.lookahead,Z.lookahead=0,Z.match_length=Z.prev_length=lt-1,Z.match_available=0,l.next_in=Ee,l.input=me,l.avail_in=$,Z.wrap=Q,Xe};var cn=ln,un=Yi,gn=Ki,mn=Hi,vn=on,pn=hn,_n=fn,xn=dn,bn="pako deflate (from Nodeca project)",ni={deflateInit:cn,deflateInit2:un,deflateReset:gn,deflateResetKeep:mn,deflateSetHeader:vn,deflate:pn,deflateEnd:_n,deflateSetDictionary:xn,deflateInfo:bn};const yn=(l,N)=>Object.prototype.hasOwnProperty.call(l,N);var En=function(l){const N=Array.prototype.slice.call(arguments,1);for(;N.length;){const y=N.shift();if(y){if(typeof y!="object")throw new TypeError(y+"must be non-object");for(const Z in y)yn(y,Z)&&(l[Z]=y[Z])}}return l},An=l=>{let N=0;for(let Z=0,Q=l.length;Z<Q;Z++)N+=l[Z].length;const y=new Uint8Array(N);for(let Z=0,Q=0,$=l.length;Z<$;Z++){let Ee=l[Z];y.set(Ee,Q),Q+=Ee.length}return y},gi={assign:En,flattenChunks:An};let Zi=!0;try{String.fromCharCode.apply(null,new Uint8Array(1))}catch{Zi=!1}const si=new Uint8Array(256);for(let l=0;l<256;l++)si[l]=l>=252?6:l>=248?5:l>=240?4:l>=224?3:l>=192?2:1;si[254]=si[254]=1;var Mn=l=>{if(typeof TextEncoder=="function"&&TextEncoder.prototype.encode)return new TextEncoder().encode(l);let N,y,Z,Q,$,Ee=l.length,me=0;for(Q=0;Q<Ee;Q++)y=l.charCodeAt(Q),(y&64512)===55296&&Q+1<Ee&&(Z=l.charCodeAt(Q+1),(Z&64512)===56320&&(y=65536+(y-55296<<10)+(Z-56320),Q++)),me+=y<128?1:y<2048?2:y<65536?3:4;for(N=new Uint8Array(me),$=0,Q=0;$<me;Q++)y=l.charCodeAt(Q),(y&64512)===55296&&Q+1<Ee&&(Z=l.charCodeAt(Q+1),(Z&64512)===56320&&(y=65536+(y-55296<<10)+(Z-56320),Q++)),y<128?N[$++]=y:y<2048?(N[$++]=192|y>>>6,N[$++]=128|y&63):y<65536?(N[$++]=224|y>>>12,N[$++]=128|y>>>6&63,N[$++]=128|y&63):(N[$++]=240|y>>>18,N[$++]=128|y>>>12&63,N[$++]=128|y>>>6&63,N[$++]=128|y&63);return N};const wn=(l,N)=>{if(N<65534&&l.subarray&&Zi)return String.fromCharCode.apply(null,l.length===N?l:l.subarray(0,N));let y="";for(let Z=0;Z<N;Z++)y+=String.fromCharCode(l[Z]);return y};var Cn=(l,N)=>{const y=N||l.length;if(typeof TextDecoder=="function"&&TextDecoder.prototype.decode)return new TextDecoder().decode(l.subarray(0,N));let Z,Q;const $=new Array(y*2);for(Q=0,Z=0;Z<y;){let Ee=l[Z++];if(Ee<128){$[Q++]=Ee;continue}let me=si[Ee];if(me>4){$[Q++]=65533,Z+=me-1;continue}for(Ee&=me===2?31:me===3?15:7;me>1&&Z<y;)Ee=Ee<<6|l[Z++]&63,me--;if(me>1){$[Q++]=65533;continue}Ee<65536?$[Q++]=Ee:(Ee-=65536,$[Q++]=55296|Ee>>10&1023,$[Q++]=56320|Ee&1023)}return wn($,Q)},Dn=(l,N)=>{N=N||l.length,N>l.length&&(N=l.length);let y=N-1;for(;y>=0&&(l[y]&192)===128;)y--;return y<0||y===0?N:y+si[l[y]]>N?y:N},ai={string2buf:Mn,buf2string:Cn,utf8border:Dn};function Tn(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}var Xi=Tn;const $i=Object.prototype.toString,{Z_NO_FLUSH:Ln,Z_SYNC_FLUSH:On,Z_FULL_FLUSH:Sn,Z_FINISH:Rn,Z_OK:mi,Z_STREAM_END:Pn,Z_DEFAULT_COMPRESSION:In,Z_DEFAULT_STRATEGY:zn,Z_DEFLATED:Fn}=he;function oi(l){this.options=gi.assign({level:In,method:Fn,chunkSize:16384,windowBits:15,memLevel:8,strategy:zn},l||{});let N=this.options;N.raw&&N.windowBits>0?N.windowBits=-N.windowBits:N.gzip&&N.windowBits>0&&N.windowBits<16&&(N.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new Xi,this.strm.avail_out=0;let y=ni.deflateInit2(this.strm,N.level,N.method,N.windowBits,N.memLevel,N.strategy);if(y!==mi)throw new Error(de[y]);if(N.header&&ni.deflateSetHeader(this.strm,N.header),N.dictionary){let Z;if(typeof N.dictionary=="string"?Z=ai.string2buf(N.dictionary):$i.call(N.dictionary)==="[object ArrayBuffer]"?Z=new Uint8Array(N.dictionary):Z=N.dictionary,y=ni.deflateSetDictionary(this.strm,Z),y!==mi)throw new Error(de[y]);this._dict_set=!0}}oi.prototype.push=function(l,N){const y=this.strm,Z=this.options.chunkSize;let Q,$;if(this.ended)return!1;for(N===~~N?$=N:$=N===!0?Rn:Ln,typeof l=="string"?y.input=ai.string2buf(l):$i.call(l)==="[object ArrayBuffer]"?y.input=new Uint8Array(l):y.input=l,y.next_in=0,y.avail_in=y.input.length;;){if(y.avail_out===0&&(y.output=new Uint8Array(Z),y.next_out=0,y.avail_out=Z),($===On||$===Sn)&&y.avail_out<=6){this.onData(y.output.subarray(0,y.next_out)),y.avail_out=0;continue}if(Q=ni.deflate(y,$),Q===Pn)return y.next_out>0&&this.onData(y.output.subarray(0,y.next_out)),Q=ni.deflateEnd(this.strm),this.onEnd(Q),this.ended=!0,Q===mi;if(y.avail_out===0){this.onData(y.output);continue}if($>0&&y.next_out>0){this.onData(y.output.subarray(0,y.next_out)),y.avail_out=0;continue}if(y.avail_in===0)break}return!0},oi.prototype.onData=function(l){this.chunks.push(l)},oi.prototype.onEnd=function(l){l===mi&&(this.result=gi.flattenChunks(this.chunks)),this.chunks=[],this.err=l,this.msg=this.strm.msg};function Ri(l,N){const y=new oi(N);if(y.push(l,!0),y.err)throw y.msg||de[y.err];return y.result}function Bn(l,N){return N=N||{},N.raw=!0,Ri(l,N)}function Un(l,N){return N=N||{},N.gzip=!0,Ri(l,N)}var Wn=oi,Nn=Ri,Gn=Bn,Vn=Un,kn=he,jn={Deflate:Wn,deflate:Nn,deflateRaw:Gn,gzip:Vn,constants:kn};const vi=16209,Hn=16191;var Kn=function(N,y){let Z,Q,$,Ee,me,Ye,le,Ae,ct,Ke,We,$e,Et,ft,st,pt,ot,He,gt,wt,Je,bt,dt,rt;const ht=N.state;Z=N.next_in,dt=N.input,Q=Z+(N.avail_in-5),$=N.next_out,rt=N.output,Ee=$-(y-N.avail_out),me=$+(N.avail_out-257),Ye=ht.dmax,le=ht.wsize,Ae=ht.whave,ct=ht.wnext,Ke=ht.window,We=ht.hold,$e=ht.bits,Et=ht.lencode,ft=ht.distcode,st=(1<<ht.lenbits)-1,pt=(1<<ht.distbits)-1;e:do{$e<15&&(We+=dt[Z++]<<$e,$e+=8,We+=dt[Z++]<<$e,$e+=8),ot=Et[We&st];t:for(;;){if(He=ot>>>24,We>>>=He,$e-=He,He=ot>>>16&255,He===0)rt[$++]=ot&65535;else if(He&16){gt=ot&65535,He&=15,He&&($e<He&&(We+=dt[Z++]<<$e,$e+=8),gt+=We&(1<<He)-1,We>>>=He,$e-=He),$e<15&&(We+=dt[Z++]<<$e,$e+=8,We+=dt[Z++]<<$e,$e+=8),ot=ft[We&pt];i:for(;;){if(He=ot>>>24,We>>>=He,$e-=He,He=ot>>>16&255,He&16){if(wt=ot&65535,He&=15,$e<He&&(We+=dt[Z++]<<$e,$e+=8,$e<He&&(We+=dt[Z++]<<$e,$e+=8)),wt+=We&(1<<He)-1,wt>Ye){N.msg="invalid distance too far back",ht.mode=vi;break e}if(We>>>=He,$e-=He,He=$-Ee,wt>He){if(He=wt-He,He>Ae&&ht.sane){N.msg="invalid distance too far back",ht.mode=vi;break e}if(Je=0,bt=Ke,ct===0){if(Je+=le-He,He<gt){gt-=He;do rt[$++]=Ke[Je++];while(--He);Je=$-wt,bt=rt}}else if(ct<He){if(Je+=le+ct-He,He-=ct,He<gt){gt-=He;do rt[$++]=Ke[Je++];while(--He);if(Je=0,ct<gt){He=ct,gt-=He;do rt[$++]=Ke[Je++];while(--He);Je=$-wt,bt=rt}}}else if(Je+=ct-He,He<gt){gt-=He;do rt[$++]=Ke[Je++];while(--He);Je=$-wt,bt=rt}for(;gt>2;)rt[$++]=bt[Je++],rt[$++]=bt[Je++],rt[$++]=bt[Je++],gt-=3;gt&&(rt[$++]=bt[Je++],gt>1&&(rt[$++]=bt[Je++]))}else{Je=$-wt;do rt[$++]=rt[Je++],rt[$++]=rt[Je++],rt[$++]=rt[Je++],gt-=3;while(gt>2);gt&&(rt[$++]=rt[Je++],gt>1&&(rt[$++]=rt[Je++]))}}else if(He&64){N.msg="invalid distance code",ht.mode=vi;break e}else{ot=ft[(ot&65535)+(We&(1<<He)-1)];continue i}break}}else if(He&64)if(He&32){ht.mode=Hn;break e}else{N.msg="invalid literal/length code",ht.mode=vi;break e}else{ot=Et[(ot&65535)+(We&(1<<He)-1)];continue t}break}}while(Z<Q&&$<me);gt=$e>>3,Z-=gt,$e-=gt<<3,We&=(1<<$e)-1,N.next_in=Z,N.next_out=$,N.avail_in=Z<Q?5+(Q-Z):5-(Z-Q),N.avail_out=$<me?257+(me-$):257-($-me),ht.hold=We,ht.bits=$e};const qt=15,Ji=852,Qi=592,qi=0,Pi=1,er=2,Yn=new Uint16Array([3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0]),Zn=new Uint8Array([16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78]),Xn=new Uint16Array([1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0]),$n=new Uint8Array([16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64]);var li=(l,N,y,Z,Q,$,Ee,me)=>{const Ye=me.bits;let le=0,Ae=0,ct=0,Ke=0,We=0,$e=0,Et=0,ft=0,st=0,pt=0,ot,He,gt,wt,Je,bt=null,dt;const rt=new Uint16Array(qt+1),ht=new Uint16Array(qt+1);let Kt=null,Zr,Ei,Ai;for(le=0;le<=qt;le++)rt[le]=0;for(Ae=0;Ae<Z;Ae++)rt[N[y+Ae]]++;for(We=Ye,Ke=qt;Ke>=1&&rt[Ke]===0;Ke--);if(We>Ke&&(We=Ke),Ke===0)return Q[$++]=1<<24|64<<16|0,Q[$++]=1<<24|64<<16|0,me.bits=1,0;for(ct=1;ct<Ke&&rt[ct]===0;ct++);for(We<ct&&(We=ct),ft=1,le=1;le<=qt;le++)if(ft<<=1,ft-=rt[le],ft<0)return-1;if(ft>0&&(l===qi||Ke!==1))return-1;for(ht[1]=0,le=1;le<qt;le++)ht[le+1]=ht[le]+rt[le];for(Ae=0;Ae<Z;Ae++)N[y+Ae]!==0&&(Ee[ht[N[y+Ae]]++]=Ae);if(l===qi?(bt=Kt=Ee,dt=20):l===Pi?(bt=Yn,Kt=Zn,dt=257):(bt=Xn,Kt=$n,dt=0),pt=0,Ae=0,le=ct,Je=$,$e=We,Et=0,gt=-1,st=1<<We,wt=st-1,l===Pi&&st>Ji||l===er&&st>Qi)return 1;for(;;){Zr=le-Et,Ee[Ae]+1<dt?(Ei=0,Ai=Ee[Ae]):Ee[Ae]>=dt?(Ei=Kt[Ee[Ae]-dt],Ai=bt[Ee[Ae]-dt]):(Ei=96,Ai=0),ot=1<<le-Et,He=1<<$e,ct=He;do He-=ot,Q[Je+(pt>>Et)+He]=Zr<<24|Ei<<16|Ai|0;while(He!==0);for(ot=1<<le-1;pt&ot;)ot>>=1;if(ot!==0?(pt&=ot-1,pt+=ot):pt=0,Ae++,--rt[le]===0){if(le===Ke)break;le=N[y+Ee[Ae]]}if(le>We&&(pt&wt)!==gt){for(Et===0&&(Et=We),Je+=ct,$e=le-Et,ft=1<<$e;$e+Et<Ke&&(ft-=rt[$e+Et],!(ft<=0));)$e++,ft<<=1;if(st+=1<<$e,l===Pi&&st>Ji||l===er&&st>Qi)return 1;gt=pt&wt,Q[gt]=We<<24|$e<<16|Je-$|0}}return pt!==0&&(Q[Je+pt]=le-Et<<24|64<<16|0),me.bits=We,0};const Jn=0,tr=1,ir=2,{Z_FINISH:rr,Z_BLOCK:Qn,Z_TREES:pi,Z_OK:jt,Z_STREAM_END:qn,Z_NEED_DICT:es,Z_STREAM_ERROR:St,Z_DATA_ERROR:nr,Z_MEM_ERROR:sr,Z_BUF_ERROR:ts,Z_DEFLATED:ar}=he,_i=16180,or=16181,lr=16182,hr=16183,fr=16184,dr=16185,cr=16186,ur=16187,gr=16188,mr=16189,xi=16190,Ft=16191,Ii=16192,vr=16193,zi=16194,pr=16195,_r=16196,xr=16197,br=16198,bi=16199,yi=16200,yr=16201,Er=16202,Ar=16203,Mr=16204,wr=16205,Fi=16206,Cr=16207,Dr=16208,yt=16209,Tr=16210,Lr=16211,is=852,rs=592,ns=15,Or=l=>(l>>>24&255)+(l>>>8&65280)+((l&65280)<<8)+((l&255)<<24);function ss(){this.strm=null,this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new Uint16Array(320),this.work=new Uint16Array(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}const Ht=l=>{if(!l)return 1;const N=l.state;return!N||N.strm!==l||N.mode<_i||N.mode>Lr?1:0},Sr=l=>{if(Ht(l))return St;const N=l.state;return l.total_in=l.total_out=N.total=0,l.msg="",N.wrap&&(l.adler=N.wrap&1),N.mode=_i,N.last=0,N.havedict=0,N.flags=-1,N.dmax=32768,N.head=null,N.hold=0,N.bits=0,N.lencode=N.lendyn=new Int32Array(is),N.distcode=N.distdyn=new Int32Array(rs),N.sane=1,N.back=-1,jt},Rr=l=>{if(Ht(l))return St;const N=l.state;return N.wsize=0,N.whave=0,N.wnext=0,Sr(l)},Pr=(l,N)=>{let y;if(Ht(l))return St;const Z=l.state;return N<0?(y=0,N=-N):(y=(N>>4)+5,N<48&&(N&=15)),N&&(N<8||N>15)?St:(Z.window!==null&&Z.wbits!==N&&(Z.window=null),Z.wrap=y,Z.wbits=N,Rr(l))},Ir=(l,N)=>{if(!l)return St;const y=new ss;l.state=y,y.strm=l,y.window=null,y.mode=_i;const Z=Pr(l,N);return Z!==jt&&(l.state=null),Z},as=l=>Ir(l,ns);let zr=!0,Bi,Ui;const os=l=>{if(zr){Bi=new Int32Array(512),Ui=new Int32Array(32);let N=0;for(;N<144;)l.lens[N++]=8;for(;N<256;)l.lens[N++]=9;for(;N<280;)l.lens[N++]=7;for(;N<288;)l.lens[N++]=8;for(li(tr,l.lens,0,288,Bi,0,l.work,{bits:9}),N=0;N<32;)l.lens[N++]=5;li(ir,l.lens,0,32,Ui,0,l.work,{bits:5}),zr=!1}l.lencode=Bi,l.lenbits=9,l.distcode=Ui,l.distbits=5},Fr=(l,N,y,Z)=>{let Q;const $=l.state;return $.window===null&&($.wsize=1<<$.wbits,$.wnext=0,$.whave=0,$.window=new Uint8Array($.wsize)),Z>=$.wsize?($.window.set(N.subarray(y-$.wsize,y),0),$.wnext=0,$.whave=$.wsize):(Q=$.wsize-$.wnext,Q>Z&&(Q=Z),$.window.set(N.subarray(y-Z,y-Z+Q),$.wnext),Z-=Q,Z?($.window.set(N.subarray(y-Z,y),0),$.wnext=Z,$.whave=$.wsize):($.wnext+=Q,$.wnext===$.wsize&&($.wnext=0),$.whave<$.wsize&&($.whave+=Q))),0},ls=(l,N)=>{let y,Z,Q,$,Ee,me,Ye,le,Ae,ct,Ke,We,$e,Et,ft=0,st,pt,ot,He,gt,wt,Je,bt;const dt=new Uint8Array(4);let rt,ht;const Kt=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]);if(Ht(l)||!l.output||!l.input&&l.avail_in!==0)return St;y=l.state,y.mode===Ft&&(y.mode=Ii),Ee=l.next_out,Q=l.output,Ye=l.avail_out,$=l.next_in,Z=l.input,me=l.avail_in,le=y.hold,Ae=y.bits,ct=me,Ke=Ye,bt=jt;e:for(;;)switch(y.mode){case _i:if(y.wrap===0){y.mode=Ii;break}for(;Ae<16;){if(me===0)break e;me--,le+=Z[$++]<<Ae,Ae+=8}if(y.wrap&2&&le===35615){y.wbits===0&&(y.wbits=15),y.check=0,dt[0]=le&255,dt[1]=le>>>8&255,y.check=T(y.check,dt,2,0),le=0,Ae=0,y.mode=or;break}if(y.head&&(y.head.done=!1),!(y.wrap&1)||(((le&255)<<8)+(le>>8))%31){l.msg="incorrect header check",y.mode=yt;break}if((le&15)!==ar){l.msg="unknown compression method",y.mode=yt;break}if(le>>>=4,Ae-=4,Je=(le&15)+8,y.wbits===0&&(y.wbits=Je),Je>15||Je>y.wbits){l.msg="invalid window size",y.mode=yt;break}y.dmax=1<<y.wbits,y.flags=0,l.adler=y.check=1,y.mode=le&512?mr:Ft,le=0,Ae=0;break;case or:for(;Ae<16;){if(me===0)break e;me--,le+=Z[$++]<<Ae,Ae+=8}if(y.flags=le,(y.flags&255)!==ar){l.msg="unknown compression method",y.mode=yt;break}if(y.flags&57344){l.msg="unknown header flags set",y.mode=yt;break}y.head&&(y.head.text=le>>8&1),y.flags&512&&y.wrap&4&&(dt[0]=le&255,dt[1]=le>>>8&255,y.check=T(y.check,dt,2,0)),le=0,Ae=0,y.mode=lr;case lr:for(;Ae<32;){if(me===0)break e;me--,le+=Z[$++]<<Ae,Ae+=8}y.head&&(y.head.time=le),y.flags&512&&y.wrap&4&&(dt[0]=le&255,dt[1]=le>>>8&255,dt[2]=le>>>16&255,dt[3]=le>>>24&255,y.check=T(y.check,dt,4,0)),le=0,Ae=0,y.mode=hr;case hr:for(;Ae<16;){if(me===0)break e;me--,le+=Z[$++]<<Ae,Ae+=8}y.head&&(y.head.xflags=le&255,y.head.os=le>>8),y.flags&512&&y.wrap&4&&(dt[0]=le&255,dt[1]=le>>>8&255,y.check=T(y.check,dt,2,0)),le=0,Ae=0,y.mode=fr;case fr:if(y.flags&1024){for(;Ae<16;){if(me===0)break e;me--,le+=Z[$++]<<Ae,Ae+=8}y.length=le,y.head&&(y.head.extra_len=le),y.flags&512&&y.wrap&4&&(dt[0]=le&255,dt[1]=le>>>8&255,y.check=T(y.check,dt,2,0)),le=0,Ae=0}else y.head&&(y.head.extra=null);y.mode=dr;case dr:if(y.flags&1024&&(We=y.length,We>me&&(We=me),We&&(y.head&&(Je=y.head.extra_len-y.length,y.head.extra||(y.head.extra=new Uint8Array(y.head.extra_len)),y.head.extra.set(Z.subarray($,$+We),Je)),y.flags&512&&y.wrap&4&&(y.check=T(y.check,Z,We,$)),me-=We,$+=We,y.length-=We),y.length))break e;y.length=0,y.mode=cr;case cr:if(y.flags&2048){if(me===0)break e;We=0;do Je=Z[$+We++],y.head&&Je&&y.length<65536&&(y.head.name+=String.fromCharCode(Je));while(Je&&We<me);if(y.flags&512&&y.wrap&4&&(y.check=T(y.check,Z,We,$)),me-=We,$+=We,Je)break e}else y.head&&(y.head.name=null);y.length=0,y.mode=ur;case ur:if(y.flags&4096){if(me===0)break e;We=0;do Je=Z[$+We++],y.head&&Je&&y.length<65536&&(y.head.comment+=String.fromCharCode(Je));while(Je&&We<me);if(y.flags&512&&y.wrap&4&&(y.check=T(y.check,Z,We,$)),me-=We,$+=We,Je)break e}else y.head&&(y.head.comment=null);y.mode=gr;case gr:if(y.flags&512){for(;Ae<16;){if(me===0)break e;me--,le+=Z[$++]<<Ae,Ae+=8}if(y.wrap&4&&le!==(y.check&65535)){l.msg="header crc mismatch",y.mode=yt;break}le=0,Ae=0}y.head&&(y.head.hcrc=y.flags>>9&1,y.head.done=!0),l.adler=y.check=0,y.mode=Ft;break;case mr:for(;Ae<32;){if(me===0)break e;me--,le+=Z[$++]<<Ae,Ae+=8}l.adler=y.check=Or(le),le=0,Ae=0,y.mode=xi;case xi:if(y.havedict===0)return l.next_out=Ee,l.avail_out=Ye,l.next_in=$,l.avail_in=me,y.hold=le,y.bits=Ae,es;l.adler=y.check=1,y.mode=Ft;case Ft:if(N===Qn||N===pi)break e;case Ii:if(y.last){le>>>=Ae&7,Ae-=Ae&7,y.mode=Fi;break}for(;Ae<3;){if(me===0)break e;me--,le+=Z[$++]<<Ae,Ae+=8}switch(y.last=le&1,le>>>=1,Ae-=1,le&3){case 0:y.mode=vr;break;case 1:if(os(y),y.mode=bi,N===pi){le>>>=2,Ae-=2;break e}break;case 2:y.mode=_r;break;case 3:l.msg="invalid block type",y.mode=yt}le>>>=2,Ae-=2;break;case vr:for(le>>>=Ae&7,Ae-=Ae&7;Ae<32;){if(me===0)break e;me--,le+=Z[$++]<<Ae,Ae+=8}if((le&65535)!==(le>>>16^65535)){l.msg="invalid stored block lengths",y.mode=yt;break}if(y.length=le&65535,le=0,Ae=0,y.mode=zi,N===pi)break e;case zi:y.mode=pr;case pr:if(We=y.length,We){if(We>me&&(We=me),We>Ye&&(We=Ye),We===0)break e;Q.set(Z.subarray($,$+We),Ee),me-=We,$+=We,Ye-=We,Ee+=We,y.length-=We;break}y.mode=Ft;break;case _r:for(;Ae<14;){if(me===0)break e;me--,le+=Z[$++]<<Ae,Ae+=8}if(y.nlen=(le&31)+257,le>>>=5,Ae-=5,y.ndist=(le&31)+1,le>>>=5,Ae-=5,y.ncode=(le&15)+4,le>>>=4,Ae-=4,y.nlen>286||y.ndist>30){l.msg="too many length or distance symbols",y.mode=yt;break}y.have=0,y.mode=xr;case xr:for(;y.have<y.ncode;){for(;Ae<3;){if(me===0)break e;me--,le+=Z[$++]<<Ae,Ae+=8}y.lens[Kt[y.have++]]=le&7,le>>>=3,Ae-=3}for(;y.have<19;)y.lens[Kt[y.have++]]=0;if(y.lencode=y.lendyn,y.lenbits=7,rt={bits:y.lenbits},bt=li(Jn,y.lens,0,19,y.lencode,0,y.work,rt),y.lenbits=rt.bits,bt){l.msg="invalid code lengths set",y.mode=yt;break}y.have=0,y.mode=br;case br:for(;y.have<y.nlen+y.ndist;){for(;ft=y.lencode[le&(1<<y.lenbits)-1],st=ft>>>24,pt=ft>>>16&255,ot=ft&65535,!(st<=Ae);){if(me===0)break e;me--,le+=Z[$++]<<Ae,Ae+=8}if(ot<16)le>>>=st,Ae-=st,y.lens[y.have++]=ot;else{if(ot===16){for(ht=st+2;Ae<ht;){if(me===0)break e;me--,le+=Z[$++]<<Ae,Ae+=8}if(le>>>=st,Ae-=st,y.have===0){l.msg="invalid bit length repeat",y.mode=yt;break}Je=y.lens[y.have-1],We=3+(le&3),le>>>=2,Ae-=2}else if(ot===17){for(ht=st+3;Ae<ht;){if(me===0)break e;me--,le+=Z[$++]<<Ae,Ae+=8}le>>>=st,Ae-=st,Je=0,We=3+(le&7),le>>>=3,Ae-=3}else{for(ht=st+7;Ae<ht;){if(me===0)break e;me--,le+=Z[$++]<<Ae,Ae+=8}le>>>=st,Ae-=st,Je=0,We=11+(le&127),le>>>=7,Ae-=7}if(y.have+We>y.nlen+y.ndist){l.msg="invalid bit length repeat",y.mode=yt;break}for(;We--;)y.lens[y.have++]=Je}}if(y.mode===yt)break;if(y.lens[256]===0){l.msg="invalid code -- missing end-of-block",y.mode=yt;break}if(y.lenbits=9,rt={bits:y.lenbits},bt=li(tr,y.lens,0,y.nlen,y.lencode,0,y.work,rt),y.lenbits=rt.bits,bt){l.msg="invalid literal/lengths set",y.mode=yt;break}if(y.distbits=6,y.distcode=y.distdyn,rt={bits:y.distbits},bt=li(ir,y.lens,y.nlen,y.ndist,y.distcode,0,y.work,rt),y.distbits=rt.bits,bt){l.msg="invalid distances set",y.mode=yt;break}if(y.mode=bi,N===pi)break e;case bi:y.mode=yi;case yi:if(me>=6&&Ye>=258){l.next_out=Ee,l.avail_out=Ye,l.next_in=$,l.avail_in=me,y.hold=le,y.bits=Ae,Kn(l,Ke),Ee=l.next_out,Q=l.output,Ye=l.avail_out,$=l.next_in,Z=l.input,me=l.avail_in,le=y.hold,Ae=y.bits,y.mode===Ft&&(y.back=-1);break}for(y.back=0;ft=y.lencode[le&(1<<y.lenbits)-1],st=ft>>>24,pt=ft>>>16&255,ot=ft&65535,!(st<=Ae);){if(me===0)break e;me--,le+=Z[$++]<<Ae,Ae+=8}if(pt&&!(pt&240)){for(He=st,gt=pt,wt=ot;ft=y.lencode[wt+((le&(1<<He+gt)-1)>>He)],st=ft>>>24,pt=ft>>>16&255,ot=ft&65535,!(He+st<=Ae);){if(me===0)break e;me--,le+=Z[$++]<<Ae,Ae+=8}le>>>=He,Ae-=He,y.back+=He}if(le>>>=st,Ae-=st,y.back+=st,y.length=ot,pt===0){y.mode=wr;break}if(pt&32){y.back=-1,y.mode=Ft;break}if(pt&64){l.msg="invalid literal/length code",y.mode=yt;break}y.extra=pt&15,y.mode=yr;case yr:if(y.extra){for(ht=y.extra;Ae<ht;){if(me===0)break e;me--,le+=Z[$++]<<Ae,Ae+=8}y.length+=le&(1<<y.extra)-1,le>>>=y.extra,Ae-=y.extra,y.back+=y.extra}y.was=y.length,y.mode=Er;case Er:for(;ft=y.distcode[le&(1<<y.distbits)-1],st=ft>>>24,pt=ft>>>16&255,ot=ft&65535,!(st<=Ae);){if(me===0)break e;me--,le+=Z[$++]<<Ae,Ae+=8}if(!(pt&240)){for(He=st,gt=pt,wt=ot;ft=y.distcode[wt+((le&(1<<He+gt)-1)>>He)],st=ft>>>24,pt=ft>>>16&255,ot=ft&65535,!(He+st<=Ae);){if(me===0)break e;me--,le+=Z[$++]<<Ae,Ae+=8}le>>>=He,Ae-=He,y.back+=He}if(le>>>=st,Ae-=st,y.back+=st,pt&64){l.msg="invalid distance code",y.mode=yt;break}y.offset=ot,y.extra=pt&15,y.mode=Ar;case Ar:if(y.extra){for(ht=y.extra;Ae<ht;){if(me===0)break e;me--,le+=Z[$++]<<Ae,Ae+=8}y.offset+=le&(1<<y.extra)-1,le>>>=y.extra,Ae-=y.extra,y.back+=y.extra}if(y.offset>y.dmax){l.msg="invalid distance too far back",y.mode=yt;break}y.mode=Mr;case Mr:if(Ye===0)break e;if(We=Ke-Ye,y.offset>We){if(We=y.offset-We,We>y.whave&&y.sane){l.msg="invalid distance too far back",y.mode=yt;break}We>y.wnext?(We-=y.wnext,$e=y.wsize-We):$e=y.wnext-We,We>y.length&&(We=y.length),Et=y.window}else Et=Q,$e=Ee-y.offset,We=y.length;We>Ye&&(We=Ye),Ye-=We,y.length-=We;do Q[Ee++]=Et[$e++];while(--We);y.length===0&&(y.mode=yi);break;case wr:if(Ye===0)break e;Q[Ee++]=y.length,Ye--,y.mode=yi;break;case Fi:if(y.wrap){for(;Ae<32;){if(me===0)break e;me--,le|=Z[$++]<<Ae,Ae+=8}if(Ke-=Ye,l.total_out+=Ke,y.total+=Ke,y.wrap&4&&Ke&&(l.adler=y.check=y.flags?T(y.check,Q,Ke,Ee-Ke):ye(y.check,Q,Ke,Ee-Ke)),Ke=Ye,y.wrap&4&&(y.flags?le:Or(le))!==y.check){l.msg="incorrect data check",y.mode=yt;break}le=0,Ae=0}y.mode=Cr;case Cr:if(y.wrap&&y.flags){for(;Ae<32;){if(me===0)break e;me--,le+=Z[$++]<<Ae,Ae+=8}if(y.wrap&4&&le!==(y.total&4294967295)){l.msg="incorrect length check",y.mode=yt;break}le=0,Ae=0}y.mode=Dr;case Dr:bt=qn;break e;case yt:bt=nr;break e;case Tr:return sr;case Lr:default:return St}return l.next_out=Ee,l.avail_out=Ye,l.next_in=$,l.avail_in=me,y.hold=le,y.bits=Ae,(y.wsize||Ke!==l.avail_out&&y.mode<yt&&(y.mode<Fi||N!==rr))&&Fr(l,l.output,l.next_out,Ke-l.avail_out),ct-=l.avail_in,Ke-=l.avail_out,l.total_in+=ct,l.total_out+=Ke,y.total+=Ke,y.wrap&4&&Ke&&(l.adler=y.check=y.flags?T(y.check,Q,Ke,l.next_out-Ke):ye(y.check,Q,Ke,l.next_out-Ke)),l.data_type=y.bits+(y.last?64:0)+(y.mode===Ft?128:0)+(y.mode===bi||y.mode===zi?256:0),(ct===0&&Ke===0||N===rr)&&bt===jt&&(bt=ts),bt},hs=l=>{if(Ht(l))return St;let N=l.state;return N.window&&(N.window=null),l.state=null,jt},fs=(l,N)=>{if(Ht(l))return St;const y=l.state;return y.wrap&2?(y.head=N,N.done=!1,jt):St},ds=(l,N)=>{const y=N.length;let Z,Q,$;return Ht(l)||(Z=l.state,Z.wrap!==0&&Z.mode!==xi)?St:Z.mode===xi&&(Q=1,Q=ye(Q,N,y,0),Q!==Z.check)?nr:($=Fr(l,N,y,y),$?(Z.mode=Tr,sr):(Z.havedict=1,jt))};var cs=Rr,us=Pr,gs=Sr,ms=as,vs=Ir,ps=ls,_s=hs,xs=fs,bs=ds,ys="pako inflate (from Nodeca project)",Bt={inflateReset:cs,inflateReset2:us,inflateResetKeep:gs,inflateInit:ms,inflateInit2:vs,inflate:ps,inflateEnd:_s,inflateGetHeader:xs,inflateSetDictionary:bs,inflateInfo:ys};function Es(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}var As=Es;const Br=Object.prototype.toString,{Z_NO_FLUSH:Ms,Z_FINISH:ws,Z_OK:hi,Z_STREAM_END:Wi,Z_NEED_DICT:Ni,Z_STREAM_ERROR:Cs,Z_DATA_ERROR:Ur,Z_MEM_ERROR:Ds}=he;function fi(l){this.options=gi.assign({chunkSize:65536,windowBits:15,to:""},l||{});const N=this.options;N.raw&&N.windowBits>=0&&N.windowBits<16&&(N.windowBits=-N.windowBits,N.windowBits===0&&(N.windowBits=-15)),N.windowBits>=0&&N.windowBits<16&&!(l&&l.windowBits)&&(N.windowBits+=32),N.windowBits>15&&N.windowBits<48&&(N.windowBits&15||(N.windowBits|=15)),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new Xi,this.strm.avail_out=0;let y=Bt.inflateInit2(this.strm,N.windowBits);if(y!==hi)throw new Error(de[y]);if(this.header=new As,Bt.inflateGetHeader(this.strm,this.header),N.dictionary&&(typeof N.dictionary=="string"?N.dictionary=ai.string2buf(N.dictionary):Br.call(N.dictionary)==="[object ArrayBuffer]"&&(N.dictionary=new Uint8Array(N.dictionary)),N.raw&&(y=Bt.inflateSetDictionary(this.strm,N.dictionary),y!==hi)))throw new Error(de[y])}fi.prototype.push=function(l,N){const y=this.strm,Z=this.options.chunkSize,Q=this.options.dictionary;let $,Ee,me;if(this.ended)return!1;for(N===~~N?Ee=N:Ee=N===!0?ws:Ms,Br.call(l)==="[object ArrayBuffer]"?y.input=new Uint8Array(l):y.input=l,y.next_in=0,y.avail_in=y.input.length;;){for(y.avail_out===0&&(y.output=new Uint8Array(Z),y.next_out=0,y.avail_out=Z),$=Bt.inflate(y,Ee),$===Ni&&Q&&($=Bt.inflateSetDictionary(y,Q),$===hi?$=Bt.inflate(y,Ee):$===Ur&&($=Ni));y.avail_in>0&&$===Wi&&y.state.wrap>0&&l[y.next_in]!==0;)Bt.inflateReset(y),$=Bt.inflate(y,Ee);switch($){case Cs:case Ur:case Ni:case Ds:return this.onEnd($),this.ended=!0,!1}if(me=y.avail_out,y.next_out&&(y.avail_out===0||$===Wi))if(this.options.to==="string"){let Ye=ai.utf8border(y.output,y.next_out),le=y.next_out-Ye,Ae=ai.buf2string(y.output,Ye);y.next_out=le,y.avail_out=Z-le,le&&y.output.set(y.output.subarray(Ye,Ye+le),0),this.onData(Ae)}else this.onData(y.output.length===y.next_out?y.output:y.output.subarray(0,y.next_out));if(!($===hi&&me===0)){if($===Wi)return $=Bt.inflateEnd(this.strm),this.onEnd($),this.ended=!0,!0;if(y.avail_in===0)break}}return!0},fi.prototype.onData=function(l){this.chunks.push(l)},fi.prototype.onEnd=function(l){l===hi&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=gi.flattenChunks(this.chunks)),this.chunks=[],this.err=l,this.msg=this.strm.msg};function Gi(l,N){const y=new fi(N);if(y.push(l),y.err)throw y.msg||de[y.err];return y.result}function Ts(l,N){return N=N||{},N.raw=!0,Gi(l,N)}var Ls=fi,Os=Gi,Ss=Ts,Rs=Gi,Ps=he,Is={Inflate:Ls,inflate:Os,inflateRaw:Ss,ungzip:Rs,constants:Ps};const{Deflate:zs,deflate:Fs,deflateRaw:Bs,gzip:Us}=jn,{Inflate:Ws,inflate:Ns,inflateRaw:Gs,ungzip:Vs}=Is;var Wr=zs,Nr=Fs,Gr=Bs,Vr=Us,kr=Ws,jr=Ns,Hr=Gs,Kr=Vs,Yr=he,ks={Deflate:Wr,deflate:Nr,deflateRaw:Gr,gzip:Vr,Inflate:kr,inflate:jr,inflateRaw:Hr,ungzip:Kr,constants:Yr}},"./node_modules/upng-js/UPNG.js"(K,C,f){(function(){var E={},S;K.exports=E,S=f("./node_modules/upng-js/node_modules/pako/index.js"),function(w,O){w.toRGBA8=function(p){var x=p.width,M=p.height;if(p.tabs.acTL==null)return[w.toRGBA8.decodeImage(p.data,x,M,p).buffer];var m=[];p.frames[0].data==null&&(p.frames[0].data=p.data);for(var b,_=new Uint8Array(x*M*4),g=0;g<p.frames.length;g++){var v=p.frames[g],r=v.rect.x,e=v.rect.y,t=v.rect.width,n=v.rect.height,o=w.toRGBA8.decodeImage(v.data,t,n,p);if(g==0?b=o:v.blend==0?w._copyTile(o,t,n,b,x,M,r,e,0):v.blend==1&&w._copyTile(o,t,n,b,x,M,r,e,1),m.push(b.buffer),b=b.slice(0),v.dispose!=0){if(v.dispose==1)w._copyTile(_,t,n,b,x,M,r,e,0);else if(v.dispose==2){for(var h=g-1;p.frames[h].dispose==2;)h--;b=new Uint8Array(m[h]).slice(0)}}}return m},w.toRGBA8.decodeImage=function(p,x,M,m){var b=x*M,_=w.decode._getBPP(m),g=Math.ceil(x*_/8),v=new Uint8Array(b*4),r=new Uint32Array(v.buffer),e=m.ctype,t=m.depth,n=w._bin.readUshort;if(e==6){var o=b<<2;if(t==8)for(var h=0;h<o;h++)v[h]=p[h];if(t==16)for(var h=0;h<o;h++)v[h]=p[h<<1]}else if(e==2){var d=m.tabs.tRNS,i=-1,s=-1,a=-1;if(d&&(i=d[0],s=d[1],a=d[2]),t==8)for(var h=0;h<b;h++){var c=h<<2,u=h*3;v[c]=p[u],v[c+1]=p[u+1],v[c+2]=p[u+2],v[c+3]=255,i!=-1&&p[u]==i&&p[u+1]==s&&p[u+2]==a&&(v[c+3]=0)}if(t==16)for(var h=0;h<b;h++){var c=h<<2,u=h*6;v[c]=p[u],v[c+1]=p[u+2],v[c+2]=p[u+4],v[c+3]=255,i!=-1&&n(p,u)==i&&n(p,u+2)==s&&n(p,u+4)==a&&(v[c+3]=0)}}else if(e==3){var A=m.tabs.PLTE,L=m.tabs.tRNS,D=L?L.length:0;if(t==1)for(var R=0;R<M;R++)for(var P=R*g,z=R*x,h=0;h<x;h++){var c=z+h<<2,F=p[P+(h>>3)]>>7-((h&7)<<0)&1,B=3*F;v[c]=A[B],v[c+1]=A[B+1],v[c+2]=A[B+2],v[c+3]=F<D?L[F]:255}if(t==2)for(var R=0;R<M;R++)for(var P=R*g,z=R*x,h=0;h<x;h++){var c=z+h<<2,F=p[P+(h>>2)]>>6-((h&3)<<1)&3,B=3*F;v[c]=A[B],v[c+1]=A[B+1],v[c+2]=A[B+2],v[c+3]=F<D?L[F]:255}if(t==4)for(var R=0;R<M;R++)for(var P=R*g,z=R*x,h=0;h<x;h++){var c=z+h<<2,F=p[P+(h>>1)]>>4-((h&1)<<2)&15,B=3*F;v[c]=A[B],v[c+1]=A[B+1],v[c+2]=A[B+2],v[c+3]=F<D?L[F]:255}if(t==8)for(var h=0;h<b;h++){var c=h<<2,F=p[h],B=3*F;v[c]=A[B],v[c+1]=A[B+1],v[c+2]=A[B+2],v[c+3]=F<D?L[F]:255}}else if(e==4){if(t==8)for(var h=0;h<b;h++){var c=h<<2,U=h<<1,W=p[U];v[c]=W,v[c+1]=W,v[c+2]=W,v[c+3]=p[U+1]}if(t==16)for(var h=0;h<b;h++){var c=h<<2,U=h<<2,W=p[U];v[c]=W,v[c+1]=W,v[c+2]=W,v[c+3]=p[U+2]}}else if(e==0){var i=m.tabs.tRNS?m.tabs.tRNS:-1;if(t==1)for(var h=0;h<b;h++){var W=255*(p[h>>3]>>7-(h&7)&1),I=W==i*255?0:255;r[h]=I<<24|W<<16|W<<8|W}if(t==2)for(var h=0;h<b;h++){var W=85*(p[h>>2]>>6-((h&3)<<1)&3),I=W==i*85?0:255;r[h]=I<<24|W<<16|W<<8|W}if(t==4)for(var h=0;h<b;h++){var W=17*(p[h>>1]>>4-((h&1)<<2)&15),I=W==i*17?0:255;r[h]=I<<24|W<<16|W<<8|W}if(t==8)for(var h=0;h<b;h++){var W=p[h],I=W==i?0:255;r[h]=I<<24|W<<16|W<<8|W}if(t==16)for(var h=0;h<b;h++){var W=p[h<<1],I=n(p,h<<1)==i?0:255;r[h]=I<<24|W<<16|W<<8|W}}return v},w.decode=function(p){for(var x=new Uint8Array(p),M=8,m=w._bin,b=m.readUshort,_=m.readUint,g={tabs:{},frames:[]},v=new Uint8Array(x.length),r=0,e,t=0,n=[137,80,78,71,13,10,26,10],o=0;o<8;o++)if(x[o]!=n[o])throw"The input is not a PNG file!";for(;M<x.length;){var h=m.readUint(x,M);M+=4;var d=m.readASCII(x,M,4);if(M+=4,d=="IHDR")w.decode._IHDR(x,M,g);else if(d=="IDAT"){for(var o=0;o<h;o++)v[r+o]=x[M+o];r+=h}else if(d=="acTL")g.tabs[d]={num_frames:_(x,M),num_plays:_(x,M+4)},e=new Uint8Array(x.length);else if(d=="fcTL"){if(t!=0){var i=g.frames[g.frames.length-1];i.data=w.decode._decompress(g,e.slice(0,t),i.rect.width,i.rect.height),t=0}var s={x:_(x,M+12),y:_(x,M+16),width:_(x,M+4),height:_(x,M+8)},a=b(x,M+22);a=b(x,M+20)/(a==0?100:a);var c={rect:s,delay:Math.round(a*1e3),dispose:x[M+24],blend:x[M+25]};g.frames.push(c)}else if(d=="fdAT"){for(var o=0;o<h-4;o++)e[t+o]=x[M+o+4];t+=h-4}else if(d=="pHYs")g.tabs[d]=[m.readUint(x,M),m.readUint(x,M+4),x[M+8]];else if(d=="cHRM"){g.tabs[d]=[];for(var o=0;o<8;o++)g.tabs[d].push(m.readUint(x,M+o*4))}else if(d=="tEXt"){g.tabs[d]==null&&(g.tabs[d]={});var u=m.nextZero(x,M),A=m.readASCII(x,M,u-M),L=m.readASCII(x,u+1,M+h-u-1);g.tabs[d][A]=L}else if(d=="iTXt"){g.tabs[d]==null&&(g.tabs[d]={});var u=0,D=M;u=m.nextZero(x,D);var A=m.readASCII(x,D,u-D);D=u+1,x[D],x[D+1],D+=2,u=m.nextZero(x,D),m.readASCII(x,D,u-D),D=u+1,u=m.nextZero(x,D),m.readUTF8(x,D,u-D),D=u+1;var L=m.readUTF8(x,D,h-(D-M));g.tabs[d][A]=L}else if(d=="PLTE")g.tabs[d]=m.readBytes(x,M,h);else if(d=="hIST"){var R=g.tabs.PLTE.length/3;g.tabs[d]=[];for(var o=0;o<R;o++)g.tabs[d].push(b(x,M+o*2))}else if(d=="tRNS")g.ctype==3?g.tabs[d]=m.readBytes(x,M,h):g.ctype==0?g.tabs[d]=b(x,M):g.ctype==2&&(g.tabs[d]=[b(x,M),b(x,M+2),b(x,M+4)]);else if(d=="gAMA")g.tabs[d]=m.readUint(x,M)/1e5;else if(d=="sRGB")g.tabs[d]=x[M];else if(d=="bKGD")g.ctype==0||g.ctype==4?g.tabs[d]=[b(x,M)]:g.ctype==2||g.ctype==6?g.tabs[d]=[b(x,M),b(x,M+2),b(x,M+4)]:g.ctype==3&&(g.tabs[d]=x[M]);else if(d=="IEND"){if(t!=0){var i=g.frames[g.frames.length-1];i.data=w.decode._decompress(g,e.slice(0,t),i.rect.width,i.rect.height),t=0}g.data=w.decode._decompress(g,v,g.width,g.height);break}M+=h,m.readUint(x,M),M+=4}return delete g.compress,delete g.interlace,delete g.filter,g},w.decode._decompress=function(p,x,M,m){return p.compress==0&&(x=w.decode._inflate(x)),p.interlace==0?x=w.decode._filterZero(x,p,0,M,m):p.interlace==1&&(x=w.decode._readInterlace(x,p)),x},w.decode._inflate=function(p){return O.inflate(p)},w.decode._readInterlace=function(p,x){for(var M=x.width,m=x.height,b=w.decode._getBPP(x),_=b>>3,g=Math.ceil(M*b/8),v=new Uint8Array(m*g),r=0,e=[0,0,4,0,2,0,1],t=[0,4,0,2,0,1,0],n=[8,8,8,4,4,2,2],o=[8,8,4,4,2,2,1],h=0;h<7;){for(var d=n[h],i=o[h],s=0,a=0,c=e[h];c<m;)c+=d,a++;for(var u=t[h];u<M;)u+=i,s++;var A=Math.ceil(s*b/8);w.decode._filterZero(p,x,r,s,a);for(var L=0,D=e[h];D<m;){for(var R=t[h],P=r+L*A<<3;R<M;){if(b==1){var z=p[P>>3];z=z>>7-(P&7)&1,v[D*g+(R>>3)]|=z<<7-((R&3)<<0)}if(b==2){var z=p[P>>3];z=z>>6-(P&7)&3,v[D*g+(R>>2)]|=z<<6-((R&3)<<1)}if(b==4){var z=p[P>>3];z=z>>4-(P&7)&15,v[D*g+(R>>1)]|=z<<4-((R&1)<<2)}if(b>=8)for(var F=D*g+R*_,B=0;B<_;B++)v[F+B]=p[(P>>3)+B];P+=b,R+=i}L++,D+=d}s*a!=0&&(r+=a*(1+A)),h=h+1}return v},w.decode._getBPP=function(p){var x=[1,null,3,1,2,null,4][p.ctype];return x*p.depth},w.decode._filterZero=function(p,x,M,m,b){var _=w.decode._getBPP(x),g=Math.ceil(m*_/8),v=w.decode._paeth;_=Math.ceil(_/8);for(var r=0;r<b;r++){var e=M+r*g,t=e+r+1,n=p[t-1];if(n==0)for(var o=0;o<g;o++)p[e+o]=p[t+o];else if(n==1){for(var o=0;o<_;o++)p[e+o]=p[t+o];for(var o=_;o<g;o++)p[e+o]=p[t+o]+p[e+o-_]&255}else if(r==0){for(var o=0;o<_;o++)p[e+o]=p[t+o];if(n==2)for(var o=_;o<g;o++)p[e+o]=p[t+o]&255;if(n==3)for(var o=_;o<g;o++)p[e+o]=p[t+o]+(p[e+o-_]>>1)&255;if(n==4)for(var o=_;o<g;o++)p[e+o]=p[t+o]+v(p[e+o-_],0,0)&255}else{if(n==2)for(var o=0;o<g;o++)p[e+o]=p[t+o]+p[e+o-g]&255;if(n==3){for(var o=0;o<_;o++)p[e+o]=p[t+o]+(p[e+o-g]>>1)&255;for(var o=_;o<g;o++)p[e+o]=p[t+o]+(p[e+o-g]+p[e+o-_]>>1)&255}if(n==4){for(var o=0;o<_;o++)p[e+o]=p[t+o]+v(0,p[e+o-g],0)&255;for(var o=_;o<g;o++)p[e+o]=p[t+o]+v(p[e+o-_],p[e+o-g],p[e+o-_-g])&255}}}return p},w.decode._paeth=function(p,x,M){var m=p+x-M,b=Math.abs(m-p),_=Math.abs(m-x),g=Math.abs(m-M);return b<=_&&b<=g?p:_<=g?x:M},w.decode._IHDR=function(p,x,M){var m=w._bin;M.width=m.readUint(p,x),x+=4,M.height=m.readUint(p,x),x+=4,M.depth=p[x],x++,M.ctype=p[x],x++,M.compress=p[x],x++,M.filter=p[x],x++,M.interlace=p[x],x++},w._bin={nextZero:function(p,x){for(;p[x]!=0;)x++;return x},readUshort:function(p,x){return p[x]<<8|p[x+1]},writeUshort:function(p,x,M){p[x]=M>>8&255,p[x+1]=M&255},readUint:function(p,x){return p[x]*16777216+(p[x+1]<<16|p[x+2]<<8|p[x+3])},writeUint:function(p,x,M){p[x]=M>>24&255,p[x+1]=M>>16&255,p[x+2]=M>>8&255,p[x+3]=M&255},readASCII:function(p,x,M){for(var m="",b=0;b<M;b++)m+=String.fromCharCode(p[x+b]);return m},writeASCII:function(p,x,M){for(var m=0;m<M.length;m++)p[x+m]=M.charCodeAt(m)},readBytes:function(p,x,M){for(var m=[],b=0;b<M;b++)m.push(p[x+b]);return m},pad:function(p){return p.length<2?"0"+p:p},readUTF8:function(p,x,M){for(var m="",b,_=0;_<M;_++)m+="%"+w._bin.pad(p[x+_].toString(16));try{b=decodeURIComponent(m)}catch{return w._bin.readASCII(p,x,M)}return b}},w._copyTile=function(p,x,M,m,b,_,g,v,r){for(var e=Math.min(x,b),t=Math.min(M,_),n=0,o=0,h=0;h<t;h++)for(var d=0;d<e;d++)if(g>=0&&v>=0?(n=h*x+d<<2,o=(v+h)*b+g+d<<2):(n=(-v+h)*x-g+d<<2,o=h*b+d<<2),r==0)m[o]=p[n],m[o+1]=p[n+1],m[o+2]=p[n+2],m[o+3]=p[n+3];else if(r==1){var i=p[n+3]*.00392156862745098,s=p[n]*i,a=p[n+1]*i,c=p[n+2]*i,u=m[o+3]*(1/255),A=m[o]*u,L=m[o+1]*u,D=m[o+2]*u,R=1-i,P=i+u*R,z=P==0?0:1/P;m[o+3]=255*P,m[o+0]=(s+A*R)*z,m[o+1]=(a+L*R)*z,m[o+2]=(c+D*R)*z}else if(r==2){var i=p[n+3],s=p[n],a=p[n+1],c=p[n+2],u=m[o+3],A=m[o],L=m[o+1],D=m[o+2];i==u&&s==A&&a==L&&c==D?(m[o]=0,m[o+1]=0,m[o+2]=0,m[o+3]=0):(m[o]=s,m[o+1]=a,m[o+2]=c,m[o+3]=i)}else if(r==3){var i=p[n+3],s=p[n],a=p[n+1],c=p[n+2],u=m[o+3],A=m[o],L=m[o+1],D=m[o+2];if(i==u&&s==A&&a==L&&c==D)continue;if(i<220&&u>20)return!1}return!0},w.encode=function(p,x,M,m,b,_){m==null&&(m=0),_==null&&(_=!1);for(var g=new Uint8Array(p[0].byteLength*p.length+100),v=[137,80,78,71,13,10,26,10],r=0;r<8;r++)g[r]=v[r];var e=8,t=w._bin,n=w.crc.crc,o=t.writeUint,h=t.writeUshort,d=t.writeASCII,i=w.encode.compressPNG(p,x,M,m,_);o(g,e,13),e+=4,d(g,e,"IHDR"),e+=4,o(g,e,x),e+=4,o(g,e,M),e+=4,g[e]=i.depth,e++,g[e]=i.ctype,e++,g[e]=0,e++,g[e]=0,e++,g[e]=0,e++,o(g,e,n(g,e-17,17)),e+=4,o(g,e,1),e+=4,d(g,e,"sRGB"),e+=4,g[e]=1,e++,o(g,e,n(g,e-5,5)),e+=4;var s=p.length>1;if(s&&(o(g,e,8),e+=4,d(g,e,"acTL"),e+=4,o(g,e,p.length),e+=4,o(g,e,0),e+=4,o(g,e,n(g,e-12,12)),e+=4),i.ctype==3){var a=i.plte.length;o(g,e,a*3),e+=4,d(g,e,"PLTE"),e+=4;for(var r=0;r<a;r++){var c=r*3,u=i.plte[r],A=u&255,L=u>>8&255,D=u>>16&255;g[e+c+0]=A,g[e+c+1]=L,g[e+c+2]=D}if(e+=a*3,o(g,e,n(g,e-a*3-4,a*3+4)),e+=4,i.gotAlpha){o(g,e,a),e+=4,d(g,e,"tRNS"),e+=4;for(var r=0;r<a;r++)g[e+r]=i.plte[r]>>24&255;e+=a,o(g,e,n(g,e-a-4,a+4)),e+=4}}for(var R=0,P=0;P<i.frames.length;P++){var z=i.frames[P];s&&(o(g,e,26),e+=4,d(g,e,"fcTL"),e+=4,o(g,e,R++),e+=4,o(g,e,z.rect.width),e+=4,o(g,e,z.rect.height),e+=4,o(g,e,z.rect.x),e+=4,o(g,e,z.rect.y),e+=4,h(g,e,b[P]),e+=2,h(g,e,1e3),e+=2,g[e]=z.dispose,e++,g[e]=z.blend,e++,o(g,e,n(g,e-30,30)),e+=4);var F=z.cimg,a=F.length;o(g,e,a+(P==0?0:4)),e+=4;var B=e;d(g,e,P==0?"IDAT":"fdAT"),e+=4,P!=0&&(o(g,e,R++),e+=4);for(var r=0;r<a;r++)g[e+r]=F[r];e+=a,o(g,e,n(g,B,e-B)),e+=4}return o(g,e,0),e+=4,d(g,e,"IEND"),e+=4,o(g,e,n(g,e-4,4)),e+=4,g.buffer.slice(0,e)},w.encode.compressPNG=function(p,x,M,m,b){for(var _=w.encode.compress(p,x,M,m,!1,b),g=0;g<p.length;g++){var v=_.frames[g];v.rect.width;var r=v.rect.height,e=v.bpl,t=v.bpp,n=new Uint8Array(r*e+r);v.cimg=w.encode._filterZero(v.img,r,t,e,n)}return _},w.encode.compress=function(p,x,M,m,b,_){_==null&&(_=!1);for(var g=6,v=8,r=4,e=255,t=0;t<p.length;t++)for(var n=new Uint8Array(p[t]),o=n.length,h=0;h<o;h+=4)e&=n[h+3];var d=e!=255,i={},s=[];if(p.length!=0&&(i[0]=0,s.push(0),m!=0&&m--),m!=0){var a=w.quantize(p,m,b);p=a.bufs;for(var h=0;h<a.plte.length;h++){var c=a.plte[h].est.rgba;i[c]==null&&(i[c]=s.length,s.push(c))}}else for(var t=0;t<p.length;t++)for(var u=new Uint32Array(p[t]),o=u.length,h=0;h<o;h++){var c=u[h];if((h<x||c!=u[h-1]&&c!=u[h-x])&&i[c]==null&&(i[c]=s.length,s.push(c),s.length>=300))break}var A=d?b:!1,L=s.length;L<=256&&_==!1&&(L<=2?v=1:L<=4?v=2:L<=16?v=4:v=8,b&&(v=8),d=!0);for(var D=[],t=0;t<p.length;t++){var R=new Uint8Array(p[t]),P=new Uint32Array(R.buffer),z=0,F=0,B=x,U=M,W=0;if(t!=0&&!A){for(var I=b||t==1||D[D.length-2].dispose==2?1:2,V=0,ee=1e9,te=0;te<I;te++){for(var pe=new Uint8Array(p[t-1-te]),ae=new Uint32Array(p[t-1-te]),re=x,fe=M,q=-1,oe=-1,be=0;be<M;be++)for(var ge=0;ge<x;ge++){var h=be*x+ge;P[h]!=ae[h]&&(ge<re&&(re=ge),ge>q&&(q=ge),be<fe&&(fe=be),be>oe&&(oe=be))}var Le=q==-1?1:(q-re+1)*(oe-fe+1);Le<ee&&(ee=Le,V=te,q==-1?(z=F=0,B=U=1):(z=re,F=fe,B=q-re+1,U=oe-fe+1))}var pe=new Uint8Array(p[t-1-V]);V==1&&(D[D.length-1].dispose=2);var J=new Uint8Array(B*U*4);new Uint32Array(J.buffer),w._copyTile(pe,x,M,J,B,U,-z,-F,0),w._copyTile(R,x,M,J,B,U,-z,-F,3)?(w._copyTile(R,x,M,J,B,U,-z,-F,2),W=1):(w._copyTile(R,x,M,J,B,U,-z,-F,0),W=0),R=J,P=new Uint32Array(R.buffer)}var ce=4*B;if(L<=256&&_==!1){ce=Math.ceil(v*B/8);for(var J=new Uint8Array(ce*U),be=0;be<U;be++){var h=be*ce,Me=be*B;if(v==8)for(var ge=0;ge<B;ge++)J[h+ge]=i[P[Me+ge]];else if(v==4)for(var ge=0;ge<B;ge++)J[h+(ge>>1)]|=i[P[Me+ge]]<<4-(ge&1)*4;else if(v==2)for(var ge=0;ge<B;ge++)J[h+(ge>>2)]|=i[P[Me+ge]]<<6-(ge&3)*2;else if(v==1)for(var ge=0;ge<B;ge++)J[h+(ge>>3)]|=i[P[Me+ge]]<<7-(ge&7)*1}R=J,g=3,r=1}else if(d==!1&&p.length==1){for(var J=new Uint8Array(B*U*3),Fe=B*U,h=0;h<Fe;h++){var ze=h*3,Be=h*4;J[ze]=R[Be],J[ze+1]=R[Be+1],J[ze+2]=R[Be+2]}R=J,g=2,r=3,ce=3*B}D.push({rect:{x:z,y:F,width:B,height:U},img:R,bpl:ce,bpp:r,blend:W,dispose:A?1:0})}return{ctype:g,depth:v,plte:s,gotAlpha:d,frames:D}},w.encode._filterZero=function(p,x,M,m,b){for(var _=[],g=0;g<5;g++)if(!(x*m>5e5&&(g==2||g==3||g==4))){for(var v=0;v<x;v++)w.encode._filterLine(b,p,v,m,M,g);if(_.push(O.deflate(b)),M==1)break}for(var r,e=1e9,t=0;t<_.length;t++)_[t].length<e&&(r=t,e=_[t].length);return _[r]},w.encode._filterLine=function(p,x,M,m,b,_){var g=M*m,v=g+M,r=w.decode._paeth;if(p[v]=_,v++,_==0)for(var e=0;e<m;e++)p[v+e]=x[g+e];else if(_==1){for(var e=0;e<b;e++)p[v+e]=x[g+e];for(var e=b;e<m;e++)p[v+e]=x[g+e]-x[g+e-b]+256&255}else if(M==0){for(var e=0;e<b;e++)p[v+e]=x[g+e];if(_==2)for(var e=b;e<m;e++)p[v+e]=x[g+e];if(_==3)for(var e=b;e<m;e++)p[v+e]=x[g+e]-(x[g+e-b]>>1)+256&255;if(_==4)for(var e=b;e<m;e++)p[v+e]=x[g+e]-r(x[g+e-b],0,0)+256&255}else{if(_==2)for(var e=0;e<m;e++)p[v+e]=x[g+e]+256-x[g+e-m]&255;if(_==3){for(var e=0;e<b;e++)p[v+e]=x[g+e]+256-(x[g+e-m]>>1)&255;for(var e=b;e<m;e++)p[v+e]=x[g+e]+256-(x[g+e-m]+x[g+e-b]>>1)&255}if(_==4){for(var e=0;e<b;e++)p[v+e]=x[g+e]+256-r(0,x[g+e-m],0)&255;for(var e=b;e<m;e++)p[v+e]=x[g+e]+256-r(x[g+e-b],x[g+e-m],x[g+e-b-m])&255}}},w.crc={table:function(){for(var p=new Uint32Array(256),x=0;x<256;x++){for(var M=x,m=0;m<8;m++)M&1?M=3988292384^M>>>1:M=M>>>1;p[x]=M}return p}(),update:function(p,x,M,m){for(var b=0;b<m;b++)p=w.crc.table[(p^x[M+b])&255]^p>>>8;return p},crc:function(p,x,M){return w.crc.update(4294967295,p,x,M)^4294967295}},w.quantize=function(p,x,M){for(var m=[],b=0,_=0;_<p.length;_++)m.push(w.encode.alphaMul(new Uint8Array(p[_]),M)),b+=p[_].byteLength;for(var g=new Uint8Array(b),v=new Uint32Array(g.buffer),r=0,_=0;_<m.length;_++){for(var e=m[_],t=e.length,n=0;n<t;n++)g[r+n]=e[n];r+=t}var o={i0:0,i1:g.length,bst:null,est:null,tdst:0,left:null,right:null};o.bst=w.quantize.stats(g,o.i0,o.i1),o.est=w.quantize.estats(o.bst);for(var h=[o];h.length<x;){for(var d=0,i=0,_=0;_<h.length;_++)h[_].est.L>d&&(d=h[_].est.L,i=_);if(d<.001)break;var s=h[i],a=w.quantize.splitPixels(g,v,s.i0,s.i1,s.est.e,s.est.eMq255),c={i0:s.i0,i1:a,bst:null,est:null,tdst:0,left:null,right:null};c.bst=w.quantize.stats(g,c.i0,c.i1),c.est=w.quantize.estats(c.bst);var u={i0:a,i1:s.i1,bst:null,est:null,tdst:0,left:null,right:null};u.bst={R:[],m:[],N:s.bst.N-c.bst.N};for(var _=0;_<16;_++)u.bst.R[_]=s.bst.R[_]-c.bst.R[_];for(var _=0;_<4;_++)u.bst.m[_]=s.bst.m[_]-c.bst.m[_];u.est=w.quantize.estats(u.bst),s.left=c,s.right=u,h[i]=c,h.push(u)}h.sort(function(I,V){return V.bst.N-I.bst.N});for(var A=0;A<m.length;A++){for(var L=w.quantize.planeDst,D=new Uint8Array(m[A].buffer),R=new Uint32Array(m[A].buffer),P=D.length,_=0;_<P;_+=4){for(var z=D[_]*.00392156862745098,F=D[_+1]*(1/255),B=D[_+2]*(1/255),U=D[_+3]*(1/255),W=o;W.left;)W=L(W.est,z,F,B,U)<=0?W.left:W.right;R[_>>2]=W.est.rgba}m[A]=R.buffer}return{bufs:m,plte:h}},w.quantize.getNearest=function(p,x,M,m,b){if(p.left==null)return p.tdst=w.quantize.dist(p.est.q,x,M,m,b),p;var _=w.quantize.planeDst(p.est,x,M,m,b),g=p.left,v=p.right;_>0&&(g=p.right,v=p.left);var r=w.quantize.getNearest(g,x,M,m,b);if(r.tdst<=_*_)return r;var e=w.quantize.getNearest(v,x,M,m,b);return e.tdst<r.tdst?e:r},w.quantize.planeDst=function(p,x,M,m,b){var _=p.e;return _[0]*x+_[1]*M+_[2]*m+_[3]*b-p.eMq},w.quantize.dist=function(p,x,M,m,b){var _=x-p[0],g=M-p[1],v=m-p[2],r=b-p[3];return _*_+g*g+v*v+r*r},w.quantize.splitPixels=function(p,x,M,m,b,_){var g=w.quantize.vecDot;for(m-=4;M<m;){for(;g(p,M,b)<=_;)M+=4;for(;g(p,m,b)>_;)m-=4;if(M>=m)break;var v=x[M>>2];x[M>>2]=x[m>>2],x[m>>2]=v,M+=4,m-=4}for(;g(p,M,b)>_;)M-=4;return M+4},w.quantize.vecDot=function(p,x,M){return p[x]*M[0]+p[x+1]*M[1]+p[x+2]*M[2]+p[x+3]*M[3]},w.quantize.stats=function(p,x,M){for(var m=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],b=[0,0,0,0],_=M-x>>2,g=x;g<M;g+=4){var v=p[g]*.00392156862745098,r=p[g+1]*(1/255),e=p[g+2]*(1/255),t=p[g+3]*(1/255);b[0]+=v,b[1]+=r,b[2]+=e,b[3]+=t,m[0]+=v*v,m[1]+=v*r,m[2]+=v*e,m[3]+=v*t,m[5]+=r*r,m[6]+=r*e,m[7]+=r*t,m[10]+=e*e,m[11]+=e*t,m[15]+=t*t}return m[4]=m[1],m[8]=m[2],m[12]=m[3],m[9]=m[6],m[13]=m[7],m[14]=m[11],{R:m,m:b,N:_}},w.quantize.estats=function(p){var x=p.R,M=p.m,m=p.N,b=M[0],_=M[1],g=M[2],v=M[3],r=m==0?0:1/m,e=[x[0]-b*b*r,x[1]-b*_*r,x[2]-b*g*r,x[3]-b*v*r,x[4]-_*b*r,x[5]-_*_*r,x[6]-_*g*r,x[7]-_*v*r,x[8]-g*b*r,x[9]-g*_*r,x[10]-g*g*r,x[11]-g*v*r,x[12]-v*b*r,x[13]-v*_*r,x[14]-v*g*r,x[15]-v*v*r],t=e,n=w.M4,o=[.5,.5,.5,.5],h=0,d=0;if(m!=0)for(var i=0;i<10&&(o=n.multVec(t,o),d=Math.sqrt(n.dot(o,o)),o=n.sml(1/d,o),!(Math.abs(d-h)<1e-9));i++)h=d;var s=[b*r,_*r,g*r,v*r],a=n.dot(n.sml(255,s),o),c=s[3]<.001?0:1/s[3];return{Cov:e,q:s,e:o,L:h,eMq255:a,eMq:n.dot(o,s),rgba:(Math.round(255*s[3])<<24|Math.round(255*s[2]*c)<<16|Math.round(255*s[1]*c)<<8|Math.round(255*s[0]*c)<<0)>>>0}},w.M4={multVec:function(p,x){return[p[0]*x[0]+p[1]*x[1]+p[2]*x[2]+p[3]*x[3],p[4]*x[0]+p[5]*x[1]+p[6]*x[2]+p[7]*x[3],p[8]*x[0]+p[9]*x[1]+p[10]*x[2]+p[11]*x[3],p[12]*x[0]+p[13]*x[1]+p[14]*x[2]+p[15]*x[3]]},dot:function(p,x){return p[0]*x[0]+p[1]*x[1]+p[2]*x[2]+p[3]*x[3]},sml:function(p,x){return[p*x[0],p*x[1],p*x[2],p*x[3]]}},w.encode.alphaMul=function(p,x){for(var M=new Uint8Array(p.length),m=p.length>>2,b=0;b<m;b++){var _=b<<2,g=p[_+3];x&&(g=g<128?0:255);var v=g*(1/255);M[_+0]=p[_+0]*v,M[_+1]=p[_+1]*v,M[_+2]=p[_+2]*v,M[_+3]=g}return M}}(E,S)})()},"./node_modules/upng-js/node_modules/pako/index.js"(K,C,f){var E=f("./node_modules/upng-js/node_modules/pako/lib/utils/common.js").assign,S=f("./node_modules/upng-js/node_modules/pako/lib/deflate.js"),w=f("./node_modules/upng-js/node_modules/pako/lib/inflate.js"),O=f("./node_modules/upng-js/node_modules/pako/lib/zlib/constants.js"),p={};E(p,S,w,O),K.exports=p},"./node_modules/upng-js/node_modules/pako/lib/deflate.js"(K,C,f){var E=f("./node_modules/upng-js/node_modules/pako/lib/zlib/deflate.js"),S=f("./node_modules/upng-js/node_modules/pako/lib/utils/common.js"),w=f("./node_modules/upng-js/node_modules/pako/lib/utils/strings.js"),O=f("./node_modules/upng-js/node_modules/pako/lib/zlib/messages.js"),p=f("./node_modules/upng-js/node_modules/pako/lib/zlib/zstream.js"),x=Object.prototype.toString,M=0,m=4,b=0,_=1,g=2,v=-1,r=0,e=8;function t(d){if(!(this instanceof t))return new t(d);this.options=S.assign({level:v,method:e,chunkSize:16384,windowBits:15,memLevel:8,strategy:r,to:""},d||{});var i=this.options;i.raw&&i.windowBits>0?i.windowBits=-i.windowBits:i.gzip&&i.windowBits>0&&i.windowBits<16&&(i.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new p,this.strm.avail_out=0;var s=E.deflateInit2(this.strm,i.level,i.method,i.windowBits,i.memLevel,i.strategy);if(s!==b)throw new Error(O[s]);if(i.header&&E.deflateSetHeader(this.strm,i.header),i.dictionary){var a;if(typeof i.dictionary=="string"?a=w.string2buf(i.dictionary):x.call(i.dictionary)==="[object ArrayBuffer]"?a=new Uint8Array(i.dictionary):a=i.dictionary,s=E.deflateSetDictionary(this.strm,a),s!==b)throw new Error(O[s]);this._dict_set=!0}}t.prototype.push=function(d,i){var s=this.strm,a=this.options.chunkSize,c,u;if(this.ended)return!1;u=i===~~i?i:i===!0?m:M,typeof d=="string"?s.input=w.string2buf(d):x.call(d)==="[object ArrayBuffer]"?s.input=new Uint8Array(d):s.input=d,s.next_in=0,s.avail_in=s.input.length;do{if(s.avail_out===0&&(s.output=new S.Buf8(a),s.next_out=0,s.avail_out=a),c=E.deflate(s,u),c!==_&&c!==b)return this.onEnd(c),this.ended=!0,!1;(s.avail_out===0||s.avail_in===0&&(u===m||u===g))&&(this.options.to==="string"?this.onData(w.buf2binstring(S.shrinkBuf(s.output,s.next_out))):this.onData(S.shrinkBuf(s.output,s.next_out)))}while((s.avail_in>0||s.avail_out===0)&&c!==_);return u===m?(c=E.deflateEnd(this.strm),this.onEnd(c),this.ended=!0,c===b):(u===g&&(this.onEnd(b),s.avail_out=0),!0)},t.prototype.onData=function(d){this.chunks.push(d)},t.prototype.onEnd=function(d){d===b&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=S.flattenChunks(this.chunks)),this.chunks=[],this.err=d,this.msg=this.strm.msg};function n(d,i){var s=new t(i);if(s.push(d,!0),s.err)throw s.msg||O[s.err];return s.result}function o(d,i){return i=i||{},i.raw=!0,n(d,i)}function h(d,i){return i=i||{},i.gzip=!0,n(d,i)}C.Deflate=t,C.deflate=n,C.deflateRaw=o,C.gzip=h},"./node_modules/upng-js/node_modules/pako/lib/inflate.js"(K,C,f){var E=f("./node_modules/upng-js/node_modules/pako/lib/zlib/inflate.js"),S=f("./node_modules/upng-js/node_modules/pako/lib/utils/common.js"),w=f("./node_modules/upng-js/node_modules/pako/lib/utils/strings.js"),O=f("./node_modules/upng-js/node_modules/pako/lib/zlib/constants.js"),p=f("./node_modules/upng-js/node_modules/pako/lib/zlib/messages.js"),x=f("./node_modules/upng-js/node_modules/pako/lib/zlib/zstream.js"),M=f("./node_modules/upng-js/node_modules/pako/lib/zlib/gzheader.js"),m=Object.prototype.toString;function b(v){if(!(this instanceof b))return new b(v);this.options=S.assign({chunkSize:16384,windowBits:0,to:""},v||{});var r=this.options;r.raw&&r.windowBits>=0&&r.windowBits<16&&(r.windowBits=-r.windowBits,r.windowBits===0&&(r.windowBits=-15)),r.windowBits>=0&&r.windowBits<16&&!(v&&v.windowBits)&&(r.windowBits+=32),r.windowBits>15&&r.windowBits<48&&(r.windowBits&15||(r.windowBits|=15)),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new x,this.strm.avail_out=0;var e=E.inflateInit2(this.strm,r.windowBits);if(e!==O.Z_OK)throw new Error(p[e]);if(this.header=new M,E.inflateGetHeader(this.strm,this.header),r.dictionary&&(typeof r.dictionary=="string"?r.dictionary=w.string2buf(r.dictionary):m.call(r.dictionary)==="[object ArrayBuffer]"&&(r.dictionary=new Uint8Array(r.dictionary)),r.raw&&(e=E.inflateSetDictionary(this.strm,r.dictionary),e!==O.Z_OK)))throw new Error(p[e])}b.prototype.push=function(v,r){var e=this.strm,t=this.options.chunkSize,n=this.options.dictionary,o,h,d,i,s,a=!1;if(this.ended)return!1;h=r===~~r?r:r===!0?O.Z_FINISH:O.Z_NO_FLUSH,typeof v=="string"?e.input=w.binstring2buf(v):m.call(v)==="[object ArrayBuffer]"?e.input=new Uint8Array(v):e.input=v,e.next_in=0,e.avail_in=e.input.length;do{if(e.avail_out===0&&(e.output=new S.Buf8(t),e.next_out=0,e.avail_out=t),o=E.inflate(e,O.Z_NO_FLUSH),o===O.Z_NEED_DICT&&n&&(o=E.inflateSetDictionary(this.strm,n)),o===O.Z_BUF_ERROR&&a===!0&&(o=O.Z_OK,a=!1),o!==O.Z_STREAM_END&&o!==O.Z_OK)return this.onEnd(o),this.ended=!0,!1;e.next_out&&(e.avail_out===0||o===O.Z_STREAM_END||e.avail_in===0&&(h===O.Z_FINISH||h===O.Z_SYNC_FLUSH))&&(this.options.to==="string"?(d=w.utf8border(e.output,e.next_out),i=e.next_out-d,s=w.buf2string(e.output,d),e.next_out=i,e.avail_out=t-i,i&&S.arraySet(e.output,e.output,d,i,0),this.onData(s)):this.onData(S.shrinkBuf(e.output,e.next_out))),e.avail_in===0&&e.avail_out===0&&(a=!0)}while((e.avail_in>0||e.avail_out===0)&&o!==O.Z_STREAM_END);return o===O.Z_STREAM_END&&(h=O.Z_FINISH),h===O.Z_FINISH?(o=E.inflateEnd(this.strm),this.onEnd(o),this.ended=!0,o===O.Z_OK):(h===O.Z_SYNC_FLUSH&&(this.onEnd(O.Z_OK),e.avail_out=0),!0)},b.prototype.onData=function(v){this.chunks.push(v)},b.prototype.onEnd=function(v){v===O.Z_OK&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=S.flattenChunks(this.chunks)),this.chunks=[],this.err=v,this.msg=this.strm.msg};function _(v,r){var e=new b(r);if(e.push(v,!0),e.err)throw e.msg||p[e.err];return e.result}function g(v,r){return r=r||{},r.raw=!0,_(v,r)}C.Inflate=b,C.inflate=_,C.inflateRaw=g,C.ungzip=_},"./node_modules/upng-js/node_modules/pako/lib/utils/common.js"(K,C){var f=typeof Uint8Array<"u"&&typeof Uint16Array<"u"&&typeof Int32Array<"u";function E(O,p){return Object.prototype.hasOwnProperty.call(O,p)}C.assign=function(O){for(var p=Array.prototype.slice.call(arguments,1);p.length;){var x=p.shift();if(x){if(typeof x!="object")throw new TypeError(x+"must be non-object");for(var M in x)E(x,M)&&(O[M]=x[M])}}return O},C.shrinkBuf=function(O,p){return O.length===p?O:O.subarray?O.subarray(0,p):(O.length=p,O)};var S={arraySet:function(O,p,x,M,m){if(p.subarray&&O.subarray){O.set(p.subarray(x,x+M),m);return}for(var b=0;b<M;b++)O[m+b]=p[x+b]},flattenChunks:function(O){var p,x,M,m,b,_;for(M=0,p=0,x=O.length;p<x;p++)M+=O[p].length;for(_=new Uint8Array(M),m=0,p=0,x=O.length;p<x;p++)b=O[p],_.set(b,m),m+=b.length;return _}},w={arraySet:function(O,p,x,M,m){for(var b=0;b<M;b++)O[m+b]=p[x+b]},flattenChunks:function(O){return[].concat.apply([],O)}};C.setTyped=function(O){O?(C.Buf8=Uint8Array,C.Buf16=Uint16Array,C.Buf32=Int32Array,C.assign(C,S)):(C.Buf8=Array,C.Buf16=Array,C.Buf32=Array,C.assign(C,w))},C.setTyped(f)},"./node_modules/upng-js/node_modules/pako/lib/utils/strings.js"(K,C,f){var E=f("./node_modules/upng-js/node_modules/pako/lib/utils/common.js"),S=!0,w=!0;try{String.fromCharCode.apply(null,[0])}catch{S=!1}try{String.fromCharCode.apply(null,new Uint8Array(1))}catch{w=!1}for(var O=new E.Buf8(256),p=0;p<256;p++)O[p]=p>=252?6:p>=248?5:p>=240?4:p>=224?3:p>=192?2:1;O[254]=O[254]=1,C.string2buf=function(M){var m,b,_,g,v,r=M.length,e=0;for(g=0;g<r;g++)b=M.charCodeAt(g),(b&64512)===55296&&g+1<r&&(_=M.charCodeAt(g+1),(_&64512)===56320&&(b=65536+(b-55296<<10)+(_-56320),g++)),e+=b<128?1:b<2048?2:b<65536?3:4;for(m=new E.Buf8(e),v=0,g=0;v<e;g++)b=M.charCodeAt(g),(b&64512)===55296&&g+1<r&&(_=M.charCodeAt(g+1),(_&64512)===56320&&(b=65536+(b-55296<<10)+(_-56320),g++)),b<128?m[v++]=b:b<2048?(m[v++]=192|b>>>6,m[v++]=128|b&63):b<65536?(m[v++]=224|b>>>12,m[v++]=128|b>>>6&63,m[v++]=128|b&63):(m[v++]=240|b>>>18,m[v++]=128|b>>>12&63,m[v++]=128|b>>>6&63,m[v++]=128|b&63);return m};function x(M,m){if(m<65534&&(M.subarray&&w||!M.subarray&&S))return String.fromCharCode.apply(null,E.shrinkBuf(M,m));for(var b="",_=0;_<m;_++)b+=String.fromCharCode(M[_]);return b}C.buf2binstring=function(M){return x(M,M.length)},C.binstring2buf=function(M){for(var m=new E.Buf8(M.length),b=0,_=m.length;b<_;b++)m[b]=M.charCodeAt(b);return m},C.buf2string=function(M,m){var b,_,g,v,r=m||M.length,e=new Array(r*2);for(_=0,b=0;b<r;){if(g=M[b++],g<128){e[_++]=g;continue}if(v=O[g],v>4){e[_++]=65533,b+=v-1;continue}for(g&=v===2?31:v===3?15:7;v>1&&b<r;)g=g<<6|M[b++]&63,v--;if(v>1){e[_++]=65533;continue}g<65536?e[_++]=g:(g-=65536,e[_++]=55296|g>>10&1023,e[_++]=56320|g&1023)}return x(e,_)},C.utf8border=function(M,m){var b;for(m=m||M.length,m>M.length&&(m=M.length),b=m-1;b>=0&&(M[b]&192)===128;)b--;return b<0||b===0?m:b+O[M[b]]>m?b:m}},"./node_modules/upng-js/node_modules/pako/lib/zlib/adler32.js"(K){function C(f,E,S,w){for(var O=f&65535|0,p=f>>>16&65535|0,x=0;S!==0;){x=S>2e3?2e3:S,S-=x;do O=O+E[w++]|0,p=p+O|0;while(--x);O%=65521,p%=65521}return O|p<<16|0}K.exports=C},"./node_modules/upng-js/node_modules/pako/lib/zlib/constants.js"(K){K.exports={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8}},"./node_modules/upng-js/node_modules/pako/lib/zlib/crc32.js"(K){function C(){for(var S,w=[],O=0;O<256;O++){S=O;for(var p=0;p<8;p++)S=S&1?3988292384^S>>>1:S>>>1;w[O]=S}return w}var f=C();function E(S,w,O,p){var x=f,M=p+O;S^=-1;for(var m=p;m<M;m++)S=S>>>8^x[(S^w[m])&255];return S^-1}K.exports=E},"./node_modules/upng-js/node_modules/pako/lib/zlib/deflate.js"(K,C,f){var E=f("./node_modules/upng-js/node_modules/pako/lib/utils/common.js"),S=f("./node_modules/upng-js/node_modules/pako/lib/zlib/trees.js"),w=f("./node_modules/upng-js/node_modules/pako/lib/zlib/adler32.js"),O=f("./node_modules/upng-js/node_modules/pako/lib/zlib/crc32.js"),p=f("./node_modules/upng-js/node_modules/pako/lib/zlib/messages.js"),x=0,M=1,m=3,b=4,_=5,g=0,v=1,r=-2,e=-3,t=-5,n=-1,o=1,h=2,d=3,i=4,s=0,a=2,c=8,u=9,A=15,L=8,D=29,R=256,P=R+1+D,z=30,F=19,B=2*P+1,U=15,W=3,I=258,V=I+W+1,ee=32,te=42,ae=69,re=73,fe=91,q=103,oe=113,be=666,ge=1,Le=2,pe=3,J=4,ce=3;function Me(T,de){return T.msg=p[de],de}function Fe(T){return(T<<1)-(T>4?9:0)}function ze(T){for(var de=T.length;--de>=0;)T[de]=0}function Be(T){var de=T.state,he=de.pending;he>T.avail_out&&(he=T.avail_out),he!==0&&(E.arraySet(T.output,de.pending_buf,de.pending_out,he,T.next_out),T.next_out+=he,de.pending_out+=he,T.total_out+=he,T.avail_out-=he,de.pending-=he,de.pending===0&&(de.pending_out=0))}function Ue(T,de){S._tr_flush_block(T,T.block_start>=0?T.block_start:-1,T.strstart-T.block_start,de),T.block_start=T.strstart,Be(T.strm)}function Se(T,de){T.pending_buf[T.pending++]=de}function Ie(T,de){T.pending_buf[T.pending++]=de>>>8&255,T.pending_buf[T.pending++]=de&255}function Re(T,de,he,H){var ne=T.avail_in;return ne>H&&(ne=H),ne===0?0:(T.avail_in-=ne,E.arraySet(de,T.input,T.next_in,ne,he),T.state.wrap===1?T.adler=w(T.adler,de,ne,he):T.state.wrap===2&&(T.adler=O(T.adler,de,ne,he)),T.next_in+=ne,T.total_in+=ne,ne)}function Oe(T,de){var he=T.max_chain_length,H=T.strstart,ne,xe,je=T.prev_length,ke=T.nice_match,Ne=T.strstart>T.w_size-V?T.strstart-(T.w_size-V):0,Qe=T.window,_t=T.w_mask,et=T.prev,Ze=T.strstart+I,Xe=Qe[H+je-1],at=Qe[H+je];T.prev_length>=T.good_match&&(he>>=2),ke>T.lookahead&&(ke=T.lookahead);do if(ne=de,!(Qe[ne+je]!==at||Qe[ne+je-1]!==Xe||Qe[ne]!==Qe[H]||Qe[++ne]!==Qe[H+1])){H+=2,ne++;do;while(Qe[++H]===Qe[++ne]&&Qe[++H]===Qe[++ne]&&Qe[++H]===Qe[++ne]&&Qe[++H]===Qe[++ne]&&Qe[++H]===Qe[++ne]&&Qe[++H]===Qe[++ne]&&Qe[++H]===Qe[++ne]&&Qe[++H]===Qe[++ne]&&H<Ze);if(xe=I-(Ze-H),H=Ze-I,xe>je){if(T.match_start=de,je=xe,xe>=ke)break;Xe=Qe[H+je-1],at=Qe[H+je]}}while((de=et[de&_t])>Ne&&--he!==0);return je<=T.lookahead?je:T.lookahead}function Ge(T){var de=T.w_size,he,H,ne,xe,je;do{if(xe=T.window_size-T.lookahead-T.strstart,T.strstart>=de+(de-V)){E.arraySet(T.window,T.window,de,de,0),T.match_start-=de,T.strstart-=de,T.block_start-=de,H=T.hash_size,he=H;do ne=T.head[--he],T.head[he]=ne>=de?ne-de:0;while(--H);H=de,he=H;do ne=T.prev[--he],T.prev[he]=ne>=de?ne-de:0;while(--H);xe+=de}if(T.strm.avail_in===0)break;if(H=Re(T.strm,T.window,T.strstart+T.lookahead,xe),T.lookahead+=H,T.lookahead+T.insert>=W)for(je=T.strstart-T.insert,T.ins_h=T.window[je],T.ins_h=(T.ins_h<<T.hash_shift^T.window[je+1])&T.hash_mask;T.insert&&(T.ins_h=(T.ins_h<<T.hash_shift^T.window[je+W-1])&T.hash_mask,T.prev[je&T.w_mask]=T.head[T.ins_h],T.head[T.ins_h]=je,je++,T.insert--,!(T.lookahead+T.insert<W)););}while(T.lookahead<V&&T.strm.avail_in!==0)}function Ve(T,de){var he=65535;for(he>T.pending_buf_size-5&&(he=T.pending_buf_size-5);;){if(T.lookahead<=1){if(Ge(T),T.lookahead===0&&de===x)return ge;if(T.lookahead===0)break}T.strstart+=T.lookahead,T.lookahead=0;var H=T.block_start+he;if((T.strstart===0||T.strstart>=H)&&(T.lookahead=T.strstart-H,T.strstart=H,Ue(T,!1),T.strm.avail_out===0)||T.strstart-T.block_start>=T.w_size-V&&(Ue(T,!1),T.strm.avail_out===0))return ge}return T.insert=0,de===b?(Ue(T,!0),T.strm.avail_out===0?pe:J):(T.strstart>T.block_start&&(Ue(T,!1),T.strm.avail_out===0),ge)}function j(T,de){for(var he,H;;){if(T.lookahead<V){if(Ge(T),T.lookahead<V&&de===x)return ge;if(T.lookahead===0)break}if(he=0,T.lookahead>=W&&(T.ins_h=(T.ins_h<<T.hash_shift^T.window[T.strstart+W-1])&T.hash_mask,he=T.prev[T.strstart&T.w_mask]=T.head[T.ins_h],T.head[T.ins_h]=T.strstart),he!==0&&T.strstart-he<=T.w_size-V&&(T.match_length=Oe(T,he)),T.match_length>=W)if(H=S._tr_tally(T,T.strstart-T.match_start,T.match_length-W),T.lookahead-=T.match_length,T.match_length<=T.max_lazy_match&&T.lookahead>=W){T.match_length--;do T.strstart++,T.ins_h=(T.ins_h<<T.hash_shift^T.window[T.strstart+W-1])&T.hash_mask,he=T.prev[T.strstart&T.w_mask]=T.head[T.ins_h],T.head[T.ins_h]=T.strstart;while(--T.match_length!==0);T.strstart++}else T.strstart+=T.match_length,T.match_length=0,T.ins_h=T.window[T.strstart],T.ins_h=(T.ins_h<<T.hash_shift^T.window[T.strstart+1])&T.hash_mask;else H=S._tr_tally(T,0,T.window[T.strstart]),T.lookahead--,T.strstart++;if(H&&(Ue(T,!1),T.strm.avail_out===0))return ge}return T.insert=T.strstart<W-1?T.strstart:W-1,de===b?(Ue(T,!0),T.strm.avail_out===0?pe:J):T.last_lit&&(Ue(T,!1),T.strm.avail_out===0)?ge:Le}function Y(T,de){for(var he,H,ne;;){if(T.lookahead<V){if(Ge(T),T.lookahead<V&&de===x)return ge;if(T.lookahead===0)break}if(he=0,T.lookahead>=W&&(T.ins_h=(T.ins_h<<T.hash_shift^T.window[T.strstart+W-1])&T.hash_mask,he=T.prev[T.strstart&T.w_mask]=T.head[T.ins_h],T.head[T.ins_h]=T.strstart),T.prev_length=T.match_length,T.prev_match=T.match_start,T.match_length=W-1,he!==0&&T.prev_length<T.max_lazy_match&&T.strstart-he<=T.w_size-V&&(T.match_length=Oe(T,he),T.match_length<=5&&(T.strategy===o||T.match_length===W&&T.strstart-T.match_start>4096)&&(T.match_length=W-1)),T.prev_length>=W&&T.match_length<=T.prev_length){ne=T.strstart+T.lookahead-W,H=S._tr_tally(T,T.strstart-1-T.prev_match,T.prev_length-W),T.lookahead-=T.prev_length-1,T.prev_length-=2;do++T.strstart<=ne&&(T.ins_h=(T.ins_h<<T.hash_shift^T.window[T.strstart+W-1])&T.hash_mask,he=T.prev[T.strstart&T.w_mask]=T.head[T.ins_h],T.head[T.ins_h]=T.strstart);while(--T.prev_length!==0);if(T.match_available=0,T.match_length=W-1,T.strstart++,H&&(Ue(T,!1),T.strm.avail_out===0))return ge}else if(T.match_available){if(H=S._tr_tally(T,0,T.window[T.strstart-1]),H&&Ue(T,!1),T.strstart++,T.lookahead--,T.strm.avail_out===0)return ge}else T.match_available=1,T.strstart++,T.lookahead--}return T.match_available&&(H=S._tr_tally(T,0,T.window[T.strstart-1]),T.match_available=0),T.insert=T.strstart<W-1?T.strstart:W-1,de===b?(Ue(T,!0),T.strm.avail_out===0?pe:J):T.last_lit&&(Ue(T,!1),T.strm.avail_out===0)?ge:Le}function X(T,de){for(var he,H,ne,xe,je=T.window;;){if(T.lookahead<=I){if(Ge(T),T.lookahead<=I&&de===x)return ge;if(T.lookahead===0)break}if(T.match_length=0,T.lookahead>=W&&T.strstart>0&&(ne=T.strstart-1,H=je[ne],H===je[++ne]&&H===je[++ne]&&H===je[++ne])){xe=T.strstart+I;do;while(H===je[++ne]&&H===je[++ne]&&H===je[++ne]&&H===je[++ne]&&H===je[++ne]&&H===je[++ne]&&H===je[++ne]&&H===je[++ne]&&ne<xe);T.match_length=I-(xe-ne),T.match_length>T.lookahead&&(T.match_length=T.lookahead)}if(T.match_length>=W?(he=S._tr_tally(T,1,T.match_length-W),T.lookahead-=T.match_length,T.strstart+=T.match_length,T.match_length=0):(he=S._tr_tally(T,0,T.window[T.strstart]),T.lookahead--,T.strstart++),he&&(Ue(T,!1),T.strm.avail_out===0))return ge}return T.insert=0,de===b?(Ue(T,!0),T.strm.avail_out===0?pe:J):T.last_lit&&(Ue(T,!1),T.strm.avail_out===0)?ge:Le}function _e(T,de){for(var he;;){if(T.lookahead===0&&(Ge(T),T.lookahead===0)){if(de===x)return ge;break}if(T.match_length=0,he=S._tr_tally(T,0,T.window[T.strstart]),T.lookahead--,T.strstart++,he&&(Ue(T,!1),T.strm.avail_out===0))return ge}return T.insert=0,de===b?(Ue(T,!0),T.strm.avail_out===0?pe:J):T.last_lit&&(Ue(T,!1),T.strm.avail_out===0)?ge:Le}function ue(T,de,he,H,ne){this.good_length=T,this.max_lazy=de,this.nice_length=he,this.max_chain=H,this.func=ne}var we;we=[new ue(0,0,0,0,Ve),new ue(4,4,8,4,j),new ue(4,5,16,8,j),new ue(4,6,32,32,j),new ue(4,4,16,16,Y),new ue(8,16,32,32,Y),new ue(8,16,128,128,Y),new ue(8,32,128,256,Y),new ue(32,128,258,1024,Y),new ue(32,258,258,4096,Y)];function De(T){T.window_size=2*T.w_size,ze(T.head),T.max_lazy_match=we[T.level].max_lazy,T.good_match=we[T.level].good_length,T.nice_match=we[T.level].nice_length,T.max_chain_length=we[T.level].max_chain,T.strstart=0,T.block_start=0,T.lookahead=0,T.insert=0,T.match_length=T.prev_length=W-1,T.match_available=0,T.ins_h=0}function G(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=c,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new E.Buf16(B*2),this.dyn_dtree=new E.Buf16((2*z+1)*2),this.bl_tree=new E.Buf16((2*F+1)*2),ze(this.dyn_ltree),ze(this.dyn_dtree),ze(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new E.Buf16(U+1),this.heap=new E.Buf16(2*P+1),ze(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new E.Buf16(2*P+1),ze(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}function se(T){var de;return!T||!T.state?Me(T,r):(T.total_in=T.total_out=0,T.data_type=a,de=T.state,de.pending=0,de.pending_out=0,de.wrap<0&&(de.wrap=-de.wrap),de.status=de.wrap?te:oe,T.adler=de.wrap===2?0:1,de.last_flush=x,S._tr_init(de),g)}function ve(T){var de=se(T);return de===g&&De(T.state),de}function Te(T,de){return!T||!T.state||T.state.wrap!==2?r:(T.state.gzhead=de,g)}function ie(T,de,he,H,ne,xe){if(!T)return r;var je=1;if(de===n&&(de=6),H<0?(je=0,H=-H):H>15&&(je=2,H-=16),ne<1||ne>u||he!==c||H<8||H>15||de<0||de>9||xe<0||xe>i)return Me(T,r);H===8&&(H=9);var ke=new G;return T.state=ke,ke.strm=T,ke.wrap=je,ke.gzhead=null,ke.w_bits=H,ke.w_size=1<<ke.w_bits,ke.w_mask=ke.w_size-1,ke.hash_bits=ne+7,ke.hash_size=1<<ke.hash_bits,ke.hash_mask=ke.hash_size-1,ke.hash_shift=~~((ke.hash_bits+W-1)/W),ke.window=new E.Buf8(ke.w_size*2),ke.head=new E.Buf16(ke.hash_size),ke.prev=new E.Buf16(ke.w_size),ke.lit_bufsize=1<<ne+6,ke.pending_buf_size=ke.lit_bufsize*4,ke.pending_buf=new E.Buf8(ke.pending_buf_size),ke.d_buf=1*ke.lit_bufsize,ke.l_buf=3*ke.lit_bufsize,ke.level=de,ke.strategy=xe,ke.method=he,ve(T)}function ye(T,de){return ie(T,de,c,A,L,s)}function k(T,de){var he,H,ne,xe;if(!T||!T.state||de>_||de<0)return T?Me(T,r):r;if(H=T.state,!T.output||!T.input&&T.avail_in!==0||H.status===be&&de!==b)return Me(T,T.avail_out===0?t:r);if(H.strm=T,he=H.last_flush,H.last_flush=de,H.status===te)if(H.wrap===2)T.adler=0,Se(H,31),Se(H,139),Se(H,8),H.gzhead?(Se(H,(H.gzhead.text?1:0)+(H.gzhead.hcrc?2:0)+(H.gzhead.extra?4:0)+(H.gzhead.name?8:0)+(H.gzhead.comment?16:0)),Se(H,H.gzhead.time&255),Se(H,H.gzhead.time>>8&255),Se(H,H.gzhead.time>>16&255),Se(H,H.gzhead.time>>24&255),Se(H,H.level===9?2:H.strategy>=h||H.level<2?4:0),Se(H,H.gzhead.os&255),H.gzhead.extra&&H.gzhead.extra.length&&(Se(H,H.gzhead.extra.length&255),Se(H,H.gzhead.extra.length>>8&255)),H.gzhead.hcrc&&(T.adler=O(T.adler,H.pending_buf,H.pending,0)),H.gzindex=0,H.status=ae):(Se(H,0),Se(H,0),Se(H,0),Se(H,0),Se(H,0),Se(H,H.level===9?2:H.strategy>=h||H.level<2?4:0),Se(H,ce),H.status=oe);else{var je=c+(H.w_bits-8<<4)<<8,ke=-1;H.strategy>=h||H.level<2?ke=0:H.level<6?ke=1:H.level===6?ke=2:ke=3,je|=ke<<6,H.strstart!==0&&(je|=ee),je+=31-je%31,H.status=oe,Ie(H,je),H.strstart!==0&&(Ie(H,T.adler>>>16),Ie(H,T.adler&65535)),T.adler=1}if(H.status===ae)if(H.gzhead.extra){for(ne=H.pending;H.gzindex<(H.gzhead.extra.length&65535)&&!(H.pending===H.pending_buf_size&&(H.gzhead.hcrc&&H.pending>ne&&(T.adler=O(T.adler,H.pending_buf,H.pending-ne,ne)),Be(T),ne=H.pending,H.pending===H.pending_buf_size));)Se(H,H.gzhead.extra[H.gzindex]&255),H.gzindex++;H.gzhead.hcrc&&H.pending>ne&&(T.adler=O(T.adler,H.pending_buf,H.pending-ne,ne)),H.gzindex===H.gzhead.extra.length&&(H.gzindex=0,H.status=re)}else H.status=re;if(H.status===re)if(H.gzhead.name){ne=H.pending;do{if(H.pending===H.pending_buf_size&&(H.gzhead.hcrc&&H.pending>ne&&(T.adler=O(T.adler,H.pending_buf,H.pending-ne,ne)),Be(T),ne=H.pending,H.pending===H.pending_buf_size)){xe=1;break}H.gzindex<H.gzhead.name.length?xe=H.gzhead.name.charCodeAt(H.gzindex++)&255:xe=0,Se(H,xe)}while(xe!==0);H.gzhead.hcrc&&H.pending>ne&&(T.adler=O(T.adler,H.pending_buf,H.pending-ne,ne)),xe===0&&(H.gzindex=0,H.status=fe)}else H.status=fe;if(H.status===fe)if(H.gzhead.comment){ne=H.pending;do{if(H.pending===H.pending_buf_size&&(H.gzhead.hcrc&&H.pending>ne&&(T.adler=O(T.adler,H.pending_buf,H.pending-ne,ne)),Be(T),ne=H.pending,H.pending===H.pending_buf_size)){xe=1;break}H.gzindex<H.gzhead.comment.length?xe=H.gzhead.comment.charCodeAt(H.gzindex++)&255:xe=0,Se(H,xe)}while(xe!==0);H.gzhead.hcrc&&H.pending>ne&&(T.adler=O(T.adler,H.pending_buf,H.pending-ne,ne)),xe===0&&(H.status=q)}else H.status=q;if(H.status===q&&(H.gzhead.hcrc?(H.pending+2>H.pending_buf_size&&Be(T),H.pending+2<=H.pending_buf_size&&(Se(H,T.adler&255),Se(H,T.adler>>8&255),T.adler=0,H.status=oe)):H.status=oe),H.pending!==0){if(Be(T),T.avail_out===0)return H.last_flush=-1,g}else if(T.avail_in===0&&Fe(de)<=Fe(he)&&de!==b)return Me(T,t);if(H.status===be&&T.avail_in!==0)return Me(T,t);if(T.avail_in!==0||H.lookahead!==0||de!==x&&H.status!==be){var Ne=H.strategy===h?_e(H,de):H.strategy===d?X(H,de):we[H.level].func(H,de);if((Ne===pe||Ne===J)&&(H.status=be),Ne===ge||Ne===pe)return T.avail_out===0&&(H.last_flush=-1),g;if(Ne===Le&&(de===M?S._tr_align(H):de!==_&&(S._tr_stored_block(H,0,0,!1),de===m&&(ze(H.head),H.lookahead===0&&(H.strstart=0,H.block_start=0,H.insert=0))),Be(T),T.avail_out===0))return H.last_flush=-1,g}return de!==b?g:H.wrap<=0?v:(H.wrap===2?(Se(H,T.adler&255),Se(H,T.adler>>8&255),Se(H,T.adler>>16&255),Se(H,T.adler>>24&255),Se(H,T.total_in&255),Se(H,T.total_in>>8&255),Se(H,T.total_in>>16&255),Se(H,T.total_in>>24&255)):(Ie(H,T.adler>>>16),Ie(H,T.adler&65535)),Be(T),H.wrap>0&&(H.wrap=-H.wrap),H.pending!==0?g:v)}function Ce(T){var de;return!T||!T.state?r:(de=T.state.status,de!==te&&de!==ae&&de!==re&&de!==fe&&de!==q&&de!==oe&&de!==be?Me(T,r):(T.state=null,de===oe?Me(T,e):g))}function Pe(T,de){var he=de.length,H,ne,xe,je,ke,Ne,Qe,_t;if(!T||!T.state||(H=T.state,je=H.wrap,je===2||je===1&&H.status!==te||H.lookahead))return r;for(je===1&&(T.adler=w(T.adler,de,he,0)),H.wrap=0,he>=H.w_size&&(je===0&&(ze(H.head),H.strstart=0,H.block_start=0,H.insert=0),_t=new E.Buf8(H.w_size),E.arraySet(_t,de,he-H.w_size,H.w_size,0),de=_t,he=H.w_size),ke=T.avail_in,Ne=T.next_in,Qe=T.input,T.avail_in=he,T.next_in=0,T.input=de,Ge(H);H.lookahead>=W;){ne=H.strstart,xe=H.lookahead-(W-1);do H.ins_h=(H.ins_h<<H.hash_shift^H.window[ne+W-1])&H.hash_mask,H.prev[ne&H.w_mask]=H.head[H.ins_h],H.head[H.ins_h]=ne,ne++;while(--xe);H.strstart=ne,H.lookahead=W-1,Ge(H)}return H.strstart+=H.lookahead,H.block_start=H.strstart,H.insert=H.lookahead,H.lookahead=0,H.match_length=H.prev_length=W-1,H.match_available=0,T.next_in=Ne,T.input=Qe,T.avail_in=ke,H.wrap=je,g}C.deflateInit=ye,C.deflateInit2=ie,C.deflateReset=ve,C.deflateResetKeep=se,C.deflateSetHeader=Te,C.deflate=k,C.deflateEnd=Ce,C.deflateSetDictionary=Pe,C.deflateInfo="pako deflate (from Nodeca project)"},"./node_modules/upng-js/node_modules/pako/lib/zlib/gzheader.js"(K){function C(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}K.exports=C},"./node_modules/upng-js/node_modules/pako/lib/zlib/inffast.js"(K){var C=30,f=12;K.exports=function(S,w){var O,p,x,M,m,b,_,g,v,r,e,t,n,o,h,d,i,s,a,c,u,A,L,D,R;O=S.state,p=S.next_in,D=S.input,x=p+(S.avail_in-5),M=S.next_out,R=S.output,m=M-(w-S.avail_out),b=M+(S.avail_out-257),_=O.dmax,g=O.wsize,v=O.whave,r=O.wnext,e=O.window,t=O.hold,n=O.bits,o=O.lencode,h=O.distcode,d=(1<<O.lenbits)-1,i=(1<<O.distbits)-1;e:do{n<15&&(t+=D[p++]<<n,n+=8,t+=D[p++]<<n,n+=8),s=o[t&d];t:for(;;){if(a=s>>>24,t>>>=a,n-=a,a=s>>>16&255,a===0)R[M++]=s&65535;else if(a&16){c=s&65535,a&=15,a&&(n<a&&(t+=D[p++]<<n,n+=8),c+=t&(1<<a)-1,t>>>=a,n-=a),n<15&&(t+=D[p++]<<n,n+=8,t+=D[p++]<<n,n+=8),s=h[t&i];i:for(;;){if(a=s>>>24,t>>>=a,n-=a,a=s>>>16&255,a&16){if(u=s&65535,a&=15,n<a&&(t+=D[p++]<<n,n+=8,n<a&&(t+=D[p++]<<n,n+=8)),u+=t&(1<<a)-1,u>_){S.msg="invalid distance too far back",O.mode=C;break e}if(t>>>=a,n-=a,a=M-m,u>a){if(a=u-a,a>v&&O.sane){S.msg="invalid distance too far back",O.mode=C;break e}if(A=0,L=e,r===0){if(A+=g-a,a<c){c-=a;do R[M++]=e[A++];while(--a);A=M-u,L=R}}else if(r<a){if(A+=g+r-a,a-=r,a<c){c-=a;do R[M++]=e[A++];while(--a);if(A=0,r<c){a=r,c-=a;do R[M++]=e[A++];while(--a);A=M-u,L=R}}}else if(A+=r-a,a<c){c-=a;do R[M++]=e[A++];while(--a);A=M-u,L=R}for(;c>2;)R[M++]=L[A++],R[M++]=L[A++],R[M++]=L[A++],c-=3;c&&(R[M++]=L[A++],c>1&&(R[M++]=L[A++]))}else{A=M-u;do R[M++]=R[A++],R[M++]=R[A++],R[M++]=R[A++],c-=3;while(c>2);c&&(R[M++]=R[A++],c>1&&(R[M++]=R[A++]))}}else if(a&64){S.msg="invalid distance code",O.mode=C;break e}else{s=h[(s&65535)+(t&(1<<a)-1)];continue i}break}}else if(a&64)if(a&32){O.mode=f;break e}else{S.msg="invalid literal/length code",O.mode=C;break e}else{s=o[(s&65535)+(t&(1<<a)-1)];continue t}break}}while(p<x&&M<b);c=n>>3,p-=c,n-=c<<3,t&=(1<<n)-1,S.next_in=p,S.next_out=M,S.avail_in=p<x?5+(x-p):5-(p-x),S.avail_out=M<b?257+(b-M):257-(M-b),O.hold=t,O.bits=n}},"./node_modules/upng-js/node_modules/pako/lib/zlib/inflate.js"(K,C,f){var E=f("./node_modules/upng-js/node_modules/pako/lib/utils/common.js"),S=f("./node_modules/upng-js/node_modules/pako/lib/zlib/adler32.js"),w=f("./node_modules/upng-js/node_modules/pako/lib/zlib/crc32.js"),O=f("./node_modules/upng-js/node_modules/pako/lib/zlib/inffast.js"),p=f("./node_modules/upng-js/node_modules/pako/lib/zlib/inftrees.js"),x=0,M=1,m=2,b=4,_=5,g=6,v=0,r=1,e=2,t=-2,n=-3,o=-4,h=-5,d=8,i=1,s=2,a=3,c=4,u=5,A=6,L=7,D=8,R=9,P=10,z=11,F=12,B=13,U=14,W=15,I=16,V=17,ee=18,te=19,ae=20,re=21,fe=22,q=23,oe=24,be=25,ge=26,Le=27,pe=28,J=29,ce=30,Me=31,Fe=32,ze=852,Be=592,Ue=15,Se=Ue;function Ie(ie){return(ie>>>24&255)+(ie>>>8&65280)+((ie&65280)<<8)+((ie&255)<<24)}function Re(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new E.Buf16(320),this.work=new E.Buf16(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}function Oe(ie){var ye;return!ie||!ie.state?t:(ye=ie.state,ie.total_in=ie.total_out=ye.total=0,ie.msg="",ye.wrap&&(ie.adler=ye.wrap&1),ye.mode=i,ye.last=0,ye.havedict=0,ye.dmax=32768,ye.head=null,ye.hold=0,ye.bits=0,ye.lencode=ye.lendyn=new E.Buf32(ze),ye.distcode=ye.distdyn=new E.Buf32(Be),ye.sane=1,ye.back=-1,v)}function Ge(ie){var ye;return!ie||!ie.state?t:(ye=ie.state,ye.wsize=0,ye.whave=0,ye.wnext=0,Oe(ie))}function Ve(ie,ye){var k,Ce;return!ie||!ie.state||(Ce=ie.state,ye<0?(k=0,ye=-ye):(k=(ye>>4)+1,ye<48&&(ye&=15)),ye&&(ye<8||ye>15))?t:(Ce.window!==null&&Ce.wbits!==ye&&(Ce.window=null),Ce.wrap=k,Ce.wbits=ye,Ge(ie))}function j(ie,ye){var k,Ce;return ie?(Ce=new Re,ie.state=Ce,Ce.window=null,k=Ve(ie,ye),k!==v&&(ie.state=null),k):t}function Y(ie){return j(ie,Se)}var X=!0,_e,ue;function we(ie){if(X){var ye;for(_e=new E.Buf32(512),ue=new E.Buf32(32),ye=0;ye<144;)ie.lens[ye++]=8;for(;ye<256;)ie.lens[ye++]=9;for(;ye<280;)ie.lens[ye++]=7;for(;ye<288;)ie.lens[ye++]=8;for(p(M,ie.lens,0,288,_e,0,ie.work,{bits:9}),ye=0;ye<32;)ie.lens[ye++]=5;p(m,ie.lens,0,32,ue,0,ie.work,{bits:5}),X=!1}ie.lencode=_e,ie.lenbits=9,ie.distcode=ue,ie.distbits=5}function De(ie,ye,k,Ce){var Pe,T=ie.state;return T.window===null&&(T.wsize=1<<T.wbits,T.wnext=0,T.whave=0,T.window=new E.Buf8(T.wsize)),Ce>=T.wsize?(E.arraySet(T.window,ye,k-T.wsize,T.wsize,0),T.wnext=0,T.whave=T.wsize):(Pe=T.wsize-T.wnext,Pe>Ce&&(Pe=Ce),E.arraySet(T.window,ye,k-Ce,Pe,T.wnext),Ce-=Pe,Ce?(E.arraySet(T.window,ye,k-Ce,Ce,0),T.wnext=Ce,T.whave=T.wsize):(T.wnext+=Pe,T.wnext===T.wsize&&(T.wnext=0),T.whave<T.wsize&&(T.whave+=Pe))),0}function G(ie,ye){var k,Ce,Pe,T,de,he,H,ne,xe,je,ke,Ne,Qe,_t,et=0,Ze,Xe,at,nt,Mt,mt,it,tt,qe=new E.Buf8(4),vt,xt,At=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];if(!ie||!ie.state||!ie.output||!ie.input&&ie.avail_in!==0)return t;k=ie.state,k.mode===F&&(k.mode=B),de=ie.next_out,Pe=ie.output,H=ie.avail_out,T=ie.next_in,Ce=ie.input,he=ie.avail_in,ne=k.hold,xe=k.bits,je=he,ke=H,tt=v;e:for(;;)switch(k.mode){case i:if(k.wrap===0){k.mode=B;break}for(;xe<16;){if(he===0)break e;he--,ne+=Ce[T++]<<xe,xe+=8}if(k.wrap&2&&ne===35615){k.check=0,qe[0]=ne&255,qe[1]=ne>>>8&255,k.check=w(k.check,qe,2,0),ne=0,xe=0,k.mode=s;break}if(k.flags=0,k.head&&(k.head.done=!1),!(k.wrap&1)||(((ne&255)<<8)+(ne>>8))%31){ie.msg="incorrect header check",k.mode=ce;break}if((ne&15)!==d){ie.msg="unknown compression method",k.mode=ce;break}if(ne>>>=4,xe-=4,it=(ne&15)+8,k.wbits===0)k.wbits=it;else if(it>k.wbits){ie.msg="invalid window size",k.mode=ce;break}k.dmax=1<<it,ie.adler=k.check=1,k.mode=ne&512?P:F,ne=0,xe=0;break;case s:for(;xe<16;){if(he===0)break e;he--,ne+=Ce[T++]<<xe,xe+=8}if(k.flags=ne,(k.flags&255)!==d){ie.msg="unknown compression method",k.mode=ce;break}if(k.flags&57344){ie.msg="unknown header flags set",k.mode=ce;break}k.head&&(k.head.text=ne>>8&1),k.flags&512&&(qe[0]=ne&255,qe[1]=ne>>>8&255,k.check=w(k.check,qe,2,0)),ne=0,xe=0,k.mode=a;case a:for(;xe<32;){if(he===0)break e;he--,ne+=Ce[T++]<<xe,xe+=8}k.head&&(k.head.time=ne),k.flags&512&&(qe[0]=ne&255,qe[1]=ne>>>8&255,qe[2]=ne>>>16&255,qe[3]=ne>>>24&255,k.check=w(k.check,qe,4,0)),ne=0,xe=0,k.mode=c;case c:for(;xe<16;){if(he===0)break e;he--,ne+=Ce[T++]<<xe,xe+=8}k.head&&(k.head.xflags=ne&255,k.head.os=ne>>8),k.flags&512&&(qe[0]=ne&255,qe[1]=ne>>>8&255,k.check=w(k.check,qe,2,0)),ne=0,xe=0,k.mode=u;case u:if(k.flags&1024){for(;xe<16;){if(he===0)break e;he--,ne+=Ce[T++]<<xe,xe+=8}k.length=ne,k.head&&(k.head.extra_len=ne),k.flags&512&&(qe[0]=ne&255,qe[1]=ne>>>8&255,k.check=w(k.check,qe,2,0)),ne=0,xe=0}else k.head&&(k.head.extra=null);k.mode=A;case A:if(k.flags&1024&&(Ne=k.length,Ne>he&&(Ne=he),Ne&&(k.head&&(it=k.head.extra_len-k.length,k.head.extra||(k.head.extra=new Array(k.head.extra_len)),E.arraySet(k.head.extra,Ce,T,Ne,it)),k.flags&512&&(k.check=w(k.check,Ce,Ne,T)),he-=Ne,T+=Ne,k.length-=Ne),k.length))break e;k.length=0,k.mode=L;case L:if(k.flags&2048){if(he===0)break e;Ne=0;do it=Ce[T+Ne++],k.head&&it&&k.length<65536&&(k.head.name+=String.fromCharCode(it));while(it&&Ne<he);if(k.flags&512&&(k.check=w(k.check,Ce,Ne,T)),he-=Ne,T+=Ne,it)break e}else k.head&&(k.head.name=null);k.length=0,k.mode=D;case D:if(k.flags&4096){if(he===0)break e;Ne=0;do it=Ce[T+Ne++],k.head&&it&&k.length<65536&&(k.head.comment+=String.fromCharCode(it));while(it&&Ne<he);if(k.flags&512&&(k.check=w(k.check,Ce,Ne,T)),he-=Ne,T+=Ne,it)break e}else k.head&&(k.head.comment=null);k.mode=R;case R:if(k.flags&512){for(;xe<16;){if(he===0)break e;he--,ne+=Ce[T++]<<xe,xe+=8}if(ne!==(k.check&65535)){ie.msg="header crc mismatch",k.mode=ce;break}ne=0,xe=0}k.head&&(k.head.hcrc=k.flags>>9&1,k.head.done=!0),ie.adler=k.check=0,k.mode=F;break;case P:for(;xe<32;){if(he===0)break e;he--,ne+=Ce[T++]<<xe,xe+=8}ie.adler=k.check=Ie(ne),ne=0,xe=0,k.mode=z;case z:if(k.havedict===0)return ie.next_out=de,ie.avail_out=H,ie.next_in=T,ie.avail_in=he,k.hold=ne,k.bits=xe,e;ie.adler=k.check=1,k.mode=F;case F:if(ye===_||ye===g)break e;case B:if(k.last){ne>>>=xe&7,xe-=xe&7,k.mode=Le;break}for(;xe<3;){if(he===0)break e;he--,ne+=Ce[T++]<<xe,xe+=8}switch(k.last=ne&1,ne>>>=1,xe-=1,ne&3){case 0:k.mode=U;break;case 1:if(we(k),k.mode=ae,ye===g){ne>>>=2,xe-=2;break e}break;case 2:k.mode=V;break;case 3:ie.msg="invalid block type",k.mode=ce}ne>>>=2,xe-=2;break;case U:for(ne>>>=xe&7,xe-=xe&7;xe<32;){if(he===0)break e;he--,ne+=Ce[T++]<<xe,xe+=8}if((ne&65535)!==(ne>>>16^65535)){ie.msg="invalid stored block lengths",k.mode=ce;break}if(k.length=ne&65535,ne=0,xe=0,k.mode=W,ye===g)break e;case W:k.mode=I;case I:if(Ne=k.length,Ne){if(Ne>he&&(Ne=he),Ne>H&&(Ne=H),Ne===0)break e;E.arraySet(Pe,Ce,T,Ne,de),he-=Ne,T+=Ne,H-=Ne,de+=Ne,k.length-=Ne;break}k.mode=F;break;case V:for(;xe<14;){if(he===0)break e;he--,ne+=Ce[T++]<<xe,xe+=8}if(k.nlen=(ne&31)+257,ne>>>=5,xe-=5,k.ndist=(ne&31)+1,ne>>>=5,xe-=5,k.ncode=(ne&15)+4,ne>>>=4,xe-=4,k.nlen>286||k.ndist>30){ie.msg="too many length or distance symbols",k.mode=ce;break}k.have=0,k.mode=ee;case ee:for(;k.have<k.ncode;){for(;xe<3;){if(he===0)break e;he--,ne+=Ce[T++]<<xe,xe+=8}k.lens[At[k.have++]]=ne&7,ne>>>=3,xe-=3}for(;k.have<19;)k.lens[At[k.have++]]=0;if(k.lencode=k.lendyn,k.lenbits=7,vt={bits:k.lenbits},tt=p(x,k.lens,0,19,k.lencode,0,k.work,vt),k.lenbits=vt.bits,tt){ie.msg="invalid code lengths set",k.mode=ce;break}k.have=0,k.mode=te;case te:for(;k.have<k.nlen+k.ndist;){for(;et=k.lencode[ne&(1<<k.lenbits)-1],Ze=et>>>24,Xe=et>>>16&255,at=et&65535,!(Ze<=xe);){if(he===0)break e;he--,ne+=Ce[T++]<<xe,xe+=8}if(at<16)ne>>>=Ze,xe-=Ze,k.lens[k.have++]=at;else{if(at===16){for(xt=Ze+2;xe<xt;){if(he===0)break e;he--,ne+=Ce[T++]<<xe,xe+=8}if(ne>>>=Ze,xe-=Ze,k.have===0){ie.msg="invalid bit length repeat",k.mode=ce;break}it=k.lens[k.have-1],Ne=3+(ne&3),ne>>>=2,xe-=2}else if(at===17){for(xt=Ze+3;xe<xt;){if(he===0)break e;he--,ne+=Ce[T++]<<xe,xe+=8}ne>>>=Ze,xe-=Ze,it=0,Ne=3+(ne&7),ne>>>=3,xe-=3}else{for(xt=Ze+7;xe<xt;){if(he===0)break e;he--,ne+=Ce[T++]<<xe,xe+=8}ne>>>=Ze,xe-=Ze,it=0,Ne=11+(ne&127),ne>>>=7,xe-=7}if(k.have+Ne>k.nlen+k.ndist){ie.msg="invalid bit length repeat",k.mode=ce;break}for(;Ne--;)k.lens[k.have++]=it}}if(k.mode===ce)break;if(k.lens[256]===0){ie.msg="invalid code -- missing end-of-block",k.mode=ce;break}if(k.lenbits=9,vt={bits:k.lenbits},tt=p(M,k.lens,0,k.nlen,k.lencode,0,k.work,vt),k.lenbits=vt.bits,tt){ie.msg="invalid literal/lengths set",k.mode=ce;break}if(k.distbits=6,k.distcode=k.distdyn,vt={bits:k.distbits},tt=p(m,k.lens,k.nlen,k.ndist,k.distcode,0,k.work,vt),k.distbits=vt.bits,tt){ie.msg="invalid distances set",k.mode=ce;break}if(k.mode=ae,ye===g)break e;case ae:k.mode=re;case re:if(he>=6&&H>=258){ie.next_out=de,ie.avail_out=H,ie.next_in=T,ie.avail_in=he,k.hold=ne,k.bits=xe,O(ie,ke),de=ie.next_out,Pe=ie.output,H=ie.avail_out,T=ie.next_in,Ce=ie.input,he=ie.avail_in,ne=k.hold,xe=k.bits,k.mode===F&&(k.back=-1);break}for(k.back=0;et=k.lencode[ne&(1<<k.lenbits)-1],Ze=et>>>24,Xe=et>>>16&255,at=et&65535,!(Ze<=xe);){if(he===0)break e;he--,ne+=Ce[T++]<<xe,xe+=8}if(Xe&&!(Xe&240)){for(nt=Ze,Mt=Xe,mt=at;et=k.lencode[mt+((ne&(1<<nt+Mt)-1)>>nt)],Ze=et>>>24,Xe=et>>>16&255,at=et&65535,!(nt+Ze<=xe);){if(he===0)break e;he--,ne+=Ce[T++]<<xe,xe+=8}ne>>>=nt,xe-=nt,k.back+=nt}if(ne>>>=Ze,xe-=Ze,k.back+=Ze,k.length=at,Xe===0){k.mode=ge;break}if(Xe&32){k.back=-1,k.mode=F;break}if(Xe&64){ie.msg="invalid literal/length code",k.mode=ce;break}k.extra=Xe&15,k.mode=fe;case fe:if(k.extra){for(xt=k.extra;xe<xt;){if(he===0)break e;he--,ne+=Ce[T++]<<xe,xe+=8}k.length+=ne&(1<<k.extra)-1,ne>>>=k.extra,xe-=k.extra,k.back+=k.extra}k.was=k.length,k.mode=q;case q:for(;et=k.distcode[ne&(1<<k.distbits)-1],Ze=et>>>24,Xe=et>>>16&255,at=et&65535,!(Ze<=xe);){if(he===0)break e;he--,ne+=Ce[T++]<<xe,xe+=8}if(!(Xe&240)){for(nt=Ze,Mt=Xe,mt=at;et=k.distcode[mt+((ne&(1<<nt+Mt)-1)>>nt)],Ze=et>>>24,Xe=et>>>16&255,at=et&65535,!(nt+Ze<=xe);){if(he===0)break e;he--,ne+=Ce[T++]<<xe,xe+=8}ne>>>=nt,xe-=nt,k.back+=nt}if(ne>>>=Ze,xe-=Ze,k.back+=Ze,Xe&64){ie.msg="invalid distance code",k.mode=ce;break}k.offset=at,k.extra=Xe&15,k.mode=oe;case oe:if(k.extra){for(xt=k.extra;xe<xt;){if(he===0)break e;he--,ne+=Ce[T++]<<xe,xe+=8}k.offset+=ne&(1<<k.extra)-1,ne>>>=k.extra,xe-=k.extra,k.back+=k.extra}if(k.offset>k.dmax){ie.msg="invalid distance too far back",k.mode=ce;break}k.mode=be;case be:if(H===0)break e;if(Ne=ke-H,k.offset>Ne){if(Ne=k.offset-Ne,Ne>k.whave&&k.sane){ie.msg="invalid distance too far back",k.mode=ce;break}Ne>k.wnext?(Ne-=k.wnext,Qe=k.wsize-Ne):Qe=k.wnext-Ne,Ne>k.length&&(Ne=k.length),_t=k.window}else _t=Pe,Qe=de-k.offset,Ne=k.length;Ne>H&&(Ne=H),H-=Ne,k.length-=Ne;do Pe[de++]=_t[Qe++];while(--Ne);k.length===0&&(k.mode=re);break;case ge:if(H===0)break e;Pe[de++]=k.length,H--,k.mode=re;break;case Le:if(k.wrap){for(;xe<32;){if(he===0)break e;he--,ne|=Ce[T++]<<xe,xe+=8}if(ke-=H,ie.total_out+=ke,k.total+=ke,ke&&(ie.adler=k.check=k.flags?w(k.check,Pe,ke,de-ke):S(k.check,Pe,ke,de-ke)),ke=H,(k.flags?ne:Ie(ne))!==k.check){ie.msg="incorrect data check",k.mode=ce;break}ne=0,xe=0}k.mode=pe;case pe:if(k.wrap&&k.flags){for(;xe<32;){if(he===0)break e;he--,ne+=Ce[T++]<<xe,xe+=8}if(ne!==(k.total&4294967295)){ie.msg="incorrect length check",k.mode=ce;break}ne=0,xe=0}k.mode=J;case J:tt=r;break e;case ce:tt=n;break e;case Me:return o;case Fe:default:return t}return ie.next_out=de,ie.avail_out=H,ie.next_in=T,ie.avail_in=he,k.hold=ne,k.bits=xe,(k.wsize||ke!==ie.avail_out&&k.mode<ce&&(k.mode<Le||ye!==b))&&De(ie,ie.output,ie.next_out,ke-ie.avail_out),je-=ie.avail_in,ke-=ie.avail_out,ie.total_in+=je,ie.total_out+=ke,k.total+=ke,k.wrap&&ke&&(ie.adler=k.check=k.flags?w(k.check,Pe,ke,ie.next_out-ke):S(k.check,Pe,ke,ie.next_out-ke)),ie.data_type=k.bits+(k.last?64:0)+(k.mode===F?128:0)+(k.mode===ae||k.mode===W?256:0),(je===0&&ke===0||ye===b)&&tt===v&&(tt=h),tt}function se(ie){if(!ie||!ie.state)return t;var ye=ie.state;return ye.window&&(ye.window=null),ie.state=null,v}function ve(ie,ye){var k;return!ie||!ie.state||(k=ie.state,!(k.wrap&2))?t:(k.head=ye,ye.done=!1,v)}function Te(ie,ye){var k=ye.length,Ce,Pe,T;return!ie||!ie.state||(Ce=ie.state,Ce.wrap!==0&&Ce.mode!==z)?t:Ce.mode===z&&(Pe=1,Pe=S(Pe,ye,k,0),Pe!==Ce.check)?n:(T=De(ie,ye,k,k),T?(Ce.mode=Me,o):(Ce.havedict=1,v))}C.inflateReset=Ge,C.inflateReset2=Ve,C.inflateResetKeep=Oe,C.inflateInit=Y,C.inflateInit2=j,C.inflate=G,C.inflateEnd=se,C.inflateGetHeader=ve,C.inflateSetDictionary=Te,C.inflateInfo="pako inflate (from Nodeca project)"},"./node_modules/upng-js/node_modules/pako/lib/zlib/inftrees.js"(K,C,f){var E=f("./node_modules/upng-js/node_modules/pako/lib/utils/common.js"),S=15,w=852,O=592,p=0,x=1,M=2,m=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],b=[16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78],_=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0],g=[16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64];K.exports=function(r,e,t,n,o,h,d,i){var s=i.bits,a=0,c=0,u=0,A=0,L=0,D=0,R=0,P=0,z=0,F=0,B,U,W,I,V,ee=null,te=0,ae,re=new E.Buf16(S+1),fe=new E.Buf16(S+1),q=null,oe=0,be,ge,Le;for(a=0;a<=S;a++)re[a]=0;for(c=0;c<n;c++)re[e[t+c]]++;for(L=s,A=S;A>=1&&re[A]===0;A--);if(L>A&&(L=A),A===0)return o[h++]=20971520,o[h++]=20971520,i.bits=1,0;for(u=1;u<A&&re[u]===0;u++);for(L<u&&(L=u),P=1,a=1;a<=S;a++)if(P<<=1,P-=re[a],P<0)return-1;if(P>0&&(r===p||A!==1))return-1;for(fe[1]=0,a=1;a<S;a++)fe[a+1]=fe[a]+re[a];for(c=0;c<n;c++)e[t+c]!==0&&(d[fe[e[t+c]]++]=c);if(r===p?(ee=q=d,ae=19):r===x?(ee=m,te-=257,q=b,oe-=257,ae=256):(ee=_,q=g,ae=-1),F=0,c=0,a=u,V=h,D=L,R=0,W=-1,z=1<<L,I=z-1,r===x&&z>w||r===M&&z>O)return 1;for(;;){be=a-R,d[c]<ae?(ge=0,Le=d[c]):d[c]>ae?(ge=q[oe+d[c]],Le=ee[te+d[c]]):(ge=96,Le=0),B=1<<a-R,U=1<<D,u=U;do U-=B,o[V+(F>>R)+U]=be<<24|ge<<16|Le|0;while(U!==0);for(B=1<<a-1;F&B;)B>>=1;if(B!==0?(F&=B-1,F+=B):F=0,c++,--re[a]===0){if(a===A)break;a=e[t+d[c]]}if(a>L&&(F&I)!==W){for(R===0&&(R=L),V+=u,D=a-R,P=1<<D;D+R<A&&(P-=re[D+R],!(P<=0));)D++,P<<=1;if(z+=1<<D,r===x&&z>w||r===M&&z>O)return 1;W=F&I,o[W]=L<<24|D<<16|V-h|0}}return F!==0&&(o[V+F]=a-R<<24|4194304|0),i.bits=L,0}},"./node_modules/upng-js/node_modules/pako/lib/zlib/messages.js"(K){K.exports={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"}},"./node_modules/upng-js/node_modules/pako/lib/zlib/trees.js"(K,C,f){var E=f("./node_modules/upng-js/node_modules/pako/lib/utils/common.js"),S=4,w=0,O=1,p=2;function x(G){for(var se=G.length;--se>=0;)G[se]=0}var M=0,m=1,b=2,_=3,g=258,v=29,r=256,e=r+1+v,t=30,n=19,o=2*e+1,h=15,d=16,i=7,s=256,a=16,c=17,u=18,A=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0],L=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],D=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7],R=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],P=512,z=new Array((e+2)*2);x(z);var F=new Array(t*2);x(F);var B=new Array(P);x(B);var U=new Array(g-_+1);x(U);var W=new Array(v);x(W);var I=new Array(t);x(I);function V(G,se,ve,Te,ie){this.static_tree=G,this.extra_bits=se,this.extra_base=ve,this.elems=Te,this.max_length=ie,this.has_stree=G&&G.length}var ee,te,ae;function re(G,se){this.dyn_tree=G,this.max_code=0,this.stat_desc=se}function fe(G){return G<256?B[G]:B[256+(G>>>7)]}function q(G,se){G.pending_buf[G.pending++]=se&255,G.pending_buf[G.pending++]=se>>>8&255}function oe(G,se,ve){G.bi_valid>d-ve?(G.bi_buf|=se<<G.bi_valid&65535,q(G,G.bi_buf),G.bi_buf=se>>d-G.bi_valid,G.bi_valid+=ve-d):(G.bi_buf|=se<<G.bi_valid&65535,G.bi_valid+=ve)}function be(G,se,ve){oe(G,ve[se*2],ve[se*2+1])}function ge(G,se){var ve=0;do ve|=G&1,G>>>=1,ve<<=1;while(--se>0);return ve>>>1}function Le(G){G.bi_valid===16?(q(G,G.bi_buf),G.bi_buf=0,G.bi_valid=0):G.bi_valid>=8&&(G.pending_buf[G.pending++]=G.bi_buf&255,G.bi_buf>>=8,G.bi_valid-=8)}function pe(G,se){var ve=se.dyn_tree,Te=se.max_code,ie=se.stat_desc.static_tree,ye=se.stat_desc.has_stree,k=se.stat_desc.extra_bits,Ce=se.stat_desc.extra_base,Pe=se.stat_desc.max_length,T,de,he,H,ne,xe,je=0;for(H=0;H<=h;H++)G.bl_count[H]=0;for(ve[G.heap[G.heap_max]*2+1]=0,T=G.heap_max+1;T<o;T++)de=G.heap[T],H=ve[ve[de*2+1]*2+1]+1,H>Pe&&(H=Pe,je++),ve[de*2+1]=H,!(de>Te)&&(G.bl_count[H]++,ne=0,de>=Ce&&(ne=k[de-Ce]),xe=ve[de*2],G.opt_len+=xe*(H+ne),ye&&(G.static_len+=xe*(ie[de*2+1]+ne)));if(je!==0){do{for(H=Pe-1;G.bl_count[H]===0;)H--;G.bl_count[H]--,G.bl_count[H+1]+=2,G.bl_count[Pe]--,je-=2}while(je>0);for(H=Pe;H!==0;H--)for(de=G.bl_count[H];de!==0;)he=G.heap[--T],!(he>Te)&&(ve[he*2+1]!==H&&(G.opt_len+=(H-ve[he*2+1])*ve[he*2],ve[he*2+1]=H),de--)}}function J(G,se,ve){var Te=new Array(h+1),ie=0,ye,k;for(ye=1;ye<=h;ye++)Te[ye]=ie=ie+ve[ye-1]<<1;for(k=0;k<=se;k++){var Ce=G[k*2+1];Ce!==0&&(G[k*2]=ge(Te[Ce]++,Ce))}}function ce(){var G,se,ve,Te,ie,ye=new Array(h+1);for(ve=0,Te=0;Te<v-1;Te++)for(W[Te]=ve,G=0;G<1<<A[Te];G++)U[ve++]=Te;for(U[ve-1]=Te,ie=0,Te=0;Te<16;Te++)for(I[Te]=ie,G=0;G<1<<L[Te];G++)B[ie++]=Te;for(ie>>=7;Te<t;Te++)for(I[Te]=ie<<7,G=0;G<1<<L[Te]-7;G++)B[256+ie++]=Te;for(se=0;se<=h;se++)ye[se]=0;for(G=0;G<=143;)z[G*2+1]=8,G++,ye[8]++;for(;G<=255;)z[G*2+1]=9,G++,ye[9]++;for(;G<=279;)z[G*2+1]=7,G++,ye[7]++;for(;G<=287;)z[G*2+1]=8,G++,ye[8]++;for(J(z,e+1,ye),G=0;G<t;G++)F[G*2+1]=5,F[G*2]=ge(G,5);ee=new V(z,A,r+1,e,h),te=new V(F,L,0,t,h),ae=new V(new Array(0),D,0,n,i)}function Me(G){var se;for(se=0;se<e;se++)G.dyn_ltree[se*2]=0;for(se=0;se<t;se++)G.dyn_dtree[se*2]=0;for(se=0;se<n;se++)G.bl_tree[se*2]=0;G.dyn_ltree[s*2]=1,G.opt_len=G.static_len=0,G.last_lit=G.matches=0}function Fe(G){G.bi_valid>8?q(G,G.bi_buf):G.bi_valid>0&&(G.pending_buf[G.pending++]=G.bi_buf),G.bi_buf=0,G.bi_valid=0}function ze(G,se,ve,Te){Fe(G),q(G,ve),q(G,~ve),E.arraySet(G.pending_buf,G.window,se,ve,G.pending),G.pending+=ve}function Be(G,se,ve,Te){var ie=se*2,ye=ve*2;return G[ie]<G[ye]||G[ie]===G[ye]&&Te[se]<=Te[ve]}function Ue(G,se,ve){for(var Te=G.heap[ve],ie=ve<<1;ie<=G.heap_len&&(ie<G.heap_len&&Be(se,G.heap[ie+1],G.heap[ie],G.depth)&&ie++,!Be(se,Te,G.heap[ie],G.depth));)G.heap[ve]=G.heap[ie],ve=ie,ie<<=1;G.heap[ve]=Te}function Se(G,se,ve){var Te,ie,ye=0,k,Ce;if(G.last_lit!==0)do Te=G.pending_buf[G.d_buf+ye*2]<<8|G.pending_buf[G.d_buf+ye*2+1],ie=G.pending_buf[G.l_buf+ye],ye++,Te===0?be(G,ie,se):(k=U[ie],be(G,k+r+1,se),Ce=A[k],Ce!==0&&(ie-=W[k],oe(G,ie,Ce)),Te--,k=fe(Te),be(G,k,ve),Ce=L[k],Ce!==0&&(Te-=I[k],oe(G,Te,Ce)));while(ye<G.last_lit);be(G,s,se)}function Ie(G,se){var ve=se.dyn_tree,Te=se.stat_desc.static_tree,ie=se.stat_desc.has_stree,ye=se.stat_desc.elems,k,Ce,Pe=-1,T;for(G.heap_len=0,G.heap_max=o,k=0;k<ye;k++)ve[k*2]!==0?(G.heap[++G.heap_len]=Pe=k,G.depth[k]=0):ve[k*2+1]=0;for(;G.heap_len<2;)T=G.heap[++G.heap_len]=Pe<2?++Pe:0,ve[T*2]=1,G.depth[T]=0,G.opt_len--,ie&&(G.static_len-=Te[T*2+1]);for(se.max_code=Pe,k=G.heap_len>>1;k>=1;k--)Ue(G,ve,k);T=ye;do k=G.heap[1],G.heap[1]=G.heap[G.heap_len--],Ue(G,ve,1),Ce=G.heap[1],G.heap[--G.heap_max]=k,G.heap[--G.heap_max]=Ce,ve[T*2]=ve[k*2]+ve[Ce*2],G.depth[T]=(G.depth[k]>=G.depth[Ce]?G.depth[k]:G.depth[Ce])+1,ve[k*2+1]=ve[Ce*2+1]=T,G.heap[1]=T++,Ue(G,ve,1);while(G.heap_len>=2);G.heap[--G.heap_max]=G.heap[1],pe(G,se),J(ve,Pe,G.bl_count)}function Re(G,se,ve){var Te,ie=-1,ye,k=se[0*2+1],Ce=0,Pe=7,T=4;for(k===0&&(Pe=138,T=3),se[(ve+1)*2+1]=65535,Te=0;Te<=ve;Te++)ye=k,k=se[(Te+1)*2+1],!(++Ce<Pe&&ye===k)&&(Ce<T?G.bl_tree[ye*2]+=Ce:ye!==0?(ye!==ie&&G.bl_tree[ye*2]++,G.bl_tree[a*2]++):Ce<=10?G.bl_tree[c*2]++:G.bl_tree[u*2]++,Ce=0,ie=ye,k===0?(Pe=138,T=3):ye===k?(Pe=6,T=3):(Pe=7,T=4))}function Oe(G,se,ve){var Te,ie=-1,ye,k=se[0*2+1],Ce=0,Pe=7,T=4;for(k===0&&(Pe=138,T=3),Te=0;Te<=ve;Te++)if(ye=k,k=se[(Te+1)*2+1],!(++Ce<Pe&&ye===k)){if(Ce<T)do be(G,ye,G.bl_tree);while(--Ce!==0);else ye!==0?(ye!==ie&&(be(G,ye,G.bl_tree),Ce--),be(G,a,G.bl_tree),oe(G,Ce-3,2)):Ce<=10?(be(G,c,G.bl_tree),oe(G,Ce-3,3)):(be(G,u,G.bl_tree),oe(G,Ce-11,7));Ce=0,ie=ye,k===0?(Pe=138,T=3):ye===k?(Pe=6,T=3):(Pe=7,T=4)}}function Ge(G){var se;for(Re(G,G.dyn_ltree,G.l_desc.max_code),Re(G,G.dyn_dtree,G.d_desc.max_code),Ie(G,G.bl_desc),se=n-1;se>=3&&G.bl_tree[R[se]*2+1]===0;se--);return G.opt_len+=3*(se+1)+5+5+4,se}function Ve(G,se,ve,Te){var ie;for(oe(G,se-257,5),oe(G,ve-1,5),oe(G,Te-4,4),ie=0;ie<Te;ie++)oe(G,G.bl_tree[R[ie]*2+1],3);Oe(G,G.dyn_ltree,se-1),Oe(G,G.dyn_dtree,ve-1)}function j(G){var se=4093624447,ve;for(ve=0;ve<=31;ve++,se>>>=1)if(se&1&&G.dyn_ltree[ve*2]!==0)return w;if(G.dyn_ltree[18]!==0||G.dyn_ltree[20]!==0||G.dyn_ltree[26]!==0)return O;for(ve=32;ve<r;ve++)if(G.dyn_ltree[ve*2]!==0)return O;return w}var Y=!1;function X(G){Y||(ce(),Y=!0),G.l_desc=new re(G.dyn_ltree,ee),G.d_desc=new re(G.dyn_dtree,te),G.bl_desc=new re(G.bl_tree,ae),G.bi_buf=0,G.bi_valid=0,Me(G)}function _e(G,se,ve,Te){oe(G,(M<<1)+(Te?1:0),3),ze(G,se,ve)}function ue(G){oe(G,m<<1,3),be(G,s,z),Le(G)}function we(G,se,ve,Te){var ie,ye,k=0;G.level>0?(G.strm.data_type===p&&(G.strm.data_type=j(G)),Ie(G,G.l_desc),Ie(G,G.d_desc),k=Ge(G),ie=G.opt_len+3+7>>>3,ye=G.static_len+3+7>>>3,ye<=ie&&(ie=ye)):ie=ye=ve+5,ve+4<=ie&&se!==-1?_e(G,se,ve,Te):G.strategy===S||ye===ie?(oe(G,(m<<1)+(Te?1:0),3),Se(G,z,F)):(oe(G,(b<<1)+(Te?1:0),3),Ve(G,G.l_desc.max_code+1,G.d_desc.max_code+1,k+1),Se(G,G.dyn_ltree,G.dyn_dtree)),Me(G),Te&&Fe(G)}function De(G,se,ve){return G.pending_buf[G.d_buf+G.last_lit*2]=se>>>8&255,G.pending_buf[G.d_buf+G.last_lit*2+1]=se&255,G.pending_buf[G.l_buf+G.last_lit]=ve&255,G.last_lit++,se===0?G.dyn_ltree[ve*2]++:(G.matches++,se--,G.dyn_ltree[(U[ve]+r+1)*2]++,G.dyn_dtree[fe(se)*2]++),G.last_lit===G.lit_bufsize-1}C._tr_init=X,C._tr_stored_block=_e,C._tr_flush_block=we,C._tr_tally=De,C._tr_align=ue},"./node_modules/upng-js/node_modules/pako/lib/zlib/zstream.js"(K){function C(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}K.exports=C},"./src/3Dmol.ts"(K,C,f){f.r(C),f.d(C,{CAP:()=>O.CAP,CC:()=>S.CC,CONTEXTS_PER_VIEWPORT:()=>M.CONTEXTS_PER_VIEWPORT,Color:()=>S.Color,CustomLinear:()=>m.CustomLinear,Cylinder:()=>o.Cylinder,GLDraw:()=>O.GLDraw,GLModel:()=>p.GLModel,GLShape:()=>x.GLShape,GLViewer:()=>M.GLViewer,GLVolumetricRender:()=>t.GLVolumetricRender,Gradient:()=>m.Gradient,GradientType:()=>m.GradientType,Label:()=>b.Label,LabelCount:()=>b.LabelCount,MarchingCube:()=>v.MarchingCube,MarchingCubeInitializer:()=>v.MarchingCubeInitializer,Matrix3:()=>n.Matrix3,Matrix4:()=>n.Matrix4,Parsers:()=>_.Parsers,PausableTimer:()=>r.PausableTimer,PointGrid:()=>v.PointGrid,ProteinSurface:()=>v.ProteinSurface,Quaternion:()=>n.Quaternion,ROYGB:()=>m.ROYGB,RWB:()=>m.RWB,Ray:()=>n.Ray,Sinebow:()=>m.Sinebow,Sphere:()=>o.Sphere,SurfaceType:()=>v.SurfaceType,Triangle:()=>o.Triangle,Vector2:()=>n.Vector2,Vector3:()=>n.Vector3,VolumeData:()=>e.VolumeData,adjustVolumeStyle:()=>r.adjustVolumeStyle,applyPartialCharges:()=>g.applyPartialCharges,autoinit:()=>E.autoinit,autoload:()=>E.autoload,base64ToArray:()=>r.base64ToArray,bondLength:()=>_.bondLength,builtinColorSchemes:()=>S.builtinColorSchemes,builtinGradients:()=>m.builtinGradients,chains:()=>S.chains,clamp:()=>n.clamp,conversionMatrix3:()=>n.conversionMatrix3,createStereoViewer:()=>M.createStereoViewer,createViewer:()=>M.createViewer,createViewerGrid:()=>M.createViewerGrid,deepCopy:()=>r.deepCopy,degToRad:()=>n.degToRad,download:()=>r.download,drawCartoon:()=>w.drawCartoon,elementColors:()=>S.elementColors,extend:()=>r.extend,get:()=>r.get,getAtomProperty:()=>r.getAtomProperty,getColorFromStyle:()=>r.getColorFromStyle,getElement:()=>r.getElement,getExtent:()=>r.getExtent,getGradient:()=>m.getGradient,getPropertyRange:()=>r.getPropertyRange,getbin:()=>r.getbin,htmlColors:()=>S.htmlColors,inflateString:()=>r.inflateString,isEmptyObject:()=>r.isEmptyObject,isNumeric:()=>r.isNumeric,makeFunction:()=>r.makeFunction,mergeGeos:()=>r.mergeGeos,normalizeValue:()=>m.normalizeValue,partialCharges:()=>g.partialCharges,processing_autoinit:()=>E.processing_autoinit,residues:()=>S.residues,setBondLength:()=>_.setBondLength,setSyncSurface:()=>v.setSyncSurface,specStringToObject:()=>r.specStringToObject,splitMesh:()=>x.splitMesh,ssColors:()=>S.ssColors,subdivide_spline:()=>w.subdivide_spline,syncSurface:()=>v.syncSurface,viewers:()=>E.viewers});var E=f("./src/autoload.ts"),S=f("./src/colors.ts"),w=f("./src/glcartoon.ts"),O=f("./src/GLDraw.ts"),p=f("./src/GLModel.ts"),x=f("./src/GLShape.ts"),M=f("./src/GLViewer.ts"),m=f("./src/Gradient.ts"),b=f("./src/Label.ts"),_=f("./src/parsers/index.ts"),g=f("./src/partialCharges.ts"),v=f("./src/ProteinSurface4.ts");f("./src/specs.ts");var r=f("./src/utilities.ts"),e=f("./src/VolumeData.ts"),t=f("./src/VolumetricRender.ts"),n=f("./src/WebGL/math/index.ts"),o=f("./src/WebGL/shapes/index.ts")},"./src/GLDraw.ts"(K,C,f){f.r(C),f.d(C,{CAP:()=>S,GLDraw:()=>w});var E=f("./src/WebGL/math/index.ts"),S;(function(O){O[O.NONE=0]="NONE",O[O.FLAT=1]="FLAT",O[O.ROUND=2]="ROUND"})(S||(S={}));var w;(function(O){function p(r,e,t){var n=Math.hypot(r,e),o,h,d,i,s;n<1e-4?(h=0,d=1):(h=-r/n,d=e/n),e=-h*r+d*e,o=Math.hypot(e,t),o<1e-4?(i=0,s=1):(i=t/o,s=e/o);var a=new Float32Array(9);return a[0]=d,a[1]=h,a[2]=0,a[3]=-h*s,a[4]=d*s,a[5]=i,a[6]=h*i,a[7]=-d*i,a[8]=s,a}class x{constructor(){this.cache={};let e=[],t=4,n=Math.pow(2,t),o=2,h=Math.pow(2,o),d=n/h,i;for(e[0]=new E.Vector3(-1,0,0),e[d]=new E.Vector3(0,0,1),e[d*2]=new E.Vector3(1,0,0),e[d*3]=new E.Vector3(0,0,-1),o=3;o<=t;o++){for(h=Math.pow(2,o-1),d=n/h,i=0;i<h-1;i++)e[d/2+i*d]=e[i*d].clone().add(e[(i+1)*d]).normalize();i=h-1,e[d/2+i*d]=e[i*d].clone().add(e[0]).normalize()}this.basisVectors=e}getVerticesForRadius(e,t,n){if(typeof this.cache<"u"&&this.cache[e]!==void 0&&this.cache[e][t+n]!==void 0)return this.cache[e][t+n];for(var o=this.basisVectors.length,h=[],d=[],i,s=0;s<o;s++)h.push(this.basisVectors[s].clone().multiplyScalar(e)),h.push(this.basisVectors[s].clone().multiplyScalar(e)),i=this.basisVectors[s].clone().normalize(),d.push(i),d.push(i);var a=[],c=10,u=o,A=0,L=Math.PI*2,D=0,R=Math.PI,P,z,F=!1,B=!1;for(z=0;z<=c;z++){F=z===0||z===c,B=z===c/2;var U=[],W=[];for(P=0;P<=u;P++){if(B){var I=P<u?2*P:0;W.push(I+1),U.push(I);continue}var V=P/u,ee=z/c;if(!F||P===0)if(P<u){var te=new E.Vector3;te.x=-e*Math.cos(A+V*L)*Math.sin(D+ee*R),t==1?te.y=0:te.y=e*Math.cos(D+ee*R),te.z=e*Math.sin(A+V*L)*Math.sin(D+ee*R),Math.abs(te.x)<1e-5&&(te.x=0),Math.abs(te.y)<1e-5&&(te.y=0),Math.abs(te.z)<1e-5&&(te.z=0),t==S.FLAT?(i=new E.Vector3(0,Math.cos(D+ee*R),0),i.normalize()):(i=new E.Vector3(te.x,te.y,te.z),i.normalize()),h.push(te),d.push(i),U.push(h.length-1)}else U.push(h.length-u);else F&&U.push(h.length-1)}B&&a.push(W),a.push(U)}var ae={vertices:h,normals:d,verticesRows:a,w:u,h:c};return e in this.cache||(this.cache[e]={}),this.cache[e][t+n]=ae,ae}}var M=new x;function m(r,e,t,n,o,h=0,d=0){if(!e||!t)return;let i=function(xe){if(typeof xe=="string"){let je=xe;return je.toLowerCase()=="flat"?S.FLAT:je.toLowerCase()=="round"?S.ROUND:S.NONE}else return xe};h=i(h),d=i(d);var s=d||h;o=o||{r:0,g:0,b:0};var a=p(t.x-e.x,t.y-e.y,t.z-e.z),c=M.getVerticesForRadius(n,d,"to"),u=c.w,A=c.h,L=s?A*u+2:2*u,D=r.updateGeoGroup(L),R=c.vertices,P=c.normals,z=c.verticesRows,F=z[A/2],B=z[A/2+1],U=D.vertices,W,I,V,ee,te,ae,re=D.vertexArray,fe=D.normalArray,q=D.colorArray,oe=D.faceArray;for(V=0;V<u;++V){var be=2*V;ee=a[0]*R[be].x+a[3]*R[be].y+a[6]*R[be].z,te=a[1]*R[be].x+a[4]*R[be].y+a[7]*R[be].z,ae=a[5]*R[be].y+a[8]*R[be].z,W=3*(U+be),I=D.faceidx,re[W]=ee+e.x,re[W+1]=te+e.y,re[W+2]=ae+e.z,re[W+3]=ee+t.x,re[W+4]=te+t.y,re[W+5]=ae+t.z,fe[W]=ee,fe[W+3]=ee,fe[W+1]=te,fe[W+4]=te,fe[W+2]=ae,fe[W+5]=ae,q[W]=o.r,q[W+3]=o.r,q[W+1]=o.g,q[W+4]=o.g,q[W+2]=o.b,q[W+5]=o.b,oe[I]=B[V]+U,oe[I+1]=B[V+1]+U,oe[I+2]=F[V]+U,oe[I+3]=F[V]+U,oe[I+4]=B[V+1]+U,oe[I+5]=F[V+1]+U,D.faceidx+=6}if(s){var ge=d?0:A/2,Le=h?A+1:A/2+1,pe,J,ce,Me,Fe,ze,Be,Ue,Se,Ie,Re,Oe,Ge,Ve,j,Y,X,_e,ue,we,De,G,se,ve,Te,ie,ye,k,Ce,Pe,T,de;for(te=ge;te<Le;te++)if(te!==A/2){var he=te<=A/2?t:e,H=M.getVerticesForRadius(n,d,"to"),ne=M.getVerticesForRadius(n,h,"from");for(he===t?(R=H.vertices,P=H.normals,z=H.verticesRows):he==e&&(R=ne.vertices,P=ne.normals,z=ne.verticesRows),ee=0;ee<u;ee++)I=D.faceidx,pe=z[te][ee+1],Ce=(pe+U)*3,J=z[te][ee],Pe=(J+U)*3,ce=z[te+1][ee],T=(ce+U)*3,Me=z[te+1][ee+1],de=(Me+U)*3,Fe=a[0]*R[pe].x+a[3]*R[pe].y+a[6]*R[pe].z,ze=a[0]*R[J].x+a[3]*R[J].y+a[6]*R[J].z,Be=a[0]*R[ce].x+a[3]*R[ce].y+a[6]*R[ce].z,Ue=a[0]*R[Me].x+a[3]*R[Me].y+a[6]*R[Me].z,Se=a[1]*R[pe].x+a[4]*R[pe].y+a[7]*R[pe].z,Ie=a[1]*R[J].x+a[4]*R[J].y+a[7]*R[J].z,Re=a[1]*R[ce].x+a[4]*R[ce].y+a[7]*R[ce].z,Oe=a[1]*R[Me].x+a[4]*R[Me].y+a[7]*R[Me].z,Ge=a[5]*R[pe].y+a[8]*R[pe].z,Ve=a[5]*R[J].y+a[8]*R[J].z,j=a[5]*R[ce].y+a[8]*R[ce].z,Y=a[5]*R[Me].y+a[8]*R[Me].z,re[Ce]=Fe+he.x,re[Pe]=ze+he.x,re[T]=Be+he.x,re[de]=Ue+he.x,re[Ce+1]=Se+he.y,re[Pe+1]=Ie+he.y,re[T+1]=Re+he.y,re[de+1]=Oe+he.y,re[Ce+2]=Ge+he.z,re[Pe+2]=Ve+he.z,re[T+2]=j+he.z,re[de+2]=Y+he.z,q[Ce]=o.r,q[Pe]=o.r,q[T]=o.r,q[de]=o.r,q[Ce+1]=o.g,q[Pe+1]=o.g,q[T+1]=o.g,q[de+1]=o.g,q[Ce+2]=o.b,q[Pe+2]=o.b,q[T+2]=o.b,q[de+2]=o.b,X=a[0]*P[pe].x+a[3]*P[pe].y+a[6]*P[pe].z,_e=a[0]*P[J].x+a[3]*P[J].y+a[6]*P[J].z,ue=a[0]*P[ce].x+a[3]*P[ce].y+a[6]*P[ce].z,we=a[0]*P[Me].x+a[3]*P[Me].y+a[6]*P[Me].z,De=a[1]*P[pe].x+a[4]*P[pe].y+a[7]*P[pe].z,G=a[1]*P[J].x+a[4]*P[J].y+a[7]*P[J].z,se=a[1]*P[ce].x+a[4]*P[ce].y+a[7]*P[ce].z,ve=a[1]*P[Me].x+a[4]*P[Me].y+a[7]*P[Me].z,Te=a[5]*P[pe].y+a[8]*P[pe].z,ie=a[5]*P[J].y+a[8]*P[J].z,ye=a[5]*P[ce].y+a[8]*P[ce].z,k=a[5]*P[Me].y+a[8]*P[Me].z,te===0?(fe[Ce]=X,fe[T]=ue,fe[de]=we,fe[Ce+1]=De,fe[T+1]=se,fe[de+1]=ve,fe[Ce+2]=Te,fe[T+2]=ye,fe[de+2]=k,oe[I]=pe+U,oe[I+1]=ce+U,oe[I+2]=Me+U,D.faceidx+=3):te===Le-1?(fe[Ce]=X,fe[Pe]=_e,fe[T]=ue,fe[Ce+1]=De,fe[Pe+1]=G,fe[T+1]=se,fe[Ce+2]=Te,fe[Pe+2]=ie,fe[T+2]=ye,oe[I]=pe+U,oe[I+1]=J+U,oe[I+2]=ce+U,D.faceidx+=3):(fe[Ce]=X,fe[Pe]=_e,fe[de]=we,fe[Ce+1]=De,fe[Pe+1]=G,fe[de+1]=ve,fe[Ce+2]=Te,fe[Pe+2]=ie,fe[de+2]=k,fe[Pe]=_e,fe[T]=ue,fe[de]=we,fe[Pe+1]=G,fe[T+1]=se,fe[de+1]=ve,fe[Pe+2]=ie,fe[T+2]=ye,fe[de+2]=k,oe[I]=pe+U,oe[I+1]=J+U,oe[I+2]=Me+U,oe[I+3]=J+U,oe[I+4]=ce+U,oe[I+5]=Me+U,D.faceidx+=6)}}D.vertices+=L}O.drawCylinder=m;function b(r,e,t,n,o){if(!e||!t)return;o=o||{r:0,g:0,b:0};let h=new E.Vector3(t.x-e.x,t.y-e.y,t.z-e.z);var d=p(h.x,h.y,h.z);h=h.normalize();var i=M.basisVectors.length,s=M.basisVectors,a=i+2,c=r.updateGeoGroup(a),u=c.vertices,A,L,D,R,P,z,F=c.vertexArray,B=c.normalArray,U=c.colorArray,W=c.faceArray;for(A=u*3,F[A]=e.x,F[A+1]=e.y,F[A+2]=e.z,B[A]=-h.x,B[A+1]=-h.y,B[A+2]=-h.z,U[A]=o.r,U[A+1]=o.g,U[A+2]=o.b,F[A+3]=t.x,F[A+4]=t.y,F[A+5]=t.z,B[A+3]=h.x,B[A+4]=h.y,B[A+5]=h.z,U[A+3]=o.r,U[A+4]=o.g,U[A+5]=o.b,A+=6,D=0;D<i;++D){var I=s[D].clone();I.multiplyScalar(n),R=d[0]*I.x+d[3]*I.y+d[6]*I.z,P=d[1]*I.x+d[4]*I.y+d[7]*I.z,z=d[5]*I.y+d[8]*I.z,F[A]=R+e.x,F[A+1]=P+e.y,F[A+2]=z+e.z,B[A]=R,B[A+1]=P,B[A+2]=z,U[A]=o.r,U[A+1]=o.g,U[A+2]=o.b,A+=3}for(c.vertices+=i+2,L=c.faceidx,D=0;D<i;D++){var V=u+2+D,ee=u+2+(D+1)%i;W[L]=V,W[L+1]=ee,W[L+2]=u,L+=3,W[L]=V,W[L+1]=ee,W[L+2]=u+1,L+=3}c.faceidx+=6*i}O.drawCone=b;class _{constructor(){this.cache=new Map}getVerticesForRadius(e,t){t=t||2,this.cache.has(t)||this.cache.set(t,new Map);let n=this.cache.get(t);if(n.has(e))return n.get(e);var o={vertices:[],verticesRows:[],normals:[]},h=16*t,d=10*t;e<1&&(h=10*t,d=8*t);var i=0,s=Math.PI*2,a=0,c=Math.PI,u,A;for(A=0;A<=d;A++){let D=[];for(u=0;u<=h;u++){let R=u/h,P=A/d,z=-e*Math.cos(i+R*s)*Math.sin(a+P*c),F=e*Math.cos(a+P*c),B=e*Math.sin(i+R*s)*Math.sin(a+P*c);var L=new E.Vector3(z,F,B);L.normalize(),o.vertices.push({x:z,y:F,z:B}),o.normals.push(L),D.push(o.vertices.length-1)}o.verticesRows.push(D)}return n.set(e,o),o}}var g=new _;function v(r,e,t,n,o){var h=g.getVerticesForRadius(t,o),d=h.vertices,i=h.normals,s=r.updateGeoGroup(d.length),a=s.vertices,c=s.vertexArray,u=s.colorArray,A=s.faceArray,L=s.lineArray,D=s.normalArray;for(let z=0,F=d.length;z<F;++z){let B=3*(a+z),U=d[z];c[B]=U.x+e.x,c[B+1]=U.y+e.y,c[B+2]=U.z+e.z,u[B]=n.r,u[B+1]=n.g,u[B+2]=n.b}s.vertices+=d.length;let R=h.verticesRows,P=R.length-1;for(let z=0;z<P;z++){let F=R[z].length-1;for(let B=0;B<F;B++){let U=s.faceidx,W=s.lineidx,I=R[z][B+1]+a,V=I*3,ee=R[z][B]+a,te=ee*3,ae=R[z+1][B]+a,re=ae*3,fe=R[z+1][B+1]+a,q=fe*3,oe=i[I-a],be=i[ee-a],ge=i[ae-a],Le=i[fe-a];Math.abs(d[I-a].y)===t?(D[V]=oe.x,D[re]=ge.x,D[q]=Le.x,D[V+1]=oe.y,D[re+1]=ge.y,D[q+1]=Le.y,D[V+2]=oe.z,D[re+2]=ge.z,D[q+2]=Le.z,A[U]=I,A[U+1]=ae,A[U+2]=fe,L[W]=I,L[W+1]=ae,L[W+2]=I,L[W+3]=fe,L[W+4]=ae,L[W+5]=fe,s.faceidx+=3,s.lineidx+=6):Math.abs(d[ae-a].y)===t?(D[V]=oe.x,D[te]=be.x,D[re]=ge.x,D[V+1]=oe.y,D[te+1]=be.y,D[re+1]=ge.y,D[V+2]=oe.z,D[te+2]=be.z,D[re+2]=ge.z,A[U]=I,A[U+1]=ee,A[U+2]=ae,L[W]=I,L[W+1]=ee,L[W+2]=I,L[W+3]=ae,L[W+4]=ee,L[W+5]=ae,s.faceidx+=3,s.lineidx+=6):(D[V]=oe.x,D[te]=be.x,D[q]=Le.x,D[V+1]=oe.y,D[te+1]=be.y,D[q+1]=Le.y,D[V+2]=oe.z,D[te+2]=be.z,D[q+2]=Le.z,D[te]=be.x,D[re]=ge.x,D[q]=Le.x,D[te+1]=be.y,D[re+1]=ge.y,D[q+1]=Le.y,D[te+2]=be.z,D[re+2]=ge.z,D[q+2]=Le.z,A[U]=I,A[U+1]=ee,A[U+2]=fe,A[U+3]=ee,A[U+4]=ae,A[U+5]=fe,L[W]=I,L[W+1]=ee,L[W+2]=I,L[W+3]=fe,L[W+4]=ee,L[W+5]=ae,L[W+6]=ae,L[W+7]=fe,s.faceidx+=6,s.lineidx+=8)}}}O.drawSphere=v})(w||(w={}))},"./src/GLModel.ts"(K,C,f){f.r(C),f.d(C,{GLModel:()=>v});var E=f("./src/WebGL/index.ts"),S=f("./src/WebGL/shapes/index.ts"),w=f("./src/WebGL/math/index.ts"),O=f("./src/colors.ts"),p=f("./src/GLDraw.ts"),x=f("./src/glcartoon.ts"),M=f("./src/utilities.ts"),m=f("./src/Gradient.ts"),b=f("./src/parsers/index.ts"),_=f("./node_modules/netcdfjs/lib-esm/index.js"),g=f("./src/parsers/utils/assignBonds.ts");class v{static sameObj(e,t){return e&&t?JSON.stringify(e)==JSON.stringify(t):e==t}constructor(e,t,n){this.atoms=[],this.frames=[],this.box=null,this.atomdfs=null,this.id=0,this.hidden=!1,this.molObj=null,this.renderedMolObj=null,this.lastColors=null,this.modelData={},this.modelDatas=null,this.idMatrix=new w.Matrix4,this.dontDuplicateAtoms=!0,this.defaultColor=O.elementColors.defaultColor,this.defaultStickRadius=.25,this.options=t||{},this.viewer=n,this.ElementColors=this.options.defaultcolors?this.options.defaultcolors:O.elementColors.defaultColors,this.defaultSphereRadius=this.options.defaultSphereRadius?this.options.defaultSphereRadius:1.5,this.defaultCartoonQuality=this.options.cartoonQuality?this.options.cartoonQuality:10,this.id=e}getRadiusFromStyle(e,t){var n=this.defaultSphereRadius;if(typeof t.radius<"u")n=t.radius;else if(v.vdwRadii[e.elem])n=v.vdwRadii[e.elem];else if(e.elem.length>1){let o=e.elem;o=o[0].toUpperCase()+o[1].toLowerCase(),v.vdwRadii[o]&&(n=v.vdwRadii[o])}return typeof t.scale<"u"&&(n*=t.scale),n}drawAtomCross(e,t){if(e.style.cross){var n=e.style.cross;if(!n.hidden){var o=n.linewidth||v.defaultlineWidth;t[o]||(t[o]=new E.Geometry);var h=t[o].updateGeoGroup(6),d=this.getRadiusFromStyle(e,n),i=[[d,0,0],[-d,0,0],[0,d,0],[0,-d,0],[0,0,d],[0,0,-d]],s=e.clickable||e.hoverable;s&&e.intersectionShape===void 0&&(e.intersectionShape={sphere:[],cylinder:[],line:[]});for(var a=(0,M.getColorFromStyle)(e,n),c=h.vertexArray,u=h.colorArray,A=0;A<6;A++){var L=h.vertices*3;if(h.vertices++,c[L]=e.x+i[A][0],c[L+1]=e.y+i[A][1],c[L+2]=e.z+i[A][2],u[L]=a.r,u[L+1]=a.g,u[L+2]=a.b,s){var D=new w.Vector3(i[A][0],i[A][1],i[A][2]);D.multiplyScalar(.1),D.set(D.x+e.x,D.y+e.y,D.z+e.z),e.intersectionShape.line.push(D)}}}}}getGoodCross(e,t,n,o){for(var h=null,d=-1,i=0,s=e.bonds.length;i<s;i++)if(e.bonds[i]!=t.index){let c=e.bonds[i],u=this.atoms[c],L=new w.Vector3(u.x,u.y,u.z).clone();L.sub(n);let D=L.clone();D.cross(o);var a=D.lengthSq();if(a>d&&(d=a,h=D,d>.1))return h}return h}getSideBondV(e,t,n){var o,h,d,i,s,a=new w.Vector3(e.x,e.y,e.z),c=new w.Vector3(t.x,t.y,t.z),u=c.clone(),A=null;if(u.sub(a),e.bonds.length===1)if(t.bonds.length===1)A=u.clone(),Math.abs(A.x)>1e-4?A.y+=1:A.x+=1;else{for(d=null,o=0;o<t.bonds.length;o++)if(h=t.bonds[o],h!==e.index){d=this.atoms[h];break}d?(i=new w.Vector3(d.x,d.y,d.z),s=i.clone(),s.sub(a),A=s.clone(),A.cross(u)):(A=u.clone(),A.x+=1)}else if(A=this.getGoodCross(e,t,a,u),A.lengthSq()<.01){var L=this.getGoodCross(t,e,a,u);L!=null&&(A=L)}return A.lengthSq()<.01&&(A=u.clone(),Math.abs(A.x)>1e-4?A.y+=1:A.x+=1),A.cross(u),A.normalize(),A}addLine(e,t,n,o,h,d){e[n]=o.x,e[n+1]=o.y,e[n+2]=o.z,t[n]=d.r,t[n+1]=d.g,t[n+2]=d.b,e[n+3]=h.x,e[n+4]=h.y,e[n+5]=h.z,t[n+3]=d.r,t[n+4]=d.g,t[n+5]=d.b}drawBondLines(e,t,n){if(e.style.line){var o=e.style.line;if(!o.hidden){var h,d,i,s,a=o.linewidth||v.defaultlineWidth;n[a]||(n[a]=new E.Geometry);for(var c=n[a].updateGeoGroup(6*e.bonds.length),u=c.vertexArray,A=c.colorArray,L=0;L<e.bonds.length;L++){var D=e.bonds[L],R=t[D];if(R.style.line&&!(e.index>=R.index)){var P=new w.Vector3(e.x,e.y,e.z),z=new w.Vector3(R.x,R.y,R.z),F=P.clone().add(z).multiplyScalar(.5),B=!1,U=e.clickable||e.hoverable,W=R.clickable||R.hoverable;(U||W)&&(U&&(e.intersectionShape===void 0&&(e.intersectionShape={sphere:[],cylinder:[],line:[],triangle:[]}),e.intersectionShape.line.push(P),e.intersectionShape.line.push(F)),W&&(R.intersectionShape===void 0&&(R.intersectionShape={sphere:[],cylinder:[],line:[],triangle:[]}),R.intersectionShape.line.push(F),R.intersectionShape.line.push(z)));var I=(0,M.getColorFromStyle)(e,e.style.line),V=(0,M.getColorFromStyle)(R,R.style.line);if(e.bondStyles&&e.bondStyles[L]){var ee=e.bondStyles[L];if(!ee.iswire)continue;ee.singleBond&&(B=!0),typeof ee.color1<"u"&&(I=O.CC.color(ee.color1)),typeof ee.color2<"u"&&(V=O.CC.color(ee.color2))}var te=c.vertices*3,ae,re;if(e.bondOrder[L]>1&&e.bondOrder[L]<4&&!B){var fe=this.getSideBondV(e,R,L),q=z.clone();q.sub(P),e.bondOrder[L]==2?(fe.multiplyScalar(.1),h=P.clone(),h.add(fe),d=P.clone(),d.sub(fe),i=h.clone(),i.add(q),s=d.clone(),s.add(q),I==V?(c.vertices+=4,this.addLine(u,A,te,h,i,I),this.addLine(u,A,te+6,d,s,I)):(c.vertices+=8,q.multiplyScalar(.5),ae=h.clone(),ae.add(q),re=d.clone(),re.add(q),this.addLine(u,A,te,h,ae,I),this.addLine(u,A,te+6,ae,i,V),this.addLine(u,A,te+12,d,re,I),this.addLine(u,A,te+18,re,s,V))):e.bondOrder[L]==3&&(fe.multiplyScalar(.1),h=P.clone(),h.add(fe),d=P.clone(),d.sub(fe),i=h.clone(),i.add(q),s=d.clone(),s.add(q),I==V?(c.vertices+=6,this.addLine(u,A,te,P,z,I),this.addLine(u,A,te+6,h,i,I),this.addLine(u,A,te+12,d,s,I)):(c.vertices+=12,q.multiplyScalar(.5),ae=h.clone(),ae.add(q),re=d.clone(),re.add(q),this.addLine(u,A,te,P,F,I),this.addLine(u,A,te+6,F,z,V),this.addLine(u,A,te+12,h,ae,I),this.addLine(u,A,te+18,ae,i,V),this.addLine(u,A,te+24,d,re,I),this.addLine(u,A,te+30,re,s,V)))}else I==V?(c.vertices+=2,this.addLine(u,A,te,P,z,I)):(c.vertices+=4,this.addLine(u,A,te,P,F,I),this.addLine(u,A,te+6,F,z,V))}}}}}drawAtomSphere(e,t){if(e.style.sphere){var n=e.style.sphere;if(!n.hidden){var o=(0,M.getColorFromStyle)(e,n),h=this.getRadiusFromStyle(e,n);if((e.clickable===!0||e.hoverable)&&e.intersectionShape!==void 0){var d=new w.Vector3(e.x,e.y,e.z);e.intersectionShape.sphere.push(new S.Sphere(d,h))}p.GLDraw.drawSphere(t,e,h,o)}}}drawAtomClickSphere(e){if(e.style.clicksphere){var t=e.style.clicksphere;if(!t.hidden){var n=this.getRadiusFromStyle(e,t);if((e.clickable===!0||e.hoverable)&&e.intersectionShape!==void 0){var o=new w.Vector3(e.x,e.y,e.z);e.intersectionShape.sphere.push(new S.Sphere(o,n))}}}}drawAtomInstanced(e,t){if(e.style.sphere){var n=e.style.sphere;if(!n.hidden){var o=this.getRadiusFromStyle(e,n),h=(0,M.getColorFromStyle)(e,n),d=t.updateGeoGroup(1),i=d.vertices,s=i*3,a=d.vertexArray,c=d.colorArray,u=d.radiusArray;if(a[s]=e.x,a[s+1]=e.y,a[s+2]=e.z,c[s]=h.r,c[s+1]=h.g,c[s+2]=h.b,u[i]=o,(e.clickable===!0||e.hoverable)&&e.intersectionShape!==void 0){var A=new w.Vector3(e.x,e.y,e.z);e.intersectionShape.sphere.push(new S.Sphere(A,o))}d.vertices+=1}}}drawSphereImposter(e,t,n,o){var h=e.updateGeoGroup(4),d,i=h.vertices,s=i*3,a=h.vertexArray,c=h.colorArray;for(d=0;d<4;d++)a[s+3*d]=t.x,a[s+3*d+1]=t.y,a[s+3*d+2]=t.z;var u=h.normalArray;for(d=0;d<4;d++)c[s+3*d]=o.r,c[s+3*d+1]=o.g,c[s+3*d+2]=o.b;u[s+0]=-n,u[s+1]=n,u[s+2]=0,u[s+3]=-n,u[s+4]=-n,u[s+5]=0,u[s+6]=n,u[s+7]=-n,u[s+8]=0,u[s+9]=n,u[s+10]=n,u[s+11]=0,h.vertices+=4;var A=h.faceArray,L=h.faceidx;A[L+0]=i,A[L+1]=i+1,A[L+2]=i+2,A[L+3]=i+2,A[L+4]=i+3,A[L+5]=i,h.faceidx+=6}drawAtomImposter(e,t){if(e.style.sphere){var n=e.style.sphere;if(!n.hidden){var o=this.getRadiusFromStyle(e,n),h=(0,M.getColorFromStyle)(e,n);if((e.clickable===!0||e.hoverable)&&e.intersectionShape!==void 0){var d=new w.Vector3(e.x,e.y,e.z);e.intersectionShape.sphere.push(new S.Sphere(d,o))}this.drawSphereImposter(t,e,o,h)}}}calculateDashes(e,t,n,o,h,d){var i=Math.sqrt(Math.pow(e.x-t.x,2)+Math.pow(e.y-t.y,2)+Math.pow(e.z-t.z,2));if(n=Math.max(n,0),h=Math.max(h,0)+2*n,o=Math.max(o,.001),o+h>i){var s=d&&d.length>0?d[0]:null;return[{from:new w.Vector3(e.x,e.y,e.z),to:new w.Vector3(t.x,t.y,t.z),color:s}]}var a=Math.floor((i-o)/(o+h))+1,c=a*o;h=(i-c)/a;for(var u,A=new w.Vector3(e.x,e.y,e.z),L=new w.Vector3((t.x-e.x)/(i/h),(t.y-e.y)/(i/h),(t.z-e.z)/(i/h)),D=new w.Vector3((t.x-e.x)/(i/o),(t.y-e.y)/(i/o),(t.z-e.z)/(i/o)),R=[],P=0;P<a;P++){u=new w.Vector3(A.x+D.x,A.y+D.y,A.z+D.z);var s=d&&d.length>1&&P>=a/2?d[1]:d?d[0]:null;R.push({from:A,to:u,color:s}),A=new w.Vector3(u.x+L.x,u.y+L.y,u.z+L.z)}return R}calculateTwoColorSegments(e,t,n){var o=[];if(n.length<=1)o.push({from:new w.Vector3(e.x,e.y,e.z),to:new w.Vector3(t.x,t.y,t.z),color:n[0]});else{var h=new w.Vector3((e.x+t.x)/2,(e.y+t.y)/2,(e.z+t.z)/2);o.push({from:new w.Vector3(e.x,e.y,e.z),to:h,color:n[0]}),o.push({from:h,to:new w.Vector3(t.x,t.y,t.z),color:n[1]})}return o}chooseDashedPlusV(e,t,n,o,h){for(var d=new w.Vector3(0,0,0),i=0,s=!1,a=0;a<e.bonds.length;a++)if(e.bonds[a]!==t.index){var c=this.atoms[e.bonds[a]];if(c&&c.bonds&&c.bonds.length>1){s=!0;break}}if(!s){for(var a=0;a<t.bonds.length;a++)if(t.bonds[a]!==e.index){var c=this.atoms[t.bonds[a]];if(c&&c.bonds&&c.bonds.length>1){s=!0;break}}}var u=(R,P)=>{for(var z=0;z<R.bonds.length;z++)if(R.bonds[z]!==P){var F=this.atoms[R.bonds[z]];if(F){var B=!F.bonds||F.bonds.length<=1,U=s&&B?.25:1;d.x+=F.x*U,d.y+=F.y*U,d.z+=F.z*U,i+=U}}};if(u(e,t.index),u(t,e.index),i<1e-8)return!1;d.multiplyScalar(1/i);var A=new w.Vector3().addVectors(n,o).multiplyScalar(.5),L=A.clone().add(h),D=A.clone().sub(h);return L.distanceToSquared(d)<D.distanceToSquared(d)}static drawStickImposter(e,t,n,o,h,d=0,i=0){for(var s=e.updateGeoGroup(4),a=s.vertices,c=a*3,u=s.vertexArray,A=s.colorArray,L=s.radiusArray,D=s.normalArray,R=h.r,P=h.g,z=h.b,F=function(V){var ee=-V;return ee==0&&(ee=-1e-4),ee},B=c,U=0;U<4;U++)u[B]=t.x,D[B]=n.x,A[B]=R,B++,u[B]=t.y,D[B]=n.y,A[B]=P,B++,u[B]=t.z,D[B]=n.z,U<2?A[B]=z:A[B]=F(z),B++;s.vertices+=4,L[a]=-o,L[a+1]=o,L[a+2]=-o,L[a+3]=o;var W=s.faceArray,I=s.faceidx;W[I+0]=a,W[I+1]=a+1,W[I+2]=a+2,W[I+3]=a+2,W[I+4]=a+3,W[I+5]=a,s.faceidx+=6}drawBondSticks(e,t,n){var o,h,d,i;if(e.style.stick){var s=e.style.stick;if(!s.hidden){var a=s.radius||this.defaultStickRadius,c=s.doubleBondScaling||.4,u=s.tripleBondScaling||.25,A=((o=s.dashedBondConfig)===null||o===void 0?void 0:o.dashLength)||.1,L=((h=s.dashedBondConfig)===null||h===void 0?void 0:h.gapLength)||.25,D=a,R=s.singleBonds||!1,P=s.dashedBonds||!1,z=0,F=0,B,U,W,I,V,ee,te,ae,re,fe,q,oe=(0,M.getColorFromStyle)(e,s),be,ge,Le;!e.capDrawn&&e.bonds.length<4&&(z=2);var pe=!((d=s.dashedBondConfig)===null||d===void 0)&&d.solidColor?O.CC.color(s.dashedBondConfig.solidColor):null,J=!((i=s.dashedBondConfig)===null||i===void 0)&&i.dashedColor?O.CC.color(s.dashedBondConfig.dashedColor):null,ce=this,Me=Xe=>{var at=n.imposter?v.drawStickImposter:p.GLDraw.drawCylinder;return!P&&Xe%1===0?(nt,Mt,mt,it,tt,qe,vt=0,xt=0)=>{if(!qe||tt===qe)at(nt,Mt,mt,it,tt,vt,xt);else for(var At=ce.calculateTwoColorSegments(Mt,mt,[tt,qe]),Ct=0;Ct<At.length;Ct++){var Dt=At[Ct],Pt=Ct===0?vt:0,Yt=Ct===At.length-1?xt:0;at(nt,Dt.from,Dt.to,it,Dt.color,Pt,Yt)}}:(nt,Mt,mt,it,tt,qe,vt=0,xt=0)=>{var At=qe?[tt,qe]:[tt],Ct=ce.calculateDashes(Mt,mt,it,A,L,At);Ct.forEach(Dt=>{at(nt,Dt.from,Dt.to,it,Dt.color,vt,xt)})}};for(W=0;W<e.bonds.length;W++){var Fe=e.bondOrder[W],ze=Fe===4?1.5:Fe,Be=Me(ze),Ue=e.bonds[W],Se=t[Ue];if(be=ge=Le=null,e.index<Se.index){F=0;var Ie=Se.style;if(!Ie.stick||Ie.stick.hidden)continue;var Re=(0,M.getColorFromStyle)(Se,Ie.stick);if(D=a,I=R,e.bondStyles&&e.bondStyles[W]){if(V=e.bondStyles[W],V.iswire)continue;V.radius&&(D=V.radius),V.singleBond&&(I=!0),typeof V.color1<"u"&&(oe=O.CC.color(V.color1)),typeof V.color2<"u"&&(Re=O.CC.color(V.color2))}var Oe=new w.Vector3(e.x,e.y,e.z),Ge=new w.Vector3(Se.x,Se.y,Se.z),Ve=pe||oe,j=pe||Re,Y=J||oe,X=J||Re;if(ze<=1||I||ze>3){ze<1&&(D*=ze),!Se.capDrawn&&Se.bonds.length<4&&(F=2);const Xe=P||ze%1!==0;if(Be(n,Oe,Ge,D,Xe?Y:oe,Xe?X:Re,z,F),B=e.clickable||e.hoverable,U=Se.clickable||Se.hoverable,B||U){if(be||(be=new w.Vector3().addVectors(Oe,Ge).multiplyScalar(.5)),B){var _e=new S.Cylinder(Oe,be,D),ue=new S.Sphere(Oe,D);e.intersectionShape.cylinder.push(_e),e.intersectionShape.sphere.push(ue)}if(U){var we=new S.Cylinder(Ge,be,D),De=new S.Sphere(Ge,D);Se.intersectionShape.cylinder.push(we),Se.intersectionShape.sphere.push(De)}}}else if(ze>1){var G=0,se=0;D!=a&&(G=2,se=2);var ve=Ge.clone(),Te=null;ve.sub(Oe);var ie,ye,k,Ce,Pe,T;Te=this.getSideBondV(e,Se,W);var de=!1;if(ze%1!==0&&(de=this.chooseDashedPlusV(e,Se,Oe,Ge,Te)),ze>1&&ze<=2){ie=D*c,ye=ie*(ze-1),Te.multiplyScalar(ie*1.5),k=Oe.clone(),k.add(Te),Ce=Oe.clone(),Ce.sub(Te),Pe=k.clone(),Pe.add(ve),T=Ce.clone(),T.add(ve);var Ve=pe||oe,j=pe||Re,Y=J||oe,X=J||Re,he=n.imposter?v.drawStickImposter:p.GLDraw.drawCylinder,H=(mt,it,tt,qe,vt,xt,At)=>{if(qe!=vt){var Ct=new w.Vector3().addVectors(mt,it).multiplyScalar(.5);he(n,mt,Ct,tt,qe,xt,0),he(n,Ct,it,tt,vt,0,At)}else he(n,mt,it,tt,qe,xt,At)},ne=(mt,it,tt,qe,vt,xt,At)=>{var Ct=qe!=vt?[qe,vt]:[qe],Dt=ce.calculateDashes(mt,it,tt,A,L,Ct);Dt.forEach(Pt=>{he(n,Pt.from,Pt.to,tt,Pt.color||qe,xt,At)})};if(ze==2?(H(k,Pe,ie,Ve,j,G,se),H(Ce,T,ie,Ve,j,G,se)):de?(ne(k,Pe,ye,Y,X,G,se),H(Ce,T,ie,Ve,j,G,se)):(H(k,Pe,ie,Ve,j,G,se),ne(Ce,T,ye,Y,X,G,se)),B=e.clickable||e.hoverable,U=Se.clickable||Se.hoverable,B||U){be||(be=new w.Vector3().addVectors(k,Pe).multiplyScalar(.5)),ge||(ge=new w.Vector3().addVectors(Ce,T).multiplyScalar(.5));var xe=ze==2?ie:de?ye:ie,je=ze==2||de?ie:ye;B&&(ee=new S.Cylinder(k,be,xe),te=new S.Cylinder(Ce,ge,je),e.intersectionShape.cylinder.push(ee),e.intersectionShape.cylinder.push(te)),U&&(re=new S.Cylinder(Pe,be,xe),fe=new S.Cylinder(T,ge,je),Se.intersectionShape.cylinder.push(re),Se.intersectionShape.cylinder.push(fe))}}else if(ze>2&&ze<=3){ie=D*u;var ke=ie*(ze-2);Te.cross(ve),Te.normalize(),Te.multiplyScalar(ie*3),k=Oe.clone(),k.add(Te),Ce=Oe.clone(),Ce.sub(Te),Pe=k.clone(),Pe.add(ve),T=Ce.clone(),T.add(ve);var he=n.imposter?v.drawStickImposter:p.GLDraw.drawCylinder,Ne=(at,nt,Mt,mt,it,tt,qe)=>{if(mt!=it){var vt=new w.Vector3().addVectors(at,nt).multiplyScalar(.5);he(n,at,vt,Mt,mt,tt,0),he(n,vt,nt,Mt,it,0,qe)}else he(n,at,nt,Mt,mt,tt,qe)},Qe=(at,nt,Mt,mt,it,tt,qe)=>{var vt=mt!=it?[mt,it]:[mt],xt=ce.calculateDashes(at,nt,Mt,A,L,vt);xt.forEach(At=>{he(n,At.from,At.to,Mt,At.color||mt,tt,qe)})};if(ze==3?(Ne(k,Pe,ie,Ve,j,G,se),Ne(Oe,Ge,ie,Ve,j,z,F),Ne(Ce,T,ie,Ve,j,G,se)):de?(Qe(k,Pe,ke,Y,X,G,se),Ne(Oe,Ge,ie,Ve,j,z,F),Ne(Ce,T,ie,Ve,j,G,se)):(Ne(k,Pe,ie,Ve,j,G,se),Ne(Oe,Ge,ie,Ve,j,z,F),Qe(Ce,T,ke,Y,X,G,se)),B=e.clickable||e.hoverable,U=Se.clickable||Se.hoverable,B||U){be||(be=new w.Vector3().addVectors(k,Pe).multiplyScalar(.5)),ge||(ge=new w.Vector3().addVectors(Ce,T).multiplyScalar(.5)),Le||(Le=new w.Vector3().addVectors(Oe,Ge).multiplyScalar(.5));var xe=ze==3?ie:de?ke:ie,je=ze==3||de?ie:ke;B&&(ee=new S.Cylinder(k.clone(),be.clone(),xe),te=new S.Cylinder(Ce.clone(),ge.clone(),je),ae=new S.Cylinder(Oe.clone(),Le.clone(),ie),e.intersectionShape.cylinder.push(ee),e.intersectionShape.cylinder.push(te),e.intersectionShape.cylinder.push(ae)),U&&(re=new S.Cylinder(Pe.clone(),be.clone(),xe),fe=new S.Cylinder(T.clone(),ge.clone(),je),q=new S.Cylinder(Ge.clone(),Le.clone(),ie),Se.intersectionShape.cylinder.push(re),Se.intersectionShape.cylinder.push(fe),Se.intersectionShape.cylinder.push(q))}}}}}var _t=!1,et=0,Ze=!1;for(W=0;W<e.bonds.length;W++)I=R,e.bondStyles&&e.bondStyles[W]&&(V=e.bondStyles[W],V.singleBond&&(I=!0),V.radius&&V.radius!=a&&(Ze=!0)),(I||e.bondOrder[W]==1)&&et++;Ze?et>0&&(_t=!0):et==0&&(e.bonds.length>0||s.showNonBonded)&&(_t=!0),_t&&(D=a,n.imposter?this.drawSphereImposter(n.sphereGeometry,e,D,oe):p.GLDraw.drawSphere(n,e,D,oe))}}}createMolObj(e,t){t=t||{};var n=new E.Object3D,o=[],h={},d={},i=this.drawAtomSphere,s=null,a=null;t.supportsImposters?(i=this.drawAtomImposter,s=new E.Geometry(!0),s.imposter=!0,a=new E.Geometry(!0,!0),a.imposter=!0,a.sphereGeometry=new E.Geometry(!0),a.sphereGeometry.imposter=!0,a.drawnCaps={}):t.supportsAIA?(i=this.drawAtomInstanced,s=new E.Geometry(!1,!0,!0),s.instanced=!0,a=new E.Geometry(!0)):(s=new E.Geometry(!0),a=new E.Geometry(!0));var c,u,A,L,D={},R=[Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY];for(c=0,A=e.length;c<A;c++){var P=e[c];if(P&&P.style){(P.clickable||P.hoverable)&&P.intersectionShape===void 0&&(P.intersectionShape={sphere:[],cylinder:[],line:[],triangle:[]}),L={line:void 0,cross:void 0,stick:void 0,sphere:void 0};for(u in L)P.style[u]?P.style[u].opacity?L[u]=parseFloat(P.style[u].opacity):L[u]=1:L[u]=void 0,D[u]?L[u]!=null&&D[u]!=L[u]&&(console.log("Warning: "+u+" opacity is ambiguous"),D[u]=1):D[u]=L[u];i.call(this,P,s),this.drawAtomClickSphere(P),this.drawAtomCross(P,d),this.drawBondLines(P,e,h),this.drawBondSticks(P,e,a),typeof P.style.cartoon<"u"&&!P.style.cartoon.hidden&&(P.style.cartoon.color==="spectrum"&&typeof P.resi=="number"&&!P.hetflag&&(P.resi<R[0]&&(R[0]=P.resi),P.resi>R[1]&&(R[1]=P.resi)),o.push(P))}}if(o.length>0&&(0,x.drawCartoon)(n,o,R,this.defaultCartoonQuality),s&&s.vertices>0){s.initTypedArrays();var z=null,F=null;s.imposter?z=new E.SphereImposterMaterial({ambient:0,vertexColors:!0,reflectivity:0}):s.instanced?(F=new E.Geometry(!0),p.GLDraw.drawSphere(F,{x:0,y:0,z:0},1,new O.Color(.5,.5,.5)),F.initTypedArrays(),z=new E.InstancedMaterial({sphereMaterial:new E.MeshLambertMaterial({ambient:0,vertexColors:!0,reflectivity:0}),sphere:F})):z=new E.MeshLambertMaterial({ambient:0,vertexColors:!0,reflectivity:0}),D.sphere<1&&D.sphere>=0&&(z.transparent=!0,z.opacity=D.sphere),F=new E.Mesh(s,z),n.add(F)}if(a.vertices>0){var B=null,U=null,W=a.sphereGeometry;(!W||typeof W.vertices>"u"||W.vertices==0)&&(W=null),a.initTypedArrays(),W&&W.initTypedArrays();var I={ambient:0,vertexColors:!0,reflectivity:0};a.imposter?(B=new E.StickImposterMaterial(I),U=new E.SphereImposterMaterial(I)):(B=new E.MeshLambertMaterial(I),U=new E.MeshLambertMaterial(I),B.wireframe&&(a.setUpWireframe(),W&&W.setUpWireframe())),D.stick<1&&D.stick>=0&&(B.transparent=!0,B.opacity=D.stick,U.transparent=!0,U.opacity=D.stick);var V=new E.Mesh(a,B);if(n.add(V),W){var ee=new E.Mesh(W,U);n.add(ee)}}var te;for(c in h)if(h.hasOwnProperty(c)){te=c;var ae=new E.LineBasicMaterial({linewidth:te,vertexColors:!0});D.line<1&&D.line>=0&&(ae.transparent=!0,ae.opacity=D.line),h[c].initTypedArrays();var re=new E.Line(h[c],ae,E.LineStyle.LinePieces);n.add(re)}for(c in d)if(d.hasOwnProperty(c)){te=c;var fe=new E.LineBasicMaterial({linewidth:te,vertexColors:!0});D.cross<1&&D.cross>=0&&(fe.transparent=!0,fe.opacity=D.cross),d[c].initTypedArrays();var q=new E.Line(d[c],fe,E.LineStyle.LinePieces);n.add(q)}if(this.dontDuplicateAtoms&&this.modelData.symmetries&&this.modelData.symmetries.length>0){var oe=new E.Object3D,be;for(be=0;be<this.modelData.symmetries.length;be++){var ge=new E.Object3D;ge=n.clone(),ge.matrix.copy(this.modelData.symmetries[be]),ge.matrixAutoUpdate=!1,oe.add(ge)}return oe}return n}getViewer(){return this.viewer}getInternalState(){return{atoms:this.atoms,frames:this.frames}}setInternalState(e){this.atoms=e.atoms,this.frames=e.frames,this.molObj=null}getCrystData(){if(this.modelData.cryst){if(!this.modelData.cryst.matrix){const e=this.modelData.cryst;this.modelData.cryst.matrix=(0,w.conversionMatrix3)(e.a,e.b,e.c,e.alpha,e.beta,e.gamma)}return this.modelData.cryst}else return null}setCrystData(e,t,n,o,h,d){e=e||1,t=t||1,n=n||1,o=o||90,h=h||90,d=d||90;const i=(0,w.conversionMatrix3)(e,t,n,o,h,d);this.modelData.cryst={a:e,b:t,c:n,alpha:o,beta:h,gamma:d,matrix:i}}setCrystMatrix(e){e=e||new w.Matrix3(1,0,0,0,1,0,0,0,1),this.modelData.cryst={matrix:e}}getSymmetries(){return typeof this.modelData.symmetries>"u"&&(this.modelData.symmetries=[this.idMatrix]),this.modelData.symmetries}setSymmetries(e){typeof e>"u"?this.modelData.symmetries=[this.idMatrix]:(this.modelData.symmetries=e,this.molObj=null)}getID(){return this.id}getNumFrames(){return this.frames.numFrames!=null?this.frames.numFrames:this.frames.length}adjustCoord(e,t,n,o){var h=t-e;return h<-n?t+o:h>n?t-o:t}adjustCoordinatesToBox(){if(this.box&&this.atomdfs)for(var e=this.box[0],t=this.box[1],n=this.box[2],o=e*.9,h=t*.9,d=n*.9,i=0;i<this.atomdfs.length;i++)for(var s=this.atomdfs[i],a=1;a<s.length;a++){var c=this.atoms[s[a][0]],u=this.atoms[s[a][1]];c.x=this.adjustCoord(u.x,c.x,o,e),c.y=this.adjustCoord(u.y,c.y,h,t),c.z=this.adjustCoord(u.z,c.z,d,n)}}setFrame(e){var t=this.getNumFrames();let n=this,o=this.viewer;return new Promise(function(h,d){if(t==0&&h(),(e<0||e>=t)&&(e=t-1),n.frames.url!=null){var i=n.frames.url;(0,M.getbin)(i+"/traj/frame/"+e+"/"+n.frames.path,void 0,"POST",void 0).then(function(s){for(var a=new Float32Array(s,44),c=0,u=0;u<n.atoms.length;u++)n.atoms[u].x=a[c++],n.atoms[u].y=a[c++],n.atoms[u].z=a[c++];n.box&&n.atomdfs&&n.adjustCoordinatesToBox(),h()}).catch(d)}else n.atoms=n.frames[e],h();n.molObj=null,n.modelDatas&&e<n.modelDatas.length&&(n.modelData=n.modelDatas[e],n.unitCellObjects&&o&&(o.removeUnitCell(n),o.addUnitCell(n)))})}addFrame(e){this.frames.push(e)}vibrate(e=10,t=1,n=!1,o){var h=0,d=e;let i=this.viewer;n&&(h=-e,d=e),this.frames!==void 0&&this.frames.origIndex!==void 0?this.setFrame(this.frames.origIndex):this.setFrame(0),h<d&&(this.frames=[]),n&&(this.frames.origIndex=e);for(var s=h;s<d;s++){var a=[],c=this.frames.length;if(s==0&&!o){this.frames.push(this.atoms);continue}for(var u=0;u<this.atoms.length;u++){var A=(0,M.getAtomProperty)(this.atoms[u],"dx"),L=(0,M.getAtomProperty)(this.atoms[u],"dy"),D=(0,M.getAtomProperty)(this.atoms[u],"dz"),R=new w.Vector3(A,L,D),P=new w.Vector3(this.atoms[u].x,this.atoms[u].y,this.atoms[u].z),z=s*t/e;R.multiplyScalar(z),P.add(R);var F={};for(var B in this.atoms[u])F[B]=this.atoms[u][B];if(F.x=P.x,F.y=P.y,F.z=P.z,a.push(F),i&&o){var U=(0,M.extend)({},o),W=new w.Vector3(A,L,D);if(W.multiplyScalar(t),W.add(P),U.start=P,U.end=W,U.frame=c,!U.color){var I=F.style.sphere;I||(I=F.style.stick),I||(I=F.style.line),U.color=(0,M.getColorFromStyle)(F,I)}i.addArrow(U)}}this.frames.push(a)}}setAtomDefaults(e){for(let t=0;t<e.length;t++){let n=e[t];n&&(n.style=n.style||(0,M.deepCopy)(v.defaultAtomStyle),n.color=n.color||this.ElementColors[n.elem]||this.defaultColor,n.model=this.id,(n.clickable||n.hoverable)&&(n.intersectionShape={sphere:[],cylinder:[],line:[],triangle:[]}))}}addMolData(e,t,n={}){var o=v.parseMolData(e,t,n);this.dontDuplicateAtoms=!n.duplicateAssemblyAtoms;var h=o.modelData;if(h&&(Array.isArray(h)?(this.modelData=h[0],n.frames&&(this.modelDatas=h)):this.modelData=h),o.box?this.box=o.box:this.box=null,this.frames.length==0){for(let i=0;i<o.length;i++)o[i].length!=0&&this.frames.push(o[i]);this.frames[0]&&(this.atoms=this.frames[0])}else if(n.frames)for(let i=0;i<o.length;i++)this.frames.push(o[i]);else for(var d=0;d<o.length;d++)this.addAtoms(o[d]);for(let i=0;i<this.frames.length;i++)this.setAtomDefaults(this.frames[i]);n.vibrate&&n.vibrate.frames&&n.vibrate.amplitude&&this.vibrate(n.vibrate.frames,n.vibrate.amplitude),n.style&&this.setStyle({},n.style)}setDontDuplicateAtoms(e){this.dontDuplicateAtoms=e}setModelData(e){this.modelData=e}propertyMatches(e,t){if(e==t)return!0;if(typeof t=="string"&&typeof e=="number"){var n=t.match(/(-?\d+)\s*-\s*(-?\d+)/);if(n){var o=parseInt(n[1]),h=parseInt(n[2]);if(n&&e>=o&&e<=h)return!0}}return!1}static deepCopyAndCache(e,t){if(typeof e!="object"||e==null||e instanceof v||e.__cache_created)return e;const n={};for(const o in e){const h=e[o];if(Array.isArray(h)){n[o]=[];for(let d=0;d<h.length;d++)n[o].push(v.deepCopyAndCache(h[d],t))}else typeof h=="object"&&o!="properties"&&o!="model"?n[o]=v.deepCopyAndCache(h,t):n[o]=h;if(o=="and"||o=="or"){const d=[];for(const i of n[o]){const s=new Set;for(const a of t.selectedAtoms(i))s.add(a.index);d.push(s)}if(o=="and"){const i=function(a,c){const u=new Set;for(const A of c)a.has(A)&&u.add(A);return u};let s=new Set(d[0]);for(const a of d.splice(1))s=i(s,a);n[o].__cached_results=s}else if(o=="or"){const i=new Set;for(const s of d)for(const a of s)i.add(a);n[o].__cached_results=i}}}return n.__cache_created=!0,n}atomIsSelected(e,t){if(typeof t>"u")return!0;var n=!!t.invert,o=!0;for(var h in t)if(h=="and"||h=="or"||h=="not"){if(h=="not"){if(this.atomIsSelected(e,t[h])){o=!1;break}}else if(t[h].__cached_results===void 0&&(t=v.deepCopyAndCache(t,this)),o=t[h].__cached_results.has(e.index),!o)break}else if(h==="predicate"){if(!t.predicate(e)){o=!1;break}}else if(h=="properties"&&e[h]){for(var d in t.properties)if(!d.startsWith("__cache")){if(typeof e.properties[d]>"u"){o=!1;break}if(e.properties[d]!=t.properties[d]){o=!1;break}}}else if(h=="model"){let c=t.model;if(typeof c=="number"&&c<0&&(c=this.viewer.getNextModelId()+c),Array.isArray(c)){let u=!1;for(let A=0;A<c.length;A++)if(c[A]==this||c[A]==this.id){u=!0;break}if(!u){o=!1;break}}else if(c!=this&&c!=this.id){o=!1;break}}else if(t.hasOwnProperty(h)&&!v.ignoredKeys.has(h)&&!h.startsWith("__cache")){if(typeof e[h]>"u"){o=!1;break}let c=!1;if(h==="bonds"){var i=t[h];if(i!=e.bonds.length){o=!1;break}}else if(Array.isArray(t[h])){var s=t[h],a=e[h];for(let u=0;u<s.length;u++)if(this.propertyMatches(a,s[u])){c=!0;break}if(!c){o=!1;break}}else{let u=t[h];if(!this.propertyMatches(e[h],u)){o=!1;break}}}return n?!o:o}static squaredDistance(e,t){var n=t.x-e.x,o=t.y-e.y,h=t.z-e.z;return n*n+o*o+h*h}expandAtomList(e,t){if(t<=0)return e;for(var n=(0,M.getExtent)(e,void 0),o=[[],[],[]],h=0;h<3;h++)o[0][h]=n[0][h]-t,o[1][h]=n[1][h]+t,o[2][h]=n[2][h];var d=[];for(let c=0;c<this.atoms.length;c++){var i=this.atoms[c].x,s=this.atoms[c].y,a=this.atoms[c].z;i>=o[0][0]&&i<=o[1][0]&&s>=o[0][1]&&s<=o[1][1]&&a>=o[0][2]&&a<=o[1][2]&&(i>=n[0][0]&&i<=n[1][0]&&s>=n[0][1]&&s<=n[1][1]&&a>=n[0][2]&&a<=n[1][2]||d.push(this.atoms[c]))}return d}static getFloat(e){return typeof e=="number"?e:parseFloat(e)}selectedAtoms(e,t){var n=[];e=v.deepCopyAndCache(e||{},this),t||(t=this.atoms);for(var o=t.length,h=0;h<o;h++){var d=t[h];d&&this.atomIsSelected(d,e)&&n.push(d)}if(e.hasOwnProperty("expand")){const F=v.getFloat(e.expand);let B=this.expandAtomList(n,F),U=n.length;const W=F*F;for(let I=0;I<B.length;I++)for(let V=0;V<U;V++){var i=v.squaredDistance(B[I],n[V]);i<W&&i>0&&n.push(B[I])}}if(e.hasOwnProperty("within")&&e.within.hasOwnProperty("sel")&&e.within.hasOwnProperty("distance")){var s=this.selectedAtoms(e.within.sel,this.atoms),a={};const F=v.getFloat(e.within.distance),B=F*F;for(let U=0;U<s.length;U++)for(let W=0;W<n.length;W++){let I=v.squaredDistance(s[U],n[W]);I<B&&I>0&&(a[W]=1)}var c=[];if(e.within.invert)for(let U=0;U<n.length;U++)a[U]||c.push(n[U]);else for(let U in a)c.push(n[U]);n=c}if(e.hasOwnProperty("byres")){var u={},A=[],L=[];for(let F=0;F<n.length;F++){let B=n[F];var D=B.chain,R=B.resi;if(u[D]===void 0&&(u[D]={}),B.hasOwnProperty("resi")&&u[D][R]===void 0){for(u[D][R]=!0,L.push(B);L.length>0;)if(B=L.pop(),D=B.chain,R=B.resi,A[B.index]===void 0){A[B.index]=!0;for(var P=0;P<B.bonds.length;P++){var z=this.atoms[B.bonds[P]];A[z.index]===void 0&&z.hasOwnProperty("resi")&&z.chain==D&&z.resi==R&&(L.push(z),n.push(z))}}}}}return n}addAtoms(e){this.molObj=null;var t=this.atoms.length,n=[],o;for(o=0;o<e.length;o++)typeof e[o].index>"u"&&(e[o].index=o),typeof e[o].serial>"u"&&(e[o].serial=o),n[e[o].index]=t+o;for(o=0;o<e.length;o++){var h=e[o],d=n[h.index],i=(0,M.extend)({},h);i.index=d,i.bonds=[],i.bondOrder=[],i.model=this.id,i.style=i.style||(0,M.deepCopy)(v.defaultAtomStyle),typeof i.color>"u"&&(i.color=this.ElementColors[i.elem]||this.defaultColor);for(var s=h.bonds?h.bonds.length:0,a=0;a<s;a++){var c=n[h.bonds[a]];typeof c<"u"&&(i.bonds.push(c),i.bondOrder.push(h.bondOrder?h.bondOrder[a]:1))}this.atoms.push(i)}}assignBonds(){(0,g.assignBonds)(this.atoms,{assignBonds:!0})}removeAtoms(e){this.molObj=null;var t=[],n;for(n=0;n<e.length;n++)t[e[n].index]=!0;var o=[];for(n=0;n<this.atoms.length;n++){var h=this.atoms[n];t[h.index]||o.push(h)}this.atoms=[],this.addAtoms(o)}setStyle(e,t,n){typeof t>"u"&&typeof n>"u"&&(t=e,e={}),e=e,typeof t=="string"&&(t=(0,M.specStringToObject)(t));var o=!1,h=this,d=function(s){var a=h.selectedAtoms(e,s);for(let c=0;c<s.length;c++)s[c]&&(s[c].capDrawn=!1);for(let c=0;c<a.length;c++){o=!0,(a[c].clickable||a[c].hoverable)&&(a[c].intersectionShape={sphere:[],cylinder:[],line:[],triangle:[]}),n||(a[c].style={});for(let u in t)t.hasOwnProperty(u)&&(a[c].style[u]=a[c].style[u]||{},Object.assign(a[c].style[u],t[u]))}};if(e.frame!==void 0&&e.frame<this.frames.length){let s=e.frame;s<0&&(s=this.frames.length+s),d(this.frames[s])}else{d(this.atoms);for(var i=0;i<this.frames.length;i++)this.frames[i]!==this.atoms&&d(this.frames[i])}o&&(this.molObj=null)}setClickable(e,t,n){if(t=!!t,n=(0,M.makeFunction)(n),n===null){console.log("Callback is not a function");return}var o=this.selectedAtoms(e,this.atoms),h=o.length;for(let d=0;d<h;d++)o[d].intersectionShape={sphere:[],cylinder:[],line:[],triangle:[]},o[d].clickable=t,n&&(o[d].callback=n);h>0&&(this.molObj=null)}setHoverable(e,t,n,o){if(t=!!t,n=(0,M.makeFunction)(n),o=(0,M.makeFunction)(o),n===null){console.log("Hover_callback is not a function");return}if(o===null){console.log("Unhover_callback is not a function");return}var h=this.selectedAtoms(e,this.atoms),d=h.length;for(let i=0;i<d;i++)h[i].intersectionShape={sphere:[],cylinder:[],line:[],triangle:[]},h[i].hoverable=t,n&&(h[i].hover_callback=n),o&&(h[i].unhover_callback=o);d>0&&(this.molObj=null)}enableContextMenu(e,t){t=!!t;var n,o=this.selectedAtoms(e,this.atoms),h=o.length;for(n=0;n<h;n++)o[n].intersectionShape={sphere:[],cylinder:[],line:[],triangle:[]},o[n].contextMenuEnabled=t;h>0&&(this.molObj=null)}setColorByElement(e,t){if(!(this.molObj!==null&&v.sameObj(t,this.lastColors))){this.lastColors=t;var n=this.selectedAtoms(e,n);n.length>0&&(this.molObj=null);for(var o=0;o<n.length;o++){var h=n[o];typeof t[h.elem]<"u"&&(h.color=t[h.elem])}}}setColorByProperty(e,t,n,o){var h,d,i=this.selectedAtoms(e,i);for(this.lastColors=null,i.length>0&&(this.molObj=null),typeof n=="string"&&typeof m.Gradient.builtinGradients[n]<"u"&&(n=new m.Gradient.builtinGradients[n]),n=n,o||(o=n.range()),o||(o=(0,M.getPropertyRange)(i,t)),h=0;h<i.length;h++){d=i[h];var s=(0,M.getAtomProperty)(d,t);s!=null&&(d.color=n.valueToHex(parseFloat(d.properties[t]),o))}}setColorByFunction(e,t){var n=this.selectedAtoms(e,n);if(typeof t=="function"){this.lastColors=null,n.length>0&&(this.molObj=null);for(let o=0;o<n.length;o++){let h=n[o];h.color=t(h)}}}toCDObject(e=!1){var t={a:[],b:[]};e&&(t.s=[]);for(let o=0;o<this.atoms.length;o++){let h={},d=this.atoms[o];if(h.x=d.x,h.y=d.y,h.z=d.z,d.elem!="C"&&(h.l=d.elem),e){for(var n=0;n<t.s.length&&JSON.stringify(d.style)!==JSON.stringify(t.s[n]);)n++;n===t.s.length&&t.s.push(d.style),n!==0&&(h.s=n)}t.a.push(h);for(let i=0;i<d.bonds.length;i++){let s=o,a=d.bonds[i];if(s>=a)continue;let c={b:s,e:a},u=d.bondOrder[i];u!=1&&(c.o=u),t.b.push(c)}}return t}globj(e,t){(this.molObj===null||t.regen)&&(this.molObj=this.createMolObj(this.atoms,t),this.renderedMolObj&&(e.remove(this.renderedMolObj),this.renderedMolObj=null),this.renderedMolObj=this.molObj.clone(),this.hidden&&(this.renderedMolObj.setVisible(!1),this.molObj.setVisible(!1)),e.add(this.renderedMolObj))}exportVRML(){var e=this.createMolObj(this.atoms,{supportsImposters:!1,supportsAIA:!1});return e.vrml()}removegl(e){this.renderedMolObj&&(this.renderedMolObj.geometry!==void 0&&this.renderedMolObj.geometry.dispose(),this.renderedMolObj.material!==void 0&&this.renderedMolObj.material.dispose(),e.remove(this.renderedMolObj),this.renderedMolObj=null),this.molObj=null}hide(){this.hidden=!0,this.renderedMolObj&&this.renderedMolObj.setVisible(!1),this.molObj&&this.molObj.setVisible(!1)}show(){this.hidden=!1,this.renderedMolObj&&this.renderedMolObj.setVisible(!0),this.molObj&&this.molObj.setVisible(!0)}addPropertyLabels(e,t,n){let o=this.selectedAtoms(t),h=this.viewer,d=(0,M.deepCopy)(n);for(let s=0;s<o.length;s++){let a=o[s];var i=null;typeof a[e]<"u"?i=String(a[e]):typeof a.properties[e]<"u"&&(i=String(a.properties[e])),i!=null&&(d.position=a,h.addLabel(i,d))}}addResLabels(e,t,n=!1){let o=this.viewer;var h=[],d=function(s,a){for(var c=s.selectedAtoms(e,c),u={},A=0;A<c.length;A++){var L=c[A],D=L.chain,R=L.resn,P=L.resi,z=R+""+P;u[D]||(u[D]={}),u[D][z]||(u[D][z]=[]),u[D][z].push(L)}var F=(0,M.deepCopy)(t);for(let U in u)if(u.hasOwnProperty(U)){var B=u[U];for(let W in B)if(B.hasOwnProperty(W)){let I=B[W],V=new w.Vector3(0,0,0);for(let te=0;te<I.length;te++){let ae=I[te];V.x+=ae.x,V.y+=ae.y,V.z+=ae.z}V.divideScalar(I.length),F.position=V,F.frame=a;let ee=o.addLabel(W,F,void 0,!0);h.push(ee)}}};if(n){var i=this.getNumFrames();let s=this.atoms;for(let a=0;a<i;a++)this.frames[a]&&(this.atoms=this.frames[a],d(this,a));this.atoms=s}else d(this);return h}setupDFS(){this.atomdfs=[];var e=this,t=new Int8Array(this.atoms.length);t.fill(0);for(var n=function(i,s,a){a.push([i,s]);var c=e.atoms[i];t[i]=1;for(var u=0;u<c.bonds.length;u++){var A=c.bonds[u];e.atoms[A]&&!t[A]&&n(A,i,a)}},o=0;o<this.atoms.length;o++){var h=this.atoms[o];if(h&&!t[o]){var d=[];n(o,-1,d),this.atomdfs.push(d)}}}setCoordinatesFromURL(e,t){this.frames=[];var n=this;return this.box&&this.setupDFS(),e.startsWith("http")||(e="http://"+e),(0,M.get)(e+"/traj/numframes/"+t,function(o){if(!isNaN(parseInt(o)))return n.frames.push(n.atoms),n.frames.numFrames=o,n.frames.url=e,n.frames.path=t,n.setFrame(0)})}setCoordinates(e,t){if(t=t||"",!e)return[];if(/\.gz$/.test(t)){t=t.replace(/\.gz$/,"");try{e=(0,M.inflateString)(e)}catch(u){console.log(u)}}var n={mdcrd:"",inpcrd:"",pdb:"",netcdf:"",array:""};if(n.hasOwnProperty(t)){this.frames=[];for(var o=this.atoms.length,h=v.parseCrd(e,t),d=0;d<h.length;){for(var i=[],s=0;s<o;s++){var a={};for(var c in this.atoms[s])a[c]=this.atoms[s][c];i[s]=a,i[s].x=h[d++],i[s].y=h[d++],i[s].z=h[d++]}this.frames.push(i)}return this.atoms=this.frames[0],this.frames}return[]}addAtomSpecs(e){}static parseCrd(e,t){var n=[],o=0;if(t=="pdb")for(var h=e.indexOf(`
ATOM`);h!=-1;){for(;e.slice(h,h+5)==`
ATOM`||e.slice(h,h+7)==`
HETATM`;)n[o++]=parseFloat(e.slice(h+31,h+39)),n[o++]=parseFloat(e.slice(h+39,h+47)),n[o++]=parseFloat(e.slice(h+47,h+55)),h=e.indexOf(`
`,h+54),e.slice(h,h+4)==`
TER`&&(h=e.indexOf(`
`,h+5));h=e.indexOf(`
ATOM`,h)}else if(t=="netcdf"){var d=new _.NetCDFReader(e);n=[].concat.apply([],d.getDataVariable("coordinates"))}else{if(t=="array"||Array.isArray(e))return e.flat(2);{let i=e.indexOf(`
`);t=="inpcrd"&&(i=e.indexOf(`
`,i+1)),e=e.slice(i+1),n=e.match(/\S+/g).map(parseFloat)}}return n}static parseMolData(e,t="",n){if(!e)return[];if(/\.gz$/.test(t)){t=t.replace(/\.gz$/,"");try{t.match(/bcif/i)?e=(0,M.inflateString)(e,!1):e=(0,M.inflateString)(e)}catch(d){console.log(d)}}typeof b.Parsers[t]>"u"&&(t=t.split(".").pop(),typeof b.Parsers[t]>"u"&&(console.log("Unknown format: "+t),e instanceof Uint8Array?t="bcif":e.match(/^@<TRIPOS>MOLECULE/gm)?t="mol2":e.match(/^data_/gm)&&e.match(/^loop_/gm)?t="cif":e.match(/^HETATM/gm)||e.match(/^ATOM/gm)?t="pdb":e.match(/ITEM: TIMESTEP/gm)?t="lammpstrj":e.match(/^.*\n.*\n.\s*(\d+)\s+(\d+)/gm)?t="sdf":e.match(/^%VERSION\s+VERSION_STAMP/gm)?t="prmtop":t="xyz",console.log("Best guess: "+t)));var o=b.Parsers[t],h=o(e,n);return h}}v.defaultAtomStyle={line:{}},v.defaultlineWidth=1,v.vdwRadii={H:1.2,He:1.4,Li:1.82,Be:1.53,B:1.92,C:1.7,N:1.55,O:1.52,F:1.47,Ne:1.54,Na:2.27,Mg:1.73,Al:1.84,Si:2.1,P:1.8,S:1.8,Cl:1.75,Ar:1.88,K:2.75,Ca:2.31,Ni:1.63,Cu:1.4,Zn:1.39,Ga:1.87,Ge:2.11,As:1.85,Se:1.9,Br:1.85,Kr:2.02,Rb:3.03,Sr:2.49,Pd:1.63,Ag:1.72,Cd:1.58,In:1.93,Sn:2.17,Sb:2.06,Te:2.06,I:1.98,Xe:2.16,Cs:3.43,Ba:2.68,Pt:1.75,Au:1.66,Hg:1.55,Tl:1.96,Pb:2.02,Bi:2.07,Po:1.97,At:2.02,Rn:2.2,Fr:3.48,Ra:2.83,U:1.86},v.ignoredKeys=new Set(["props","invert","model","frame","byres","expand","within","and","or","not"])},"./src/GLShape.ts"(K,C,f){f.r(C),f.d(C,{GLShape:()=>_,splitMesh:()=>g});var E=f("./src/WebGL/index.ts"),S=f("./src/WebGL/shapes/index.ts"),w=f("./src/WebGL/math/index.ts"),O=f("./src/colors.ts"),p=f("./src/ProteinSurface4.ts"),x=f("./src/VolumeData.ts"),M=f("./src/GLDraw.ts"),m=f("./src/glcartoon.ts"),b=f("./src/utilities.ts");class _{static finalizeGeo(r){var e=r.updateGeoGroup(0);e.vertices>0&&e.truncateArrayBuffers(!0,!0)}static updateColor(r,e){e=e||O.CC.color(e),r.colorsNeedUpdate=!0;var t,n,o;e.constructor!==Array&&(t=e.r,n=e.g,o=e.b);for(let h in r.geometryGroups){let d=r.geometryGroups[h],i=d.colorArray;for(let s=0,a=d.vertices;s<a;++s){if(e.constructor===Array){let c=e[s];t=c.r,n=c.g,o=c.b}i[s*3]=t,i[s*3+1]=n,i[s*3+2]=o}}}static drawArrow(r,e,t){var n=t.start,o=t.end,h=t.radius,d=t.radiusRatio,i=t.mid,s=t.midpos;if(!(n&&o))return;var a=e.updateGeoGroup(51),c=new w.Vector3(o.x,o.y,o.z).sub(n);if(s){let ie=c.length();s>0?i=s/ie:i=(ie+s)/ie}c.multiplyScalar(i);var u=new w.Vector3(n.x,n.y,n.z).add(c),A=c.clone().negate();let L=new w.Vector3(n.x,n.y,n.z);r.intersectionShape.cylinder.push(new S.Cylinder(L,u.clone(),h)),r.intersectionShape.sphere.push(new S.Sphere(L,h));var D=[];D[0]=c.clone(),Math.abs(D[0].x)>1e-4?D[0].y+=1:D[0].x+=1,D[0].cross(c),D[0].normalize(),D[4]=D[0].clone(),D[4].crossVectors(D[0],c),D[4].normalize(),D[8]=D[0].clone().negate(),D[12]=D[4].clone().negate(),D[2]=D[0].clone().add(D[4]).normalize(),D[6]=D[4].clone().add(D[8]).normalize(),D[10]=D[8].clone().add(D[12]).normalize(),D[14]=D[12].clone().add(D[0]).normalize(),D[1]=D[0].clone().add(D[2]).normalize(),D[3]=D[2].clone().add(D[4]).normalize(),D[5]=D[4].clone().add(D[6]).normalize(),D[7]=D[6].clone().add(D[8]).normalize(),D[9]=D[8].clone().add(D[10]).normalize(),D[11]=D[10].clone().add(D[12]).normalize(),D[13]=D[12].clone().add(D[14]).normalize(),D[15]=D[14].clone().add(D[0]).normalize();var R=a.vertices,P=a.vertexArray,z=a.faceArray,F=a.normalArray,B=a.lineArray,U,W,I;for(W=0,I=D.length;W<I;++W){U=3*(R+3*W);var V=D[W].clone().multiplyScalar(h).add(n),ee=D[W].clone().multiplyScalar(h).add(u),te=D[W].clone().multiplyScalar(h*d).add(u);if(P[U]=V.x,P[U+1]=V.y,P[U+2]=V.z,P[U+3]=ee.x,P[U+4]=ee.y,P[U+5]=ee.z,P[U+6]=te.x,P[U+7]=te.y,P[U+8]=te.z,W>0){var ae=P[U-3],re=P[U-2],fe=P[U-1],q=new w.Vector3(ae,re,fe),oe=new w.Vector3(o.x,o.y,o.z),be=u.clone(),ge=new w.Vector3(te.x,te.y,te.z);r.intersectionShape.triangle.push(new S.Triangle(ge,oe,q)),r.intersectionShape.triangle.push(new S.Triangle(q.clone(),be,ge.clone()))}}a.vertices+=48,U=a.vertices*3,P[U]=n.x,P[U+1]=n.y,P[U+2]=n.z,P[U+3]=u.x,P[U+4]=u.y,P[U+5]=u.z,P[U+6]=o.x,P[U+7]=o.y,P[U+8]=o.z,a.vertices+=3;var Le,pe,J,ce,Me,Fe,ze,Be,Ue,Se,Ie,Re,Oe,Ge,Ve,j,Y,X,_e,ue=a.vertices-3,we=a.vertices-2,De=a.vertices-1,G=ue*3,se=we*3,ve=De*3;for(W=0,I=D.length-1;W<I;++W){var Te=R+3*W;U=Te*3,pe=a.faceidx,J=a.lineidx,ce=Te,Se=ce*3,Me=Te+1,Ie=Me*3,Fe=Te+2,Re=Fe*3,ze=Te+4,Oe=ze*3,Be=Te+5,Ge=Be*3,Ue=Te+3,Ve=Ue*3,j=Y=D[W],X=_e=D[W+1],F[Se]=j.x,F[Ie]=Y.x,F[Ve]=_e.x,F[Se+1]=j.y,F[Ie+1]=Y.y,F[Ve+1]=_e.y,F[Se+2]=j.z,F[Ie+2]=Y.z,F[Ve+2]=_e.z,F[Ie]=Y.x,F[Oe]=X.x,F[Ve]=_e.x,F[Ie+1]=Y.y,F[Oe+1]=X.y,F[Ve+1]=_e.y,F[Ie+2]=Y.z,F[Oe+2]=X.z,F[Ve+2]=_e.z,F[Re]=Y.x,F[Ge]=X.x,F[Re+1]=Y.y,F[Ge+1]=X.y,F[Re+2]=Y.z,F[Ge+2]=X.z,z[pe]=ce,z[pe+1]=Me,z[pe+2]=Ue,z[pe+3]=Me,z[pe+4]=ze,z[pe+5]=Ue,z[pe+6]=ce,z[pe+7]=Ue,z[pe+8]=ue,z[pe+9]=Fe,z[pe+10]=we,z[pe+11]=Be,z[pe+12]=Fe,z[pe+13]=De,z[pe+14]=Be,B[J]=ce,B[J+1]=Me,B[J+2]=ce,B[J+3]=Ue,B[J+4]=ze,B[J+5]=Ue,B[J+6]=ce,B[J+7]=Ue,B[J+8]=Fe,B[J+9]=Me,B[J+10]=Fe,B[J+11]=Be,B[J+12]=ze,B[J+13]=Be,B[J+14]=Fe,B[J+15]=De,B[J+16]=Fe,B[J+17]=Be,B[J+18]=De,B[J+19]=Be,a.faceidx+=15,a.lineidx+=20}Le=[R+45,R+46,R+1,R,R+47,R+2],pe=a.faceidx,J=a.lineidx,ce=Le[0],Se=ce*3,Me=Le[1],Ie=Me*3,Fe=Le[4],Re=Fe*3,ze=Le[2],Oe=ze*3,Be=Le[5],Ge=Be*3,Ue=Le[3],Ve=Ue*3,j=Y=D[15],X=_e=D[0],F[Se]=j.x,F[Ie]=Y.x,F[Ve]=_e.x,F[Se+1]=j.y,F[Ie+1]=Y.y,F[Ve+1]=_e.y,F[Se+2]=j.z,F[Ie+2]=Y.z,F[Ve+2]=_e.z,F[Ie]=Y.x,F[Oe]=X.x,F[Ve]=_e.x,F[Ie+1]=Y.y,F[Oe+1]=X.y,F[Ve+1]=_e.y,F[Ie+2]=Y.z,F[Oe+2]=X.z,F[Ve+2]=_e.z,F[Re]=Y.x,F[Ge]=X.x,F[Re+1]=Y.y,F[Ge+1]=X.y,F[Re+2]=Y.z,F[Ge+2]=X.z,c.normalize(),A.normalize(),F[G]=A.x,F[se]=F[ve]=c.x,F[G+1]=A.y,F[se+1]=F[ve+1]=c.y,F[G+2]=A.z,F[se+2]=F[ve+2]=c.z,z[pe]=ce,z[pe+1]=Me,z[pe+2]=Ue,z[pe+3]=Me,z[pe+4]=ze,z[pe+5]=Ue,z[pe+6]=ce,z[pe+7]=Ue,z[pe+8]=ue,z[pe+9]=Fe,z[pe+10]=we,z[pe+11]=Be,z[pe+12]=Fe,z[pe+13]=De,z[pe+14]=Be,B[J]=ce,B[J+1]=Me,B[J+2]=ce,B[J+3]=Ue,B[J+4]=ze,B[J+5]=Ue,B[J+6]=ce,B[J+7]=Ue,B[J+8]=Fe,B[J+9]=Me,B[J+10]=Fe,B[J+11]=Be,B[J+12]=ze,B[J+13]=Be,B[J+14]=Fe,B[J+15]=De,B[J+16]=Fe,B[J+17]=Be,B[J+18]=De,B[J+19]=Be,a.faceidx+=15,a.lineidx+=20}static updateBoundingFromPoints(r,e,t,n){r.center.set(0,0,0);let o=1/0,h=1/0,d=1/0,i=-1/0,s=-1/0,a=-1/0;r.box&&(o=r.box.min.x,i=r.box.max.x,h=r.box.min.y,s=r.box.max.y,d=r.box.min.z,a=r.box.max.z);for(let L=0,D=n;L<D;L++){var c=t[L*3],u=t[L*3+1],A=t[L*3+2];c<o&&(o=c),u<h&&(h=u),A<d&&(d=A),c>i&&(i=c),u>s&&(s=u),A>a&&(a=A)}r.center.set((i+o)/2,(s+h)/2,(a+d)/2),r.radius=r.center.distanceTo({x:i,y:s,z:a}),r.box={min:{x:o,y:h,z:d},max:{x:i,y:s,z:a}}}static addCustomGeo(r,e,t,n,o){var h=e.addGeoGroup(),d=t.vertexArr,i=t.normalArr,s=t.faceArr;h.vertices=d.length,h.faceidx=s.length;var a,c,u,A,L,D,R,P,z,F=h.vertexArray,B=h.colorArray;for(n.constructor!==Array&&(P=n.r,z=n.g,A=n.b),D=0,R=h.vertices;D<R;++D)a=D*3,c=d[D],F[a]=c.x,F[a+1]=c.y,F[a+2]=c.z,n.constructor===Array&&(L=n[D],P=L.r,z=L.g,A=L.b),B[a]=P,B[a+1]=z,B[a+2]=A;if(o)for(D=0,R=h.faceidx/3;D<R;++D){a=D*3,u=s[a],A=s[a+1],L=s[a+2];var U=new w.Vector3,W=new w.Vector3,I=new w.Vector3;r.intersectionShape.triangle.push(new S.Triangle(U.copy(d[u]),W.copy(d[A]),I.copy(d[L])))}if(o){var V=new w.Vector3(0,0,0),ee=0;for(let re=0;re<e.geometryGroups.length;re++)V.add(e.geometryGroups[re].getCentroid()),ee++;V.divideScalar(ee),_.updateBoundingFromPoints(r.boundingSphere,{centroid:V},F,h.vertices)}if(h.faceArray=new Uint16Array(s),h.truncateArrayBuffers(!0,!0),i.length<h.vertices)h.setNormals();else{var te=h.normalArray=new Float32Array(h.vertices*3),ae;for(D=0,R=h.vertices;D<R;++D)a=D*3,ae=i[D],te[a]=ae.x,te[a+1]=ae.y,te[a+2]=ae.z}h.setLineIndices(),h.lineidx=h.lineArray.length}static updateFromStyle(r,e){typeof e.color<"u"?(r.color=e.color||new O.Color,e.color instanceof O.Color||(r.color=O.CC.color(e.color))):r.color=O.CC.color(0),r.wireframe=!!e.wireframe,r.opacity=e.alpha?(0,w.clamp)(e.alpha,0,1):1,typeof e.opacity<"u"&&(r.opacity=(0,w.clamp)(e.opacity,0,1)),r.side=e.side!==void 0?e.side:E.DoubleSide,r.linewidth=typeof e.linewidth>"u"?1:e.linewidth,r.clickable=!!e.clickable,r.callback=(0,b.makeFunction)(e.callback),r.hoverable=!!e.hoverable,r.hover_callback=(0,b.makeFunction)(e.hover_callback),r.unhover_callback=(0,b.makeFunction)(e.unhover_callback),r.contextMenuEnabled=!!e.contextMenuEnabled,r.hidden=e.hidden,r.frame=e.frame}constructor(r){this.color=16777215,this.hidden=!1,this.wireframe=!1,this.opacity=1,this.linewidth=1,this.clickable=!1,this.hoverable=!1,this.contextMenuEnabled=!1,this.side=E.DoubleSide,this.stylespec=r||{},this.boundingSphere=new S.Sphere,this.intersectionShape={sphere:[],cylinder:[],line:[],triangle:[]},_.updateFromStyle(this,this.stylespec),this.components=[],this.shapeObj=null,this.renderedShapeObj=null,this.geo=new E.Geometry(!0),this.linegeo=new E.Geometry(!0)}updateStyle(r){for(var e in r)this.stylespec[e]=r[e];if(_.updateFromStyle(this,this.stylespec),r.voldata&&r.volscheme){(0,b.adjustVolumeStyle)(r);const t=r.volscheme,n=r.voldata,o=O.CC,h=t.range()||[-1,1];this.geo.setColors(function(d,i,s){let a=n.getVal(d,i,s);return o.color(t.valueToHex(a,h))}),delete this.color}}addCustom(r){r.vertexArr=r.vertexArr||[],r.faceArr=r.faceArr||[],r.normalArr=r.normalArr||[],_.drawCustom(this,this.geo,r)}addSphere(r){r.center||(r.center=new w.Vector3(0,0,0)),r.radius=r.radius?(0,w.clamp)(r.radius,0,1/0):1.5,r.color=O.CC.color(r.color),this.intersectionShape.sphere.push(new S.Sphere(r.center,r.radius)),M.GLDraw.drawSphere(this.geo,r.center,r.radius,r.color,r.quality),this.components.push({centroid:new w.Vector3(r.center.x,r.center.y,r.center.z)});var e=this.geo.updateGeoGroup(0);_.updateBoundingFromPoints(this.boundingSphere,this.components,e.vertexArray,e.vertices)}addBox(r){var e=r.dimensions||{w:1,h:1,d:1},t;typeof e.w=="number"?t={x:e.w,y:0,z:0}:t=e.w;var n;typeof e.h=="number"?n={x:0,y:e.h,z:0}:n=e.h;var o;typeof e.d=="number"?o={x:0,y:0,z:e.d}:o=e.d;var h=r.corner;h==null&&(r.center!==void 0?h={x:r.center.x-.5*(t.x+n.x+o.x),y:r.center.y-.5*(t.y+n.y+o.y),z:r.center.z-.5*(t.z+n.z+o.z)}:h={x:0,y:0,z:0});var d=[{x:h.x,y:h.y,z:h.z},{x:h.x+t.x,y:h.y+t.y,z:h.z+t.z},{x:h.x+n.x,y:h.y+n.y,z:h.z+n.z},{x:h.x+t.x+n.x,y:h.y+t.y+n.y,z:h.z+t.z+n.z},{x:h.x+o.x,y:h.y+o.y,z:h.z+o.z},{x:h.x+t.x+o.x,y:h.y+t.y+o.y,z:h.z+t.z+o.z},{x:h.x+n.x+o.x,y:h.y+n.y+o.y,z:h.z+n.z+o.z},{x:h.x+t.x+n.x+o.x,y:h.y+t.y+n.y+o.y,z:h.z+t.z+n.z+o.z}],i=[],s=[];i.splice(i.length,0,d[0],d[1],d[2],d[3]),s.splice(s.length,0,0,2,1,1,2,3);var a=4;i.splice(i.length,0,d[2],d[3],d[6],d[7]),s.splice(s.length,0,a+0,a+2,a+1,a+1,a+2,a+3),a+=4,i.splice(i.length,0,d[4],d[5],d[0],d[1]),s.splice(s.length,0,a+0,a+2,a+1,a+1,a+2,a+3),a+=4,i.splice(i.length,0,d[6],d[7],d[4],d[5]),s.splice(s.length,0,a+0,a+2,a+1,a+1,a+2,a+3),a+=4,i.splice(i.length,0,d[3],d[1],d[7],d[5]),s.splice(s.length,0,a+0,a+2,a+1,a+1,a+2,a+3),a+=4,i.splice(i.length,0,d[2],d[6],d[0],d[4]),s.splice(s.length,0,a+0,a+2,a+1,a+1,a+2,a+3),a+=4;var c=(0,b.extend)({},r);c.vertexArr=i,c.faceArr=s,c.normalArr=[],_.drawCustom(this,this.geo,c);var u=new w.Vector3;this.components.push({centroid:u.addVectors(d[0],d[7]).multiplyScalar(.5)});var A=this.geo.updateGeoGroup(0);_.updateBoundingFromPoints(this.boundingSphere,this.components,A.vertexArray,A.vertices)}addCylinder(r){var e,t;r.start?e=new w.Vector3(r.start.x||0,r.start.y||0,r.start.z||0):e=new w.Vector3(0,0,0),r.end?(t=new w.Vector3(r.end.x,r.end.y||0,r.end.z||0),typeof t.x>"u"&&(t.x=3)):t=new w.Vector3(0,0,0);var n=r.radius||.1,o=O.CC.color(r.color);this.intersectionShape.cylinder.push(new S.Cylinder(e,t,n)),M.GLDraw.drawCylinder(this.geo,e,t,n,o,r.fromCap,r.toCap);var h=new w.Vector3;this.components.push({centroid:h.addVectors(e,t).multiplyScalar(.5)});var d=this.geo.updateGeoGroup(0);_.updateBoundingFromPoints(this.boundingSphere,this.components,d.vertexArray,d.vertices)}addDashedCylinder(r){r.dashLength=r.dashLength||.25,r.gapLength=r.gapLength||.25;var e;r.start?e=new w.Vector3(r.start.x||0,r.start.y||0,r.start.z||0):e=new w.Vector3(0,0,0);var t;r.end?(t=new w.Vector3(r.end.x,r.end.y||0,r.end.z||0),typeof t.x>"u"&&(t.x=3)):t=new w.Vector3(3,0,0);for(var n=r.radius||.1,o=O.CC.color(r.color),h=Math.sqrt(Math.pow(e.x-t.x,2)+Math.pow(e.y-t.y,2)+Math.pow(e.z-t.z,2)),d=h/(r.gapLength+r.dashLength),i=new w.Vector3(r.start.x||0,r.start.y||0,r.start.z||0),s=new w.Vector3(r.end.x,r.end.y||0,r.end.z||0),a=new w.Vector3((t.x-e.x)/(h/r.gapLength),(t.y-e.y)/(h/r.gapLength),(t.z-e.z)/(h/r.gapLength)),c=new w.Vector3((t.x-e.x)/(h/r.dashLength),(t.y-e.y)/(h/r.dashLength),(t.z-e.z)/(h/r.dashLength)),u=0;u<d;u++)s=new w.Vector3(i.x+c.x,i.y+c.y,i.z+c.z),this.intersectionShape.cylinder.push(new S.Cylinder(i,s,n)),M.GLDraw.drawCylinder(this.geo,i,s,n,o,r.fromCap,r.toCap),i=new w.Vector3(s.x+a.x,s.y+a.y,s.z+a.z);var A=new w.Vector3;this.components.push({centroid:A.addVectors(e,t).multiplyScalar(.5)});var L=this.geo.updateGeoGroup(0);_.updateBoundingFromPoints(this.boundingSphere,this.components,L.vertexArray,L.vertices)}addCurve(r){r.points=r.points||[],r.smooth=r.smooth||10,typeof r.fromCap>"u"&&(r.fromCap=2),typeof r.toCap>"u"&&(r.toCap=2);var e=(0,m.subdivide_spline)(r.points,r.smooth);if(e.length<3){console.log("Too few points in addCurve");return}var t=r.radius||.1,n=O.CC.color(r.color),o=0,h=e.length-1,d=e[0].distanceTo(e[1]),i=Math.ceil(2*t/d);if(r.toArrow){h-=i;let u={start:e[h],end:e[e.length-1],radius:t,color:n,mid:1e-4};this.addArrow(u)}if(r.fromArrow){o+=i;let u={start:e[o],end:e[0],radius:t,color:n,mid:1e-4};this.addArrow(u)}for(var s=Math.ceil(e.length/2),a={radius:t,color:n,fromCap:2,toCap:2},c=o;c<h;c++)a.start=e[c],a.end=e[c+1],a.fromCap=2,a.toCap=2,c<s?(a.fromCap=2,a.toCap=0):c>s?(a.fromCap=0,a.toCap=2):(a.fromCap=2,a.toCap=2),this.addCylinder(a)}addLine(r){var e,t;r.start?e=new w.Vector3(r.start.x||0,r.start.y||0,r.start.z||0):e=new w.Vector3(0,0,0),r.end?(t=new w.Vector3(r.end.x,r.end.y||0,r.end.z||0),typeof t.x>"u"&&(t.x=3)):t=new w.Vector3(3,0,0);var n=this.geo.updateGeoGroup(2),o=n.vertices,h=o*3,d=n.vertexArray;d[h]=e.x,d[h+1]=e.y,d[h+2]=e.z,d[h+3]=t.x,d[h+4]=t.y,d[h+5]=t.z,n.vertices+=2;var i=n.lineArray,s=n.lineidx;i[s]=o,i[s+1]=o+1,n.lineidx+=2;var a=new w.Vector3;this.components.push({centroid:a.addVectors(e,t).multiplyScalar(.5)}),n=this.geo.updateGeoGroup(0),_.updateBoundingFromPoints(this.boundingSphere,this.components,n.vertexArray,n.vertices)}addArrow(r){if(r.start?r.start=new w.Vector3(r.start.x||0,r.start.y||0,r.start.z||0):r.start=new w.Vector3(0,0,0),r.dir instanceof w.Vector3&&typeof r.length=="number"){var e=r.dir.clone().multiplyScalar(r.length).add(r.start);r.end=e}else r.end?(r.end=new w.Vector3(r.end.x,r.end.y||0,r.end.z||0),typeof r.end.x>"u"&&(r.end.x=3)):r.end=new w.Vector3(3,0,0);r.radius=r.radius||.1,r.radiusRatio=r.radiusRatio||1.618034,r.mid=0<r.mid&&r.mid<1?r.mid:.618034,_.drawArrow(this,this.geo,r);var t=new w.Vector3;this.components.push({centroid:t.addVectors(r.start,r.end).multiplyScalar(.5)});var n=this.geo.updateGeoGroup(0);_.updateBoundingFromPoints(this.boundingSphere,this.components,n.vertexArray,n.vertices)}static distance_from(r,e){return Math.sqrt(Math.pow(r.x-e.x,2)+Math.pow(r.y-e.y,2)+Math.pow(r.z-e.z,2))}static inSelectedRegion(r,e,t){for(var n=0;n<e.length;n++)if(_.distance_from(e[n],r)<=t)return!0;return!1}addIsosurface(r,e,t,n){var o=e.isoval!==void 0&&typeof e.isoval=="number"?e.isoval:0,h=!!e.voxel,d=e.smoothness===void 0?1:e.smoothness,i=r.size.x,s=r.size.y,a=r.size.z,c=new Int16Array(i*s*a),u=r.data,A,L;for(A=0,L=c.length;A<L;++A)c[A]=-1;var D=new Uint8Array(i*s*a);for(A=0,L=u.length;A<L;++A){var R=o>=0?u[A]-o:o-u[A];R>0&&(D[A]|=_.ISDONE)}var P=[],z=[];p.MarchingCube.march(D,P,z,{fulltable:!0,voxel:h,unitCube:r.unit,origin:r.origin,matrix:r.matrix,nX:i,nY:s,nZ:a}),!h&&d>0&&p.MarchingCube.laplacianSmooth(d,P,z);var F=[],B=[],U=[];if(e.selectedRegion&&e.coords===void 0&&(e.coords=e.selectedRegion),e.coords===void 0&&e.selection!==void 0&&(n?e.coords=n.selectedAtoms(e.selection):console.log("addIsosurface needs viewer is selection provided.")),e.coords!==void 0){var W=e.coords[0].x,I=e.coords[0].y,V=e.coords[0].z,ee=e.coords[0].x,te=e.coords[0].y,ae=e.coords[0].z;for(let J=0;J<e.coords.length;J++)e.coords[J].x>W?W=e.coords[J].x:e.coords[J].x<ee&&(ee=e.coords[J].x),e.coords[J].y>I?I=e.coords[J].y:e.coords[J].y<te&&(te=e.coords[J].y),e.coords[J].z>V?V=e.coords[J].z:e.coords[J].z<ae&&(ae=e.coords[J].z);var re=2;e.radius!==void 0&&(re=e.radius),e.selectedOffset!==void 0&&(re=e.selectedOffset),e.seldist!==void 0&&(re=e.seldist),ee-=re,W+=re,te-=re,I+=re,ae-=re,V+=re;for(let J=0;J<P.length;J++)P[J].x>ee&&P[J].x<W&&P[J].y>te&&P[J].y<I&&P[J].z>ae&&P[J].z<V&&_.inSelectedRegion(P[J],e.coords,re)?(F.push(B.length),B.push(P[J])):F.push(-1);for(let J=0;J+2<z.length;J+=3)F[z[J]]!==-1&&F[z[J+1]]!==-1&&F[z[J+2]]!==-1&&(U.push(z[J]-(z[J]-F[z[J]])),U.push(z[J+1]-(z[J+1]-F[z[J+1]])),U.push(z[J+2]-(z[J+2]-F[z[J+2]])));P=B,z=U}_.drawCustom(this,this.geo,{vertexArr:P,faceArr:z,normalArr:[],clickable:e.clickable,hoverable:e.hoverable}),this.updateStyle(e);var fe=new w.Vector3(r.origin.x,r.origin.y,r.origin.z),q=new w.Vector3(r.size.x*r.unit.x,r.size.y*r.unit.y,r.size.z*r.unit.z),oe=new w.Vector3(0,0,0),be=fe.clone(),ge=fe.clone().add(q);for(let J=0;J<P.length;J++)oe.add(P[J]),be.max(P[J]),ge.min(P[J]);oe.divideScalar(P.length);var Le=oe.distanceTo(ge),pe=oe.distanceTo(be);this.boundingSphere.center=oe,this.boundingSphere.radius=Math.max(Le,pe),typeof t=="function"&&t()}addVolumetricData(r,e,t){r=new x.VolumeData(r,e),this.addIsosurface(r,t)}finalize(){return _.finalizeGeo(this.geo),this.geo.initTypedArrays(),this.geo}globj(r){if(this.renderedShapeObj&&(r.remove(this.renderedShapeObj),this.renderedShapeObj=null),!this.hidden){_.finalizeGeo(this.geo),this.geo.initTypedArrays(),this.wireframe&&this.geo.setUpWireframe(),typeof this.color<"u"&&_.updateColor(this.geo,this.color),this.shapeObj=new E.Object3D;var e=null;this.side==E.DoubleSide?e=new E.MeshDoubleLambertMaterial({wireframe:this.wireframe,side:this.side,transparent:this.opacity<1,opacity:this.opacity,wireframeLinewidth:this.linewidth,vertexColors:E.Coloring.VertexColors}):e=new E.MeshLambertMaterial({wireframe:this.wireframe,side:this.side,transparent:this.opacity<1,opacity:this.opacity,wireframeLinewidth:this.linewidth,vertexColors:E.Coloring.VertexColors});var t=new E.Mesh(this.geo,e);if(this.shapeObj.add(t),this.linegeo&&this.linegeo.vertices>0){var n=new E.LineBasicMaterial({linewidth:this.linewidth,color:this.color}),o=new E.Line(this.linegeo,n,E.LineStyle.LinePieces);this.shapeObj.add(o)}this.renderedShapeObj=this.shapeObj.clone(),r.add(this.renderedShapeObj)}}removegl(r){this.renderedShapeObj&&(this.renderedShapeObj.geometry!==void 0&&this.renderedShapeObj.geometry.dispose(),this.renderedShapeObj.material!==void 0&&this.renderedShapeObj.material.dispose(),r.remove(this.renderedShapeObj),this.renderedShapeObj=null),this.shapeObj=null}get position(){return this.boundingSphere.center}get x(){return this.boundingSphere.center.x}get y(){return this.boundingSphere.center.y}get z(){return this.boundingSphere.center.z}}_.ISDONE=2,_.drawCustom=function(v,r,e){var t=e,n=t.vertexArr,o=t.faceArr;(n.length===0||o.length===0)&&console.warn("Error adding custom shape component: No vertices and/or face indices supplied!");var h=e.color;typeof h>"u"&&(h=v.color),h=O.CC.color(h);for(var d=g(t),i=0,s=d.length;i<s;i++)_.addCustomGeo(v,r,d[i],d[i].colorArr?d[i].colorArr:h,e.clickable)};function g(v){var r=64e3;if(v.vertexArr.length<r)return[v];var e=[{vertexArr:[],normalArr:[],faceArr:[]}];v.colorArr&&(e.colorArr=[]);var t=[],n=[],o=0,h=v.faceArr;for(let i=0,s=h.length;i<s;i+=3){let a=e[o];for(let c=0;c<3;c++){var d=h[i+c];t[d]!==o&&(t[d]=o,n[d]=a.vertexArr.length,a.vertexArr.push(v.vertexArr[d]),v.normalArr&&v.normalArr[d]&&a.normalArr.push(v.normalArr[d]),v.colorArr&&v.colorArr[d]&&a.colorArr.push(v.colorArr[d])),a.faceArr.push(n[d])}a.vertexArr.length>=r&&(e.push({vertexArr:[],normalArr:[],faceArr:[]}),v.colorArr&&(e.colorArr=[]),o++)}return e}},"./src/GLViewer.ts"(K,C,f){f.r(C),f.d(C,{CONTEXTS_PER_VIEWPORT:()=>r,GLViewer:()=>t,createStereoViewer:()=>h,createViewer:()=>n,createViewerGrid:()=>o});var E=f("./node_modules/upng-js/UPNG.js"),S=f("./src/GLModel.ts"),w=f("./src/GLShape.ts"),O=f("./src/Gradient.ts"),p=f("./src/Label.ts"),x=f("./src/ProteinSurface4.ts"),M=f("./src/VolumeData.ts"),m=f("./src/VolumetricRender.ts"),b=f("./src/WebGL/index.ts"),_=f("./src/WebGL/math/index.ts"),g=f("./src/colors.ts"),v=f("./src/utilities.ts");const r=16;class e extends Array{constructor(i){super(...i)}getSymmetries(){if(this.length==0)return[];let i=this[0];return typeof i.symmetries>"u"&&this.setSymmetries([new _.Matrix4]),i.symmetries}setSymmetries(i){typeof i>"u"&&(i=[new _.Matrix4]);for(let s of this)s.symmetries=i,s.finished=!1}}class t{getWidth(){let i=this.container,s=i.offsetWidth;if(s==0&&i.style.display==="none"){let a=i.style.position,c=i.style.visibility;i.style.display="block",i.style.visibility="hidden",i.style.position="absolute",s=i.offsetWidth,i.style.display="none",i.style.visibility=c,i.style.position=a}return s}getHeight(){let i=this.container,s=i.offsetHeight;if(s==0&&i.style.display==="none"){let a=i.style.position,c=i.style.visibility;i.style.display="block",i.style.visibility="hidden",i.style.position="absolute",s=i.offsetHeight,i.style.display="none",i.style.visibility=c,i.style.position=a}return s}setupRenderer(){let i=Object.assign(Object.assign({},this.config),{preserveDrawingBuffer:!0,premultipliedAlpha:!1,containerWidth:this.WIDTH,containerHeight:this.HEIGHT});this.renderer=new b.Renderer(i),this.renderer.domElement.style.width="100%",this.renderer.domElement.style.height="100%",this.renderer.domElement.style.padding="0",this.renderer.domElement.style.position="absolute",this.renderer.domElement.style.top="0px",this.renderer.domElement.style.left="0px",this.renderer.domElement.style.zIndex="0"}initializeScene(){this.scene=new b.Scene,this.scene.fog=new b.Fog(this.bgColor,100,200),this.modelGroup=new b.Object3D,this.rotationGroup=new b.Object3D,this.rotationGroup.useQuaternion=!0,this.rotationGroup.quaternion=new _.Quaternion(0,0,0,1),this.rotationGroup.add(this.modelGroup),this.scene.add(this.rotationGroup);var i=new b.Light(16777215);i.position=new _.Vector3(.2,.2,1).normalize(),i.intensity=1,this.scene.add(i)}_handleLostContext(i){const s=function(a){const c=a.getBoundingClientRect();return!(c.right<0||c.bottom<0||c.top>(window.innerHeight||document.documentElement.clientHeight)||c.left>(window.innerWidth||document.documentElement.clientWidth))};if(s(this.container)){let a=0;for(let c of document.getElementsByTagName("canvas"))if(s(c)&&c._3dmol_viewer!=null&&(c._3dmol_viewer.resize(),a+=1,a>=r))break}}initContainer(i){this.container=i,this.WIDTH=this.getWidth(),this.HEIGHT=this.getHeight(),this.ASPECT=this.renderer.getAspect(this.WIDTH,this.HEIGHT),this.renderer.setSize(this.WIDTH,this.HEIGHT),this.container.append(this.renderer.domElement),this.glDOM=this.renderer.domElement,this.glDOM._3dmol_viewer=this,this.glDOM.addEventListener("webglcontextlost",this._handleLostContext.bind(this)),this.nomouse||(this.glDOM.addEventListener("mousedown",this._handleMouseDown.bind(this),{passive:!1}),this.glDOM.addEventListener("touchstart",this._handleMouseDown.bind(this),{passive:!1}),this.glDOM.addEventListener("wheel",this._handleMouseScroll.bind(this),{passive:!1}),this.glDOM.addEventListener("mousemove",this._handleMouseMove.bind(this),{passive:!1}),this.glDOM.addEventListener("touchmove",this._handleMouseMove.bind(this),{passive:!1}),this.glDOM.addEventListener("contextmenu",this._handleContextMenu.bind(this),{passive:!1}))}decAnim(){this.animated--,this.animated<0&&(this.animated=0)}incAnim(){this.animated++}nextSurfID(){var i=0;for(let a in this.surfaces)if(this.surfaces.hasOwnProperty(a)){var s=parseInt(a);isNaN(s)||s>i&&(i=s)}return i+1}setSlabAndFog(){let i=this.camera.position.z-this.rotationGroup.position.z;i<1&&(i=1),this.camera.near=i+this.slabNear,!this.camera.ortho&&this.camera.near<1&&(this.camera.near=1),this.camera.far=i+this.slabFar,this.camera.near+1>this.camera.far&&(this.camera.far=this.camera.near+1),this.camera.fov=this.fov,this.camera.right=i*Math.tan(Math.PI/180*this.fov),this.camera.left=-this.camera.right,this.camera.top=this.camera.right/this.ASPECT,this.camera.bottom=-this.camera.top,this.camera.updateProjectionMatrix(),this.scene.fog.near=this.camera.near+this.fogStart*(this.camera.far-this.camera.near),this.scene.fog.far=this.camera.near+this.fogEnd*(this.camera.far-this.camera.near),this.config.disableFog&&(this.scene.fog.near=this.scene.fog.far)}show(i){if(this.renderer.setViewport(),!!this.scene&&(this.setSlabAndFog(),this.renderer.render(this.scene,this.camera),this.viewChangeCallback&&this.viewChangeCallback(this._viewer.getView()),!i&&this.linkedViewers.length>0))for(var s=this._viewer.getView(),a=0;a<this.linkedViewers.length;a++){var c=this.linkedViewers[a];c.setView(s,!0)}}updateClickables(){this.clickables.splice(0,this.clickables.length),this.hoverables.splice(0,this.hoverables.length),this.contextMenuEnabledObjects.splice(0,this.contextMenuEnabledObjects.length);for(let i=0,s=this.models.length;i<s;i++){let a=this.models[i];if(a){let c=a.selectedAtoms({clickable:!0}),u=a.selectedAtoms({hoverable:!0}),A=a.selectedAtoms({contextMenuEnabled:!0});for(let L=0;L<u.length;L++)this.hoverables.push(u[L]);for(let L=0;L<c.length;L++)this.clickables.push(c[L]);for(let L=0;L<A.length;L++)this.contextMenuEnabledObjects.push(A[L])}}for(let i=0,s=this.shapes.length;i<s;i++){let a=this.shapes[i];a&&a.clickable&&this.clickables.push(a),a&&a.hoverable&&this.hoverables.push(a),a&&a.contextMenuEnabled&&this.contextMenuEnabledObjects.push(a)}}handleClickSelection(i,s,a){let c=this.targetedObjects(i,s,this.clickables);if(c.length){var u=c[0].clickable;u.callback!==void 0&&(typeof u.callback!="function"&&(u.callback=(0,v.makeFunction)(u.callback)),typeof u.callback=="function"&&(this.mouseButton===3&&this.contextMenuEnabledObjects.includes(u)&&this.userContextMenuHandler||u.callback(u,this._viewer,a,this.container,c)))}}canvasOffset(){let i=this.glDOM,s=i.getBoundingClientRect(),a=i.ownerDocument,c=a.documentElement,u=a.defaultView;return{top:s.top+u.pageYOffset-c.clientTop,left:s.left+u.pageXOffset-c.clientLeft}}setHover(i,s,a){this.current_hover!=i&&(this.current_hover&&(typeof this.current_hover.unhover_callback!="function"&&(this.current_hover.unhover_callback=(0,v.makeFunction)(this.current_hover.unhover_callback)),this.current_hover.unhover_callback(this.current_hover,this._viewer,s,this.container,a)),this.current_hover=i,i&&i.hover_callback!==void 0&&(typeof i.hover_callback!="function"&&(i.hover_callback=(0,v.makeFunction)(i.hover_callback)),typeof i.hover_callback=="function"&&i.hover_callback(i,this._viewer,s,this.container,a)))}handleHoverSelection(i,s,a){if(this.hoverables.length==0)return;let c=this.targetedObjects(i,s,this.hoverables);if(c.length){var u=c[0].clickable;this.setHover(u,a,c),this.current_hover=u}else this.setHover(null)}handleHoverContinue(i,s){let a=this.targetedObjects(i,s,this.hoverables);(a.length==0||a[0]===void 0)&&this.setHover(null),a[0]!==void 0&&a[0].clickable!==this.current_hover&&this.setHover(null)}closeEnoughForClick(i,{allowTolerance:s=i.targetTouches,tolerance:a=5}={}){const c=this.getX(i),u=this.getY(i);if(s){const A=Math.abs(c-this.mouseStartX),L=Math.abs(u-this.mouseStartY);return A<=a&&L<=a}else return c===this.mouseStartX&&u===this.mouseStartY}calcTouchDistance(i){var s=i.targetTouches[0].pageX-i.targetTouches[1].pageX,a=i.targetTouches[0].pageY-i.targetTouches[1].pageY;return Math.hypot(s,a)}getX(i){var s=i.pageX;return s==null&&(s=i.pageX),i.targetTouches&&i.targetTouches[0]?s=i.targetTouches[0].pageX:i.changedTouches&&i.changedTouches[0]&&(s=i.changedTouches[0].pageX),s}getY(i){var s=i.pageY;return s==null&&(s=i.pageY),i.targetTouches&&i.targetTouches[0]?s=i.targetTouches[0].pageY:i.changedTouches&&i.changedTouches[0]&&(s=i.changedTouches[0].pageY),s}isInViewer(i,s){if(this.viewers!=null){var a=this.WIDTH/this.cols,c=this.HEIGHT/this.rows,u=this.canvasOffset(),A=i-u.left,L=s-u.top,D=this.rows-Math.floor(L/c)-1,R=Math.floor(A/a);if(D!=this.row||R!=this.col)return!1}return!0}adjustZoomToLimits(i){if(this.config.lowerZoomLimit&&this.config.lowerZoomLimit>0){let s=this.CAMERA_Z-this.config.lowerZoomLimit;i>s&&(i=s)}if(this.config.upperZoomLimit&&this.config.upperZoomLimit>0){let s=this.CAMERA_Z-this.config.upperZoomLimit;i<s&&(i=s)}return i>this.CAMERA_Z-1&&(i=this.CAMERA_Z-1),i}static slerp(i,s,a){if(a==1)return s.clone();if(a==0)return i.clone();let c=i.x*s.x+i.y*s.y+i.z*s.z+i.w*s.w;if(c>.9995){let z=new _.Quaternion(i.x+a*(s.x-i.x),i.y+a*(s.y-i.y),i.z+a*(s.z-i.z),i.w+a*(s.w-i.w));return z.normalize(),z}c<0&&(s=s.clone().multiplyScalar(-1),c=-c),c>1?c=1:c<-1&&(c=-1);var u=Math.acos(c),A=u*a,L=s.clone();L.sub(i.clone().multiplyScalar(c)),L.normalize();var D=Math.cos(A),R=Math.sin(A),P=new _.Quaternion(i.x*D+L.x*R,i.y*D+L.y*R,i.z*D+L.z*R,i.w*D+L.w*R);return P.normalize(),P}constructor(i,s={}){if(this.nomouse=!1,this.glDOM=null,this.models=[],this.surfaces={},this.shapes=[],this.labels=[],this.clickables=[],this.hoverables=[],this.contextMenuEnabledObjects=[],this.current_hover=null,this.hoverDuration=500,this.longTouchDuration=1e3,this.viewer_frame=0,this.viewChangeCallback=null,this.stateChangeCallback=null,this.NEAR=1,this.FAR=800,this.CAMERA_Z=150,this.fov=20,this.linkedViewers=[],this.renderer=null,this.control_all=!1,this.scene=null,this.rotationGroup=null,this.modelGroup=null,this.fogStart=.4,this.fogEnd=1,this.slabNear=-50,this.slabFar=50,this.cq=new _.Quaternion(0,0,0,1),this.dq=new _.Quaternion(0,0,0,1),this.animated=0,this.animationTimers=new Set,this.isDragging=!1,this.mouseStartX=0,this.mouseStartY=0,this.touchDistanceStart=0,this.touchHold=!1,this.currentModelPos=0,this.cz=0,this.cslabNear=0,this.cslabFar=0,this.userContextMenuHandler=null,this.config=s,this.callback=this.config.callback,this.defaultcolors=this.config.defaultcolors,this.defaultcolors||(this.defaultcolors=g.elementColors.defaultColors),this.nomouse=!!this.config.nomouse,this.bgColor=0,this.config.backgroundColor=this.config.backgroundColor||"#ffffff",typeof this.config.backgroundColor<"u"&&(this.bgColor=g.CC.color(this.config.backgroundColor).getHex()),this.config.backgroundAlpha=this.config.backgroundAlpha==null?1:this.config.backgroundAlpha,this.camerax=0,typeof this.config.camerax<"u"&&(this.camerax=typeof this.config.camerax=="string"?parseFloat(this.config.camerax):this.config.camerax),this._viewer=this,this.container=i,this.config.hoverDuration!=null&&(this.hoverDuration=this.config.hoverDuration),this.config.antialias===void 0&&(this.config.antialias=!0),this.config.cartoonQuality===void 0&&(this.config.cartoonQuality=10),this.WIDTH=this.getWidth(),this.HEIGHT=this.getHeight(),this.setupRenderer(),this.row=this.config.row==null?0:this.config.row,this.col=this.config.col==null?0:this.config.col,this.cols=this.config.cols,this.rows=this.config.rows,this.viewers=this.config.viewers,this.control_all=this.config.control_all,this.ASPECT=this.renderer.getAspect(this.WIDTH,this.HEIGHT),this.camera=new b.Camera(this.fov,this.ASPECT,this.NEAR,this.FAR,this.config.orthographic),this.camera.position=new _.Vector3(this.camerax,0,this.CAMERA_Z),this.lookingAt=new _.Vector3,this.camera.lookAt(this.lookingAt),this.raycaster=new b.Raycaster(new _.Vector3(0,0,0),new _.Vector3(0,0,0)),this.projector=new b.Projector,this.initializeScene(),this.renderer.setClearColorHex(this.bgColor,this.config.backgroundAlpha),this.scene.fog.color=g.CC.color(this.bgColor),document.body.addEventListener("mouseup",this._handleMouseUp.bind(this)),document.body.addEventListener("touchend",this._handleMouseUp.bind(this)),this.initContainer(this.container),this.config.style&&this.setViewStyle(this.config),window.addEventListener("resize",this.resize.bind(this)),typeof window.ResizeObserver<"u"&&(this.divwatcher=new window.ResizeObserver(this.resize.bind(this)),this.divwatcher.observe(this.container)),typeof window.IntersectionObserver<"u"){let a=(c,u)=>{c.forEach(A=>{A.isIntersecting&&this.resize()})};this.intwatcher=new window.IntersectionObserver(a),this.intwatcher.observe(this.container)}try{typeof this.callback=="function"&&this.callback(this)}catch(a){console.log("error with glviewer callback: "+a)}}targetedObjects(i,s,a){var c={x:i,y:s,z:-1};return Array.isArray(a)||(a=this.selectedAtoms(a)),a.length==0?[]:(this.raycaster.setFromCamera(c,this.camera),this.raycaster.intersectObjects(this.modelGroup,a))}modelToScreen(i){let s=!1;Array.isArray(i)||(i=[i],s=!0);let a=this.renderer.getXRatio(),c=this.renderer.getYRatio(),u=this.col,A=this.row,L=u*(this.WIDTH/a),D=(c-A-1)*(this.HEIGHT/c),R=[],P=this.canvasOffset();return i.forEach(z=>{let F=new _.Vector3(z.x,z.y,z.z);F.applyMatrix4(this.modelGroup.matrixWorld),this.projector.projectVector(F,this.camera);let B=this.WIDTH/a*(F.x+1)/2+P.left+L,U=-(this.HEIGHT/c)*(F.y-1)/2+P.top+D;R.push({x:B,y:U})}),s&&(R=R[0]),R}screenOffsetToModel(i,s,a){var c=i/this.WIDTH,u=s/this.HEIGHT,A=a===void 0?this.rotationGroup.position.z:a,L=this.rotationGroup.quaternion,D=new _.Vector3(0,0,A);return this.projector.projectVector(D,this.camera),D.x+=c*2,D.y-=u*2,this.projector.unprojectVector(D,this.camera),D.z=0,D.applyQuaternion(L),D}screenToModelDistance(i,s){let a=this.canvasOffset(),c=new _.Vector3(s.x,s.y,s.z);c.applyMatrix4(this.modelGroup.matrixWorld);let u=c.clone();this.projector.projectVector(c,this.camera);let A=new _.Vector3((i.x-a.left)*2/this.WIDTH-1,(i.y-a.top)*2/-this.HEIGHT+1,c.z);return this.projector.unprojectVector(A,this.camera),A.distanceTo(u)}setViewChangeCallback(i){(typeof i=="function"||i==null)&&(this.viewChangeCallback=i)}setStateChangeCallback(i){(typeof i=="function"||i==null)&&(this.stateChangeCallback=i)}getConfig(){return this.config}setConfig(i){this.config=i,i.ambientOcclusion&&this.renderer.enableAmbientOcclusion(i.ambientOcclusion)}getInternalState(){var i={models:[],surfaces:[],shapes:[],labels:[]};for(let s=0;s<this.models.length;s++)this.models[s]&&(i.models[s]=this.models[s].getInternalState());return i}setInternalState(i){this.clear();var s=i.models;for(let a=0;a<s.length;a++)s[a]&&(this.models[a]=new S.GLModel(a,void 0,this),this.models[a].setInternalState(s[a]));this.render()}setZoomLimits(i,s){typeof i<"u"&&(this.config.lowerZoomLimit=i),s&&(this.config.upperZoomLimit=s),this.rotationGroup.position.z=this.adjustZoomToLimits(this.rotationGroup.position.z),this.show()}setCameraParameters(i){i.fov!==void 0&&(this.fov=i.fov,this.camera.fov=this.fov),i.z!==void 0&&(this.CAMERA_Z=i.z,this.camera.z=this.CAMERA_Z),i.orthographic!==void 0&&(this.camera.ortho=i.orthographic),this.setSlabAndFog()}_handleMouseDown(i){if(i.preventDefault(),!this.scene)return;var s=this.getX(i),a=this.getY(i);if(s===void 0)return;this.isDragging=!0,this.mouseButton=i.which,this.mouseStartX=s,this.mouseStartY=a,this.touchHold=!0,this.touchDistanceStart=0,i.targetTouches&&i.targetTouches.length==2&&(this.touchDistanceStart=this.calcTouchDistance(i)),this.cq=this.rotationGroup.quaternion.clone(),this.cz=this.rotationGroup.position.z,this.currentModelPos=this.modelGroup.position.clone(),this.cslabNear=this.slabNear,this.cslabFar=this.slabFar;let c=this;i.targetTouches&&i.targetTouches.length===1&&(this.longTouchTimeout=setTimeout(function(){if(c.touchHold==!0){c.glDOM=c.renderer.domElement;const u=i.targetTouches[0],A=new PointerEvent("contextmenu",Object.assign(Object.assign({},i),{pageX:u.pageX,pageY:u.pageY,screenX:u.screenX,screenY:u.screenY,clientX:u.clientX,clientY:u.clientY}));c.glDOM.dispatchEvent(A)}},this.longTouchDuration))}_handleMouseUp(i){if(this.touchHold=!1,this.isDragging&&this.scene){var s=this.getX(i),a=this.getY(i);if(this.closeEnoughForClick(i)&&this.isInViewer(s,a)){let c=this.mouseXY(s,a);this.handleClickSelection(c.x,c.y,i)}}this.isDragging=!1}_handleMouseScroll(i){if(i.preventDefault(),!!this.scene){var s=this.getX(i),a=this.getY(i);if(s!==void 0&&!(!this.control_all&&!this.isInViewer(s,a))){var c=(this.CAMERA_Z-this.rotationGroup.position.z)*.85,u=1;if(i.ctrlKey&&(u=-1),i.detail)this.rotationGroup.position.z+=u*c*i.detail/10;else if(i.wheelDelta){let A=i.wheelDelta*600/(i.wheelDelta+600);this.rotationGroup.position.z-=u*c*A/400}this.rotationGroup.position.z=this.adjustZoomToLimits(this.rotationGroup.position.z),this.show()}}}pngURI(){return this.getCanvas().toDataURL("image/png")}apngURI(i){let s=this;return i=i||1,new Promise(function(a){let c=0,u=s.viewChangeCallback,A=[],L=[],D=Date.now();s.viewChangeCallback=function(){L.push(Date.now()-D),D=Date.now(),A.push(new Promise(R=>{s.getCanvas().toBlob(function(P){P.arrayBuffer().then(R)},"image/png")})),c+=1,c==i&&(s.viewChangeCallback=u,Promise.all(A).then(R=>{let P=[];for(let I=0;I<R.length;I++){let V=(0,E.decode)(R[I]);P.push((0,E.toRGBA8)(V)[0])}let z=s.getCanvas().width,F=s.getCanvas().height,B=(0,E.encode)(P,z,F,0,L),U=new Blob([B],{type:"image/png"}),W=new FileReader;W.onload=function(I){a(I.target.result)},W.readAsDataURL(U)}))}})}getCanvas(){return this.glDOM}getRenderer(){return this.renderer}setHoverDuration(i){this.hoverDuration=i}mouseXY(i,s){let a=this.canvasOffset(),c=this.renderer.getXRatio(),u=this.renderer.getYRatio(),A=this.col,L=this.row,D=A*(this.WIDTH/c),R=(u-L-1)*(this.HEIGHT/u),P=(i-a.left-D)/(this.WIDTH/c)*2-1,z=-((s-a.top-R)/(this.HEIGHT/u))*2+1;return{x:P,y:z}}_handleMouseMove(i){clearTimeout(this.hoverTimeout),i.preventDefault();let s=this.getX(i),a=this.getY(i);if(s===void 0)return;let c=this.renderer.getXRatio(),u=this.renderer.getYRatio(),A=this.mouseXY(s,a),L=this;this.current_hover!==null&&this.handleHoverContinue(A.x,A.y);var D=0;if(!(!this.control_all&&!this.isInViewer(s,a))&&this.scene&&(this.hoverables.length>0&&(this.hoverTimeout=setTimeout(function(){L.handleHoverSelection(A.x,A.y,i)},this.hoverDuration)),!!this.isDragging)){i.targetTouches&&(i.targetTouches.length>1||i.targetTouches.length===1&&!this.closeEnoughForClick(i))&&clearTimeout(this.longTouchTimeout);var R=(s-this.mouseStartX)/this.WIDTH,P=(a-this.mouseStartY)/this.HEIGHT;if(this.touchDistanceStart!=0&&i.targetTouches&&i.targetTouches.length==2){var z=this.calcTouchDistance(i);D=2,P=(z-this.touchDistanceStart)*2/(this.WIDTH+this.HEIGHT)}else i.targetTouches&&i.targetTouches.length==3&&(D=1);R*=c,P*=u;var F=Math.hypot(R,P),B;if(D==3||this.mouseButton==3&&i.ctrlKey)this.slabNear=this.cslabNear+R*100,this.slabFar=this.cslabFar-P*100;else if(D==2||this.mouseButton==3||i.shiftKey)B=(this.CAMERA_Z-this.rotationGroup.position.z)*.85,B<80&&(B=80),this.rotationGroup.position.z=this.cz+P*B,this.rotationGroup.position.z=this.adjustZoomToLimits(this.rotationGroup.position.z);else if(D==1||this.mouseButton==2||i.ctrlKey){var U=this.screenOffsetToModel(c*(s-this.mouseStartX),u*(a-this.mouseStartY));this.modelGroup.position.addVectors(this.currentModelPos,U)}else if((D===0||this.mouseButton==1)&&F!==0){var W=Math.sin(F*Math.PI)/F;this.dq.x=Math.cos(F*Math.PI),this.dq.y=0,this.dq.z=W*R,this.dq.w=-W*P,this.rotationGroup.quaternion.set(1,0,0,0),this.rotationGroup.quaternion.multiply(this.dq),this.rotationGroup.quaternion.multiply(this.cq)}this.show()}}_handleContextMenu(i){if(i.preventDefault(),this.closeEnoughForClick(i)){var c=this.mouseStartX,u=this.mouseStartY,a=this.canvasOffset();let A=this.mouseXY(c,u),L=A.x,D=A.y,R=this.targetedObjects(L,D,this.contextMenuEnabledObjects);var s=null;R.length&&(s=R[0].clickable);var a=this.canvasOffset(),c=this.mouseStartX-a.left,u=this.mouseStartY-a.top;this.userContextMenuHandler&&(this.userContextMenuHandler(s,c,u,R,i),this.isDragging=!1)}}setContainer(i){let s=(0,v.getElement)(i)||this.container;return this.initContainer(s),this}setBackgroundColor(i,s){(typeof s>"u"||s<0||s>1)&&(s=1);var a=g.CC.color(i);return this.scene.fog.color=a,this.bgColor=a.getHex(),this.renderer.setClearColorHex(a.getHex(),s),this.show(),this}setProjection(i){this.camera.ortho=i==="orthographic",this.setSlabAndFog()}setViewStyle(i){if(i=i||{},i.style=i.style||"",i.style.includes("outline")?this.renderer.enableOutline(i):this.renderer.disableOutline(),i.style.includes("ambientOcclusion")){var s={};i.strength&&(s.strength=i.strength),i.radius&&(s.radius=i.radius),this.renderer.enableAmbientOcclusion(s)}else this.renderer.disableAmbientOcclusion();return this}updateSize(){this.renderer.setSize(this.WIDTH,this.HEIGHT),this.ASPECT=this.renderer.getAspect(this.WIDTH,this.HEIGHT),this.renderer.setSize(this.WIDTH,this.HEIGHT),this.camera.aspect=this.ASPECT,this.camera.updateProjectionMatrix()}setWidth(i){return this.WIDTH=i||this.WIDTH,this.updateSize(),this}setHeight(i){return this.HEIGHT=i||this.HEIGHT,this.updateSize(),this}resize(){this.WIDTH=this.getWidth(),this.HEIGHT=this.getHeight();let i=!1;if(this.renderer.isLost()&&this.WIDTH>0&&this.HEIGHT>0){let s=!1,a=this.container.querySelector("canvas");a&&a!=this.renderer.getCanvas()?this.config.canvas=a:(a.remove(),this.config&&this.config.canvas!=null&&(delete this.config.canvas,s=!0)),this.setupRenderer(),this.initContainer(this.container),this.renderer.setClearColorHex(this.bgColor,this.config.backgroundAlpha),i=!0,s&&(this.config.canvas=this.renderer.getCanvas())}if(this.WIDTH==0||this.HEIGHT==0?this.animated&&this._viewer.pauseAnimate():this.animated&&this._viewer.resumeAnimate(),this.updateSize(),i){let s=this.renderer.supportedExtensions();if(s.regen=!0,this.viewers)for(let a=0,c=this.viewers.length;a<c;a++)for(let u=0,A=this.viewers[a].length;u<A;u++)this.viewers[a][u].render(null,s);this._viewer.render(null,s)}else this.WIDTH>0&&this.HEIGHT>0&&this.show();return this}getModel(i){return i===void 0?this.models.length==0?null:this.models[this.models.length-1]:i instanceof S.GLModel?i:i in this.models?this.models[i]:this.models.length==0?null:this.models[this.models.length-1]}spin(i,s=1,a=!1){if(clearInterval(this.spinInterval),typeof i>"u"&&(i="y"),typeof i=="boolean")if(i)i="y";else return;Array.isArray(i)&&(i={x:i[0],y:i[1],z:i[2]});var c=this;this.spinInterval=setInterval(function(){!c.getCanvas().isConnected&&c.renderer.isLost()&&clearInterval(c.spinInterval),(!a||c.container.checkVisibility&&c.container.checkVisibility())&&c.rotate(1*s,i)},25)}animateMotion(i,s,a,c,u,A){var L=20,D=Math.ceil(i/L);D<1&&(D=1),this.incAnim();var R={mpos:this.modelGroup.position.clone(),rz:this.rotationGroup.position.z,rot:this.rotationGroup.quaternion.clone(),cam:this.lookingAt.clone()};if(s){let F=new Array(D);for(let I=0;I<D;I++){let V=(I+1)/D,ee={mpos:R.mpos,rz:R.rz,rot:R.rot};ee.mpos=a.clone().sub(R.mpos).multiplyScalar(V).add(R.mpos),ee.rz=R.rz+V*(c-R.rz),ee.rot=t.slerp(R.rot,u,V),ee.cam=A.clone().sub(R.cam).multiplyScalar(V).add(R.cam),F[I]=ee}let B=0,U=this,W=function(){var I=F[B];B+=1,U.modelGroup.position=I.mpos,U.rotationGroup.position.z=I.rz,U.rotationGroup.quaternion=I.rot,U.camera.lookAt(I.cam),B<F.length?setTimeout(W,L):U.decAnim(),U.show()};setTimeout(W,L)}else{var P={};let F=1/D;if(a&&(P.mpos=a.clone().sub(R.mpos).multiplyScalar(F)),typeof c<"u"&&c!=null&&(P.rz=F*(c-R.rz)),u){var z=t.slerp(R.rot,u,F);P.rot=R.rot.clone().inverse().multiply(z)}A&&(P.cam=A.clone().sub(R.cam).multiplyScalar(F));let B=0,U=this,W=function(){B+=1,P.mpos&&U.modelGroup.position.add(P.mpos),P.rz&&(U.rotationGroup.position.z+=P.rz),P.rot&&U.rotationGroup.quaternion.multiply(P.rot),P.cam&&(U.lookingAt.add(P.cam),U.camera.lookAt(U.lookingAt)),B<D?setTimeout(W,L):U.decAnim(),U.show()};setTimeout(W,L)}}rotate(i,s="y",a=0,c=!1){if(s=="x"?s={x:1,y:0,z:0}:s=="y"?s={x:0,y:1,z:0}:s=="z"&&(s={x:0,y:0,z:1}),s=="vx"?s={vx:1,vy:0,vz:0}:s=="vy"?s={vx:0,vy:1,vz:0}:s=="vz"&&(s={vx:0,vy:0,vz:1}),typeof s.vx<"u"){var u=new _.Vector3(s.vx,s.vy,s.vz);u.applyQuaternion(this.rotationGroup.quaternion),s={x:u.x,y:u.y,z:u.z}}var A=function(P){var z=Math.sin(P/2),F=Math.cos(P/2),B=0,U=0,W=0;return B=s.x*z,U=s.y*z,W=s.z*z,new _.Quaternion(B,U,W,F).normalize()},L=Math.PI*i/180,D=A(L);if(a){var R=new _.Quaternion().copy(this.rotationGroup.quaternion).multiply(D);this.animateMotion(a,c,this.modelGroup.position,this.rotationGroup.position.z,R,this.lookingAt)}else this.rotationGroup.quaternion.multiply(D),this.show();return this}surfacesFinished(){for(var i in this.surfaces)if(!this.surfaces[i][0].done)return!1;return!0}getView(){if(!this.modelGroup)return[0,0,0,0,0,0,0,1];var i=this.modelGroup.position,s=this.rotationGroup.quaternion;return[i.x,i.y,i.z,this.rotationGroup.position.z,s.x,s.y,s.z,s.w]}setView(i,s){return i===void 0||!(i instanceof Array||i.length!==8)?this:!this.modelGroup||!this.rotationGroup?this:(this.modelGroup.position.x=i[0],this.modelGroup.position.y=i[1],this.modelGroup.position.z=i[2],this.rotationGroup.position.z=i[3],this.rotationGroup.quaternion.x=i[4],this.rotationGroup.quaternion.y=i[5],this.rotationGroup.quaternion.z=i[6],this.rotationGroup.quaternion.w=i[7],typeof i[8]<"u"&&(this.rotationGroup.position.x=i[8],this.rotationGroup.position.y=i[9]),this.show(s),this)}render(i,s){this.renderer.setViewport(),this.updateClickables();var a=this.getView();this.stateChangeCallback&&this.stateChangeCallback(this.getInternalState());var c,u;for(s||(s=this.renderer.supportedExtensions()),c=0;c<this.models.length;c++)this.models[c]&&this.models[c].globj(this.modelGroup,s);for(c=0;c<this.shapes.length;c++)this.shapes[c]&&(typeof this.shapes[c].frame>"u"||this.viewer_frame<0||this.shapes[c].frame<0||this.shapes[c].frame==this.viewer_frame?this.shapes[c].globj(this.modelGroup,s):this.shapes[c].removegl(this.modelGroup));for(c=0;c<this.labels.length;c++)s.regen&&(this.labels[c].dispose(),this.modelGroup.remove(this.labels[c].sprite),this.labels[c].setContext(),this.modelGroup.add(this.labels[c].sprite)),this.labels[c]&&typeof this.labels[c].frame<"u"&&this.labels[c].frame>=0&&(this.modelGroup.remove(this.labels[c].sprite),(this.viewer_frame<0||this.labels[c].frame==this.viewer_frame)&&this.modelGroup.add(this.labels[c].sprite));for(c in this.surfaces)if(this.surfaces.hasOwnProperty(c)){var A=this.surfaces[c];for(u=0;u<A.length;u++)if(A.hasOwnProperty(u)){var L=A[u].geo;if(!A[u].finished||s.regen){L.verticesNeedUpdate=!0,L.elementsNeedUpdate=!0,L.normalsNeedUpdate=!0,L.colorsNeedUpdate=!0,L.buffersNeedUpdate=!0,A[u].mat.needsUpdate=!0,A[u].done&&(A[u].finished=!0),A[u].lastGL&&this.modelGroup.remove(A[u].lastGL);var D=null;if(A[u].mat instanceof b.LineBasicMaterial?D=new b.Line(L,A[u].mat):("wireframe"in A.style&&A.style.wireframe&&L.setUpWireframe(),D=new b.Mesh(L,A[u].mat)),A[u].mat.transparent&&A[u].mat.opacity==0?D.visible=!1:D.visible=!0,A[u].symmetries.length>1||A[u].symmetries.length==1&&!A[u].symmetries[0].isIdentity()){var R,P=new b.Object3D;for(R=0;R<A[u].symmetries.length;R++){var z=D.clone();z.matrix=A[u].symmetries[R],z.matrixAutoUpdate=!1,P.add(z)}A[u].lastGL=P,this.modelGroup.add(P)}else A[u].lastGL=D,this.modelGroup.add(D)}}}return this.setView(a),typeof i=="function"&&i(this),this}getModelList(i){let s=[];if(typeof i>"u"||typeof i.model>"u")for(let c=0;c<this.models.length;c++)this.models[c]&&s.push(this.models[c]);else{let c=i.model;Array.isArray(c)||(c=[c]);for(let u=0;u<c.length;u++)if(typeof c[u]=="number"){var a=c[u];a<0&&(a+=this.models.length),s.push(this.models[a])}else s.push(c[u])}return s}getAtomsFromSel(i){var s=[];typeof i>"u"&&(i={});var a=this.getModelList(i);for(let c=0;c<a.length;c++)s=s.concat(a[c].selectedAtoms(i));return s}atomIsSelected(i,s){typeof s>"u"&&(s={});for(var a=this.getModelList(s),c=0;c<a.length;c++)if(a[c].atomIsSelected(i,s))return!0;return!1}selectedAtoms(i){return this.getAtomsFromSel(i)}getUniqueValues(i,s){typeof s>"u"&&(s={});var a=this.getAtomsFromSel(s),c={};for(var u in a)if(a[u].hasOwnProperty(i)){var A=a[u][i];c[A]=!0}return Object.keys(c)}pdbData(i){for(var s=this.getAtomsFromSel(i),a="",c=0,u=s.length;c<u;++c)a+=s[c].pdbline+`
`;return a}zoom(i=2,s=0,a=!1){var c=(this.CAMERA_Z-this.rotationGroup.position.z)/i,u=this.CAMERA_Z-c;return s>0?this.animateMotion(s,a,this.modelGroup.position,this.adjustZoomToLimits(u),this.rotationGroup.quaternion,this.lookingAt):(this.rotationGroup.position.z=this.adjustZoomToLimits(u),this.show()),this}translate(i,s,a=0,c=!1){var u=i/this.WIDTH,A=s/this.HEIGHT,L=new _.Vector3(0,0,-this.CAMERA_Z);this.projector.projectVector(L,this.camera),L.x-=u,L.y-=A,this.projector.unprojectVector(L,this.camera),L.z=0;var D=this.lookingAt.clone().add(L);return a>0?this.animateMotion(a,c,this.modelGroup.position,this.rotationGroup.position.z,this.rotationGroup.quaternion,D):(this.lookingAt=D,this.camera.lookAt(this.lookingAt),this.show()),this}translateScene(i,s,a=0,c=!1){var u=this.screenOffsetToModel(i,s),A=this.modelGroup.position.clone().add(u);return a>0?this.animateMotion(a,c,this.modelGroup.position,this.rotationGroup.position.z,this.rotationGroup.quaternion,this.lookingAt):(this.modelGroup.position=A,this.show()),this}fitSlab(i){i=i||{};var s=this.getAtomsFromSel(i),a=(0,v.getExtent)(s),c=a[1][0]-a[0][0],u=a[1][1]-a[0][1],A=a[1][2]-a[0][2],L=Math.hypot(c,u,A);return L<5&&(L=5),this.slabNear=-L/1.9,this.slabFar=L/2,this}center(i={},s=0,a=!1){var c,u,A=this.getAtomsFromSel(i),L=(0,v.getExtent)(A);(0,v.isEmptyObject)(i)?(this.shapes.forEach(V=>{if(V&&V.boundingSphere&&V.boundingSphere.center){var ee=V.boundingSphere.center,te=V.boundingSphere.radius;te>0?(A.push(new _.Vector3(ee.x+te,ee.y,ee.z)),A.push(new _.Vector3(ee.x-te,ee.y,ee.z)),A.push(new _.Vector3(ee.x,ee.y+te,ee.z)),A.push(new _.Vector3(ee.x,ee.y-te,ee.z)),A.push(new _.Vector3(ee.x,ee.y,ee.z+te)),A.push(new _.Vector3(ee.x,ee.y,ee.z-te))):A.push(ee)}}),L=(0,v.getExtent)(A),c=A,u=L):(c=this.getAtomsFromSel({}),u=(0,v.getExtent)(c));var D=new _.Vector3(L[2][0],L[2][1],L[2][2]),R=u[1][0]-u[0][0],P=u[1][1]-u[0][1],z=u[1][2]-u[0][2],F=Math.hypot(R,P,z);F<5&&(F=5),this.slabNear=-F/1.9,this.slabFar=F/2,R=L[1][0]-L[0][0],P=L[1][1]-L[0][1],z=L[1][2]-L[0][2],F=Math.hypot(R,P,z),F<5&&(F=5);for(var B=25,U=0;U<A.length;U++)if(A[U]){var W=D.distanceToSquared(A[U]);W>B&&(B=W)}F=Math.sqrt(B)*2;var I=D.clone().multiplyScalar(-1);return s>0?this.animateMotion(s,a,I,this.rotationGroup.position.z,this.rotationGroup.quaternion,this.lookingAt):(this.modelGroup.position=I,this.show()),this}zoomTo(i={},s=0,a=!1){let c=this.getAtomsFromSel(i),u=(0,v.getExtent)(c),A=u;if((0,v.isEmptyObject)(i)){let ee=c&&c.length;if(this.shapes.forEach(te=>{if(te&&te.boundingSphere){if(te.boundingSphere.box){let fe=te.boundingSphere.box;c.push(new _.Vector3(fe.min.x,fe.min.y,fe.min.z)),c.push(new _.Vector3(fe.max.x,fe.max.y,fe.max.z))}else if(te.boundingSphere.center){var ae=te.boundingSphere.center,re=te.boundingSphere.radius;re>0?(c.push(new _.Vector3(ae.x+re,ae.y,ae.z)),c.push(new _.Vector3(ae.x-re,ae.y,ae.z)),c.push(new _.Vector3(ae.x,ae.y+re,ae.z)),c.push(new _.Vector3(ae.x,ae.y-re,ae.z)),c.push(new _.Vector3(ae.x,ae.y,ae.z+re)),c.push(new _.Vector3(ae.x,ae.y,ae.z-re))):c.push(ae)}}}),A=(0,v.getExtent)(c),!ee)for(let te=0;te<3;te++)u[2][te]=(A[0][te]+A[1][te])/2}else{let ee=this.getAtomsFromSel({});A=(0,v.getExtent)(ee)}var L=new _.Vector3(u[2][0],u[2][1],u[2][2]),D=A[1][0]-A[0][0],R=A[1][1]-A[0][1],P=A[1][2]-A[0][2],z=Math.hypot(D,R,P);z<5&&(z=5),this.slabNear=-z/1.9,this.slabFar=z/2,Object.keys(i).length===0&&(this.slabNear=Math.min(-z*2,-50),this.slabFar=Math.max(z*2,50));var F=this.config.minimumZoomToDistance||5;D=u[1][0]-u[0][0],R=u[1][1]-u[0][1],P=u[1][2]-u[0][2],z=Math.hypot(D,R,P),z<F&&(z=F);for(var B=F*F,U=0;U<c.length;U++)if(c[U]){var W=L.distanceToSquared(c[U]);W>B&&(B=W)}z=Math.sqrt(B)*2;var I=L.clone().multiplyScalar(-1),V=-(z*.5/Math.tan(Math.PI/180*this.camera.fov/2)-this.CAMERA_Z);return V=this.adjustZoomToLimits(V),s>0?this.animateMotion(s,a,I,V,this.rotationGroup.quaternion,this.lookingAt):(this.modelGroup.position=I,this.rotationGroup.position.z=V,this.show()),this}setSlab(i,s){this.slabNear=i,this.slabFar=s}getSlab(){return{near:this.slabNear,far:this.slabFar}}addLabel(i,s={},a,c=!1){if(a){var u=(0,v.getExtent)(this.getAtomsFromSel(a));s.position={x:u[2][0],y:u[2][1],z:u[2][2]}}var A=new p.Label(i,s);return A.setContext(),this.modelGroup.add(A.sprite),this.labels.push(A),c||this.show(),A}addResLabels(i,s,a=!1){let c=this.labels.length;return this.applyToModels("addResLabels",i,s,a),this.show(),this.labels.slice(c)}addPropertyLabels(i,s,a){return this.applyToModels("addPropertyLabels",i,s,a),this.show(),this}removeLabel(i){for(var s=0;s<this.labels.length;s++)if(this.labels[s]==i){this.labels.splice(s,1),i.dispose(),this.modelGroup.remove(i.sprite);break}return this.show(),this}removeAllLabels(){for(var i=0;i<this.labels.length;i++)this.labels[i]&&this.labels[i].sprite&&this.modelGroup.remove(this.labels[i].sprite);return this.labels.splice(0,this.labels.length),this.show(),this}hideAllLabels(){for(var i=0;i<this.labels.length;i++)this.labels[i]&&this.labels[i].hide();return this.show(),this}showAllLabels(){for(var i=0;i<this.labels.length;i++)this.labels[i]&&this.labels[i].show();return this.show(),this}setLabelStyle(i,s){return this.modelGroup.remove(i.sprite),i.dispose(),i.stylespec=s,i.setContext(),this.modelGroup.add(i.sprite),this.show(),i}setLabelText(i,s){return this.modelGroup.remove(i.sprite),i.dispose(),i.text=s,i.setContext(),this.modelGroup.add(i.sprite),this.show(),i}addShape(i){i=i||{};var s=new w.GLShape(i);return s.shapePosition=this.shapes.length,this.shapes.push(s),s}removeShape(i){if(!i)return this;for(i.removegl(this.modelGroup),delete this.shapes[i.shapePosition];this.shapes.length>0&&typeof this.shapes[this.shapes.length-1]>"u";)this.shapes.pop();return this}removeAllShapes(){for(var i=0;i<this.shapes.length;i++){var s=this.shapes[i];s&&s.removegl(this.modelGroup)}return this.shapes.splice(0,this.shapes.length),this}getSelectionCenter(i){if(i.hasOwnProperty("x")&&i.hasOwnProperty("y")&&i.hasOwnProperty("z"))return i;var s=this.getAtomsFromSel(i);if(s.length==0)return{x:0,y:0,z:0};var a=(0,v.getExtent)(s);return{x:a[0][0]+(a[1][0]-a[0][0])/2,y:a[0][1]+(a[1][1]-a[0][1])/2,z:a[0][2]+(a[1][2]-a[0][2])/2}}addSphere(i){i=i||{},i.center=this.getSelectionCenter(i.center);var s=new w.GLShape(i);return s.shapePosition=this.shapes.length,s.addSphere(i),this.shapes.push(s),s.finalize(),s}addBox(i={}){i.corner!=null&&(i.corner=this.getSelectionCenter(i.corner)),i.center!=null&&(i.center=this.getSelectionCenter(i.center));var s=new w.GLShape(i);return s.shapePosition=this.shapes.length,s.addBox(i),this.shapes.push(s),s.finalize(),s}addArrow(i={}){i.start=this.getSelectionCenter(i.start),i.end=this.getSelectionCenter(i.end);var s=new w.GLShape(i);return s.shapePosition=this.shapes.length,s.addArrow(i),this.shapes.push(s),s.finalize(),s}addCylinder(i={}){i.start=this.getSelectionCenter(i.start),i.end=this.getSelectionCenter(i.end);var s=new w.GLShape(i);return s.shapePosition=this.shapes.length,i.dashed?s.addDashedCylinder(i):s.addCylinder(i),this.shapes.push(s),s.finalize(),s}addCurve(i={}){var s=new w.GLShape(i);return s.shapePosition=this.shapes.length,s.addCurve(i),this.shapes.push(s),s.finalize(),s}addLine(i={}){i.start=this.getSelectionCenter(i.start),i.end=this.getSelectionCenter(i.end),i.wireframe=!0;var s=new w.GLShape(i);return s.shapePosition=this.shapes.length,i.dashed?s=this.addLineDashed(i,s):s.addLine(i),this.shapes.push(s),s.finalize(),s}addUnitCell(i,s){i=this.getModel(i),s=s||{alabel:"a",blabel:"b",clabel:"c"},s.box=s.box||{},s.astyle=s.astyle||{color:"red",radius:.1,midpos:-1},s.bstyle=s.bstyle||{color:"green",radius:.1,midpos:-1},s.cstyle=s.cstyle||{color:"blue",radius:.1,midpos:-1},s.alabelstyle=s.alabelstyle||{fontColor:"red",showBackground:!1,alignment:"center",inFront:!1},s.blabelstyle=s.blabelstyle||{fontColor:"green",showBackground:!1,alignment:"center",inFront:!1},s.clabelstyle=s.clabelstyle||{fontColor:"blue",showBackground:!1,alignment:"center",inFront:!1},i.unitCellObjects&&this.removeUnitCell(i),i.unitCellObjects={shapes:[],labels:[]};var a=i.getCrystData(),c=null;if(a){if(a.matrix)c=a.matrix;else{var u=a.a,A=a.b,L=a.c,D=a.alpha,R=a.beta,P=a.gamma;D=D*Math.PI/180,R=R*Math.PI/180,P=P*Math.PI/180;var z,F,B;z=Math.cos(R),F=(Math.cos(D)-Math.cos(R)*Math.cos(P))/Math.sin(P),B=Math.sqrt(Math.max(0,1-z*z-F*F)),c=new _.Matrix3(u,A*Math.cos(P),L*z,0,A*Math.sin(P),L*F,0,0,L*B)}var U=[new _.Vector3(0,0,0),new _.Vector3(1,0,0),new _.Vector3(0,1,0),new _.Vector3(0,0,1),new _.Vector3(1,1,0),new _.Vector3(0,1,1),new _.Vector3(1,0,1),new _.Vector3(1,1,1)];if(a.matrix4)for(let I=0;I<U.length;I++)a.size&&U[I].multiplyVectors(U[I],a.size),U[I]=U[I].applyMatrix4(a.matrix4);else for(let I=0;I<U.length;I++)U[I]=U[I].applyMatrix3(c);if(s.box&&!s.box.hidden){s.box.wireframe=!0;var W=new w.GLShape(s.box);W.shapePosition=this.shapes.length,W.addLine({start:U[0],end:U[1]}),W.addLine({start:U[0],end:U[2]}),W.addLine({start:U[1],end:U[4]}),W.addLine({start:U[2],end:U[4]}),W.addLine({start:U[0],end:U[3]}),W.addLine({start:U[3],end:U[5]}),W.addLine({start:U[2],end:U[5]}),W.addLine({start:U[1],end:U[6]}),W.addLine({start:U[4],end:U[7]}),W.addLine({start:U[6],end:U[7]}),W.addLine({start:U[3],end:U[6]}),W.addLine({start:U[5],end:U[7]}),this.shapes.push(W),i.unitCellObjects.shapes.push(W),W.finalize()}if(!s.astyle.hidden){s.astyle.start=U[0],s.astyle.end=U[1];let I=this.addArrow(s.astyle);i.unitCellObjects.shapes.push(I)}if(!s.bstyle.hidden){s.bstyle.start=U[0],s.bstyle.end=U[2];let I=this.addArrow(s.bstyle);i.unitCellObjects.shapes.push(I)}if(!s.cstyle.hidden){s.cstyle.start=U[0],s.cstyle.end=U[3];let I=this.addArrow(s.cstyle);i.unitCellObjects.shapes.push(I)}if(s.alabel){s.alabelstyle.position=U[1];let I=this.addLabel(s.alabel,s.alabelstyle);i.unitCellObjects.labels.push(I)}if(s.blabel){s.blabelstyle.position=U[2];let I=this.addLabel(s.blabel,s.blabelstyle);i.unitCellObjects.labels.push(I)}if(s.clabel){s.clabelstyle.position=U[3];let I=this.addLabel(s.clabel,s.clabelstyle);i.unitCellObjects.labels.push(I)}}}removeUnitCell(i){if(i=this.getModel(i),i.unitCellObjects){let s=this;i.unitCellObjects.shapes.forEach(function(a){s.removeShape(a)}),i.unitCellObjects.labels.forEach(function(a){s.removeLabel(a)})}delete i.unitCellObjects}replicateUnitCell(i=3,s=i,a=s,c,u,A){c=this.getModel(c);let L=c.getCrystData();if(L){const D=c.selectedAtoms({}),R=L.matrix;let P=function(F){return F%2==0?-F/2:Math.ceil(F/2)};i<=1&&s<=1&&a<=1&&(A=!0,i=s=a=3);let z=function(F,B,U){return!1};if(A){const F=new _.Matrix3().getInverse3(R);z=function(B,U,W){let I=new _.Vector3(B,U,W).applyMatrix3(F);return!(I.x>-1e-4&&I.x<1.0001&&I.y>-1e-4&&I.y<1.0001&&I.z>-1e-4&&I.z<1.0001)}}for(let F=0;F<i;F++)for(let B=0;B<s;B++)for(let U=0;U<a;U++){if(F==0&&B==0&&U==0)continue;let W=new _.Vector3(P(F),P(B),P(U));W.applyMatrix3(R);let I=[];for(let V=0;V<D.length;V++){let ee=D[V].x+W.x,te=D[V].y+W.y,ae=D[V].z+W.z;if(z(ee,te,ae))continue;let re={};for(let fe in D[V])re[fe]=D[V][fe];re.x=ee,re.y=te,re.z=ae,I.push(re)}c.addAtoms(I)}u&&c.assignBonds()}}addLineDashed(i,s){i.dashLength=i.dashLength||.5,i.gapLength=i.gapLength||.5;var a;i.start?a=new _.Vector3(i.start.x||0,i.start.y||0,i.start.z||0):a=new _.Vector3(0,0,0);var c;i.end?c=new _.Vector3(i.end.x,i.end.y||0,i.end.z||0):c=new _.Vector3(0,0,0);var u=new _.Vector3,A=new _.Vector3,L=new _.Vector3,D,R,P,z=a.clone(),F=0;for(u.subVectors(c,a),D=u.length(),u.normalize(),A=u.clone(),L=u.clone(),A.multiplyScalar(i.dashLength),L.multiplyScalar(i.gapLength),R=A.length(),P=L.length();F<D;){if(F+R>D){i.start=a,i.end=c,s.addLine(i);break}z.addVectors(a,A),i.start=a,i.end=z,s.addLine(i),a=z.clone(),F+=R,z.addVectors(a,L),a=z.clone(),F+=P}return s.finalize(),s}addCustom(i){i=i||{};var s=new w.GLShape(i);return s.shapePosition=this.shapes.length,s.addCustom(i),this.shapes.push(s),s.finalize(),s}addVolumetricData(i,s,a={}){var c=new M.VolumeData(i,s);return a.hasOwnProperty("transferfn")?this.addVolumetricRender(c,a):this.addIsosurface(c,a)}addIsosurface(i,s={},a){var c=new w.GLShape(s);return c.shapePosition=this.shapes.length,c.addIsosurface(i,s,a,this),this.shapes.push(c),c}addVolumetricRender(i,s){s=s||{};var a=new m.GLVolumetricRender(i,s,this);return a.shapePosition=this.shapes.length,this.shapes.push(a),a}hasVolumetricRender(){return this.renderer.supportsVolumetric()}enableFog(i){if(i){this.scene.fog=new b.Fog(this.bgColor,100,200),this.config.disableFog=!1;const s=i;s.fogStart==null?this.fogStart=.4:this.fogStart=s.fogStart,s.fogEnd==null?this.fogEnd=1:this.fogEnd=s.fogEnd}else this.config.disableFog=!0,this.show()}setFrame(i){this.viewer_frame=i;let s=this;return new Promise(function(a){var c=s.models.map(function(u){return u.setFrame(i)});Promise.all(c).then(function(){a()})})}getFrame(){return this.viewer_frame}getNumFrames(){var i=0;for(let s=0;s<this.models.length;s++)this.models[s].getNumFrames()>i&&(i=this.models[s].getNumFrames());for(let s=0;s<this.shapes.length;s++)this.shapes[s].frame&&this.shapes[s].frame>=i&&(i=this.shapes[s].frame+1);for(let s=0;s<this.labels.length;s++)this.labels[s].frame&&this.labels[s].frame>=i&&(i=this.labels[s].frame+1);return i}getNextModelId(){return this.models.length}animate(i){this.incAnim();var s=100,a="forward",c=1/0;i=i||{},i.interval&&(s=i.interval),i.loop&&(a=i.loop),i.reps&&(c=i.reps);var u=this.getNumFrames(),A=this,L=0;i.startFrame&&(L=i.startFrame%u);var D=1;i.step&&(D=i.step,c/=D);var R=0,P=u*c,z=new Date,F,B,U=function(W){z=new Date,W=="forward"?A.setFrame(L).then(function(){L=(L+D)%u,F()}):W=="backward"?A.setFrame(u-1-L).then(function(){L=(L+D)%u,F()}):A.setFrame(L).then(function(){L+=D,D*=L%(u-1)==0?-1:1,F()})};return F=function(){if(A.render(),!A.getCanvas().isConnected)A.stopAnimate();else if(++R>=P||!A.isAnimated())B.cancel(),A.animationTimers.delete(B),A.decAnim();else{var W=s-(new Date().getTime()-z.getTime());W=W>0?W:0,B.cancel(),A.animationTimers.delete(B),B=new v.PausableTimer(U,W,a),A.animationTimers.add(B)}},B=new v.PausableTimer(U,0,a),this.animationTimers.add(B),this}stopAnimate(){return this.animated=0,this.animationTimers.forEach(function(i){i.cancel()}),this.animationTimers=new Set,this}pauseAnimate(){return this.animationTimers.forEach(function(i){i.pause()}),this}resumeAnimate(){return this.animationTimers.forEach(function(i){i.resume()}),this}isAnimated(){return this.animated>0}getModelOpt(i){return i&&!i.defaultcolors?(i.defaultcolors=this.defaultcolors,i.cartoonQuality=i.cartoonQuality||this.config.cartoonQuality):typeof i>"u"&&(i={defaultcolors:this.defaultcolors,cartoonQuality:this.config.cartoonQuality}),i}addModel(i,s="",a){a=this.getModelOpt(a);var c=new S.GLModel(this.models.length,a,this);return c.addMolData(i,s,a),this.models.push(c),c}addModels(i,s,a){a=this.getModelOpt(a),a.multimodel=!0,a.frames=!0;for(var c=S.GLModel.parseMolData(i,s,a),u=0;u<c.length;u++){var A=new S.GLModel(this.models.length,a,this);A.setAtomDefaults(c[u]),A.addFrame(c[u]),A.setFrame(0),c.modelData&&A.setModelData(c.modelData[u]),A.setDontDuplicateAtoms(!a.duplicateAssemblyAtoms),this.models.push(A)}return this.models}addModelsAsFrames(i,s,a){a=this.getModelOpt(a),a.multimodel=!0,a.frames=!0;var c=new S.GLModel(this.models.length,a,this);return c.addMolData(i,s,a),this.models.push(c),c}addAsOneMolecule(i,s,a){a=this.getModelOpt(a),a.multimodel=!0,a.onemol=!0;var c=new S.GLModel(this.models.length,a,this);return c.addMolData(i,s,a),this.models.push(c),c}removeModel(i){if(i=this.getModel(i),!!i){for(i.removegl(this.modelGroup),delete this.models[i.getID()];this.models.length>0&&typeof this.models[this.models.length-1]>"u";)this.models.pop();return this}}removeAllModels(){for(var i=0;i<this.models.length;i++){var s=this.models[i];s&&s.removegl(this.modelGroup)}return this.models.splice(0,this.models.length),this}exportJSON(i,s){var a={};return s===void 0?a.m=this.models.map(function(c){return c.toCDObject(i)}):a.m=[this.models[s].toCDObject()],JSON.stringify(a)}exportVRML(){var i=this.modelGroup;this.applyToModels("removegl",this.modelGroup),this.modelGroup=new b.Object3D,this.render(null,{supportsImposters:!1,supportsAIA:!1,regen:!0});var s=`#VRML V2.0 utf8
`+this.modelGroup.vrml()+`
`;return this.applyToModels("removegl",this.modelGroup),this.modelGroup=i,s}createModelFrom(i,s=!1){for(var a=new S.GLModel(this.models.length,this.defaultcolors,this),c=0;c<this.models.length;c++)if(this.models[c]){var u=this.models[c].selectedAtoms(i);a.addAtoms(u),s&&this.models[c].removeAtoms(u)}return this.models.push(a),a}applyToModels(i,s,a,c,u,A,L){for(var D=this.getModelList(s),R=0;R<D.length;R++)D[R][i](s,a,c,u,A,L)}setStyle(i,s){return typeof s>"u"&&(s=i,i={}),this.applyToModels("setStyle",i,s,!1),this}addStyle(i,s){return typeof s>"u"&&(s=i,i={}),this.applyToModels("setStyle",i,s,!0),this}setClickable(i,s,a){return this.applyToModels("setClickable",i,s,a),this}setHoverable(i,s,a,c){return this.applyToModels("setHoverable",i,s,a,c),this}enableContextMenu(i,s){return this.applyToModels("enableContextMenu",i,s),this}vibrate(i,s,a,c){return this.applyToModels("vibrate",i,s,a,c),this}setColorByProperty(i,s,a,c){return this.applyToModels("setColorByProperty",i,s,a,c),this}setColorByElement(i,s){return this.applyToModels("setColorByElement",i,s),this}static getAtomsWithin(i,s){var a=[];for(let u=0;u<i.length;u++){var c=i[u];typeof c>"u"||c.x<s[0][0]||c.x>s[1][0]||c.y<s[0][1]||c.y>s[1][1]||c.z<s[0][2]||c.z>s[1][2]||a.push(c)}return a}static volume(i){var s=i[1][0]-i[0][0],a=i[1][1]-i[0][1],c=i[1][2]-i[0][2];return s*a*c}carveUpExtent(i,s,a){let c=[],u={};for(let z=0,F=s.length;z<F;z++)u[s[z].index]=z;let A=function(z){let F=[];for(let B=0,U=z.length;B<U;B++)z[B].index in u&&F.push(u[z[B].index]);return F},L=function(z){let F=[];return F[0]=[z[0][0],z[0][1],z[0][2]],F[1]=[z[1][0],z[1][1],z[1][2]],F},D=function(z){if(t.volume(z)<t.maxVolume)return[z];var F=z[1][0]-z[0][0],B=z[1][1]-z[0][1],U=z[1][2]-z[0][2],W;F>B&&F>U?W=0:B>F&&B>U?W=1:W=2;var I=L(z),V=L(z),ee=(z[1][W]-z[0][W])/2+z[0][W];I[1][W]=ee,V[0][W]=ee;var te=D(I),ae=D(V);return te.concat(ae)},R=D(i),P=6;for(let z=0,F=R.length;z<F;z++){let B=L(R[z]);B[0][0]-=P,B[0][1]-=P,B[0][2]-=P,B[1][0]+=P,B[1][1]+=P,B[1][2]+=P;let U=t.getAtomsWithin(s,B),W=t.getAtomsWithin(a,R[z]);c.push({extent:R[z],atoms:A(U),toshow:A(W)})}return c}static generateSurfaceMesh(i,s,a){var c=new b.Geometry(!0),u=c.updateGeoGroup(0),A=[];for(let J=0,ce=i.length;J<ce;J++){var L=i[J];L&&(typeof L.surfaceColor<"u"?A[J]=L.surfaceColor:L.color&&(A[J]=g.CC.color(L.color)))}var D=u.vertexArray,R=s.vertices;for(let J=0,ce=R.length;J<ce;J++){let Me=u.vertices*3;D[Me]=R[J].x,D[Me+1]=R[J].y,D[Me+2]=R[J].z,u.vertices++}var P=u.colorArray;let z=u.atomArray;if(a.voldata&&a.volscheme){var F=a.volscheme,B=a.voldata,U=F.range()||[-1,1];for(let J=0,ce=R.length;J<ce;J++){let Me=R[J].atomid,Fe=B.getVal(R[J].x,R[J].y,R[J].z),ze=g.CC.color(F.valueToHex(Fe,U)),Be=J*3;P[Be]=ze.r,P[Be+1]=ze.g,P[Be+2]=ze.b,z[J]=i[Me]}}else if(A.length>0)for(let J=0,ce=R.length;J<ce;J++){let Me=R[J].atomid,Fe=J*3;P[Fe]=A[Me].r,P[Fe+1]=A[Me].g,P[Fe+2]=A[Me].b,z[J]=i[Me]}var W=s.faces;u.faceidx=W.length,c.initTypedArrays();var I=u.vertexArray,V=u.normalArray,ee,te,ae,re;for(let J=0,ce=W.length;J<ce;J+=3){var fe=W[J],q=W[J+1],oe=W[J+2],be=fe*3,ge=q*3,Le=oe*3;ee=new _.Vector3(I[be],I[be+1],I[be+2]),te=new _.Vector3(I[ge],I[ge+1],I[ge+2]),ae=new _.Vector3(I[Le],I[Le+1],I[Le+2]),ae.subVectors(ae,te),ee.subVectors(ee,te),ae.cross(ee),re=ae,re.normalize(),V[be]+=re.x,V[ge]+=re.x,V[Le]+=re.x,V[be+1]+=re.y,V[ge+1]+=re.y,V[Le+1]+=re.y,V[be+2]+=re.z,V[ge+2]+=re.z,V[Le+2]+=re.z}u.faceArray=new Uint16Array(W);var pe=new b.Mesh(c,a);return pe}static generateMeshSyncHelper(i,s,a,c,u,A){var L=new x.ProteinSurface;return L.initparm(s,i!==1,A),L.fillvoxels(u,a),L.buildboundary(),(i==x.SurfaceType.SES||i==x.SurfaceType.MS)&&(L.fastdistancemap(),L.boundingatom(!1),L.fillvoxelswaals(u,a)),L.marchingcube(i),L.getFacesAndVertices(c)}static getMatWithStyle(i){let s=null;i.onesided?s=new b.MeshLambertMaterial:s=new b.MeshDoubleLambertMaterial,s.vertexColors=b.Coloring.VertexColors;for(var a in i)a==="color"||a==="map"||i.hasOwnProperty(a)&&(s[a]=i[a]);return i.opacity!==void 0&&(i.opacity===1?s.transparent=!1:s.transparent=!0),i.wireframe!==void 0&&(s.wireframe=i.wireframe),s}addMesh(i){let s={geo:i.geometry,mat:i.material,done:!0,finished:!1};var a=this.nextSurfID();return this.surfaces[a]=new e([s]),a}static shallowCopy(i){var s=[];let a=i.length;for(let c=0;c<a;c++)s[c]=(0,v.extend)({},i[c]);return s}addSurface(i,s={},a={},c,u,A){let L=this.nextSurfID(),D=null,R=this,P=x.SurfaceType.VDW;typeof i=="string"?t.surfaceTypeMap[i.toUpperCase()]!==void 0?P=t.surfaceTypeMap[i]:console.log("Surface type : "+i+" is not recognized"):typeof i=="number"&&(P=i);var z=null,F=null,B=t.shallowCopy(this.getAtomsFromSel(a));c?z=t.shallowCopy(this.getAtomsFromSel(c)):z=B,(0,v.adjustVolumeStyle)(s);var U=!1,W;for(W=0;W<this.models.length;W++)if(this.models[W]){var I=this.models[W].getSymmetries();if(I.length>1||I.length==1&&!I[0].isIdentity()){U=!0;break}}var V=function(oe,be,ge){u?F=t.shallowCopy(R.getAtomsFromSel(u)):F=ge;var Le,pe=(0,v.getExtent)(ge,!0);if(s.map&&s.map.prop){var J=s.map.prop;let Ge=(0,O.getGradient)(s.map.scheme||s.map.gradient||new O.Gradient.RWB),Ve=Ge.range();Ve||(Ve=(0,v.getPropertyRange)(ge,J)),s.colorscheme={prop:J,gradient:Ge}}for(let Ge=0,Ve=be.length;Ge<Ve;Ge++)Le=be[Ge],Le.surfaceColor=(0,v.getColorFromStyle)(Le,s);var ce=t.volume(pe),Me=R.carveUpExtent(pe,be,ge);if(F&&F.length&&F.length>0){var Fe=(0,v.getExtent)(F,!0),ze=function(Ge,Ve){var j=function(_e,ue){var we=_e.extent,De=we[1][0]-we[0][0],G=we[1][1]-we[0][1],se=we[1][2]-we[0][2],ve=De-ue[2][0];ve*=ve;var Te=G-ue[2][1];Te*=Te;var ie=se-ue[2][2];return ie*=ie,ve+Te+ie},Y=j(Ge,Fe),X=j(Ve,Fe);return Y-X};Me.sort(ze)}var Be=[];for(let Ge=0,Ve=be.length;Ge<Ve;Ge++)Le=be[Ge],Be[Ge]={x:Le.x,y:Le.y,z:Le.z,serial:Ge,elem:Le.elem};var Ue=!!x.syncSurface;if((typeof $3Dmol>"u"||typeof $3Dmol.SurfaceWorker>"u")&&(console.log("$3Dmol.SurfaceWorker is not defined, using synchronous surface generation."),Ue=!0),Ue){var Se=function(Ve){return new Promise(function(j){for(var Y=t.generateMeshSyncHelper(P,Me[Ve].extent,Me[Ve].atoms,Me[Ve].toshow,Be,ce),X=(0,w.splitMesh)({vertexArr:Y.vertices,faceArr:Y.faces}),_e=0,ue=X.length;_e<ue;_e++){Y={vertices:X[_e].vertexArr,faces:X[_e].faceArr};var we=t.generateSurfaceMesh(be,Y,D);(0,v.mergeGeos)(oe.geo,we)}R.render(),j()})},Ie=[];for(let Ge=0;Ge<Me.length;Ge++)Ie.push(Se(Ge));return Promise.all(Ie).then(function(){return oe.done=!0,R.render(),Promise.resolve(L)})}else{var Re=[];P<0&&(P=0);for(let Ge=0,Ve=t.numWorkers;Ge<Ve;Ge++){var Oe=new Worker($3Dmol.SurfaceWorker);Re.push(Oe),Oe.postMessage({type:-1,atoms:Be,volume:ce})}return new Promise(function(Ge,Ve){var j=0,Y=function(){!Re||!Re.length||Re.forEach(function(we){we&&we.terminate&&we.terminate()})},X=function(we){for(var De=(0,w.splitMesh)({vertexArr:we.data.vertices,faceArr:we.data.faces}),G=0,se=De.length;G<se;G++){var ve={vertices:De[G].vertexArr,faces:De[G].faceArr},Te=t.generateSurfaceMesh(be,ve,D);(0,v.mergeGeos)(oe.geo,Te)}R.render(),j++,j==Me.length&&(oe.done=!0,Y(),Ge(L))},_e=function(we){Y(),console.log(we.message+" ("+we.filename+":"+we.lineno+")"),Ve(we)};for(let we=0;we<Me.length;we++){var ue=Re[we%Re.length];ue.onmessage=X,ue.onerror=_e,ue.postMessage({type:P,expandedExtent:Me[we].extent,extendedAtoms:Me[we].atoms,atomsToShow:Me[we].toshow})}})}};s=s||{},D=t.getMatWithStyle(s);let ee=new e([]);ee.style=s,ee.atomsel=a,ee.allsel=c,ee.focus=u;var te=null;if(U){var ae={},re={};for(W=0;W<this.models.length;W++)ae[W]=[],re[W]=[];for(W=0;W<z.length;W++)ae[z[W].model].push(z[W]);for(W=0;W<B.length;W++)re[B[W].model].push(B[W]);var fe=[];for(W=0;W<this.models.length;W++)re[W].length>0&&(ee.push({geo:new b.Geometry(!0),mat:D,done:!1,finished:!1,symmetries:this.models[W].getSymmetries()}),fe.push(V(ee[ee.length-1],ae[W],re[W])));te=Promise.all(fe)}else ee.push({geo:new b.Geometry(!0),mat:D,done:!1,finished:!1,symmetries:[new _.Matrix4]}),te=V(ee[ee.length-1],z,B);return this.surfaces[L]=ee,te.surfid=L,A&&typeof A=="function"?(te.then(function(q){A(q)}),L):te}setSurfaceMaterialStyle(i,s){if((0,v.adjustVolumeStyle)(s),this.surfaces[i]){var a=this.surfaces[i];for(let u=0;u<a.length;u++){var c=a[u].mat=t.getMatWithStyle(s);if(a[u].mat.side=b.FrontSide,s.wireframe&&a[u].geo.setUpWireframe(),s.color){a[u].mat.color=g.CC.color(s.color),a[u].geo.colorsNeedUpdate=!0;const A=g.CC.color(s.color);a[u].geo.setColor(A)}else if(c.voldata&&c.volscheme){const A=c.volscheme,L=c.voldata,D=g.CC,R=A.range()||[-1,1];a[u].geo.setColors(function(P,z,F){let B=L.getVal(P,z,F);return D.color(A.valueToHex(B,R))})}else{a[u].geo.colorsNeedUpdate=!0;for(let A of a[u].geo.geometryGroups)for(let L=0;L<A.vertices;L++){let D=(0,v.getColorFromStyle)(A.atomArray[L],s),R=3*L;A.colorArray[R]=D.r,A.colorArray[R+1]=D.g,A.colorArray[R+2]=D.b}}a[u].finished=!1}}return this}getSurface(i){return this.surfaces[i]}removeSurface(i){for(var s=this.surfaces[i],a=0;a<s.length;a++)s[a]&&s[a].lastGL&&(s[a].geo!==void 0&&s[a].geo.dispose(),s[a].mat!==void 0&&s[a].mat.dispose(),this.modelGroup.remove(s[a].lastGL));return delete this.surfaces[i],this.show(),this}removeAllSurfaces(){for(var i in this.surfaces)if(this.surfaces.hasOwnProperty(i)){for(var s=this.surfaces[i],a=0;a<s.length;a++)s[a]&&s[a].lastGL&&(s[a].geo!==void 0&&s[a].geo.dispose(),s[a].mat!==void 0&&s[a].mat.dispose(),this.modelGroup.remove(s[a].lastGL));delete this.surfaces[i]}return this.show(),this}jmolMoveTo(){var i=this.modelGroup.position,s="center { "+-i.x+" "+-i.y+" "+-i.z+" }; ",a=this.rotationGroup.quaternion;return s+="moveto .5 quaternion { "+a.x+" "+a.y+" "+a.z+" "+a.w+" };",s}clear(){return this.removeAllSurfaces(),this.removeAllModels(),this.removeAllLabels(),this.removeAllShapes(),this.show(),this}mapAtomProperties(i,s){s=s||{};var a=this.getAtomsFromSel(s);if(typeof i=="function")for(let A=0,L=a.length;A<L;A++){let D=a[A];i(D)}else for(let A=0,L=a.length;A<L;A++){var c=a[A];for(let D=0,R=i.length;D<R;D++){let P=i[D];if(P.props)for(var u in P.props)P.props.hasOwnProperty(u)&&this.atomIsSelected(c,P)&&(c.properties||(c.properties={}),c.properties[u]=P.props[u])}}return this}linkViewer(i){return this.linkedViewers.push(i),this}getPerceivedDistance(){return this.CAMERA_Z-this.rotationGroup.position.z}setPerceivedDistance(i){this.rotationGroup.position.z=this.CAMERA_Z-i}setAutoEyeSeparation(i,s){var a=this.getPerceivedDistance();return s||(s=5),i||this.camera.position.x>0?this.camera.position.x=a*Math.tan(Math.PI/180*s):this.camera.position.x=-a*Math.tan(Math.PI/180*s),this.camera.lookAt(new _.Vector3(0,0,this.rotationGroup.position.z)),this.camera.position.x}setDefaultCartoonQuality(i){this.config.cartoonQuality=i}}t.numWorkers=4,t.maxVolume=64e3,t.surfaceTypeMap={VDW:x.SurfaceType.VDW,MS:x.SurfaceType.MS,SAS:x.SurfaceType.SAS,SES:x.SurfaceType.SES};function n(d,i){if(d=(0,v.getElement)(d),!!d){i=i||{};try{var s=new t(d,i);return s}catch(a){throw"error creating viewer: "+a}}}function o(d,i={},s={}){if(d=(0,v.getElement)(d),!!d){var a=[],c=document.createElement("canvas");s.rows=i.rows,s.cols=i.cols,s.control_all=i.control_all!=null?i.control_all:!1,d.appendChild(c);try{for(var u=0;u<i.rows;u++){for(var A=[],L=0;L<i.cols;L++){s.row=u,s.col=L,s.canvas=c,s.viewers=a,s.control_all=i.control_all;var D=n(d,(0,v.extend)({},s));A.push(D)}a.unshift(A)}}catch(R){throw"error creating viewer grid: "+R}return a}}function h(d){var i=this;if(d=(0,v.getElement)(d),!!d){var s=o(d,{rows:1,cols:2,control_all:!0});this.glviewer1=s[0][0],this.glviewer2=s[0][1],this.glviewer1.setAutoEyeSeparation(!1),this.glviewer2.setAutoEyeSeparation(!0),this.glviewer1.linkViewer(this.glviewer2),this.glviewer2.linkViewer(this.glviewer1);for(var a=Object.getOwnPropertyNames(this.glviewer1.__proto__).filter(function(u){return typeof i.glviewer1[u]=="function"}),c=0;c<a.length;c++)this[a[c]]=function(u){return function(){var A=this.glviewer1[u].apply(this.glviewer1,arguments),L=this.glviewer2[u].apply(this.glviewer2,arguments);return[A,L]}}(a[c]);this.setCoordinates=function(u,A,L){for(var D=0;D<u.length;D++)u[D].setCoordinates(A,L)},this.surfacesFinished=function(){return this.glviewer1.surfacesFinished()&&this.glviewer2.surfacesFinished()},this.isAnimated=function(){return this.glviewer1.isAnimated()||this.glviewer2.isAnimated()},this.render=function(u){this.glviewer1.render(),this.glviewer2.render(),u&&u(this)},this.getCanvas=function(){return this.glviewer1.getCanvas()}}}},"./src/Gradient.ts"(K,C,f){f.r(C),f.d(C,{CustomLinear:()=>m,Gradient:()=>_,GradientType:()=>S,ROYGB:()=>x,RWB:()=>p,Sinebow:()=>M,builtinGradients:()=>b,getGradient:()=>O,normalizeValue:()=>w});var E=f("./src/colors.ts");class S{}function w(g,v,r){return v>=g?(r<g&&(r=g),r>v&&(r=v),{lo:g,hi:v,val:r}):(r>g&&(r=g),r<v&&(r=v),r=g-r+v,{lo:v,hi:g,val:r})}function O(g){if(g instanceof S)return g;if(g.gradient!==void 0&&b[g.gradient]){let v=g.min===void 0?-1:g.min,r=g.max===void 0?1:g.max;return g.mid===void 0?g.colors===void 0?new b[g.gradient](v,r):new b[g.gradient](v,r,g.colors):new b[g.gradient](v,r,g.mid)}else if(typeof g.gradient=="string"&&g.gradient.startsWith("linear_")){let v=g.gradient.split("_");v.shift();let r=g.min===void 0?-1:g.min,e=g.max===void 0?1:g.max;return new m(r,e,v)}return g}class p extends S{constructor(v,r,e){super(),this.gradient="RWB",this.mult=1,this.mid=e,this.min=v,this.max=r,typeof r>"u"&&Array.isArray(v)&&v.length>=2?(this.max=v[1],this.min=v[0]):v&&r&&!Array.isArray(v)&&(this.min=v,this.max=r)}range(){return typeof this.min<"u"&&typeof this.max<"u"?[this.min,this.max]:null}valueToHex(v,r){var e,t;if(v=this.mult*v,r?(e=r[0],t=r[1]):(e=this.min,t=this.max),v===void 0)return 16777215;var n=w(e,t,v);e=n.lo,t=n.hi,v=n.val;var o=(t+e)/2;r&&typeof r[2]<"u"?o=r[2]:typeof this.mid<"u"?o=this.mid:o=(e+t)/2;var h,d;return v<o?(h=Math.floor(255*Math.sqrt((v-e)/(o-e))),d=16711680+256*h+h,d):v>o?(h=Math.floor(255*Math.sqrt(1-(v-o)/(t-o))),d=65536*h+256*h+255,d):16777215}}class x extends S{constructor(v,r){super(),this.gradient="ROYGB",this.mult=1,this.min=v,this.max=r,typeof r>"u"&&Array.isArray(v)&&v.length>=2?(this.max=v[1],this.min=v[0]):v&&r&&!Array.isArray(v)&&(this.min=v,this.max=r)}valueToHex(v,r){var e,t;if(v=this.mult*v,r?(e=r[0],t=r[1]):(e=this.min,t=this.max),typeof v>"u")return 16777215;var n=w(e,t,v);e=n.lo,t=n.hi,v=n.val;var o=(e+t)/2,h=(e+o)/2,d=(o+t)/2,i,s;return v<h?(i=Math.floor(255*Math.sqrt((v-e)/(h-e))),s=16711680+256*i+0,s):v<o?(i=Math.floor(255*Math.sqrt(1-(v-h)/(o-h))),s=65536*i+65280+0,s):v<d?(i=Math.floor(255*Math.sqrt((v-o)/(d-o))),s=65280+1*i,s):(i=Math.floor(255*Math.sqrt(1-(v-d)/(t-d))),s=0+256*i+255,s)}range(){return typeof this.min<"u"&&typeof this.max<"u"?[this.min,this.max]:null}}class M extends S{constructor(v,r){super(),this.gradient="Sinebow",this.mult=1,this.min=v,this.max=r,typeof r>"u"&&Array.isArray(v)&&v.length>=2&&(this.max=v[1],this.min=v[0]),r<v&&(this.mult=-1,this.min*=-1,this.max*=-1)}valueToHex(v,r){var e,t;if(v=this.mult*v,r?(e=r[0],t=r[1]):(e=this.min,t=this.max),typeof v>"u")return 16777215;var n=_.normalizeValue(e,t,v);e=n.lo,t=n.hi,v=n.val;var o=(v-e)/(t-e),h=5*o/6+.5,d=Math.sin(Math.PI*h);d*=d*255;var i=Math.sin(Math.PI*(h+1/3));i*=i*255;var s=Math.sin(Math.PI*(h+2/3));return s*=s*255,65536*Math.floor(d)+256*Math.floor(s)+1*Math.floor(i)}range(){return typeof this.min<"u"&&typeof this.max<"u"?[this.min,this.max]:null}}class m extends S{constructor(v,r,e){super(),this.gradient="linear",this.colors=new Array;var t;if(Array.isArray(v)&&v.length>=2?(this.max=v[1],this.min=v[0],t=r):(this.min=v,this.max=r,t=e),t)for(let n of t)this.colors.push(E.CC.color(n));else this.colors.push(E.CC.color(0))}range(){return typeof this.min<"u"&&typeof this.max<"u"?[this.min,this.max]:null}valueToHex(v,r){var e,t;if(r?(e=r[0],t=r[1]):(e=this.min,t=this.max),v===void 0)return 16777215;var n=w(e,t,v);e=n.lo,t=n.hi,v=n.val;let o=this.colors.length,h=(t-e)/o,d=Math.min(Math.floor((v-e)/h),o-1),i=Math.min(d+1,o-1),s=(v-e-d*h)/h,a=this.colors[d],c=this.colors[i];return new E.Color(a.r+s*(c.r-a.r),a.g+s*(c.g-a.g),a.b+s*(c.b-a.b)).getHex()}}const b={rwb:p,RWB:p,roygb:x,ROYGB:x,sinebow:M,linear:m};class _ extends S{valueToHex(v,r){return 0}range(){return null}}_.RWB=p,_.ROYGB=x,_.Sinebow=M,_.CustomLinear=m,_.builtinGradients=b,_.normalizeValue=w,_.getGradient=O},"./src/Label.ts"(K,C,f){f.r(C),f.d(C,{Label:()=>M,LabelCount:()=>O});var E=f("./src/WebGL/index.ts"),S=f("./src/Gradient.ts"),w=f("./src/colors.ts");let O=0;function p(m,b,_,g,v,r,e){m.beginPath(),m.moveTo(b+r,_),m.lineTo(b+g-r,_),m.quadraticCurveTo(b+g,_,b+g,_+r),m.lineTo(b+g,_+v-r),m.quadraticCurveTo(b+g,_+v,b+g-r,_+v),m.lineTo(b+r,_+v),m.quadraticCurveTo(b,_+v,b,_+v-r),m.lineTo(b,_+r),m.quadraticCurveTo(b,_,b+r,_),m.closePath(),m.fill(),e&&m.stroke()}function x(m,b,_){var g=_;return typeof m<"u"&&(m instanceof w.Color?g=m.scaled():(g=w.CC.color(m),typeof g.scaled<"u"&&(g=g.scaled()))),typeof b<"u"&&(g.a=parseFloat(b)),g}class M{constructor(b,_){this.id=O++,this.stylespec=_||{},this.canvas=document.createElement("canvas"),this.canvas.width=134,this.canvas.height=35,this.context=this.canvas.getContext("2d"),this.sprite=new E.Sprite,this.text=b,this.frame=this.stylespec.frame}getStyle(){return this.stylespec}hide(){this.sprite&&(this.sprite.visible=!1)}show(){this.sprite&&(this.sprite.visible=!0)}setContext(){var b=this.stylespec,_=typeof b.useScreen>"u"?!1:b.useScreen,g=b.showBackground;(g==="0"||g==="false")&&(g=!1),typeof g>"u"&&(g=!0);var v=b.font?b.font:"sans-serif",r=parseInt(b.fontSize)?parseInt(b.fontSize):18,e=x(b.fontColor,b.fontOpacity,{r:255,g:255,b:255,a:1}),t=b.padding?b.padding:4,n=b.borderThickness?b.borderThickness:0,o=x(b.backgroundColor,b.backgroundOpacity,{r:0,g:0,b:0,a:1}),h=x(b.borderColor,b.borderOpacity,o),d=b.position?b.position:{x:-10,y:1,z:1},i=b.inFront!==void 0?b.inFront:!0;(i==="false"||i==="0")&&(i=!1);var s=b.alignment||E.SpriteAlignment.topLeft;typeof s=="string"&&s in E.SpriteAlignment&&(s=E.SpriteAlignment[s]);var a="";b.bold&&(a="bold "),this.context.font=a+r+"px  "+v;var c=this.context.measureText(this.text),u=c.width;g||(n=0);var A=u+2.5*n+2*t,L=r*1.25+2*n+2*t;if(b.backgroundImage){var D=b.backgroundImage,R=b.backgroundWidth?b.backgroundWidth:D.width,P=b.backgroundHeight?b.backgroundHeight:D.height;R>A&&(A=R),P>L&&(L=P)}if(this.canvas.width=A,this.canvas.height=L,this.context.clearRect(0,0,this.canvas.width,this.canvas.height),a="",b.bold&&(a="bold "),this.context.font=a+r+"px  "+v,this.context.fillStyle="rgba("+o.r+","+o.g+","+o.b+","+o.a+")",this.context.strokeStyle="rgba("+h.r+","+h.g+","+h.b+","+h.a+")",b.backgroundGradient){let F=this.context.createLinearGradient(0,L/2,A,L/2),B=S.Gradient.getGradient(b.backgroundGradient),U=B.range(),W=-1,I=1;U&&(W=U[0],I=U[1]);let V=I-W;for(let ee=0;ee<1.01;ee+=.1){let te=x(B.valueToHex(W+V*ee)),ae="rgba("+te.r+","+te.g+","+te.b+","+te.a+")";F.addColorStop(ee,ae)}this.context.fillStyle=F}this.context.lineWidth=n,g&&p(this.context,n,n,A-2*n,L-2*n,6,n>0),b.backgroundImage&&this.context.drawImage(D,0,0,A,L),this.context.fillStyle="rgba("+e.r+","+e.g+","+e.b+","+e.a+")",this.context.fillText(this.text,n+t,r+n+t,u);var z=new E.Texture(this.canvas);z.needsUpdate=!0,this.sprite.material=new E.SpriteMaterial({map:z,useScreenCoordinates:_,alignment:s,depthTest:!i,screenOffset:b.screenOffset||null}),this.sprite.scale.set(1,1,1),this.sprite.position.set(d.x,d.y,d.z)}dispose(){this.sprite.material.map!==void 0&&this.sprite.material.map.dispose(),this.sprite.material!==void 0&&this.sprite.material.dispose()}}},"./src/ProteinSurface4.ts"(K,C,f){f.r(C),f.d(C,{MarchingCube:()=>x,MarchingCubeInitializer:()=>p,PointGrid:()=>M,ProteinSurface:()=>m,SurfaceType:()=>S,setSyncSurface:()=>O,syncSurface:()=>w});var E=f("./src/WebGL/math/index.ts"),S;(function(b){b[b.VDW=1]="VDW",b[b.MS=2]="MS",b[b.SAS=3]="SAS",b[b.SES=4]="SES"})(S||(S={}));var w=!1;function O(b){w=b}(window.navigator.userAgent.indexOf("MSIE ")>=0||window.navigator.userAgent.indexOf("Trident/")>=0)&&(w=!0);class p{constructor(){this.ISDONE=2,this.edgeTable=new Uint32Array([0,0,0,0,0,0,0,2816,0,0,0,1792,0,3328,3584,3840,0,0,0,138,0,21,0,134,0,0,0,652,0,2067,3865,3600,0,0,0,42,0,0,0,294,0,0,21,28,0,3875,1049,3360,0,168,162,170,0,645,2475,2210,0,687,293,172,4010,3747,3497,3232,0,0,0,0,0,69,0,900,0,0,0,1792,138,131,1608,1920,0,81,0,2074,84,85,84,86,0,81,0,3676,330,1105,1881,1616,0,0,0,42,0,69,0,502,0,0,21,3580,138,2035,1273,1520,2816,104,2337,106,840,581,367,102,2816,3695,3429,3180,1898,1635,1385,1120,0,0,0,0,0,0,0,3910,0,0,69,588,42,2083,41,2880,0,0,0,1722,0,2293,4095,3830,0,255,757,764,2538,2291,3065,2800,0,0,81,338,0,3925,1119,3414,84,855,85,340,2130,2899,89,2384,1792,712,194,1162,4036,3781,3535,3270,708,719,197,204,3018,2755,2505,2240,0,0,0,0,168,420,168,1958,162,162,676,2988,170,163,680,928,3328,3096,3328,3642,52,53,1855,1590,2340,2111,2869,2620,298,51,825,560,3584,3584,3090,3482,1668,1941,1183,1430,146,2975,2069,2460,154,915,153,400,3840,3592,3329,3082,1796,1541,1295,1030,2818,2575,2309,2060,778,515,265,0]),this.triTable=[[],[],[],[],[],[],[],[11,9,8],[],[],[],[8,10,9],[],[10,8,11],[9,11,10],[8,10,9,8,11,10],[],[],[],[1,7,3],[],[4,2,0],[],[2,1,7],[],[],[],[2,7,3,2,9,7],[],[1,4,11,1,0,4],[3,8,0,11,9,4,11,10,9],[4,11,9,11,10,9],[],[],[],[5,3,1],[],[],[],[2,5,8,2,1,5],[],[],[2,4,0],[3,2,4],[],[0,9,1,8,10,5,8,11,10],[3,4,0,3,10,4],[5,8,10,8,11,10],[],[3,5,7],[7,1,5],[1,7,3,1,5,7],[],[9,2,0,9,7,2],[0,3,8,1,7,11,1,5,7],[11,1,7,1,5,7],[],[9,1,0,5,3,2,5,7,3],[8,2,5,8,0,2],[2,5,3,5,7,3],[3,9,1,3,8,9,7,11,10,7,10,5],[9,1,0,10,7,11,10,5,7],[3,8,0,7,10,5,7,11,10],[11,5,7,11,10,5],[],[],[],[],[],[0,6,2],[],[7,2,9,7,9,8],[],[],[],[8,10,9],[7,1,3],[7,1,0],[6,9,3,6,10,9],[7,10,8,10,9,8],[],[6,0,4],[],[11,1,4,11,3,1],[2,4,6],[2,0,4,2,4,6],[2,4,6],[1,4,2,4,6,2],[],[6,0,4],[],[2,11,3,6,9,4,6,10,9],[8,6,1,8,1,3],[10,0,6,0,4,6],[8,0,3,9,6,10,9,4,6],[10,4,6,10,9,4],[],[],[],[5,3,1],[],[0,6,2],[],[7,4,8,5,2,1,5,6,2],[],[],[2,4,0],[7,4,8,2,11,3,10,5,6],[7,1,3],[5,6,10,0,9,1,8,7,4],[5,6,10,7,0,3,7,4,0],[10,5,6,4,8,7],[9,11,8],[3,5,6],[0,5,11,0,11,8],[6,3,5,3,1,5],[3,9,6,3,8,9],[9,6,0,6,2,0],[0,3,8,2,5,6,2,1,5],[1,6,2,1,5,6],[9,11,8],[1,0,9,6,10,5,11,3,2],[6,10,5,2,8,0,2,11,8],[3,2,11,10,5,6],[10,5,6,9,3,8,9,1,3],[0,9,1,5,6,10],[8,0,3,10,5,6],[10,5,6],[],[],[],[],[],[],[],[1,10,2,9,11,6,9,8,11],[],[],[6,0,2],[3,6,9,3,2,6],[3,5,1],[0,5,1,0,11,5],[0,3,5],[6,9,11,9,8,11],[],[],[],[4,5,9,7,1,10,7,3,1],[],[11,6,7,2,4,5,2,0,4],[11,6,7,8,0,3,1,10,2,9,4,5],[6,7,11,1,10,2,9,4,5],[],[4,1,0,4,5,1,6,7,3,6,3,2],[9,4,5,0,6,7,0,2,6],[4,5,9,6,3,2,6,7,3],[6,7,11,5,3,8,5,1,3],[6,7,11,4,1,0,4,5,1],[4,5,9,3,8,0,11,6,7],[9,4,5,7,11,6],[],[],[0,6,4],[8,6,4,8,1,6],[],[0,10,2,0,9,10,4,8,11,4,11,6],[10,2,1,6,0,3,6,4,0],[10,2,1,11,4,8,11,6,4],[4,2,6],[1,0,9,2,4,8,2,6,4],[2,4,0,2,6,4],[8,2,4,2,6,4],[11,4,1,11,6,4],[0,9,1,4,11,6,4,8,11],[3,6,0,6,4,0],[8,6,4,8,11,6],[10,8,9],[6,3,9,6,7,3],[6,7,1],[10,7,1,7,3,1],[7,11,6,8,10,2,8,9,10],[11,6,7,10,0,9,10,2,0],[2,1,10,7,11,6,8,0,3],[1,10,2,6,7,11],[7,2,6,7,9,2],[1,0,9,3,6,7,3,2,6],[7,0,6,0,2,6],[2,7,3,2,6,7],[7,11,6,3,9,1,3,8,9],[9,1,0,11,6,7],[0,3,8,11,6,7],[11,6,7],[],[],[],[],[5,3,7],[8,5,2,8,7,5],[5,3,7],[1,10,2,5,8,7,5,9,8],[1,7,5],[1,7,5],[9,2,7,9,7,5],[11,3,2,8,5,9,8,7,5],[1,3,7,1,7,5],[0,7,1,7,5,1],[9,3,5,3,7,5],[9,7,5,9,8,7],[8,10,11],[3,4,10,3,10,11],[8,10,11],[5,9,4,1,11,3,1,10,11],[2,4,5],[5,2,4,2,0,4],[0,3,8,5,9,4,10,2,1],[2,1,10,9,4,5],[2,8,5,2,11,8],[3,2,11,1,4,5,1,0,4],[9,4,5,8,2,11,8,0,2],[11,3,2,9,4,5],[8,5,3,5,1,3],[5,0,4,5,1,0],[3,8,0,4,5,9],[9,4,5],[11,9,10],[11,9,10],[1,11,4,1,10,11],[8,7,4,11,1,10,11,3,1],[2,7,9,2,9,10],[4,8,7,0,10,2,0,9,10],[2,1,10,0,7,4,0,3,7],[10,2,1,8,7,4],[1,7,4],[3,2,11,4,8,7,9,1,0],[11,4,2,4,0,2],[2,11,3,7,4,8],[4,1,7,1,3,7],[1,0,9,8,7,4],[3,4,0,3,7,4],[8,7,4],[8,9,10,8,10,11],[3,9,11,9,10,11],[0,10,8,10,11,8],[10,3,1,10,11,3],[2,8,10,8,9,10],[9,2,0,9,10,2],[8,0,3,1,10,2],[10,2,1],[1,11,9,11,8,9],[11,3,2,0,9,1],[11,0,2,11,8,0],[11,3,2],[8,1,3,8,9,1],[9,1,0],[8,0,3],[]],this.edgeTable2=[0,265,515,778,2060,2309,2575,2822,1030,1295,1541,1804,3082,3331,3593,3840,400,153,915,666,2460,2197,2975,2710,1430,1183,1941,1692,3482,3219,3993,3728,560,825,51,314,2620,2869,2111,2358,1590,1855,1077,1340,3642,3891,3129,3376,928,681,419,170,2988,2725,2479,2214,1958,1711,1445,1196,4010,3747,3497,3232,2240,2505,2755,3018,204,453,719,966,3270,3535,3781,4044,1226,1475,1737,1984,2384,2137,2899,2650,348,85,863,598,3414,3167,3925,3676,1370,1107,1881,1616,2800,3065,2291,2554,764,1013,255,502,3830,4095,3317,3580,1786,2035,1273,1520,2912,2665,2403,2154,876,613,367,102,3942,3695,3429,3180,1898,1635,1385,1120,1120,1385,1635,1898,3180,3429,3695,3942,102,367,613,876,2154,2403,2665,2912,1520,1273,2035,1786,3580,3317,4095,3830,502,255,1013,764,2554,2291,3065,2800,1616,1881,1107,1370,3676,3925,3167,3414,598,863,85,348,2650,2899,2137,2384,1984,1737,1475,1226,4044,3781,3535,3270,966,719,453,204,3018,2755,2505,2240,3232,3497,3747,4010,1196,1445,1711,1958,2214,2479,2725,2988,170,419,681,928,3376,3129,3891,3642,1340,1077,1855,1590,2358,2111,2869,2620,314,51,825,560,3728,3993,3219,3482,1692,1941,1183,1430,2710,2975,2197,2460,666,915,153,400,3840,3593,3331,3082,1804,1541,1295,1030,2822,2575,2309,2060,778,515,265,0],this.triTable2=[[],[8,3,0],[9,0,1],[8,3,1,8,1,9],[11,2,3],[11,2,0,11,0,8],[11,2,3,0,1,9],[2,1,11,1,9,11,11,9,8],[10,1,2],[8,3,0,1,2,10],[9,0,2,9,2,10],[3,2,8,2,10,8,8,10,9],[10,1,3,10,3,11],[1,0,10,0,8,10,10,8,11],[0,3,9,3,11,9,9,11,10],[8,10,9,8,11,10],[8,4,7],[3,0,4,3,4,7],[1,9,0,8,4,7],[9,4,1,4,7,1,1,7,3],[2,3,11,7,8,4],[7,11,4,11,2,4,4,2,0],[3,11,2,4,7,8,9,0,1],[2,7,11,2,1,7,1,4,7,1,9,4],[10,1,2,8,4,7],[2,10,1,0,4,7,0,7,3],[4,7,8,0,2,10,0,10,9],[2,7,3,2,9,7,7,9,4,2,10,9],[8,4,7,11,10,1,11,1,3],[11,4,7,1,4,11,1,11,10,1,0,4],[3,8,0,7,11,4,11,9,4,11,10,9],[7,11,4,4,11,9,11,10,9],[9,5,4],[3,0,8,4,9,5],[5,4,0,5,0,1],[4,8,5,8,3,5,5,3,1],[11,2,3,9,5,4],[9,5,4,8,11,2,8,2,0],[3,11,2,1,5,4,1,4,0],[8,5,4,2,5,8,2,8,11,2,1,5],[2,10,1,9,5,4],[0,8,3,5,4,9,10,1,2],[10,5,2,5,4,2,2,4,0],[3,4,8,3,2,4,2,5,4,2,10,5],[5,4,9,1,3,11,1,11,10],[0,9,1,4,8,5,8,10,5,8,11,10],[3,4,0,3,10,4,4,10,5,3,11,10],[4,8,5,5,8,10,8,11,10],[9,5,7,9,7,8],[0,9,3,9,5,3,3,5,7],[8,0,7,0,1,7,7,1,5],[1,7,3,1,5,7],[11,2,3,8,9,5,8,5,7],[9,2,0,9,7,2,2,7,11,9,5,7],[0,3,8,2,1,11,1,7,11,1,5,7],[2,1,11,11,1,7,1,5,7],[1,2,10,5,7,8,5,8,9],[9,1,0,10,5,2,5,3,2,5,7,3],[5,2,10,8,2,5,8,5,7,8,0,2],[10,5,2,2,5,3,5,7,3],[3,9,1,3,8,9,7,11,10,7,10,5],[9,1,0,10,7,11,10,5,7],[3,8,0,7,10,5,7,11,10],[11,5,7,11,10,5],[11,7,6],[0,8,3,11,7,6],[9,0,1,11,7,6],[7,6,11,3,1,9,3,9,8],[2,3,7,2,7,6],[8,7,0,7,6,0,0,6,2],[1,9,0,3,7,6,3,6,2],[7,6,2,7,2,9,2,1,9,7,9,8],[1,2,10,6,11,7],[2,10,1,7,6,11,8,3,0],[11,7,6,10,9,0,10,0,2],[7,6,11,3,2,8,8,2,10,8,10,9],[6,10,7,10,1,7,7,1,3],[6,10,1,6,1,7,7,1,0,7,0,8],[9,0,3,6,9,3,6,10,9,6,3,7],[6,10,7,7,10,8,10,9,8],[8,4,6,8,6,11],[11,3,6,3,0,6,6,0,4],[0,1,9,4,6,11,4,11,8],[1,9,4,11,1,4,11,3,1,11,4,6],[3,8,2,8,4,2,2,4,6],[2,0,4,2,4,6],[1,9,0,3,8,2,2,8,4,2,4,6],[9,4,1,1,4,2,4,6,2],[10,1,2,11,8,4,11,4,6],[10,1,2,11,3,6,6,3,0,6,0,4],[0,2,10,0,10,9,4,11,8,4,6,11],[2,11,3,6,9,4,6,10,9],[8,4,6,8,6,1,6,10,1,8,1,3],[1,0,10,10,0,6,0,4,6],[8,0,3,9,6,10,9,4,6],[10,4,6,10,9,4],[9,5,4,7,6,11],[4,9,5,3,0,8,11,7,6],[6,11,7,4,0,1,4,1,5],[6,11,7,4,8,5,5,8,3,5,3,1],[4,9,5,6,2,3,6,3,7],[9,5,4,8,7,0,0,7,6,0,6,2],[4,0,1,4,1,5,6,3,7,6,2,3],[7,4,8,5,2,1,5,6,2],[6,11,7,1,2,10,9,5,4],[11,7,6,8,3,0,1,2,10,9,5,4],[11,7,6,10,5,2,2,5,4,2,4,0],[7,4,8,2,11,3,10,5,6],[4,9,5,6,10,7,7,10,1,7,1,3],[5,6,10,0,9,1,8,7,4],[5,6,10,7,0,3,7,4,0],[10,5,6,4,8,7],[5,6,9,6,11,9,9,11,8],[0,9,5,0,5,3,3,5,6,3,6,11],[0,1,5,0,5,11,5,6,11,0,11,8],[11,3,6,6,3,5,3,1,5],[9,5,6,3,9,6,3,8,9,3,6,2],[5,6,9,9,6,0,6,2,0],[0,3,8,2,5,6,2,1,5],[1,6,2,1,5,6],[1,2,10,5,6,9,9,6,11,9,11,8],[1,0,9,6,10,5,11,3,2],[6,10,5,2,8,0,2,11,8],[3,2,11,10,5,6],[10,5,6,9,3,8,9,1,3],[0,9,1,5,6,10],[8,0,3,10,5,6],[10,5,6],[10,6,5],[8,3,0,10,6,5],[0,1,9,5,10,6],[10,6,5,9,8,3,9,3,1],[3,11,2,10,6,5],[6,5,10,2,0,8,2,8,11],[1,9,0,6,5,10,11,2,3],[1,10,2,5,9,6,9,11,6,9,8,11],[1,2,6,1,6,5],[0,8,3,2,6,5,2,5,1],[5,9,6,9,0,6,6,0,2],[9,6,5,3,6,9,3,9,8,3,2,6],[11,6,3,6,5,3,3,5,1],[0,5,1,0,11,5,5,11,6,0,8,11],[0,5,9,0,3,5,3,6,5,3,11,6],[5,9,6,6,9,11,9,8,11],[10,6,5,4,7,8],[5,10,6,7,3,0,7,0,4],[5,10,6,0,1,9,8,4,7],[4,5,9,6,7,10,7,1,10,7,3,1],[7,8,4,2,3,11,10,6,5],[11,6,7,10,2,5,2,4,5,2,0,4],[11,6,7,8,0,3,1,10,2,9,4,5],[6,7,11,1,10,2,9,4,5],[7,8,4,5,1,2,5,2,6],[4,1,0,4,5,1,6,7,3,6,3,2],[9,4,5,8,0,7,0,6,7,0,2,6],[4,5,9,6,3,2,6,7,3],[6,7,11,4,5,8,5,3,8,5,1,3],[6,7,11,4,1,0,4,5,1],[4,5,9,3,8,0,11,6,7],[9,4,5,7,11,6],[10,6,4,10,4,9],[8,3,0,9,10,6,9,6,4],[1,10,0,10,6,0,0,6,4],[8,6,4,8,1,6,6,1,10,8,3,1],[2,3,11,6,4,9,6,9,10],[0,10,2,0,9,10,4,8,11,4,11,6],[10,2,1,11,6,3,6,0,3,6,4,0],[10,2,1,11,4,8,11,6,4],[9,1,4,1,2,4,4,2,6],[1,0,9,3,2,8,2,4,8,2,6,4],[2,4,0,2,6,4],[3,2,8,8,2,4,2,6,4],[1,4,9,11,4,1,11,1,3,11,6,4],[0,9,1,4,11,6,4,8,11],[11,6,3,3,6,0,6,4,0],[8,6,4,8,11,6],[6,7,10,7,8,10,10,8,9],[9,3,0,6,3,9,6,9,10,6,7,3],[6,1,10,6,7,1,7,0,1,7,8,0],[6,7,10,10,7,1,7,3,1],[7,11,6,3,8,2,8,10,2,8,9,10],[11,6,7,10,0,9,10,2,0],[2,1,10,7,11,6,8,0,3],[1,10,2,6,7,11],[7,2,6,7,9,2,2,9,1,7,8,9],[1,0,9,3,6,7,3,2,6],[8,0,7,7,0,6,0,2,6],[2,7,3,2,6,7],[7,11,6,3,9,1,3,8,9],[9,1,0,11,6,7],[0,3,8,11,6,7],[11,6,7],[11,7,5,11,5,10],[3,0,8,7,5,10,7,10,11],[9,0,1,10,11,7,10,7,5],[3,1,9,3,9,8,7,10,11,7,5,10],[10,2,5,2,3,5,5,3,7],[5,10,2,8,5,2,8,7,5,8,2,0],[9,0,1,10,2,5,5,2,3,5,3,7],[1,10,2,5,8,7,5,9,8],[2,11,1,11,7,1,1,7,5],[0,8,3,2,11,1,1,11,7,1,7,5],[9,0,2,9,2,7,2,11,7,9,7,5],[11,3,2,8,5,9,8,7,5],[1,3,7,1,7,5],[8,7,0,0,7,1,7,5,1],[0,3,9,9,3,5,3,7,5],[9,7,5,9,8,7],[4,5,8,5,10,8,8,10,11],[3,0,4,3,4,10,4,5,10,3,10,11],[0,1,9,4,5,8,8,5,10,8,10,11],[5,9,4,1,11,3,1,10,11],[3,8,4,3,4,2,2,4,5,2,5,10],[10,2,5,5,2,4,2,0,4],[0,3,8,5,9,4,10,2,1],[2,1,10,9,4,5],[8,4,5,2,8,5,2,11,8,2,5,1],[3,2,11,1,4,5,1,0,4],[9,4,5,8,2,11,8,0,2],[11,3,2,9,4,5],[4,5,8,8,5,3,5,1,3],[5,0,4,5,1,0],[3,8,0,4,5,9],[9,4,5],[7,4,11,4,9,11,11,9,10],[3,0,8,7,4,11,11,4,9,11,9,10],[11,7,4,1,11,4,1,10,11,1,4,0],[8,7,4,11,1,10,11,3,1],[2,3,7,2,7,9,7,4,9,2,9,10],[4,8,7,0,10,2,0,9,10],[2,1,10,0,7,4,0,3,7],[10,2,1,8,7,4],[2,11,7,2,7,1,1,7,4,1,4,9],[3,2,11,4,8,7,9,1,0],[7,4,11,11,4,2,4,0,2],[2,11,3,7,4,8],[9,1,4,4,1,7,1,3,7],[1,0,9,8,7,4],[3,4,0,3,7,4],[8,7,4],[8,9,10,8,10,11],[0,9,3,3,9,11,9,10,11],[1,10,0,0,10,8,10,11,8],[10,3,1,10,11,3],[3,8,2,2,8,10,8,9,10],[9,2,0,9,10,2],[8,0,3,1,10,2],[10,2,1],[2,11,1,1,11,9,11,8,9],[11,3,2,0,9,1],[11,0,2,11,8,0],[11,3,2],[8,1,3,8,9,1],[9,1,0],[8,0,3],[]]}march(_,g,v,r){let e=!!r.fulltable,t=r.hasOwnProperty("origin")&&r.origin.hasOwnProperty("x")?r.origin:{x:0,y:0,z:0},n=!!r.voxel,o=r.matrix,h=r.nX||0,d=r.nY||0,i=r.nZ||0,s=r.scale||1,a=null;r.unitCube?a=r.unitCube:a={x:s,y:s,z:s};let c=new Int32Array(h*d*i),u,A;for(u=0,A=c.length;u<A;++u)c[u]=-1;let L=function(z,F,B,U,W,I){let V={x:0,y:0,z:0},ee=!!(U&1<<W),te=!!(U&1<<I),ae=W;if(!ee&&te&&(ae=I),ae&1&&B++,ae&2&&F++,ae&4&&z++,o){let fe=new E.Vector3(z,F,B);fe=fe.applyMatrix4(o),V={x:fe.x,y:fe.y,z:fe.z}}else V.x=t.x+a.x*z,V.y=t.y+a.y*F,V.z=t.z+a.z*B;let re=(d*z+F)*i+B;return n?(g.push(V),g.length-1):(c[re]<0&&(c[re]=g.length,g.push(V)),c[re])},D=new Int32Array(12),R=e?this.edgeTable2:this.edgeTable,P=e?this.triTable2:this.triTable;for(u=0;u<h-1;++u)for(let z=0;z<d-1;++z)for(let F=0;F<i-1;++F){let B=0;for(let I=0;I<8;++I){let V=(d*(u+((I&4)>>2))+z+((I&2)>>1))*i+F+(I&1),ee=!!(_[V]&this.ISDONE);B|=ee<<I}if(B===0||B===255)continue;let U=R[B];if(U===0)continue;let W=P[B];U&1&&(D[0]=L(u,z,F,B,0,1)),U&2&&(D[1]=L(u,z,F,B,1,3)),U&4&&(D[2]=L(u,z,F,B,3,2)),U&8&&(D[3]=L(u,z,F,B,2,0)),U&16&&(D[4]=L(u,z,F,B,4,5)),U&32&&(D[5]=L(u,z,F,B,5,7)),U&64&&(D[6]=L(u,z,F,B,7,6)),U&128&&(D[7]=L(u,z,F,B,6,4)),U&256&&(D[8]=L(u,z,F,B,0,4)),U&512&&(D[9]=L(u,z,F,B,1,5)),U&1024&&(D[10]=L(u,z,F,B,3,7)),U&2048&&(D[11]=L(u,z,F,B,2,6));for(let I=0;I<W.length;I+=3){let V=D[W[I]],ee=D[W[I+1]],te=D[W[I+2]];n&&I>=3&&(g.push(g[V]),V=g.length-1,g.push(g[ee]),ee=g.length-1,g.push(g[te]),te=g.length-1),v.push(V),v.push(ee),v.push(te)}}}laplacianSmooth(_,g,v){let r=new Array(g.length),e,t,n,o,h;for(e=0,t=g.length;e<t;e++)r[e]={x:0,y:0,z:0};let d=new Array(20),i;for(e=0;e<20;e++)d[e]=new Array(g.length);for(e=0,t=g.length;e<t;e++)d[0][e]=0;for(e=0,t=v.length/3;e<t;e++){let c=e*3,u=e*3+1,A=e*3+2;for(i=!0,n=0,o=d[0][v[c]];n<o;n++)if(v[u]==d[n+1][v[c]]){i=!1;break}for(i&&(d[0][v[c]]++,d[d[0][v[c]]][v[c]]=v[u]),i=!0,n=0,o=d[0][v[c]];n<o;n++)if(v[A]==d[n+1][v[c]]){i=!1;break}for(i&&(d[0][v[c]]++,d[d[0][v[c]]][v[c]]=v[A]),i=!0,n=0,o=d[0][v[u]];n<o;n++)if(v[c]==d[n+1][v[u]]){i=!1;break}for(i&&(d[0][v[u]]++,d[d[0][v[u]]][v[u]]=v[c]),i=!0,n=0,o=d[0][v[u]];n<o;n++)if(v[A]==d[n+1][v[u]]){i=!1;break}for(i&&(d[0][v[u]]++,d[d[0][v[u]]][v[u]]=v[A]),i=!0,n=0;n<d[0][v[A]];n++)if(v[c]==d[n+1][v[A]]){i=!1;break}for(i&&(d[0][v[A]]++,d[d[0][v[A]]][v[A]]=v[c]),i=!0,n=0,o=d[0][v[A]];n<o;n++)if(v[u]==d[n+1][v[A]]){i=!1;break}i&&(d[0][v[A]]++,d[d[0][v[A]]][v[A]]=v[u])}let s=1,a=.5;for(h=0;h<_;h++){for(e=0,t=g.length;e<t;e++)if(d[0][e]<3)r[e].x=g[e].x,r[e].y=g[e].y,r[e].z=g[e].z;else if(d[0][e]==3||d[0][e]==4){for(r[e].x=0,r[e].y=0,r[e].z=0,n=0,o=d[0][e];n<o;n++)r[e].x+=g[d[n+1][e]].x,r[e].y+=g[d[n+1][e]].y,r[e].z+=g[d[n+1][e]].z;r[e].x+=a*g[e].x,r[e].y+=a*g[e].y,r[e].z+=a*g[e].z,r[e].x/=a+d[0][e],r[e].y/=a+d[0][e],r[e].z/=a+d[0][e]}else{for(r[e].x=0,r[e].y=0,r[e].z=0,n=0,o=d[0][e];n<o;n++)r[e].x+=g[d[n+1][e]].x,r[e].y+=g[d[n+1][e]].y,r[e].z+=g[d[n+1][e]].z;r[e].x+=s*g[e].x,r[e].y+=s*g[e].y,r[e].z+=s*g[e].z,r[e].x/=s+d[0][e],r[e].y/=s+d[0][e],r[e].z/=s+d[0][e]}for(e=0,t=g.length;e<t;e++)g[e].x=r[e].x,g[e].y=r[e].y,g[e].z=r[e].z}}}let x=new p;class M{constructor(_,g,v){this.data=new Int32Array(_*g*v*3),this.width=g,this.height=v}set(_,g,v,r){let e=((_*this.width+g)*this.height+v)*3;this.data[e]=r.ix,this.data[e+1]=r.iy,this.data[e+2]=r.iz}get(_,g,v){let r=((_*this.width+g)*this.height+v)*3;return{ix:this.data[r],iy:this.data[r+1],iz:this.data[r+2]}}}class m{constructor(){this.INOUT=1,this.ISDONE=2,this.ISBOUND=4,this.ptranx=0,this.ptrany=0,this.ptranz=0,this.probeRadius=1.4,this.defaultScaleFactor=2,this.scaleFactor=this.defaultScaleFactor,this.pHeight=0,this.pWidth=0,this.pLength=0,this.cutRadius=0,this.vpBits=null,this.vpDistance=null,this.vpAtomID=null,this.pminx=0,this.pminy=0,this.pminz=0,this.pmaxx=0,this.pmaxy=0,this.pmaxz=0,this.depty={},this.widxz={},this.faces=[],this.verts=[],this.vdwRadii={H:1.2,Li:1.82,Na:2.27,K:2.75,C:1.7,N:1.55,O:1.52,F:1.47,P:1.8,S:1.8,CL:1.75,BR:1.85,SE:1.9,ZN:1.39,CU:1.4,NI:1.63,X:2},this.nb=[new Int32Array([1,0,0]),new Int32Array([-1,0,0]),new Int32Array([0,1,0]),new Int32Array([0,-1,0]),new Int32Array([0,0,1]),new Int32Array([0,0,-1]),new Int32Array([1,1,0]),new Int32Array([1,-1,0]),new Int32Array([-1,1,0]),new Int32Array([-1,-1,0]),new Int32Array([1,0,1]),new Int32Array([1,0,-1]),new Int32Array([-1,0,1]),new Int32Array([-1,0,-1]),new Int32Array([0,1,1]),new Int32Array([0,1,-1]),new Int32Array([0,-1,1]),new Int32Array([0,-1,-1]),new Int32Array([1,1,1]),new Int32Array([1,1,-1]),new Int32Array([1,-1,1]),new Int32Array([-1,1,1]),new Int32Array([1,-1,-1]),new Int32Array([-1,-1,1]),new Int32Array([-1,1,-1]),new Int32Array([-1,-1,-1])],m.MarchingCube||(m.MarchingCube=new p)}getVDWIndex(_){return!_.elem||typeof this.vdwRadii[_.elem]>"u"?"X":_.elem}getFacesAndVertices(_){let g={};for(let e=0,t=_.length;e<t;e++)g[_[e]]=!0;let v=this.verts;for(let e=0,t=v.length;e<t;e++)v[e].x=v[e].x/this.scaleFactor-this.ptranx,v[e].y=v[e].y/this.scaleFactor-this.ptrany,v[e].z=v[e].z/this.scaleFactor-this.ptranz;let r=[];for(let e=0,t=this.faces.length;e<t;e+=3){let n=this.faces[e],o=this.faces[e+1],h=this.faces[e+2],d=v[n].atomid,i=v[o].atomid,s=v[h].atomid,a=d;i<a&&(a=i),s<a&&(a=s),g[a]&&n!==o&&o!==h&&n!==h&&(r.push(n),r.push(o),r.push(h))}return this.vpBits=null,this.vpDistance=null,this.vpAtomID=null,{vertices:v,faces:r}}initparm(_,g,v){v>1e6&&(this.scaleFactor=this.defaultScaleFactor/2);let r=1/this.scaleFactor*5.5;this.pminx=_[0][0],this.pmaxx=_[1][0],this.pminy=_[0][1],this.pmaxy=_[1][1],this.pminz=_[0][2],this.pmaxz=_[1][2],g?(this.pminx-=this.probeRadius+r,this.pminy-=this.probeRadius+r,this.pminz-=this.probeRadius+r,this.pmaxx+=this.probeRadius+r,this.pmaxy+=this.probeRadius+r,this.pmaxz+=this.probeRadius+r):(this.pminx-=r,this.pminy-=r,this.pminz-=r,this.pmaxx+=r,this.pmaxy+=r,this.pmaxz+=r),this.pminx=Math.floor(this.pminx*this.scaleFactor)/this.scaleFactor,this.pminy=Math.floor(this.pminy*this.scaleFactor)/this.scaleFactor,this.pminz=Math.floor(this.pminz*this.scaleFactor)/this.scaleFactor,this.pmaxx=Math.ceil(this.pmaxx*this.scaleFactor)/this.scaleFactor,this.pmaxy=Math.ceil(this.pmaxy*this.scaleFactor)/this.scaleFactor,this.pmaxz=Math.ceil(this.pmaxz*this.scaleFactor)/this.scaleFactor,this.ptranx=-this.pminx,this.ptrany=-this.pminy,this.ptranz=-this.pminz,this.pLength=Math.ceil(this.scaleFactor*(this.pmaxx-this.pminx))+1,this.pWidth=Math.ceil(this.scaleFactor*(this.pmaxy-this.pminy))+1,this.pHeight=Math.ceil(this.scaleFactor*(this.pmaxz-this.pminz))+1,this.boundingatom(g),this.cutRadius=this.probeRadius*this.scaleFactor,this.vpBits=new Uint8Array(this.pLength*this.pWidth*this.pHeight),this.vpDistance=new Float64Array(this.pLength*this.pWidth*this.pHeight),this.vpAtomID=new Int32Array(this.pLength*this.pWidth*this.pHeight)}boundingatom(_){let g={};for(const v in this.vdwRadii){let r=this.vdwRadii[v];_?g[v]=(r+this.probeRadius)*this.scaleFactor+.5:g[v]=r*this.scaleFactor+.5;let e=g[v]*g[v];this.widxz[v]=Math.floor(g[v])+1,this.depty[v]=new Int32Array(this.widxz[v]*this.widxz[v]);let t=0;for(let n=0;n<this.widxz[v];n++)for(let o=0;o<this.widxz[v];o++){let h=n*n+o*o;if(h>e)this.depty[v][t]=-1;else{let d=Math.sqrt(e-h);this.depty[v][t]=Math.floor(d)}t++}}}fillvoxels(_,g){for(let v=0,r=this.vpBits.length;v<r;v++)this.vpBits[v]=0,this.vpDistance[v]=-1,this.vpAtomID[v]=-1;for(let v in g){let r=_[g[v]];r!==void 0&&this.fillAtom(r,_)}for(let v=0,r=this.vpBits.length;v<r;v++)this.vpBits[v]&this.INOUT&&(this.vpBits[v]|=this.ISDONE)}fillAtom(_,g){let v=Math.floor(.5+this.scaleFactor*(_.x+this.ptranx)),r=Math.floor(.5+this.scaleFactor*(_.y+this.ptrany)),e=Math.floor(.5+this.scaleFactor*(_.z+this.ptranz)),t=this.getVDWIndex(_),n=0,o=this.pWidth*this.pHeight;for(let h=0,d=this.widxz[t];h<d;h++)for(let i=0;i<d;i++){if(this.depty[t][n]!=-1){for(let s=-1;s<2;s++)for(let a=-1;a<2;a++)for(let c=-1;c<2;c++)if(s!==0&&a!==0&&c!==0){let u=s*h,A=c*i;for(let L=0;L<=this.depty[t][n];L++){let D=L*a,R=v+u,P=r+D,z=e+A;if(R<0||P<0||z<0||R>=this.pLength||P>=this.pWidth||z>=this.pHeight)continue;let F=R*o+P*this.pHeight+z;if(!(this.vpBits[F]&this.INOUT))this.vpBits[F]|=this.INOUT,this.vpAtomID[F]=_.serial;else{let B=g[this.vpAtomID[F]];if(B.serial!=_.serial){let U=v+u-Math.floor(.5+this.scaleFactor*(B.x+this.ptranx)),W=r+D-Math.floor(.5+this.scaleFactor*(B.y+this.ptrany)),I=e+A-Math.floor(.5+this.scaleFactor*(B.z+this.ptranz));u*u+D*D+A*A<U*U+W*W+I*I&&(this.vpAtomID[F]=_.serial)}}}}}n++}}fillvoxelswaals(_,g){for(let v=0,r=this.vpBits.length;v<r;v++)this.vpBits[v]&=~this.ISDONE;for(let v in g){let r=_[g[v]];r!==void 0&&this.fillAtomWaals(r,_)}}fillAtomWaals(_,g){let v=0,r=Math.floor(.5+this.scaleFactor*(_.x+this.ptranx)),e=Math.floor(.5+this.scaleFactor*(_.y+this.ptrany)),t=Math.floor(.5+this.scaleFactor*(_.z+this.ptranz)),n=this.getVDWIndex(_),o=this.pWidth*this.pHeight;for(let h=0,d=this.widxz[n];h<d;h++)for(let i=0;i<d;i++){if(this.depty[n][v]!=-1){for(let s=-1;s<2;s++)for(let a=-1;a<2;a++)for(let c=-1;c<2;c++)if(s!==0&&a!==0&&c!==0){let u=s*h,A=c*i;for(let L=0;L<=this.depty[n][v];L++){let D=L*a,R=r+u,P=e+D,z=t+A;if(R<0||P<0||z<0||R>=this.pLength||P>=this.pWidth||z>=this.pHeight)continue;let F=R*o+P*this.pHeight+z;if(!(this.vpBits[F]&this.ISDONE))this.vpBits[F]|=this.ISDONE,this.vpAtomID[F]=_.serial;else{let B=g[this.vpAtomID[F]];if(B.serial!=_.serial){let U=r+u-Math.floor(.5+this.scaleFactor*(B.x+this.ptranx)),W=e+D-Math.floor(.5+this.scaleFactor*(B.y+this.ptrany)),I=t+A-Math.floor(.5+this.scaleFactor*(B.z+this.ptranz));u*u+D*D+A*A<U*U+W*W+I*I&&(this.vpAtomID[F]=_.serial)}}}}}v++}}buildboundary(){let _=this.pWidth*this.pHeight;for(let g=0;g<this.pLength;g++)for(let v=0;v<this.pHeight;v++)for(let r=0;r<this.pWidth;r++){let e=g*_+r*this.pHeight+v;if(this.vpBits[e]&this.INOUT){let t=0;for(;t<26;){let n=g+this.nb[t][0],o=v+this.nb[t][2],h=r+this.nb[t][1];if(n>-1&&n<this.pLength&&h>-1&&h<this.pWidth&&o>-1&&o<this.pHeight&&!(this.vpBits[n*_+h*this.pHeight+o]&this.INOUT)){this.vpBits[e]|=this.ISBOUND;break}else t++}}}}fastdistancemap(){let _=new M(this.pLength,this.pWidth,this.pHeight),g=this.pWidth*this.pHeight,v=this.cutRadius*this.cutRadius,r=[],e=[],t;for(let h=0;h<this.pLength;h++)for(let d=0;d<this.pWidth;d++)for(let i=0;i<this.pHeight;i++)if(t=h*g+d*this.pHeight+i,this.vpBits[t]&=~this.ISDONE,this.vpBits[t]&this.INOUT&&this.vpBits[t]&this.ISBOUND){let s={ix:h,iy:d,iz:i};_.set(h,d,i,s),r.push(s),this.vpDistance[t]=0,this.vpBits[t]|=this.ISDONE,this.vpBits[t]&=~this.ISBOUND}do{e=this.fastoneshell(r,_),r=[];for(let h=0,d=e.length;h<d;h++)t=g*e[h].ix+this.pHeight*e[h].iy+e[h].iz,this.vpBits[t]&=~this.ISBOUND,this.vpDistance[t]<=1.0404*v&&r.push({ix:e[h].ix,iy:e[h].iy,iz:e[h].iz})}while(r.length!==0);r=[],e=[],_=null;let n=this.scaleFactor-.5;n<0&&(n=0);let o=v-.5/(.1+n);for(let h=0;h<this.pLength;h++)for(let d=0;d<this.pWidth;d++)for(let i=0;i<this.pHeight;i++)t=h*g+d*this.pHeight+i,this.vpBits[t]&=~this.ISBOUND,this.vpBits[t]&this.INOUT&&(!(this.vpBits[t]&this.ISDONE)||this.vpBits[t]&this.ISDONE&&this.vpDistance[t]>=o)&&(this.vpBits[t]|=this.ISBOUND)}fastoneshell(_,g){let v,r,e,t,n,o,h,d,i,s=[];if(_.length===0)return s;let a={ix:-1,iy:-1,iz:-1},c=this.pWidth*this.pHeight;for(let u=0,A=_.length;u<A;u++){v=_[u].ix,r=_[u].iy,e=_[u].iz,d=g.get(v,r,e);for(let L=0;L<6;L++)a.ix=v+this.nb[L][0],a.iy=r+this.nb[L][1],a.iz=e+this.nb[L][2],a.ix<this.pLength&&a.ix>-1&&a.iy<this.pWidth&&a.iy>-1&&a.iz<this.pHeight&&a.iz>-1&&(i=a.ix*c+this.pHeight*a.iy+a.iz,this.vpBits[i]&this.INOUT&&!(this.vpBits[i]&this.ISDONE)?(g.set(a.ix,a.iy,e+this.nb[L][2],d),t=a.ix-d.ix,n=a.iy-d.iy,o=a.iz-d.iz,h=t*t+n*n+o*o,this.vpDistance[i]=h,this.vpBits[i]|=this.ISDONE,this.vpBits[i]|=this.ISBOUND,s.push({ix:a.ix,iy:a.iy,iz:a.iz})):this.vpBits[i]&this.INOUT&&this.vpBits[i]&this.ISDONE&&(t=a.ix-d.ix,n=a.iy-d.iy,o=a.iz-d.iz,h=t*t+n*n+o*o,h<this.vpDistance[i]&&(g.set(a.ix,a.iy,a.iz,d),this.vpDistance[i]=h,this.vpBits[i]&this.ISBOUND||(this.vpBits[i]|=this.ISBOUND,s.push({ix:a.ix,iy:a.iy,iz:a.iz})))))}for(let u=0,A=_.length;u<A;u++){v=_[u].ix,r=_[u].iy,e=_[u].iz,d=g.get(v,r,e);for(let L=6;L<18;L++)a.ix=v+this.nb[L][0],a.iy=r+this.nb[L][1],a.iz=e+this.nb[L][2],a.ix<this.pLength&&a.ix>-1&&a.iy<this.pWidth&&a.iy>-1&&a.iz<this.pHeight&&a.iz>-1&&(i=a.ix*c+this.pHeight*a.iy+a.iz,this.vpBits[i]&this.INOUT&&!(this.vpBits[i]&this.ISDONE)?(g.set(a.ix,a.iy,e+this.nb[L][2],d),t=a.ix-d.ix,n=a.iy-d.iy,o=a.iz-d.iz,h=t*t+n*n+o*o,this.vpDistance[i]=h,this.vpBits[i]|=this.ISDONE,this.vpBits[i]|=this.ISBOUND,s.push({ix:a.ix,iy:a.iy,iz:a.iz})):this.vpBits[i]&this.INOUT&&this.vpBits[i]&this.ISDONE&&(t=a.ix-d.ix,n=a.iy-d.iy,o=a.iz-d.iz,h=t*t+n*n+o*o,h<this.vpDistance[i]&&(g.set(a.ix,a.iy,a.iz,d),this.vpDistance[i]=h,this.vpBits[i]&this.ISBOUND||(this.vpBits[i]|=this.ISBOUND,s.push({ix:a.ix,iy:a.iy,iz:a.iz})))))}for(let u=0,A=_.length;u<A;u++){v=_[u].ix,r=_[u].iy,e=_[u].iz,d=g.get(v,r,e);for(let L=18;L<26;L++)a.ix=v+this.nb[L][0],a.iy=r+this.nb[L][1],a.iz=e+this.nb[L][2],a.ix<this.pLength&&a.ix>-1&&a.iy<this.pWidth&&a.iy>-1&&a.iz<this.pHeight&&a.iz>-1&&(i=a.ix*c+this.pHeight*a.iy+a.iz,this.vpBits[i]&this.INOUT&&!(this.vpBits[i]&this.ISDONE)?(g.set(a.ix,a.iy,e+this.nb[L][2],d),t=a.ix-d.ix,n=a.iy-d.iy,o=a.iz-d.iz,h=t*t+n*n+o*o,this.vpDistance[i]=h,this.vpBits[i]|=this.ISDONE,this.vpBits[i]|=this.ISBOUND,s.push({ix:a.ix,iy:a.iy,iz:a.iz})):this.vpBits[i]&this.INOUT&&this.vpBits[i]&this.ISDONE&&(t=a.ix-d.ix,n=a.iy-d.iy,o=a.iz-d.iz,h=t*t+n*n+o*o,h<this.vpDistance[i]&&(g.set(a.ix,a.iy,a.iz,d),this.vpDistance[i]=h,this.vpBits[i]&this.ISBOUND||(this.vpBits[i]|=this.ISBOUND,s.push({ix:a.ix,iy:a.iy,iz:a.iz})))))}return s}marchingcubeinit(_){for(let g=0,v=this.vpBits.length;g<v;g++)_==1?this.vpBits[g]&=~this.ISBOUND:_==4?(this.vpBits[g]&=~this.ISDONE,this.vpBits[g]&this.ISBOUND&&(this.vpBits[g]|=this.ISDONE),this.vpBits[g]&=~this.ISBOUND):_==2?this.vpBits[g]&this.ISBOUND&&this.vpBits[g]&this.ISDONE?this.vpBits[g]&=~this.ISBOUND:this.vpBits[g]&this.ISBOUND&&!(this.vpBits[g]&this.ISDONE)&&(this.vpBits[g]|=this.ISDONE):_==3&&(this.vpBits[g]&=~this.ISBOUND)}marchingcube(_){this.marchingcubeinit(_),this.verts=[],this.faces=[],m.MarchingCube.march(this.vpBits,this.verts,this.faces,{smooth:1,nX:this.pLength,nY:this.pWidth,nZ:this.pHeight});let g=this.pWidth*this.pHeight;for(let v=0,r=this.verts.length;v<r;v++)this.verts[v].atomid=this.vpAtomID[this.verts[v].x*g+this.pHeight*this.verts[v].y+this.verts[v].z];m.MarchingCube.laplacianSmooth(1,this.verts,this.faces)}}m.MarchingCube=new p},"./src/SurfaceWorker.js"(){$3Dmol.workerString=(function(){self.onmessage=function(K){var C=K.data,f=C.type;if(f<0)self.atomData=C.atoms,self.volume=C.volume,self.ps=new ProteinSurface;else{var E=self.ps;E.initparm(C.expandedExtent,f!=1,self.volume),E.fillvoxels(self.atomData,C.extendedAtoms),E.buildboundary(),(f===4||f===2)&&(E.fastdistancemap(),E.boundingatom(!1),E.fillvoxelswaals(self.atomData,C.extendedAtoms)),E.marchingcube(f);var S=E.getFacesAndVertices(C.atomsToShow);self.postMessage(S)}}}).toString().replace(/(^.*?\{|\}$)/g,""),$3Dmol.workerString+=`;
function _classCallCheck() {};`,$3Dmol.workerString+=`;
`+$3Dmol.Vector3.toString(),$3Dmol.workerString+=`;
`+$3Dmol.MarchingCubeInitializer.toString()+`;

`,$3Dmol.workerString+=`;
`+$3Dmol.PointGrid.toString()+`;
`,$3Dmol.workerString+=`;
var ProteinSurface = `+$3Dmol.ProteinSurface.toString()+`;
`,$3Dmol.SurfaceWorker=window.URL?window.URL.createObjectURL(new Blob([$3Dmol.workerString],{type:"text/javascript"})):void 0},"./src/VolumeData.ts"(K,C,f){f.r(C),f.d(C,{VolumeData:()=>x});var E=f("./src/utilities.ts"),S=f("./src/WebGL/math/index.ts"),w=f("./src/parsers/VASP.ts"),O=f("./src/parsers/CUBE.ts"),p=f("./node_modules/pako/dist/pako.esm.mjs");class x{constructor(m,b,_){if(this.unit={x:1,y:1,z:1},this.origin={x:0,y:0,z:0},this.size={x:0,y:0,z:0},this.data=new Float32Array([]),this.matrix=null,this.inversematrix=null,this.isbinary=new Set(["ccp4","CCP4"]),this.getCoordinates=function(t){var n=t/(this.size.y*this.size.z),o=t%(this.size.y*this.size.z),h=t%this.size.z;return n*=this.unit.x,o*=this.unit.y,h*=this.unit.z,n+=this.origin.x,o+=this.origin.y,h+=this.origin.z,{x:n,y:o,z:h}},this.vasp=function(t){var n=t.replace(/^\s+/,"").split(/[\n\r]/),o=(0,w.VASP)(t)[0],h=o.length;if(h==0){console.warn("No good formating of CHG or CHGCAR file, not atomic information provided in the file."),this.data=[];return}var d=1.889725992,i=.036749309,s=parseFloat(n[1]),a;a=n[2].replace(/^\s+/,"").split(/\s+/);var c=new S.Vector3(parseFloat(a[0]),parseFloat(a[1]),parseFloat(a[2])).multiplyScalar(s*d);a=n[3].replace(/^\s+/,"").split(/\s+/);var u=new S.Vector3(parseFloat(a[0]),parseFloat(a[1]),parseFloat(a[2])).multiplyScalar(s*d);a=n[4].replace(/^\s+/,"").split(/\s+/);var A=new S.Vector3(parseFloat(a[0]),parseFloat(a[1]),parseFloat(a[2])).multiplyScalar(s*d),L=c.x*(u.y*A.z-A.y*u.z)-u.x*(c.y*A.z-A.y*c.z)+A.x*(c.y*u.z-u.y*c.z);L=Math.abs(L)/Math.pow(d,3);var D=1/L;n.splice(0,8+h+1);var R=n[0].replace(/^\s+/,"").replace(/\s+/g," ").split(" "),P=Math.abs(parseFloat(R[0])),z=Math.abs(parseFloat(R[1])),F=Math.abs(parseFloat(R[2])),B=this.origin=new S.Vector3(0,0,0);this.size={x:P,y:z,z:F},this.unit=new S.Vector3(c.x,u.y,A.z),c=c.multiplyScalar(1/(d*P)),u=u.multiplyScalar(1/(d*z)),A=A.multiplyScalar(1/(d*F)),(c.y!=0||c.z!=0||u.x!=0||u.z!=0||A.x!=0||A.y!=0)&&(this.matrix=new S.Matrix4(c.x,u.x,A.x,0,c.y,u.y,A.y,0,c.z,u.z,A.z,0,0,0,0,1),this.matrix=this.matrix.multiplyMatrices(this.matrix,new S.Matrix4().makeTranslation(B.x,B.y,B.z)),this.origin=new S.Vector3(0,0,0),this.unit=new S.Vector3(1,1,1)),n.splice(0,1);var U=n.join(" ");U=U.replace(/^\s+/,"");var W=U.split(/[\s\r]+/);W.splice(P*z*F+1);for(var I=Float32Array.from(W,parseFloat),V=0;V<I.length;V++)I[V]=I[V]*D*i;this.data=I},this.dx=function(t){var n=t.split(/[\n\r]+/),o,h=/gridpositions\s+counts\s+(\d+)\s+(\d+)\s+(\d+)/,d=/^origin\s+(\S+)\s+(\S+)\s+(\S+)/,i=/^delta\s+(\S+)\s+(\S+)\s+(\S+)/,s=/data follows/,a=0;for(a=0;a<n.length;a++){var c=n[a];if(o=h.exec(c)){var u=parseInt(o[1]),A=parseInt(o[2]),L=parseInt(o[3]);this.size={x:u,y:A,z:L}}else if(o=i.exec(c)){var D=parseFloat(o[1]);if((parseFloat(o[2])!=0||parseFloat(o[3])!=0)&&console.warn("Non-orthogonal delta matrix not currently supported in dx format"),a+=1,c=n[a],o=i.exec(c),o==null){console.error("Parse error in dx delta matrix");return}var R=parseFloat(o[2]);if((parseFloat(o[1])!=0||parseFloat(o[3])!=0)&&console.warn("Non-orthogonal delta matrix not currently supported in dx format"),a+=1,c=n[a],o=i.exec(c),o==null){console.error("Parse error in dx delta matrix");return}var P=parseFloat(o[3]);(parseFloat(o[1])!=0||parseFloat(o[2])!=0)&&console.warn("Non-orthogonal delta matrix not currently supported in dx format"),this.unit=new S.Vector3(D,R,P)}else if(o=d.exec(c)){var z=parseFloat(o[1]),F=parseFloat(o[2]),B=parseFloat(o[3]);this.origin=new S.Vector3(z,F,B)}else if(o=s.exec(c))break}if(a+=1,!this.size||!this.origin||!this.unit||!this.size){console.error("Error parsing dx format");return}var U=n.splice(a).join(" "),W=U.split(/[\s\r]+/);this.data=Float32Array.from(W,parseFloat)},b=b.toLowerCase(),/\.gz$/.test(b)){b=b.replace(/\.gz$/,"");try{this[b]&&this.isbinary.has(b)?(typeof m=="string"&&(m=(0,E.base64ToArray)(m)),m=(0,p.inflate)(m)):m=new TextDecoder("utf-8").decode((0,p.inflate)(m))}catch(t){console.error(t)}}if(this[b]&&(this.isbinary.has(b)&&typeof m=="string"&&(m=(0,E.base64ToArray)(m)),this[b](m)),_){if(_.negate)for(let t=0,n=this.data.length;t<n;t++)this.data[t]=-this.data[t];if(_.normalize){var g=0;for(let t=0,n=this.data.length;t<n;t++)g+=this.data[t];var v=g/this.data.length;g=0;for(let t=0,n=this.data.length;t<n;t++){var r=this.data[t]-v;g+=r*r}var e=g/this.data.length;for(let t=0,n=this.data.length;t<n;t++)this.data[t]=(this.data[t]-v)/e}}}getIndex(m,b,_){if(this.matrix){this.inversematrix==null&&(this.inversematrix=new S.Matrix4().getInverse(this.matrix));var g=new S.Vector3(m,b,_);g=g.applyMatrix4(this.inversematrix),m=g.x,b=g.y,_=g.z}else m-=this.origin.x,b-=this.origin.y,_-=this.origin.z,m/=this.unit.x,b/=this.unit.y,_/=this.unit.z;return m=Math.round(m),b=Math.round(b),_=Math.round(_),m<0||m>=this.size.x||b<0||b>=this.size.y||_<0||_>=this.size.z?-1:m*this.size.y*this.size.z+b*this.size.z+_}getVal(m,b,_){let g=this.getIndex(m,b,_);return g<0?0:this.data[g]}cube(m){var b=m.split(/\r?\n/);if(!(b.length<6)){var _=(0,O.CUBE)(m,{}).modelData[0].cryst,g=b[2].replace(/^\s+/,"").replace(/\s+/g," ").split(" "),v=parseFloat(g[0]),r=Math.abs(v);this.origin=_.origin,this.size=_.size,this.unit=_.unit,this.matrix=_.matrix4;var e=6;v<0&&e++;var t=b.splice(r+e).join(" ");t=t.replace(/^\s+/,"");var n=t.split(/[\s\r]+/);this.data=Float32Array.from(n,parseFloat)}}ccp4(m){var b={};m=new Int8Array(m);var _=new Int32Array(m.buffer,0,56),g=new Float32Array(m.buffer,0,56),v=new DataView(m.buffer);if(b.MAP=String.fromCharCode(v.getUint8(208),v.getUint8(209),v.getUint8(210),v.getUint8(211)),b.MACHST=[v.getUint8(212),v.getUint8(213)],b.MACHST[0]===17&&b.MACHST[1]===17)for(var r=m.byteLength,e=0;e<r;e+=4)v.setFloat32(e,v.getFloat32(e),!0);b.NX=_[0],b.NY=_[1],b.NZ=_[2],b.MODE=_[3],b.NXSTART=_[4],b.NYSTART=_[5],b.NZSTART=_[6],b.MX=_[7],b.MY=_[8],b.MZ=_[9],b.xlen=g[10],b.ylen=g[11],b.zlen=g[12],b.alpha=g[13],b.beta=g[14],b.gamma=g[15],b.MAPC=_[16],b.MAPR=_[17],b.MAPS=_[18],b.DMIN=g[19],b.DMAX=g[20],b.DMEAN=g[21],b.ISPG=_[22],b.NSYMBT=_[23],b.LSKFLG=_[24],b.originX=g[49],b.originY=g[50],b.originZ=g[51],b.ARMS=g[54];var t=b,n=[t.xlen,0,0],o=[t.ylen*Math.cos(Math.PI/180*t.gamma),t.ylen*Math.sin(Math.PI/180*t.gamma),0],h=[t.zlen*Math.cos(Math.PI/180*t.beta),t.zlen*(Math.cos(Math.PI/180*t.alpha)-Math.cos(Math.PI/180*t.gamma)*Math.cos(Math.PI/180*t.beta))/Math.sin(Math.PI/180*t.gamma),0];h[2]=Math.sqrt(t.zlen*t.zlen*Math.sin(Math.PI/180*t.beta)*Math.sin(Math.PI/180*t.beta)-h[1]*h[1]);var d=[0,n,o,h],i=[0,t.MX,t.MY,t.MZ],s=[0,t.MAPC,t.MAPR,t.MAPS];this.matrix=new S.Matrix4,this.matrix.set(d[s[1]][0]/i[s[1]],d[s[2]][0]/i[s[2]],d[s[3]][0]/i[s[3]],0,d[s[1]][1]/i[s[1]],d[s[2]][1]/i[s[2]],d[s[3]][1]/i[s[3]],0,d[s[1]][2]/i[s[1]],d[s[2]][2]/i[s[2]],d[s[3]][2]/i[s[3]],0,0,0,0,1),this.matrix=this.matrix.multiplyMatrices(this.matrix,new S.Matrix4().makeTranslation(t.NXSTART+t.originX,t.NYSTART+t.originY,t.NZSTART+t.originZ)),this.origin=new S.Vector3(0,0,0),this.unit=new S.Vector3(1,1,1),this.size={x:b.NX,y:b.NY,z:b.NZ},this.dimensionorder=[b.MAPC,b.MAPR,b.MAPS];var a=new Float32Array(m.buffer,1024+b.NSYMBT),c=b.NX,u=b.NY,A=b.NZ;this.data=new Float32Array(c*u*A);for(let L=0;L<c;L++)for(let D=0;D<u;D++)for(let R=0;R<A;R++)this.data[(L*u+D)*A+R]=a[(R*u+D)*c+L]}}},"./src/VolumetricRender.ts"(K,C,f){f.r(C),f.d(C,{GLVolumetricRender:()=>x});var E=f("./src/WebGL/shapes/index.ts"),S=f("./src/WebGL/math/index.ts"),w=f("./src/WebGL/index.ts"),O=f("./src/colors.ts"),p=f("./src/GLShape.ts");class x{static interpolateArray(m,b){function _(h,d,i){return h+(d-h)*i}var g=[],v=(m.length-1)/(b-1);g[0]=m[0];for(var r=1;r<b-1;r++){var e=r*v,t=Math.floor(e),n=Math.ceil(e),o=e-t;g[r]=_(m[t],m[n],o)}return g[b-1]=m[m.length-1],g}constructor(m,b,_){this.hidden=!1,this.boundingSphere=new E.Sphere,this.renderedShapeObj=null,this.shapeObj=null,this.subsamples=5,this.data=null,this.transferfunctionbuffer=[],this.min=0,this.max=0,b=b||{};var g=Object.assign([],b.transferfn);this.subsamples=b.subsamples||5;let v=256;g.forEach(function(u){u.value=parseFloat(u.value)}),g.sort(function(u,A){return u.value-A.value}),this.min=g[0].value,g.length==0&&g.push(g[0]),this.max=g[g.length-1].value;var r,e,t,n,o,h,d,i,s,a;for(let u=0;u<g.length-1;u++)if(t=O.CC.color(g[u].color),n=O.CC.color(g[u+1].color),s=g[u].opacity,a=g[u+1].opacity,r=Math.floor((g[u].value-this.min)*v/(this.max-this.min)),e=Math.floor((g[u+1].value-this.min)*v/(this.max-this.min)),r!=e){o=x.interpolateArray([t.r*255,n.r*255],e-r),h=x.interpolateArray([t.g*255,n.g*255],e-r),d=x.interpolateArray([t.b*255,n.b*255],e-r),i=x.interpolateArray([s*255,a*255],e-r);for(let A=0;A<o.length;A++)this.transferfunctionbuffer.push(o[A]),this.transferfunctionbuffer.push(h[A]),this.transferfunctionbuffer.push(d[A]),this.transferfunctionbuffer.push(i[A])}if(this.transferfunctionbuffer=new Uint8ClampedArray(this.transferfunctionbuffer),m.matrix){let u=new S.Vector3(0,0,0),A=new S.Vector3(m.size.x,m.size.y,m.size.z),L=new S.Vector3(1,1,1);u.applyMatrix4(m.matrix),A.applyMatrix4(m.matrix),L.applyMatrix4(m.matrix).sub(u),this.extent=[[u.x,u.y,u.z],[A.x,A.y,A.z]];for(let z=1;z<7;z++)A.x=z&1?m.size.x:0,A.y=z&2?m.size.y:0,A.z=z&4?m.size.z:0,A.applyMatrix4(m.matrix),this.extent[0][0]=Math.min(this.extent[0][0],A.x),this.extent[0][1]=Math.min(this.extent[0][1],A.y),this.extent[0][2]=Math.min(this.extent[0][2],A.z),this.extent[1][0]=Math.max(this.extent[1][0],A.x),this.extent[1][1]=Math.max(this.extent[1][1],A.y),this.extent[1][2]=Math.max(this.extent[1][2],A.z);let D=A.x-u.x,R=A.y-u.y,P=A.z-u.z;this.maxdepth=Math.sqrt(D*D+R*R+P*P),this.minunit=Math.min(Math.min(L.x,L.y),L.z),this.texmatrix=new S.Matrix4().identity().scale({x:m.size.x,y:m.size.y,z:m.size.z}),this.texmatrix=this.texmatrix.multiplyMatrices(m.matrix,this.texmatrix),this.texmatrix=this.texmatrix.getInverse(this.texmatrix)}else{this.texmatrix=new S.Matrix4().identity();let u=m.unit.x*m.size.x,A=m.unit.y*m.size.y,L=m.unit.z*m.size.z;this.texmatrix.makeTranslation(-m.origin.x/u,-m.origin.y/A,-m.origin.z/L),this.texmatrix.scale({x:1/u,y:1/A,z:1/L}),this.minunit=Math.min(Math.min(m.unit.x,m.unit.y),m.unit.z),this.extent=[[m.origin.x,m.origin.y,m.origin.z],[m.origin.x+u,m.origin.y+A,m.origin.z+L]],this.maxdepth=Math.sqrt(u*u+A*A+L*L)}var c=new p.GLShape({});if(c.addBox({corner:{x:this.extent[0][0],y:this.extent[0][1],z:this.extent[0][2]},dimensions:{w:this.extent[1][0]-this.extent[0][0],h:this.extent[1][1]-this.extent[0][1],d:this.extent[1][2]-this.extent[0][2]}}),this.geo=c.finalize(),this.boundingSphere.center=new S.Vector3((this.extent[0][0]+this.extent[1][0])/2,(this.extent[0][1]+this.extent[1][1])/2,(this.extent[0][2]+this.extent[1][2])/2),this.boundingSphere.radius=this.maxdepth/2,b.coords===void 0&&b.selection!==void 0&&(_?b.coords=_.selectedAtoms(b.selection):console.log("Need to provide viewer to volumetric renderer if selection specified.")),b.coords!==void 0&&b.seldist!==void 0){let u=new Uint8Array(m.data.length),A=b.seldist,L=A*A;for(let D=0,R=b.coords.length;D<R;D++){let P=b.coords[D],z=P.x-A,F=P.y-A,B=P.z-A,U=P.x+A,W=P.y+A,I=P.z+A;if(m.getIndex(z,F,B)>=0||m.getIndex(U,W,I)>=0)for(let V=z;V<U;V+=this.minunit)for(let ee=F;ee<W;ee+=this.minunit)for(let te=B;te<I;te+=this.minunit){let ae=m.getIndex(V,ee,te);ae>=0&&!u[ae]&&(V-P.x)*(V-P.x)+(ee-P.y)*(ee-P.y)+(te-P.z)*(te-P.z)<L&&(u[ae]=1)}}for(let D=0,R=m.data.length;D<R;D++)u[D]==0&&(m.data[D]=1/0)}this.data=m}globj(m){if(this.renderedShapeObj&&(m.remove(this.renderedShapeObj),this.renderedShapeObj=null),!this.hidden){this.shapeObj=new w.Object3D;var b=null,_=new w.Texture(this.data,!0),g=new w.Texture(this.transferfunctionbuffer,!1);_.needsUpdate=!0,g.needsUpdate=!0,g.flipY=!1,b=new w.VolumetricMaterial({transferfn:g,transfermin:this.min,transfermax:this.max,map:_,extent:this.extent,maxdepth:this.maxdepth,texmatrix:this.texmatrix,unit:this.minunit,subsamples:this.subsamples});var v=new w.Mesh(this.geo,b);this.shapeObj.add(v),this.renderedShapeObj=this.shapeObj.clone(),m.add(this.renderedShapeObj)}}removegl(m){this.renderedShapeObj&&(this.renderedShapeObj.geometry!==void 0&&this.renderedShapeObj.geometry.dispose(),this.renderedShapeObj.material!==void 0&&this.renderedShapeObj.material.dispose(),m.remove(this.renderedShapeObj),this.renderedShapeObj=null),this.shapeObj=null}get position(){return this.boundingSphere.center}get x(){return this.boundingSphere.center.x}get y(){return this.boundingSphere.center.y}get z(){return this.boundingSphere.center.z}}},"./src/WebGL/Camera.ts"(K,C,f){f.r(C),f.d(C,{Camera:()=>w});var E=f("./src/WebGL/core/index.ts"),S=f("./src/WebGL/math/index.ts");class w extends E.Object3D{constructor(p=50,x=1,M=.1,m=2e3,b=!1){super(),this.projectionMatrix=new S.Matrix4,this.projectionMatrixInverse=new S.Matrix4,this.matrixWorldInverse=new S.Matrix4,this.fov=p,this.aspect=x,this.near=M,this.far=m;var _=this.position.z;this.right=_*Math.tan(Math.PI/180*p),this.left=-this.right,this.top=this.right/this.aspect,this.bottom=-this.top,this.ortho=!!b,this.updateProjectionMatrix()}lookAt(p){this.matrix.lookAt(this.position,p,this.up),this.rotationAutoUpdate&&(this.useQuaternion===!1&&this.rotation instanceof S.Vector3?this.rotation.setEulerFromRotationMatrix(this.matrix,this.eulerOrder):console.error("Unimplemented math operation."))}updateProjectionMatrix(){this.ortho?this.projectionMatrix.makeOrthographic(this.left,this.right,this.top,this.bottom,this.near,this.far):this.projectionMatrix.makePerspective(this.fov,this.aspect,this.near,this.far),this.projectionMatrixInverse.getInverse(this.projectionMatrix)}}},"./src/WebGL/Fog.ts"(K,C,f){f.r(C),f.d(C,{Fog:()=>S});var E=f("./src/colors.ts");class S{constructor(O,p=1,x=1e3){this.name="",this.color=new E.Color(O),this.near=p,this.far=x}clone(){return new S(this.color.getHex(),this.near,this.far)}}},"./src/WebGL/Renderer.ts"(K,C,f){f.r(C),f.d(C,{Renderer:()=>r});var E=f("./src/WebGL/Camera.ts"),S=f("./src/WebGL/constants/Sides.ts"),w=f("./src/WebGL/constants/TextureConstants.ts"),O=f("./src/WebGL/core/index.ts"),p=f("./src/colors.ts"),x=f("./src/WebGL/materials/index.ts"),M=f("./src/WebGL/math/index.ts"),m=f("./src/WebGL/objects/index.ts"),b=f("./src/WebGL/shaders/index.ts"),_=f("./src/WebGL/SpritePlugin.ts"),g=null,v=null;class r{constructor(t){this.context=null,this.devicePixelRatio=1,this.sortObjects=!0,this.autoUpdateObjects=!0,this.autoUpdateScene=!0,this.info={memory:{programs:0,geometries:0,textures:0},render:{calls:0,vertices:0,faces:0,points:0}},this._offscreen=null,this._bitmap=null,this._programs=[],this._programs_counter=0,this._webglversion=1,this._currentProgram=null,this._currentMaterialId=-1,this._currentGeometryGroupHash=null,this._currentCamera=null,this._geometryGroupCounter=0,this._oldDoubleSided=-1,this._oldFlipSided=-1,this._oldDepthTest=-1,this._oldDepthWrite=-1,this._oldPolygonOffset=null,this._oldLineWidth=null,this._viewportWidth=0,this._viewportHeight=0,this._currentWidth=0,this._currentHeight=0,this._enabledAttributes={},this._vector3=new M.Vector3,this._worldInverse=new M.Matrix4,this._projInverse=new M.Matrix4,this._textureMatrix=new M.Matrix4,this._fullProjModelMatrix=new M.Matrix4,this._fullProjModelMatrixInv=new M.Matrix4,this._direction=new M.Vector3,this._lightsNeedUpdate=!0,this._lights={ambient:[0,0,0],directional:{length:0,colors:[],positions:[]},point:{length:0,colors:[],positions:[],distances:[]},spot:{length:0,colors:[],positions:[],distances:[],directions:[],anglesCos:[],exponents:[]},hemi:{length:0,skyColors:[],groundColors:[],positions:[]}},this.sprites=new _.SpritePlugin,this._screenshader=null,this._AOshader=null,this._blurshader=null,this._vertexattribpos=null,this._aovertexattribpos=null,this._blurvertexattribpos=null,this._screenQuadVBO=null,this._fb=null,this._targetTexture=null,this._depthTexture=null,this._shadingTexture=null,this._scratchTexture=null,this._upscale=null,this._AOstrength=1,this._AOradius=5,this.SHADE_TEXTURE=3,t=t||{},this.row=t.row,this.col=t.col,this.rows=t.rows,this.cols=t.cols,this._canvas=t.canvas!==void 0?t.canvas:document.createElement("canvas"),this._precision=t.precision!==void 0?t.precision:"highp",this._alpha=t.alpha!==void 0?t.alpha:!0,this._premultipliedAlpha=t.premultipliedAlpha!==void 0?t.premultipliedAlpha:!0,this._antialias=t.antialias!==void 0?t.antialias:!1,this._upscale=t.upscale!==void 0?t.upscale:this._antialias,this._preserveDrawingBuffer=t.preserveDrawingBuffer!==void 0?t.preserveDrawingBuffer:!1,this._clearColor=t.clearColor!==void 0?new p.Color(t.clearColor):new p.Color(0),this._clearAlpha=t.clearAlpha!==void 0?t.clearAlpha:0,this._outlineMaterial=new x.MeshOutlineMaterial(t.outline),this._outlineSphereImposterMaterial=new x.SphereImposterOutlineMaterial(t.outline),this._outlineStickImposterMaterial=new x.StickImposterOutlineMaterial(t.outline),this._outlineEnabled=!!t.outline,this._AOEnabled=!!t.ambientOcclusion,t.ambientOcclusion&&typeof t.ambientOcclusion.strength<"u"&&(this._AOstrength=parseFloat(t.ambientOcclusion.strength)),this._AOstrength==0&&(this._AOEnabled=!1),t.ambientOcclusion&&typeof t.ambientOcclusion.radius<"u"&&(this._AOradius=parseFloat(t.ambientOcclusion.radius)),this.domElement=this._canvas,this._canvas.id=t.id,!(t.containerWidth==0||t.containerHeight==0)&&(this.initGL(),this.setDefaultGLState(),this.context=this._gl,this.isWebGL1()?this._extInstanced=this._gl.getExtension("ANGLE_instanced_arrays"):this._extInstanced={vertexAttribDivisorANGLE:this._gl.vertexAttribDivisor.bind(this._gl),drawElementsInstancedANGLE:this._gl.drawElementsInstanced.bind(this._gl)},this._extFragDepth=this._gl.getExtension("EXT_frag_depth"),this._extFloatLinear=this._gl.getExtension("OES_texture_float_linear"),this._extColorBufferFloat=this._gl.getExtension("EXT_color_buffer_float"),this.sprites.init(this))}supportedExtensions(){return{supportsAIA:!!this._extInstanced,supportsImposters:!!this._extFragDepth||!this.isWebGL1(),regen:!1}}getContext(){return this._gl}getCanvas(){return this._canvas}isLost(){return this._gl==null||this._gl.isContextLost()}getPrecision(){return this._precision}setClearColorHex(t,n){this._clearColor.setHex(t),this._clearAlpha=n,this.isLost()||this._gl.clearColor(this._clearColor.r,this._clearColor.g,this._clearColor.b,this._clearAlpha)}enableOutline(t){this._outlineMaterial=new x.MeshOutlineMaterial(t),this._outlineSphereImposterMaterial=new x.SphereImposterOutlineMaterial(t),this._outlineStickImposterMaterial=new x.StickImposterOutlineMaterial(t),this._outlineEnabled=!0}disableOutline(){this._outlineEnabled=!1}enableAmbientOcclusion(t){t&&(t.strength&&(this._AOstrength=t.strength),t.scale&&(this._AOradius=t.scale)),this._AOEnabled=this._AOstrength>0}disableAmbientOcclusion(){this._AOEnabled=!1}setViewport(){if(this._offscreen&&(this._offscreen.width=this._canvas.width,this._offscreen.height=this._canvas.height),this.rows!=null&&this.cols!=null&&this.row!=null&&this.col!=null&&!this.isLost()){var t=this._gl.drawingBufferWidth/this.cols,n=this._gl.drawingBufferHeight/this.rows;this._viewportWidth=t,this._viewportHeight=n,this._gl.enable(this._gl.SCISSOR_TEST),this._gl.scissor(t*this.col,n*this.row,t,n),this._gl.viewport(t*this.col,n*this.row,t,n)}}setSize(t,n){this.devicePixelRatio=window.devicePixelRatio!==void 0?window.devicePixelRatio:1,this._upscale&&this.devicePixelRatio<2&&(this.devicePixelRatio=2),this._canvas.width=t*this.devicePixelRatio,this._canvas.height=n*this.devicePixelRatio,this._canvas.style.width=t+"px",this._canvas.style.height=n+"px",this.rows!=null&&this.cols!=null&&this.row!=null&&this.col!=null?(this.isLost()||(this._viewportWidth=this._gl.drawingBufferWidth/this.cols,this._viewportHeight=this._gl.drawingBufferHeight/this.rows),this.setViewport()):(this._viewportWidth=this._canvas.width,this._viewportHeight=this._canvas.height,this.isLost()||this._gl.viewport(0,0,this._gl.drawingBufferWidth,this._gl.drawingBufferHeight)),this.initFrameBuffer()}clear(t,n,o){var h=0;(t===void 0||t)&&(h|=this._gl.COLOR_BUFFER_BIT),(n===void 0||n)&&(h|=this._gl.DEPTH_BUFFER_BIT),(o===void 0||o)&&(h|=this._gl.STENCIL_BUFFER_BIT),this._gl.clear(h)}setMaterialFaces(t,n){var o=t.side===S.DoubleSide,h=t.side===S.BackSide;t.imposter||(h=n?!h:h),this._oldDoubleSided!==o&&(o?this._gl.disable(this._gl.CULL_FACE):this._gl.enable(this._gl.CULL_FACE),this._oldDoubleSided=o),this._oldFlipSided!==h&&(h?this._gl.frontFace(this._gl.CW):this._gl.frontFace(this._gl.CCW),this._oldFlipSided=h),this._gl.cullFace(this._gl.BACK)}setDepthTest(t){this._oldDepthTest!==t&&(t?this._gl.enable(this._gl.DEPTH_TEST):this._gl.disable(this._gl.DEPTH_TEST),this._oldDepthTest=t)}setDepthWrite(t){this._oldDepthWrite!==t&&(this._gl.depthMask(t),this._oldDepthWrite=t)}setBlending(t){t?(this._gl.enable(this._gl.BLEND),this._gl.blendEquationSeparate(this._gl.FUNC_ADD,this._gl.FUNC_ADD),this._gl.blendFuncSeparate(this._gl.SRC_ALPHA,this._gl.ONE_MINUS_SRC_ALPHA,this._gl.ONE,this._gl.ONE_MINUS_SRC_ALPHA)):this._gl.disable(this._gl.BLEND)}initMaterial(t,n,o,h){t.addEventListener("dispose",this.onMaterialDispose.bind(this));var d,i;if(i=t.shaderID,i){var s=b.ShaderLib[i];t.vertexShader=s.vertexShader,t.fragmentShader=s.fragmentShader,t.uniforms=b.ShaderUtils.clone(s.uniforms),t.shaded&&t.makeShaded(this.SHADE_TEXTURE)}d={wireframe:t.wireframe,fragdepth:t.imposter,volumetric:t.volumetric,shaded:t.shaded},t.program=this.buildProgram(t.fragmentShader,t.vertexShader,t.uniforms,d)}renderBuffer(t,n,o,h,d,i){if(h.visible){var s,a;if(s=this.setProgram(t,n,o,h,i,this),!!s){a=s.attributes;var c=!1,u=h.wireframe?1:0,A=d.id*16777215+s.id*2+u;A!==this._currentGeometryGroupHash&&(this._currentGeometryGroupHash=A,c=!0),c&&(this.disableAttributes(),a.position>=0&&(this._gl.bindBuffer(this._gl.ARRAY_BUFFER,d.__webglVertexBuffer),this.enableAttribute(a.position),this._gl.vertexAttribPointer(a.position,3,this._gl.FLOAT,!1,0,0)),a.color>=0&&(this._gl.bindBuffer(this._gl.ARRAY_BUFFER,d.__webglColorBuffer),this.enableAttribute(a.color),this._gl.vertexAttribPointer(a.color,3,this._gl.FLOAT,!1,0,0)),a.normal>=0&&(this._gl.bindBuffer(this._gl.ARRAY_BUFFER,d.__webglNormalBuffer),this.enableAttribute(a.normal),this._gl.vertexAttribPointer(a.normal,3,this._gl.FLOAT,!1,0,0)),a.offset>=0&&(this._gl.bindBuffer(this._gl.ARRAY_BUFFER,d.__webglOffsetBuffer),this.enableAttribute(a.offset),this._gl.vertexAttribPointer(a.offset,3,this._gl.FLOAT,!1,0,0)),a.radius>=0&&(this._gl.bindBuffer(this._gl.ARRAY_BUFFER,d.__webglRadiusBuffer),this.enableAttribute(a.radius),this._gl.vertexAttribPointer(a.radius,1,this._gl.FLOAT,!1,0,0)));var L,D;if(i instanceof m.Mesh){if(h.shaderID==="instanced"){var R=h.sphere.geometryGroups[0];c&&(this._gl.bindBuffer(this._gl.ARRAY_BUFFER,d.__webglVertexBuffer),this._gl.bufferData(this._gl.ARRAY_BUFFER,R.vertexArray,this._gl.STATIC_DRAW),this._gl.bindBuffer(this._gl.ARRAY_BUFFER,d.__webglNormalBuffer),this._gl.bufferData(this._gl.ARRAY_BUFFER,R.normalArray,this._gl.STATIC_DRAW),this._gl.bindBuffer(this._gl.ELEMENT_ARRAY_BUFFER,d.__webglFaceBuffer),this._gl.bufferData(this._gl.ELEMENT_ARRAY_BUFFER,R.faceArray,this._gl.STATIC_DRAW)),L=R.faceidx,this._extInstanced.vertexAttribDivisorANGLE(a.offset,1),this._extInstanced.vertexAttribDivisorANGLE(a.radius,1),this._extInstanced.vertexAttribDivisorANGLE(a.color,1),this._extInstanced.drawElementsInstancedANGLE(this._gl.TRIANGLES,L,this._gl.UNSIGNED_SHORT,0,d.radiusArray.length),this._extInstanced.vertexAttribDivisorANGLE(a.offset,0),this._extInstanced.vertexAttribDivisorANGLE(a.radius,0),this._extInstanced.vertexAttribDivisorANGLE(a.color,0)}else h.wireframe?(D=d.lineidx,this.setLineWidth(h.wireframeLinewidth),c&&this._gl.bindBuffer(this._gl.ELEMENT_ARRAY_BUFFER,d.__webglLineBuffer),this._gl.drawElements(this._gl.LINES,D,this._gl.UNSIGNED_SHORT,0)):(L=d.faceidx,c&&this._gl.bindBuffer(this._gl.ELEMENT_ARRAY_BUFFER,d.__webglFaceBuffer),this._gl.drawElements(this._gl.TRIANGLES,L,this._gl.UNSIGNED_SHORT,0));this.info.render.calls++,this.info.render.vertices+=L,this.info.render.faces+=L/3}else i instanceof m.Line&&(D=d.vertices,this.setLineWidth(h.linewidth),this._gl.drawArrays(this._gl.LINES,0,D),this.info.render.calls++)}}}clearShading(){this._gl.framebufferTexture2D(this._gl.FRAMEBUFFER,this._gl.DEPTH_ATTACHMENT,this._gl.TEXTURE_2D,this._shadingTexture,0),this.clear(!1,!0,!1),this._gl.framebufferTexture2D(this._gl.FRAMEBUFFER,this._gl.DEPTH_ATTACHMENT,this._gl.TEXTURE_2D,this._depthTexture,0)}setShading(t,n,o){let h=t.__lights,d=t.fog,i=[];for(let c=0,u=t.__webglObjects.length;c<u;c++){let A=t.__webglObjects[c];A.render&&A[o]&&i.push(A)}if(i.length==0)return;this._gl.framebufferTexture2D(this._gl.FRAMEBUFFER,this._gl.DEPTH_ATTACHMENT,this._gl.TEXTURE_2D,this._shadingTexture,0),this._gl.framebufferTexture2D(this._gl.FRAMEBUFFER,this._gl.COLOR_ATTACHMENT0,this._gl.TEXTURE_2D,null,0),this.renderObjects(t.__webglObjects,!0,o+"Depth",n,h,d,!1),this._gl.framebufferTexture2D(this._gl.FRAMEBUFFER,this._gl.DEPTH_ATTACHMENT,this._gl.TEXTURE_2D,this._scratchTexture,0),this.clear(!1,!0,!1),this._gl.useProgram(this._AOshader),this._currentProgram=this._AOshader,this.setDepthTest(-1),this.setDepthWrite(-1);let s=this._AOshader.uniforms;this._gl.uniform1f(s.total_strength,this._AOstrength),this._gl.uniform1f(s.radius,this._AOradius),this._fullProjModelMatrix=new M.Matrix4,this._fullProjModelMatrixInv=new M.Matrix4;let a=i[0].object;this._fullProjModelMatrix.multiplyMatrices(n.projectionMatrix,a._modelViewMatrix),this._fullProjModelMatrixInv.getInverse(this._fullProjModelMatrix),this._gl.uniformMatrix4fv(s.projectionMatrix,!1,this._fullProjModelMatrix.elements),this._gl.uniformMatrix4fv(s.projinv,!1,this._fullProjModelMatrixInv.elements),this._gl.bindBuffer(this._gl.ARRAY_BUFFER,this._screenQuadVBO),this._gl.enableVertexAttribArray(this._aovertexattribpos),this._gl.vertexAttribPointer(this._aovertexattribpos,2,this._gl.FLOAT,!1,0,0),this._gl.activeTexture(this._gl.TEXTURE0),this._gl.bindTexture(this._gl.TEXTURE_2D,this._shadingTexture),this._gl.drawArrays(this._gl.TRIANGLES,0,6),this._gl.framebufferTexture2D(this._gl.FRAMEBUFFER,this._gl.DEPTH_ATTACHMENT,this._gl.TEXTURE_2D,this._shadingTexture,0),this.clear(!1,!0,!1),this._gl.useProgram(this._blurshader),this._currentProgram=this._blurshader,this.setDepthTest(-1),this.setDepthWrite(-1),this._gl.bindBuffer(this._gl.ARRAY_BUFFER,this._screenQuadVBO),this._gl.enableVertexAttribArray(this._blurvertexattribpos),this._gl.vertexAttribPointer(this._blurvertexattribpos,2,this._gl.FLOAT,!1,0,0),this._gl.activeTexture(this._gl.TEXTURE0),this._gl.bindTexture(this._gl.TEXTURE_2D,this._scratchTexture),this._gl.drawArrays(this._gl.TRIANGLES,0,6),this._gl.framebufferTexture2D(this._gl.FRAMEBUFFER,this._gl.COLOR_ATTACHMENT0,this._gl.TEXTURE_2D,this._targetTexture,0),this._gl.framebufferTexture2D(this._gl.FRAMEBUFFER,this._gl.DEPTH_ATTACHMENT,this._gl.TEXTURE_2D,this._depthTexture,0)}render(t,n){if(!(n instanceof E.Camera)){console.error("Renderer.render: camera is not an instance of Camera.");return}var o,h,d,i,s,a=t.__lights,c=t.fog;if(this._currentMaterialId=-1,this._lightsNeedUpdate=!0,this.autoUpdateScene&&t.updateMatrixWorld(),n.parent===void 0&&n.updateMatrixWorld(),n.matrixWorldInverse.getInverse(n.matrixWorld),this.isLost())return;this.autoUpdateObjects&&this.initWebGLObjects(t),this.info.render.calls=0,this.info.render.vertices=0,this.info.render.faces=0,this.info.render.points=0,this._currentWidth=this._viewportWidth,this._currentHeight=this._viewportHeight,this.setViewport(),this.setFrameBuffer(),this._gl.clearColor(this._clearColor.r,this._clearColor.g,this._clearColor.b,this._clearAlpha),this.clear(!0,!0,!0),s=t.__webglObjects;let u=!1,A=this._AOEnabled;for(o=0,h=s.length;o<h;o++)d=s[o],i=d.object,d.render=!1,i.visible&&(this.setupMatrices(i,n),this.unrollBufferMaterial(d),d.render=!0,d.volumetric&&(u=!0),d.hasAO&&(A=!0));if(this.setBlending(!1),A&&this.setShading(t,n,"opaque"),this.renderObjects(t.__webglObjects,!0,"opaque",n,a,c,!1),A&&this.clearShading(),this.renderSprites(t,n,!1),this.renderObjects(t.__webglObjects,!0,"transparentDepth",n,a,c,!0),this.renderObjects(t.__webglObjects,!1,"transparent",n,a,c,!0),u&&this._fb&&(this._gl.framebufferTexture2D(this._gl.FRAMEBUFFER,this._gl.DEPTH_ATTACHMENT,this._gl.TEXTURE_2D,null,0),this.renderObjects(t.__webglObjects,!1,"volumetric",n,a,c,!0)),this.renderFrameBuffertoScreen(),this.setDepthTest(!0),this.setDepthWrite(!0),this.renderSprites(t,n,!0),this._bitmap){const L=this._offscreen.transferToImageBitmap();this._bitmap.transferFromImageBitmap(L),L.close()}}setFrameBuffer(){if(this.isWebGL1()||!this._fb)return;let t=this._viewportWidth,n=this._viewportHeight;this._gl.enable(this._gl.SCISSOR_TEST),this._gl.scissor(0,0,t,n),this._gl.viewport(0,0,t,n),this._gl.bindTexture(this._gl.TEXTURE_2D,this._targetTexture),this._gl.texImage2D(this._gl.TEXTURE_2D,0,this._gl.RGBA,t,n,0,this._gl.RGBA,this._gl.UNSIGNED_BYTE,null),this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_MIN_FILTER,this._gl.LINEAR),this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_MAG_FILTER,this._gl.LINEAR),this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_WRAP_S,this._gl.CLAMP_TO_EDGE),this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_WRAP_T,this._gl.CLAMP_TO_EDGE),this._gl.bindTexture(this._gl.TEXTURE_2D,this._depthTexture),this._gl.texImage2D(this._gl.TEXTURE_2D,0,this._gl.DEPTH_COMPONENT32F,t,n,0,this._gl.DEPTH_COMPONENT,this._gl.FLOAT,null),this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_MIN_FILTER,this._gl.NEAREST),this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_MAG_FILTER,this._gl.NEAREST),this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_WRAP_S,this._gl.CLAMP_TO_EDGE),this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_WRAP_T,this._gl.CLAMP_TO_EDGE),this._shadingTexture&&(this._gl.deleteTexture(this._shadingTexture),this._shadingTexture=this._gl.createTexture(),this._gl.bindTexture(this._gl.TEXTURE_2D,this._shadingTexture),this._gl.texImage2D(this._gl.TEXTURE_2D,0,this._gl.DEPTH_COMPONENT32F,t,n,0,this._gl.DEPTH_COMPONENT,this._gl.FLOAT,null),this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_MIN_FILTER,this._gl.NEAREST),this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_MAG_FILTER,this._gl.NEAREST),this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_WRAP_S,this._gl.CLAMP_TO_EDGE),this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_WRAP_T,this._gl.CLAMP_TO_EDGE),this._gl.deleteTexture(this._scratchTexture),this._scratchTexture=this._gl.createTexture(),this._gl.bindTexture(this._gl.TEXTURE_2D,this._scratchTexture),this._gl.texImage2D(this._gl.TEXTURE_2D,0,this._gl.DEPTH_COMPONENT32F,t,n,0,this._gl.DEPTH_COMPONENT,this._gl.FLOAT,null),this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_MIN_FILTER,this._gl.NEAREST),this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_MAG_FILTER,this._gl.NEAREST),this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_WRAP_S,this._gl.CLAMP_TO_EDGE),this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_WRAP_T,this._gl.CLAMP_TO_EDGE)),this._gl.bindFramebuffer(this._gl.FRAMEBUFFER,this._fb),this._gl.framebufferTexture2D(this._gl.FRAMEBUFFER,this._gl.COLOR_ATTACHMENT0,this._gl.TEXTURE_2D,this._targetTexture,0),this._gl.framebufferTexture2D(this._gl.FRAMEBUFFER,this._gl.DEPTH_ATTACHMENT,this._gl.TEXTURE_2D,this._shadingTexture,0),this._gl.clearDepth(1),this._gl.clear(this._gl.DEPTH_BUFFER_BIT),this._gl.framebufferTexture2D(this._gl.FRAMEBUFFER,this._gl.DEPTH_ATTACHMENT,this._gl.TEXTURE_2D,this._depthTexture,0)}initFrameBuffer(){if(this.isWebGL1())return;let t=this._viewportWidth,n=this._viewportHeight;this._gl.enable(this._gl.SCISSOR_TEST),this._gl.scissor(0,0,t,n),this._gl.viewport(0,0,t,n),this._targetTexture=this._gl.createTexture(),this._depthTexture=this._gl.createTexture(),this._shadingTexture=this._gl.createTexture(),this._scratchTexture=this._gl.createTexture(),this._fb=this._gl.createFramebuffer();var o=this._antialias?b.ShaderLib.screenaa:b.ShaderLib.screen;this._screenshader=this.buildProgram(o.fragmentShader,o.vertexShader,o.uniforms,{}),this._vertexattribpos=this._gl.getAttribLocation(this._screenshader,"vertexPosition");var h=[1,1,-1,1,-1,-1,-1,-1,1,-1,1,1];this._screenQuadVBO=this._gl.createBuffer(),this._gl.bindBuffer(this._gl.ARRAY_BUFFER,this._screenQuadVBO),this._gl.bufferData(this._gl.ARRAY_BUFFER,new Float32Array(h),this._gl.STATIC_DRAW);let d=b.ShaderLib.ssao;this._AOshader=this.buildProgram(d.fragmentShader,d.vertexShader,d.uniforms,{}),this._aovertexattribpos=this._gl.getAttribLocation(this._AOshader,"vertexPosition");let i=b.ShaderLib.blur;this._blurshader=this.buildProgram(i.fragmentShader,i.vertexShader,i.uniforms,{}),this._blurvertexattribpos=this._gl.getAttribLocation(this._blurshader,"vertexPosition")}renderFrameBuffertoScreen(){this.isWebGL1()||this._fb===null||(this.setViewport(),this._gl.bindFramebuffer(this._gl.FRAMEBUFFER,null),this._gl.clear(this._gl.COLOR_BUFFER_BIT|this._gl.DEPTH_BUFFER_BIT),this._gl.frontFace(this._gl.CCW),this._gl.cullFace(this._gl.BACK),this._gl.useProgram(this._screenshader),this._currentProgram=this._screenshader,this.setDepthTest(-1),this.setDepthWrite(-1),this._gl.bindBuffer(this._gl.ARRAY_BUFFER,this._screenQuadVBO),this._gl.enableVertexAttribArray(this._vertexattribpos),this._gl.vertexAttribPointer(this._vertexattribpos,2,this._gl.FLOAT,!1,0,0),this._gl.activeTexture(this._gl.TEXTURE0),this._gl.bindTexture(this._gl.TEXTURE_2D,this._targetTexture),this._gl.drawArrays(this._gl.TRIANGLES,0,6))}initWebGLObjects(t){if(t.__webglObjects||(t.__webglObjects=[],t.__webglObjectsImmediate=[],t.__webglSprites=[],t.__webglFlares=[]),t.__objectsAdded.length){for(;t.__objectsAdded.length;)this.addObject(t.__objectsAdded[0],t),t.__objectsAdded.splice(0,1);this._currentGeometryGroupHash=-1}for(;t.__objectsRemoved.length;)this.removeObject(t.__objectsRemoved[0],t),t.__objectsRemoved.splice(0,1);for(var n=0,o=t.__webglObjects.length;n<o;n++)this.updateObject(t.__webglObjects[n].object)}getYRatio(){return this.rows!==void 0&&this.row!==void 0?this.rows:1}getXRatio(){return this.cols!==void 0&&this.col!==void 0?this.cols:1}getAspect(t,n){(t==null||n==null)&&(t=this._canvas.width,n=this._canvas.height);var o=t/n;if(this.rows!=null&&this.cols!=null&&this.row!=null&&this.col!=null){var h=t/this.cols,d=n/this.rows;o=h/d}return o}setTexture(t,n,o){if(t.needsUpdate){t.__webglInit||(t.__webglInit=!0,t.addEventListener("dispose",this.onTextureDispose.bind(this)),t.__webglTexture=this._gl.createTexture(),this.info.memory.textures++),this._gl.activeTexture(this._gl.TEXTURE0+n);var h=o?this._gl.TEXTURE_3D:this._gl.TEXTURE_2D;this._gl.bindTexture(h,t.__webglTexture),this._gl.pixelStorei(this._gl.UNPACK_FLIP_Y_WEBGL,t.flipY),this._gl.pixelStorei(this._gl.UNPACK_PREMULTIPLY_ALPHA_WEBGL,t.premultiplyAlpha),this._gl.pixelStorei(this._gl.UNPACK_ALIGNMENT,t.unpackAlignment),this._gl.pixelStorei(this._gl.PACK_ALIGNMENT,t.unpackAlignment);var d=this.paramToGL(t.format),i=this.paramToGL(t.type);if(o)this.setTextureParameters(this._gl.TEXTURE_3D,t),this._gl.texImage3D(this._gl.TEXTURE_3D,0,this._gl.R32F,t.image.size.z,t.image.size.y,t.image.size.x,0,this._gl.RED,this._gl.FLOAT,t.image.data);else{var s=t.image,a=s.width,c=s.height;typeof a>"u"&&(a=s.length,d==this._gl.RGBA&&(a/=4),c=1),this.setTextureParameters(this._gl.TEXTURE_2D,t),this.isWebGL1()?this._gl.texImage2D(this._gl.TEXTURE_2D,0,d,d,i,t.image):this._gl.texImage2D(this._gl.TEXTURE_2D,0,d,a,c,0,d,i,t.image)}t.needsUpdate=!1,t.onUpdate&&t.onUpdate()}else this._gl.activeTexture(this._gl.TEXTURE0+n),o?this._gl.bindTexture(this._gl.TEXTURE_3D,t.__webglTexture):this._gl.bindTexture(this._gl.TEXTURE_2D,t.__webglTexture)}supportsVolumetric(){return!this.isWebGL1()}enableAttribute(t){this._enabledAttributes[t]||(this._gl.enableVertexAttribArray(t),this._enabledAttributes[t]=!0)}disableAttributes(){for(let t in this._enabledAttributes)this._enabledAttributes[t]&&(this._gl.disableVertexAttribArray(t),this._enabledAttributes[t]=!1)}setPolygonOffset(t,n,o){this._oldPolygonOffset!==t&&(t?this._gl.enable(this._gl.POLYGON_OFFSET_FILL):this._gl.disable(this._gl.POLYGON_OFFSET_FILL))}setLineWidth(t){t!==this._oldLineWidth&&(this._gl.lineWidth(t),this._oldLineWidth=t)}deallocateGeometry(t){if(t.__webglInit=void 0,t.__webglVertexBuffer!==void 0&&this._gl.deleteBuffer(t.__webglVertexBuffer),t.__webglColorBuffer!==void 0&&this._gl.deleteBuffer(t.__webglColorBuffer),t.geometryGroups!==void 0)for(var n=0,o=t.groups;n<o;n++){var h=t.geometryGroups[n];h.__webglVertexBuffer!==void 0&&this._gl.deleteBuffer(h.__webglVertexBuffer),h.__webglColorBuffer!==void 0&&this._gl.deleteBuffer(h.__webglColorBuffer),h.__webglNormalBuffer!==void 0&&this._gl.deleteBuffer(h.__webglNormalBuffer),h.__webglFaceBuffer!==void 0&&this._gl.deleteBuffer(h.__webglFaceBuffer),h.__webglLineBuffer!==void 0&&this._gl.deleteBuffer(h.__webglLineBuffer)}}deallocateMaterial(t){var n=t.program;if(n!==void 0){t.program=void 0;var o,h,d,i=!1;for(o=0,h=this._programs.length;o<h;o++)if(d=this._programs[o],d.program===n){d.usedTimes--,d.usedTimes===0&&(i=!0);break}if(i===!0){var s=[];for(o=0,h=this._programs.length;o<h;o++)d=this._programs[o],d.program!==n&&s.push(d);this._programs=s,this._gl.deleteProgram(n),this.info.memory.programs--}}}deallocateTexture(t){if(t.image&&t.image.__webglTextureCube)this._gl.deleteTexture(t.image.__webglTextureCube);else{if(!t.__webglInit)return;t.__webglInit=!1,this._gl.deleteTexture(t.__webglTexture)}}onGeometryDispose(t){var n=t.target;n.removeEventListener("dispose",this.onGeometryDispose),this.deallocateGeometry(n),this.info.memory.geometries--}onTextureDispose(t){var n=t.target;n.removeEventListener("dispose",this.onTextureDispose),this.deallocateTexture(n),this.info.memory.textures--}onMaterialDispose(t){var n=t.target;n.removeEventListener("dispose",this.onMaterialDispose),this.deallocateMaterial(n)}getShader(t,n){var o;return!this.isWebGL1()&&!n.startsWith("#version")&&(n=n.replace(/gl_FragDepthEXT/g,"gl_FragDepth"),t=="fragment"?n=n.replace(/varying/g,"in"):n=n.replace(/varying/g,"out"),n=n.replace(/attribute/g,"in"),n=n.replace(/texture2D/g,"texture"),n=n.replace(/\/\/DEFINEFRAGCOLOR/g,"out vec4 glFragColor;"),n=n.replace(/gl_FragColor/g,"glFragColor"),n=`#version 300 es
`+n),t==="fragment"?o=this._gl.createShader(this._gl.FRAGMENT_SHADER):t==="vertex"&&(o=this._gl.createShader(this._gl.VERTEX_SHADER)),o==null?null:(this._gl.shaderSource(o,n),this._gl.compileShader(o),this._gl.getShaderParameter(o,this._gl.COMPILE_STATUS)?o:(console.error(this._gl.getShaderInfoLog(o)),console.error("could not initialize shader"),null))}buildProgram(t,n,o,h){var d,i,s,a,c=[];c.push(t),c.push(n);for(d in h)c.push(d),c.push(h[d]);for(a=c.join(),d=0,i=this._programs.length;d<i;d++){var u=this._programs[d];if(u.code===a)return u.usedTimes++,u.program}if(this.isWebGL1()&&h.volumetric)throw new Error("Volumetric rendering requires webgl2 which is not supported by your hardware.");if(s=this._gl.createProgram(),s==null)return null;var A=this._precision,L="precision "+A+" float;",D=[h.volumetric?"#version 300 es":"",L].join(`
`),R=[h.volumetric?"#version 300 es":"",h.fragdepth&&this.isWebGL1()?"#extension GL_EXT_frag_depth: enable":"",h.shaded?"#define SHADED 1":"",h.wireframe?"#define WIREFRAME 1":"",L].join(`
`),P=this.getShader("fragment",R+t),z=this.getShader("vertex",D+n);z!=null&&this._gl.attachShader(s,z),P!=null&&this._gl.attachShader(s,P),this._gl.linkProgram(s),this._gl.getProgramParameter(s,this._gl.LINK_STATUS)||console.error("Could not initialize shader"),s.uniforms={},s.attributes={};var F,B,U;F=["viewMatrix","modelViewMatrix","projectionMatrix","normalMatrix","vWidth","vHeight"];for(B in o)F.push(B);for(U=0;U<F.length;U++){var W=F[U];s.uniforms[W]=this._gl.getUniformLocation(s,W)}for(F=["position","normal","color","lineDistance","offset","radius"],U=0;U<F.length;U++){var I=F[U];s.attributes[I]=this._gl.getAttribLocation(s,I)}return s.id=this._programs_counter++,this._programs.push({program:s,code:a,usedTimes:1}),this.info.memory.programs=this._programs.length,s}setProgram(t,n,o,h,d,i){if(h.needsUpdate&&(h.program&&this.deallocateMaterial(h),this.initMaterial(h,n,o,d),h.needsUpdate=!1),h.program==null)return null;var s=!1,a=h.program,c=a.uniforms,u=h.uniforms;if(a!=this._currentProgram&&(this._gl.useProgram(a),this._currentProgram=a,s=!0),h.id!=this._currentMaterialId&&(this._currentMaterialId=h.id,s=!0),t!=this._currentCamera&&(this._currentCamera=t,s=!0),c.projectionMatrix&&this._gl.uniformMatrix4fv(c.projectionMatrix,!1,t.projectionMatrix.elements),c.modelViewMatrix&&this._gl.uniformMatrix4fv(c.modelViewMatrix,!1,d._modelViewMatrix.elements),c.normalMatrix&&this._gl.uniformMatrix3fv(c.normalMatrix,!1,d._normalMatrix.elements),c.projinv&&(this._projInverse.getInverse(t.projectionMatrix),this._gl.uniformMatrix4fv(c.projinv,!1,this._projInverse.elements)),c.viewMatrix&&this._gl.uniformMatrix4fv(c.viewMatrix,!1,t.matrixWorldInverse.elements),c.vWidth&&this._gl.uniform1f(c.vWidth,this._viewportWidth),c.vHeight&&this._gl.uniform1f(c.vHeight,this._viewportHeight),s){if(u.fogColor.value=o.color,u.fogNear.value=o.near,u.fogFar.value=o.far,h.shaderID.startsWith("lambert")||h.shaderID==="instanced"||h.shaderID.endsWith("imposter"))this._lightsNeedUpdate&&(this.setupLights(a,n),this._lightsNeedUpdate=!1),u.directionalLightColor.value=this._lights.directional.colors,u.directionalLightDirection.value=this._lights.directional.positions;else if(h.shaderID.endsWith("outline"))u.outlineColor.value=h.outlineColor,u.outlineWidth.value=h.outlineWidth,u.outlinePushback.value=h.outlinePushback,u.outlineMaxPixels.value=h.outlineMaxPixels*this.devicePixelRatio;else if(h.shaderID==="volumetric"){d._modelViewMatrix.getScale(this._direction),this._worldInverse.getInverse(d._modelViewMatrix),this._projInverse.getInverse(t.projectionMatrix),this._textureMatrix.multiplyMatrices(d.material.texmatrix,this._worldInverse),this._gl.uniformMatrix4fv(c.textmat,!1,this._textureMatrix.elements),this._gl.uniformMatrix4fv(c.projinv,!1,this._projInverse.elements);let A=Math.min(Math.min(this._direction.x,this._direction.y),this._direction.z);u.step.value=d.material.unit*A,u.maxdepth.value=d.material.maxdepth*A,u.transfermax.value=d.material.transfermax,u.transfermin.value=d.material.transfermin,u.subsamples.value=d.material.subsamples,i.setTexture(d.material.transferfn,4,!1),i.setTexture(d.material.map,3,!0),this._gl.activeTexture(this._gl.TEXTURE5),this._gl.bindTexture(this._gl.TEXTURE_2D,this._depthTexture)}u.opacity.value=h.opacity,this.loadMaterialUniforms(c,u)}return u.shading&&(u.shading.value==3?(this._gl.activeTexture(this._gl.TEXTURE0+this.SHADE_TEXTURE),this._gl.bindTexture(this._gl.TEXTURE_2D,this._shadingTexture)):console.error("Invalid shading textures.")),a}loadMaterialUniforms(t,n){var o,h,d,i;for(o in n)t[o]&&(h=n[o].type,d=n[o].value,i=t[o],h==="f"?this._gl.uniform1f(i,d):h==="i"?this._gl.uniform1i(i,d):h==="fv"?this._gl.uniform3fv(i,d):h==="c"?this._gl.uniform3f(i,d.r,d.g,d.b):h==="f4"&&this._gl.uniform4f(i,d[0],d[1],d[2],d[3]))}addObject(t,n){var o,h,d,i;if(!t.__webglInit&&(t.__webglInit=!0,t._modelViewMatrix=new M.Matrix4,t._normalMatrix=new M.Matrix3,t.geometry!==void 0&&t.geometry.__webglInit===void 0&&(t.geometry.__webglInit=!0,t.geometry.addEventListener("dispose",this.onGeometryDispose.bind(this))),t instanceof m.Mesh||t instanceof m.Line))for(d=t.geometry,o=0,h=d.geometryGroups.length;o<h;o++)i=d.geometryGroups[o],i.id=this._geometryGroupCounter++,i.__webglVertexBuffer||(t instanceof m.Mesh?(this.createMeshBuffers(i),d.elementsNeedUpdate=!0,d.normalsNeedUpdate=!0):t instanceof m.Line&&this.createLineBuffers(i),d.verticesNeedUpdate=!0,d.colorsNeedUpdate=!0);if(!t.__webglActive){if(t instanceof m.Mesh||t instanceof m.Line)for(d=t.geometry,o=0,h=d.geometryGroups.length;o<h;o++)i=d.geometryGroups[o],this.addBuffer(n.__webglObjects,i,t);else t instanceof m.Sprite&&n.__webglSprites.push(t);t.__webglActive=!0}}updateObject(t){var n=t.geometry,o;if(t instanceof m.Mesh||t instanceof m.Line){for(var h=0,d=n.geometryGroups.length;h<d;h++)o=n.geometryGroups[h],(n.verticesNeedUpdate||n.elementsNeedUpdate||n.colorsNeedUpdate||n.normalsNeedUpdate)&&this.setBuffers(o,this._gl.STATIC_DRAW);n.verticesNeedUpdate=!1,n.elementsNeedUpdate=!1,n.normalsNeedUpdate=!1,n.colorsNeedUpdate=!1,n.buffersNeedUpdate=!1}}removeObject(t,n){t instanceof m.Mesh||t instanceof m.Line?this.removeInstances(n.__webglObjects,t):t instanceof m.Sprite&&this.removeInstancesDirect(n.__webglSprites,t),t.__webglActive=!1}removeInstances(t,n){for(var o=t.length-1;o>=0;--o)t[o].object===n&&t.splice(o,1)}removeInstancesDirect(t,n){for(var o=t.length-1;o>=0;--o)t[o]===n&&t.splice(o,1)}unrollBufferMaterial(t){var n=t.object,o=n.material;if(o.volumetric)t.opaque=null,t.transparent=null,t.volumetric=o;else if(o.transparent){if(t.opaque=null,t.volumetric=null,t.transparent=o,!o.wireframe){let h=o.clone();h.opacity=0,t.transparentDepth=h}}else{if(t.opaque=o,t.transparent=null,t.volumetric=null,!o.wireframe){let h=o.clone();h.opacity=0,t.opaqueDepth=h}o.hasAO&&(t.hasAO=!0),(this._AOEnabled||t.hasAO)&&(t.opaqueShaded=o.clone(),t.opaqueShaded.shaded=!0)}}setBuffers(t,n){var o=t.vertexArray,h=t.colorArray;if(t.__webglOffsetBuffer!==void 0?(this._gl.bindBuffer(this._gl.ARRAY_BUFFER,t.__webglOffsetBuffer),this._gl.bufferData(this._gl.ARRAY_BUFFER,o,n)):(this._gl.bindBuffer(this._gl.ARRAY_BUFFER,t.__webglVertexBuffer),this._gl.bufferData(this._gl.ARRAY_BUFFER,o,n)),this._gl.bindBuffer(this._gl.ARRAY_BUFFER,t.__webglColorBuffer),this._gl.bufferData(this._gl.ARRAY_BUFFER,h,n),t.normalArray&&t.__webglNormalBuffer!==void 0){var d=t.normalArray;this._gl.bindBuffer(this._gl.ARRAY_BUFFER,t.__webglNormalBuffer),this._gl.bufferData(this._gl.ARRAY_BUFFER,d,n)}if(t.radiusArray&&t.__webglRadiusBuffer!==void 0&&(this._gl.bindBuffer(this._gl.ARRAY_BUFFER,t.__webglRadiusBuffer),this._gl.bufferData(this._gl.ARRAY_BUFFER,t.radiusArray,n)),t.faceArray&&t.__webglFaceBuffer!==void 0){var i=t.faceArray;this._gl.bindBuffer(this._gl.ELEMENT_ARRAY_BUFFER,t.__webglFaceBuffer),this._gl.bufferData(this._gl.ELEMENT_ARRAY_BUFFER,i,n)}if(t.lineArray&&t.__webglLineBuffer!==void 0){var s=t.lineArray;this._gl.bindBuffer(this._gl.ELEMENT_ARRAY_BUFFER,t.__webglLineBuffer),this._gl.bufferData(this._gl.ELEMENT_ARRAY_BUFFER,s,n)}}createMeshBuffers(t){t.radiusArray&&(t.__webglRadiusBuffer=this._gl.createBuffer()),t.useOffset&&(t.__webglOffsetBuffer=this._gl.createBuffer()),t.__webglVertexBuffer=this._gl.createBuffer(),t.__webglNormalBuffer=this._gl.createBuffer(),t.__webglColorBuffer=this._gl.createBuffer(),t.__webglFaceBuffer=this._gl.createBuffer(),t.__webglLineBuffer=this._gl.createBuffer(),this.info.memory.geometries++}createLineBuffers(t){t.__webglVertexBuffer=this._gl.createBuffer(),t.__webglColorBuffer=this._gl.createBuffer(),this.info.memory.geometries++}addBuffer(t,n,o){t.push({buffer:n,object:o,opaque:null,transparent:null})}setupMatrices(t,n){t._modelViewMatrix.multiplyMatrices(n.matrixWorldInverse,t.matrixWorld),t._normalMatrix.getInverse(t._modelViewMatrix),t._normalMatrix.transpose()}filterFallback(t){return this._gl.LINEAR}setTextureParameters(t,n){t==this._gl.TEXTURE_2D?(this._gl.texParameteri(t,this._gl.TEXTURE_WRAP_S,this._gl.CLAMP_TO_EDGE),this._gl.texParameteri(t,this._gl.TEXTURE_WRAP_T,this._gl.CLAMP_TO_EDGE),this._gl.texParameteri(t,this._gl.TEXTURE_MAG_FILTER,this.filterFallback(n.magFilter)),this._gl.texParameteri(t,this._gl.TEXTURE_MIN_FILTER,this.filterFallback(n.minFilter))):(this._gl.texParameteri(t,this._gl.TEXTURE_WRAP_S,this._gl.CLAMP_TO_EDGE),this._gl.texParameteri(t,this._gl.TEXTURE_WRAP_T,this._gl.CLAMP_TO_EDGE),this._gl.texParameteri(t,this._gl.TEXTURE_WRAP_R,this._gl.CLAMP_TO_EDGE),this._extColorBufferFloat&&this._extFloatLinear?(this._gl.texParameteri(t,this._gl.TEXTURE_MAG_FILTER,this._gl.LINEAR),this._gl.texParameteri(t,this._gl.TEXTURE_MIN_FILTER,this._gl.LINEAR)):(this._gl.texParameteri(t,this._gl.TEXTURE_MAG_FILTER,this._gl.NEAREST),this._gl.texParameteri(t,this._gl.TEXTURE_MIN_FILTER,this._gl.NEAREST)))}paramToGL(t){return t===w.UnsignedByteType?this._gl.UNSIGNED_BYTE:t===w.RGBAFormat?this._gl.RGBA:t===w.NearestFilter?this._gl.NEAREST:0}setupLights(t,n){var o,h,d,i=0,s=0,a=0,c,u,A=this._lights,L=A.directional.colors,D=A.directional.positions,R=0,P=0;for(o=0,h=n.length;o<h;o++)if(d=n[o],c=d.color,u=d.intensity,d instanceof O.Light){if(this._direction.getPositionFromMatrix(d.matrixWorld),this._vector3.getPositionFromMatrix(d.target.matrixWorld),this._direction.sub(this._vector3),this._direction.normalize(),this._direction.x===0&&this._direction.y===0&&this._direction.z===0)continue;D[P]=this._direction.x,D[P+1]=this._direction.y,D[P+2]=this._direction.z,L[P]=c.r*u,L[P+1]=c.g*u,L[P+2]=c.b*u,P+=3,R++}A.ambient[0]=i,A.ambient[1]=s,A.ambient[2]=a,A.directional.length=R}initGL(){try{if(OffscreenCanvas&&!(this.rows!=null&&this.cols!=null&&this.row!=null&&this.col!=null))(v==null||v.isContextLost())&&(g=new OffscreenCanvas(this._canvas.width,this._canvas.height),v=g.getContext("webgl2",{alpha:!0,premultipliedAlpha:this._premultipliedAlpha,antialias:this._antialias,preserveDrawingBuffer:this._preserveDrawingBuffer})),this._offscreen=g,this._gl=v,this._bitmap=this._canvas.getContext("bitmaprenderer",{alpha:!0});else if(!(this._gl=this._canvas.getContext("webgl2",{alpha:this._alpha,premultipliedAlpha:this._premultipliedAlpha,antialias:this._antialias,preserveDrawingBuffer:this._preserveDrawingBuffer}))&&!(this._gl=this._canvas.getContext("experimental-webgl",{alpha:this._alpha,premultipliedAlpha:this._premultipliedAlpha,antialias:this._antialias,preserveDrawingBuffer:this._preserveDrawingBuffer}))&&!(this._gl=this._canvas.getContext("webgl",{alpha:this._alpha,premultipliedAlpha:this._premultipliedAlpha,antialias:this._antialias,preserveDrawingBuffer:this._preserveDrawingBuffer})))throw"Error creating WebGL context.";var t=this._gl.getParameter(this._gl.VERSION);this._webglversion=parseInt(t[6])}catch(n){console.error(n)}}isWebGL1(){return this._webglversion==1}setDefaultGLState(){this._gl.clearDepth(1),this._gl.clearStencil(0),this._gl.enable(this._gl.DEPTH_TEST),this._gl.depthFunc(this._gl.LEQUAL),this._gl.frontFace(this._gl.CCW),this._gl.cullFace(this._gl.BACK),this._gl.enable(this._gl.CULL_FACE),this._gl.enable(this._gl.BLEND),this._gl.blendEquation(this._gl.FUNC_ADD),this._gl.blendFunc(this._gl.SRC_ALPHA,this._gl.ONE_MINUS_SRC_ALPHA),this._gl.clearColor(this._clearColor.r,this._clearColor.g,this._clearColor.b,this._clearAlpha)}renderObjects(t,n,o,h,d,i,s){var a,c,u,A,L,D,R;n?(L=t.length-1,D=-1,R=-1):(L=0,D=t.length,R=1);for(var P=L;P!==D;P+=R)if(a=t[P],a.render){if(c=a.object,u=a.buffer,A=a[o],(a.hasAO||this._AOEnabled)&&a[o+"Shaded"]&&(A=a[o+"Shaded"]),!A)continue;this.setBlending(s),this.setDepthTest(A.depthTest),this.setDepthWrite(A.depthWrite),this.setPolygonOffset(A.polygonOffset,A.polygonOffsetFactor,A.polygonOffsetUnits);var z=c._modelViewMatrix.isReflected();if(this.setMaterialFaces(A,z),this.renderBuffer(h,d,i,A,u,c),(this._outlineEnabled||A.outline)&&!A.wireframe&&A.shaderID!=="basic"&&A.opacity!==0){let F=this._outlineMaterial;A.shaderID=="sphereimposter"?F=this._outlineSphereImposterMaterial:A.shaderID=="stickimposter"&&(F=this._outlineStickImposterMaterial),this.renderBuffer(h,d,i,F,u,c)}}}renderSprites(t,n,o){this._currentGeometryGroupHash=-1,this._currentProgram=null,this._currentCamera=null,this._oldDepthWrite=-1,this._oldDepthTest=-1,this._oldDoubleSided=-1,this._currentMaterialId=-1,this._oldFlipSided=-1,this._lightsNeedUpdate=!0,this.sprites.render(t,n,this._currentWidth,this._currentHeight,o),this._currentGeometryGroupHash=-1,this._currentProgram=null,this._currentCamera=null,this._oldDepthWrite=-1,this._oldDepthTest=-1,this._oldDoubleSided=-1,this._currentMaterialId=-1,this._oldFlipSided=-1}}},"./src/WebGL/SpritePlugin.ts"(K,C,f){f.r(C),f.d(C,{SpritePlugin:()=>S});var E=f("./src/WebGL/shaders/index.ts");class S{constructor(){this.sprite={vertices:null,faces:null,vertexBuffer:null,elementBuffer:null,program:null,attributes:{},uniforms:null}}init(p){this.gl=p.context,this.renderer=p,this.precision=p.getPrecision(),this.sprite.vertices=new Float32Array(16),this.sprite.faces=new Uint16Array(6);var x=0;this.sprite.vertices[x++]=-1,this.sprite.vertices[x++]=-1,this.sprite.vertices[x++]=0,this.sprite.vertices[x++]=0,this.sprite.vertices[x++]=1,this.sprite.vertices[x++]=-1,this.sprite.vertices[x++]=1,this.sprite.vertices[x++]=0,this.sprite.vertices[x++]=1,this.sprite.vertices[x++]=1,this.sprite.vertices[x++]=1,this.sprite.vertices[x++]=1,this.sprite.vertices[x++]=-1,this.sprite.vertices[x++]=1,this.sprite.vertices[x++]=0,this.sprite.vertices[x++]=1,x=0,this.sprite.faces[x++]=0,this.sprite.faces[x++]=1,this.sprite.faces[x++]=2,this.sprite.faces[x++]=0,this.sprite.faces[x++]=2,this.sprite.faces[x++]=3,this.sprite.vertexBuffer=this.gl.createBuffer(),this.sprite.elementBuffer=this.gl.createBuffer(),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,this.sprite.vertexBuffer),this.gl.bufferData(this.gl.ARRAY_BUFFER,this.sprite.vertices,this.gl.STATIC_DRAW),this.gl.bindBuffer(this.gl.ELEMENT_ARRAY_BUFFER,this.sprite.elementBuffer),this.gl.bufferData(this.gl.ELEMENT_ARRAY_BUFFER,this.sprite.faces,this.gl.STATIC_DRAW),this.sprite.program=this.createProgram(E.ShaderLib.sprite,this.precision||1),this.sprite.attributes={};const M={};this.sprite.attributes.position=this.gl.getAttribLocation(this.sprite.program,"position"),this.sprite.attributes.uv=this.gl.getAttribLocation(this.sprite.program,"uv"),M.uvOffset=this.gl.getUniformLocation(this.sprite.program,"uvOffset"),M.uvScale=this.gl.getUniformLocation(this.sprite.program,"uvScale"),M.rotation=this.gl.getUniformLocation(this.sprite.program,"rotation"),M.scale=this.gl.getUniformLocation(this.sprite.program,"scale"),M.alignment=this.gl.getUniformLocation(this.sprite.program,"alignment"),M.color=this.gl.getUniformLocation(this.sprite.program,"color"),M.map=this.gl.getUniformLocation(this.sprite.program,"map"),M.opacity=this.gl.getUniformLocation(this.sprite.program,"opacity"),M.useScreenCoordinates=this.gl.getUniformLocation(this.sprite.program,"useScreenCoordinates"),M.screenPosition=this.gl.getUniformLocation(this.sprite.program,"screenPosition"),M.modelViewMatrix=this.gl.getUniformLocation(this.sprite.program,"modelViewMatrix"),M.projectionMatrix=this.gl.getUniformLocation(this.sprite.program,"projectionMatrix"),M.fogNear=this.gl.getUniformLocation(this.sprite.program,"fogNear"),M.fogFar=this.gl.getUniformLocation(this.sprite.program,"fogFar"),M.fogColor=this.gl.getUniformLocation(this.sprite.program,"fogColor"),M.alphaTest=this.gl.getUniformLocation(this.sprite.program,"alphaTest"),this.sprite.uniforms=M}render(p,x,M,m,b){var _,g,v,r,e,t,n,o,h,d;if(!this.gl)throw new Error("WebGLRenderer not initialized");let i=[];(_=p==null?void 0:p.__webglSprites)===null||_===void 0||_.forEach(W=>{(b&&W.material.depthTest==!1||!b&&W.material.depthTest)&&i.push(W)});let s=i.length;if(!s)return;const a=this.sprite.attributes,c=this.sprite.uniforms;if(!c)throw new Error("Uniforms not defined");var u=M*.5,A=m*.5;this.gl.useProgram(this.sprite.program),this.gl.enableVertexAttribArray(a.position),this.gl.enableVertexAttribArray(a.uv),this.gl.disable(this.gl.CULL_FACE),this.gl.enable(this.gl.BLEND),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,this.sprite.vertexBuffer),this.gl.vertexAttribPointer(a.position,2,this.gl.FLOAT,!1,16,0),this.gl.vertexAttribPointer(a.uv,2,this.gl.FLOAT,!1,16,8),this.gl.bindBuffer(this.gl.ELEMENT_ARRAY_BUFFER,this.sprite.elementBuffer),this.gl.uniformMatrix4fv(c.projectionMatrix,!1,x.projectionMatrix.elements),this.gl.activeTexture(this.gl.TEXTURE0),this.gl.uniform1i(c.map,0);var L=p.fog;L?(this.gl.uniform3f(c.fogColor,L.color.r,L.color.g,L.color.b),this.gl.uniform1f(c.fogNear,L.near),this.gl.uniform1f(c.fogFar,L.far)):(this.gl.uniform1f(c.fogNear,0),this.gl.uniform1f(c.fogFar,0));var D;let R,P,z,F=[];for(D=0;D<s;D++)R=i[D],P=R.material,P&&(P.depthTest==!1&&!b||!R.visible||P.opacity===0||(P.useScreenCoordinates?R.z=-R.position.z:(R._modelViewMatrix.multiplyMatrices(x.matrixWorldInverse,R.matrixWorld),R.z=-R._modelViewMatrix.elements[14])));for(i.sort(w),D=0;D<s;D++)if(R=i[D],P=R.material,!!P&&!(!R.visible||P.opacity===0)&&P.map&&P.map.image&&P.map.image.width){this.gl.uniform1f((c==null?void 0:c.alphaTest)||null,P.alphaTest);var B=P.map.image.width,U=P.map.image.height;F[0]=B*this.renderer.devicePixelRatio/M,F[1]=U*this.renderer.devicePixelRatio/m,P.useScreenCoordinates===!0?(this.gl.uniform1i(c.useScreenCoordinates,1),this.gl.uniform3f(c.screenPosition,(R.position.x*this.renderer.devicePixelRatio-u)/u,(A-R.position.y*this.renderer.devicePixelRatio)/A,Math.max(0,Math.min(1,R.position.z)))):(this.gl.uniform1i(c.useScreenCoordinates,0),this.gl.uniformMatrix4fv(c.modelViewMatrix,!1,R._modelViewMatrix.elements)),z=1/(P.scaleByViewport?m:1),F[0]*=z*R.scale.x,F[1]*=z*R.scale.y;let W=(g=P==null?void 0:P.alignment)===null||g===void 0?void 0:g.x,I=(v=P==null?void 0:P.alignment)===null||v===void 0?void 0:v.y;P.screenOffset&&(W=(W||0)+2*P.screenOffset.x/B,I=(I||0)+2*P.screenOffset.y/U),this.gl.uniform2f(c.uvScale,((r=P==null?void 0:P.uvScale)===null||r===void 0?void 0:r.x)||1,((e=P==null?void 0:P.uvScale)===null||e===void 0?void 0:e.y)||1),this.gl.uniform2f(c.uvOffset,((t=P==null?void 0:P.uvOffset)===null||t===void 0?void 0:t.x)||0,((n=P==null?void 0:P.uvOffset)===null||n===void 0?void 0:n.y)||0),this.gl.uniform2f(c.alignment,W||0,I||0),this.gl.uniform1f(c.opacity,P.opacity),this.gl.uniform3f(c.color,((o=P==null?void 0:P.color)===null||o===void 0?void 0:o.r)||0,((h=P==null?void 0:P.color)===null||h===void 0?void 0:h.g)||0,((d=P==null?void 0:P.color)===null||d===void 0?void 0:d.b)||0),this.gl.uniform1f(c.rotation,R.rotation),this.gl.uniform2fv(c.scale,F),this.renderer.setDepthTest(P.depthTest),this.renderer.setDepthWrite(P.depthWrite),this.renderer.setTexture(P.map,0),this.gl.drawElements(this.gl.TRIANGLES,6,this.gl.UNSIGNED_SHORT,0)}this.gl.enable(this.gl.CULL_FACE)}createProgram(p,x){if(!this.gl)throw new Error("WebGL Rendering context not found");var M=this.gl.createProgram();if(!M)throw new Error("Error creating webgl program");var m=this.gl.createShader(this.gl.FRAGMENT_SHADER),b=this.gl.createShader(this.gl.VERTEX_SHADER);if(!m)throw new Error("Unable to create fragment shader SpritePlugin.createProgram");if(!b)throw new Error("Unable to create vertex shader SpritePlugin.createProgram");var _="precision "+x+` float;
`;if(this.gl.shaderSource(m,_+p.fragmentShader),this.gl.shaderSource(b,_+p.vertexShader),this.gl.compileShader(m),this.gl.compileShader(b),!this.gl.getShaderParameter(m,this.gl.COMPILE_STATUS)||!this.gl.getShaderParameter(b,this.gl.COMPILE_STATUS))throw new Error(`Error compiling shader: 
      ${this.gl.getShaderInfoLog(m)} 
      ${this.gl.getShaderInfoLog(b)}`);return this.gl.attachShader(M,m),this.gl.attachShader(M,b),this.gl.linkProgram(M),this.gl.getProgramParameter(M,this.gl.LINK_STATUS)||console.error("Could not initialize shader"),M}}function w(O,p){return O.z!==p.z?p.z-O.z:p.id-O.id}},"./src/WebGL/constants/Coloring.ts"(K,C,f){f.r(C),f.d(C,{Coloring:()=>E});var E;(function(S){S[S.NoColors=0]="NoColors",S[S.FaceColors=1]="FaceColors",S[S.VertexColors=2]="VertexColors"})(E||(E={}))},"./src/WebGL/constants/Shading.ts"(K,C,f){f.r(C),f.d(C,{Shading:()=>E});var E;(function(S){S[S.NoShading=0]="NoShading",S[S.FlatShading=1]="FlatShading",S[S.SmoothShading=2]="SmoothShading"})(E||(E={}))},"./src/WebGL/constants/Sides.ts"(K,C,f){f.r(C),f.d(C,{BackSide:()=>S,DoubleSide:()=>w,FrontSide:()=>E});const E=0,S=1,w=2},"./src/WebGL/constants/SpriteAlignment.ts"(K,C,f){f.r(C),f.d(C,{SpriteAlignment:()=>S});var E=f("./src/WebGL/math/index.ts");const S={topLeft:new E.Vector2(1,-1),topCenter:new E.Vector2(0,-1),topRight:new E.Vector2(-1,-1),centerLeft:new E.Vector2(1,0),center:new E.Vector2(0,0),centerRight:new E.Vector2(-1,0),bottomLeft:new E.Vector2(1,1),bottomCenter:new E.Vector2(0,1),bottomRight:new E.Vector2(-1,1)}},"./src/WebGL/constants/TextureConstants.ts"(K,C,f){f.r(C),f.d(C,{ClampToEdgeWrapping:()=>E,FloatType:()=>x,LinearFilter:()=>S,LinearMipMapLinearFilter:()=>O,NearestFilter:()=>w,R32Format:()=>b,RFormat:()=>m,RGBAFormat:()=>M,UnsignedByteType:()=>p});const E=1001,S=1006,w=1007,O=1008,p=1009,x=1010,M=1021,m=1022,b=1023},"./src/WebGL/constants/TextureOperations.ts"(K,C,f){f.r(C),f.d(C,{TextureOperations:()=>E});var E;(function(S){S[S.MultiplyOperation=0]="MultiplyOperation",S[S.MixOperation=1]="MixOperation",S[S.AddOperation=2]="AddOperation"})(E||(E={}))},"./src/WebGL/constants/index.ts"(K,C,f){f.r(C),f.d(C,{BackSide:()=>S.BackSide,ClampToEdgeWrapping:()=>p.ClampToEdgeWrapping,Coloring:()=>E.Coloring,DoubleSide:()=>S.DoubleSide,FloatType:()=>p.FloatType,FrontSide:()=>S.FrontSide,LinearFilter:()=>p.LinearFilter,LinearMipMapLinearFilter:()=>p.LinearMipMapLinearFilter,NearestFilter:()=>p.NearestFilter,R32Format:()=>p.R32Format,RFormat:()=>p.RFormat,RGBAFormat:()=>p.RGBAFormat,Shading:()=>w.Shading,SpriteAlignment:()=>O.SpriteAlignment,TextureOperations:()=>x.TextureOperations,UnsignedByteType:()=>p.UnsignedByteType});var E=f("./src/WebGL/constants/Coloring.ts"),S=f("./src/WebGL/constants/Sides.ts"),w=f("./src/WebGL/constants/Shading.ts"),O=f("./src/WebGL/constants/SpriteAlignment.ts"),p=f("./src/WebGL/constants/TextureConstants.ts"),x=f("./src/WebGL/constants/TextureOperations.ts")},"./src/WebGL/core/EventDispatcher.ts"(K,C,f){f.r(C),f.d(C,{EventDispatcher:()=>E});class E{constructor(){this.listeners={}}dispatchEvent(w){var O=this.listeners[w.type];if(O!==void 0){w.target=this;for(var p=0,x=O.length;p<x;p++)O[p].call(this,w)}}removeEventListener(w,O){if(!O)this.listeners[w]=[];else{var p=this.listeners[w].indexOf(O);p!==-1&&this.listeners[w].splice(p,1)}}addEventListener(w,O){this.listeners[w]===void 0&&(this.listeners[w]=[]),this.listeners[w].indexOf(O)===-1&&this.listeners[w].push(O)}}},"./src/WebGL/core/Geometry.ts"(K,C,f){f.r(C),f.d(C,{Geometry:()=>M,GeometryGroup:()=>x,GeometryIDCount:()=>m});var E=f("./src/WebGL/materials/LineBasicMaterial.ts"),S=f("./src/WebGL/core/EventDispatcher.ts"),w=f("./src/WebGL/math/index.ts"),O=f("./src/colors.ts");const p=65535;class x{constructor(_=0){this.vertexArray=null,this.colorArray=null,this.normalArray=null,this.radiusArray=null,this.faceArray=null,this.lineArray=null,this.atomArray=Array(),this.vertices=0,this.faceidx=0,this.lineidx=0,this.__inittedArrays=!1,this.id=_}setColor(_){var g=this.vertexArray,v=this.colorArray;if(!g)throw new Error("vertex array not initialized");if(!v)throw new Error("color array not initialized");let r=O.CC.color(_);for(var e=0;e<g.length;e+=3)v[e]=r.r,v[e+1]=r.g,v[e+2]=r.b}setColors(_){var g=this.vertexArray,v=this.colorArray;if(!g)throw new Error("vertex array not initialized");if(!v)throw new Error("color array not initialized");if(g.length!=v.length){console.log("Cannot re-color geometry group due to mismatched lengths.");return}for(var r=0;r<g.length;r+=3){var e=_(g[r],g[r+1],g[r+2]);e instanceof O.Color||(e=O.CC.color(e)),v[r]=e.r,v[r+1]=e.g,v[r+2]=e.b}}getNumVertices(){return this.vertices}getVertices(){return this.vertexArray}getCentroid(){if(!this.vertexArray)throw new Error("vertex array not initialized");for(var _=new w.Vector3,g,v,r,e,t=0;t<this.vertices;++t)g=t*3,v=this.vertexArray[g],r=this.vertexArray[g+1],e=this.vertexArray[g+2],_.x+=v,_.y+=r,_.z+=e;return _.divideScalar(this.vertices),_}setNormals(){var _=this.faceArray,g=this.vertexArray,v=this.normalArray;if(!(!this.vertices||!this.faceidx)){if(!_)throw new Error("face array not initialized");if(!g)throw new Error("vertex array not initialized");if(!v)throw new Error("normal array not initialized");for(var r,e,t,n,o,h,d,i=0;i<_.length/3;++i)r=_[i*3]*3,e=_[i*3+1]*3,t=_[i*3+2]*3,n=new w.Vector3(g[r],g[r+1],g[r+2]),o=new w.Vector3(g[e],g[e+1],g[e+2]),h=new w.Vector3(g[t],g[t+1],g[t+2]),n.subVectors(n,o),h.subVectors(h,o),h.cross(n),d=h,d.normalize(),v[r]+=d.x,v[e]+=d.x,v[t]+=d.x,v[r+1]+=d.y,v[e+1]+=d.y,v[t+1]+=d.y,v[r+2]+=d.z,v[e+2]+=d.z,v[t+2]+=d.z}}setLineIndices(){if(this.faceidx&&!(this.lineArray&&this.lineArray.length==this.faceidx*2&&this.lineidx==this.faceidx*2)){var _=this.faceArray,g=this.lineArray=new Uint16Array(this.faceidx*2);if(this.lineidx=this.faceidx*2,!_)throw new Error("face array not initialized");for(var v=0;v<this.faceidx/3;++v){var r=v*3,e=r*2,t=_[r],n=_[r+1],o=_[r+2];g[e]=t,g[e+1]=n,g[e+2]=t,g[e+3]=o,g[e+4]=n,g[e+5]=o}}}vrml(_,g){var v,r,e,t,n,o,h,d,i,s,a,c,u,A,L,D,R,P,z="";if(z+=_+`Shape {
`+_+` appearance Appearance {
`+_+`  material Material {
`+_+"   diffuseColor "+((v=g==null?void 0:g.color)===null||v===void 0?void 0:v.r)+" "+((r=g==null?void 0:g.color)===null||r===void 0?void 0:r.g)+" "+((e=g==null?void 0:g.color)===null||e===void 0?void 0:e.b)+`
`,g.wireframe&&this.colorArray){let B=this.colorArray;z+=_+"    emissiveColor "+B[0]+" "+B[1]+" "+B[2]+`
`}g!=null&&g.transparent&&(z+=_+"   transparency "+(1-g.opacity)+`
`),z+=_+`  }
`,z+=_+` }
`;var F=_;if(_+=" ",g instanceof E.LineBasicMaterial||g.wireframe){z+=_+`geometry IndexedLineSet {
`+_+` colorPerVertex TRUE
`+_+` coord Coordinate {
`+_+`  point [
`;let B,U,W;for(let I=0;I<this.vertices;++I){let V=I*3;B=(t=this.vertexArray)===null||t===void 0?void 0:t[V],U=(n=this.vertexArray)===null||n===void 0?void 0:n[V+1],W=(o=this.vertexArray)===null||o===void 0?void 0:o[V+2],z+=_+"   "+B+" "+U+" "+W+`,
`}if(z+=_+`  ]
`,z+=_+` }
`,this.colorArray&&!g.wireframe){z+=_+` color Color {
`+_+`  color [
`;for(let I=0;I<this.vertices;++I){let V=I*3;B=this.colorArray[V],U=this.colorArray[V+1],W=this.colorArray[V+2],z+=_+"   "+B+" "+U+" "+W+`,
`}z+=_+`  ]
`,z+=_+` }
`}if(z+=_+` coordIndex [
`,g.wireframe&&this.faceArray)for(let I=0;I<this.faceidx;I+=3)B=(h=this.faceArray)===null||h===void 0?void 0:h[I],U=(d=this.faceArray)===null||d===void 0?void 0:d[I+1],W=(i=this.faceArray)===null||i===void 0?void 0:i[I+2],z+=_+"  "+B+", "+U+", "+W+`, -1,
`;else for(let I=0;I<this.vertices-1;I+=2)z+=_+"  "+I+", "+(I+1)+`, -1,
`;z+=_+` ]
`,z+=_+`}
`}else{z+=_+`geometry IndexedFaceSet {
`+_+` colorPerVertex TRUE
`+_+` normalPerVertex TRUE
`+_+` solid FALSE
`,z+=_+` coord Coordinate {
`+_+`  point [
`;let B,U,W;for(let I=0;I<this.vertices;++I){let V=I*3;B=(s=this.vertexArray)===null||s===void 0?void 0:s[V],U=(a=this.vertexArray)===null||a===void 0?void 0:a[V+1],W=(c=this.vertexArray)===null||c===void 0?void 0:c[V+2],z+=_+"   "+B+" "+U+" "+W+`,
`}z+=_+`  ]
`,z+=_+` }
`,z+=_+` normal Normal {
`+_+`  vector [
`;for(let I=0;I<this.vertices;++I){let V=I*3;B=(u=this.normalArray)===null||u===void 0?void 0:u[V],U=(A=this.normalArray)===null||A===void 0?void 0:A[V+1],W=(L=this.normalArray)===null||L===void 0?void 0:L[V+2],z+=_+"   "+B+" "+U+" "+W+`,
`}if(z+=_+`  ]
`,z+=_+` }
`,this.colorArray){z+=_+` color Color {
`+_+`  color [
`;for(let I=0;I<this.vertices;++I){let V=I*3;B=this.colorArray[V],U=this.colorArray[V+1],W=this.colorArray[V+2],z+=_+"   "+B+" "+U+" "+W+`,
`}z+=_+`  ]
`,z+=_+` }
`}z+=_+` coordIndex [
`;for(let I=0;I<this.faceidx;I+=3)B=(D=this.faceArray)===null||D===void 0?void 0:D[I],U=(R=this.faceArray)===null||R===void 0?void 0:R[I+1],W=(P=this.faceArray)===null||P===void 0?void 0:P[I+2],z+=_+"  "+B+", "+U+", "+W+`, -1,
`;z+=_+` ]
`,z+=_+`}
`}return z+=F+"}",z}truncateArrayBuffers(_=!0,g=!1){var v=this.vertexArray,r=this.colorArray,e=this.normalArray,t=this.faceArray,n=this.lineArray,o=this.radiusArray;this.vertexArray=(v==null?void 0:v.subarray(0,this.vertices*3))||null,this.colorArray=(r==null?void 0:r.subarray(0,this.vertices*3))||null,_?(this.normalArray=(e==null?void 0:e.subarray(0,this.vertices*3))||null,this.faceArray=(t==null?void 0:t.subarray(0,this.faceidx))||null,this.lineidx>0?this.lineArray=(n==null?void 0:n.subarray(0,this.lineidx))||null:this.lineArray=new Uint16Array(0)):(this.normalArray=new Float32Array(0),this.faceArray=new Uint16Array(0),this.lineArray=new Uint16Array(0)),o&&(this.radiusArray=o.subarray(0,this.vertices)),g&&(this.normalArray&&(this.normalArray=new Float32Array(this.normalArray)),this.faceArray&&(this.faceArray=new Uint16Array(this.faceArray)),this.lineArray&&(this.lineArray=new Uint16Array(this.lineArray)),this.vertexArray&&(this.vertexArray=new Float32Array(this.vertexArray)),this.colorArray&&(this.colorArray=new Float32Array(this.colorArray)),this.radiusArray&&(this.radiusArray=new Float32Array(this.radiusArray))),this.__inittedArrays=!0}}class M extends S.EventDispatcher{constructor(_=!1,g=!1,v=!1){super(),this.name="",this.hasTangents=!1,this.dynamic=!0,this.verticesNeedUpdate=!1,this.elementsNeedUpdate=!1,this.normalsNeedUpdate=!1,this.colorsNeedUpdate=!1,this.buffersNeedUpdate=!1,this.imposter=!1,this.instanced=!1,this.geometryGroups=[],this.groups=0,this.id=m++,this.mesh=_,this.radii=g,this.offset=v}updateGeoGroup(_=0){var g,v=this.groups>0?this.geometryGroups[this.groups-1]:null;return(!v||v.vertices+_>(((g=v==null?void 0:v.vertexArray)===null||g===void 0?void 0:g.length)||0)/3)&&(v=this.addGeoGroup()),v}vrml(_,g){for(var v="",r=this.geometryGroups.length,e=0;e<r;e++){var t=this.geometryGroups[e];v+=t.vrml(_,g)+`,
`}return v}addGeoGroup(){var _=new x(this.geometryGroups.length);return this.geometryGroups.push(_),this.groups=this.geometryGroups.length,_.vertexArray=new Float32Array(p*3),_.colorArray=new Float32Array(p*3),this.mesh&&(_.normalArray=new Float32Array(p*3),_.faceArray=new Uint16Array(p*6),_.lineArray=new Uint16Array(p*6)),this.radii&&(_.radiusArray=new Float32Array(p)),_.useOffset=this.offset,_}setUpNormals(..._){for(var g=0;g<this.groups;g++){var v=this.geometryGroups[g];v.setNormals(..._)}}setColors(..._){for(var g=this.geometryGroups.length,v=0;v<g;v++){var r=this.geometryGroups[v];r.setColors(..._)}}setColor(..._){let g=this.geometryGroups.length;for(var v=0;v<g;v++){var r=this.geometryGroups[v];r.setColor(..._)}}setUpWireframe(..._){let g=this.geometryGroups.length;for(var v=0;v<g;v++){var r=this.geometryGroups[v];r.setLineIndices(..._)}}initTypedArrays(){for(var _=0;_<this.groups;_++){var g=this.geometryGroups[_];g.__inittedArrays!==!0&&g.truncateArrayBuffers(this.mesh,!1)}}dispose(){this.dispatchEvent({type:"dispose"})}get vertices(){for(var _=0,g=0;g<this.groups;g++)_+=this.geometryGroups[g].vertices;return _}}let m=0},"./src/WebGL/core/Object3D.ts"(K,C,f){f.r(C),f.d(C,{Light:()=>x,Object3D:()=>O,Object3DIDCount:()=>w,Scene:()=>p});var E=f("./src/WebGL/math/index.ts"),S=f("./src/colors.ts");let w=0;class O{constructor(){this.id=w++,this.name="",this.children=[],this.position=new E.Vector3,this.rotation=new E.Vector3,this.matrix=new E.Matrix4,this.matrixWorld=new E.Matrix4,this.quaternion=new E.Quaternion,this.eulerOrder="XYZ",this.up=new E.Vector3(0,1,0),this.scale=new E.Vector3(1,1,1),this.matrixAutoUpdate=!0,this.matrixWorldNeedsUpdate=!0,this.rotationAutoUpdate=!0,this.useQuaternion=!1,this.visible=!0}lookAt(m){this.matrix.lookAt(m,this.position,this.up),this.rotationAutoUpdate&&(this.useQuaternion===!0?console.error("Unimplemented math operation."):this.rotation instanceof E.Vector3&&this.rotation.setEulerFromRotationMatrix(this.matrix,this.eulerOrder))}add(m){if(m===this){console.error("Can't add $3Dmol.Object3D to itself");return}m.parent=this,this.children.push(m);for(var b=this;b.parent!==void 0;)b=b.parent;b!==void 0&&b instanceof p&&b.__addObject(m)}remove(m){var b=this.children.indexOf(m);if(b!==-1){m.parent=void 0,this.children.splice(b,1);for(var _=this;_.parent!==void 0;)_=_.parent;_!==void 0&&_ instanceof p&&_.__removeObject(m)}}vrml(m){m||(m=" ");var b=2*Math.atan2(this.quaternion.lengthxyz(),this.quaternion.w),_=0,g=0,v=0;if(b!=0){let t=Math.sin(b/2);_=this.quaternion.x/t,g=this.quaternion.y/t,v=this.quaternion.z/t}var r=m+`Transform {
`+m+" center "+this.position.x+" "+this.position.y+" "+this.position.z+`
`+m+" rotation "+_+" "+g+" "+v+" "+b+`
`+m+` children [
`;this.geometry&&(r+=this.geometry.vrml(m,this.material));for(var e=0;e<this.children.length;e++)r+=this.children[e].vrml(m+" ")+`,
`;return r+=` ]
`,r+="}",r}updateMatrix(){this.matrix.setPosition(this.position),this.useQuaternion===!1&&this.rotation instanceof E.Vector3?this.matrix.setRotationFromEuler(this.rotation,this.eulerOrder):this.matrix.setRotationFromQuaternion(this.quaternion),(this.scale.x!==1||this.scale.y!==1||this.scale.z!==1)&&this.matrix.scale(this.scale),this.matrixWorldNeedsUpdate=!0}updateMatrixWorld(m){this.matrixAutoUpdate===!0&&this.updateMatrix(),(this.matrixWorldNeedsUpdate===!0||m===!0)&&(this.parent===void 0?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix)),this.matrixWorldNeedsUpdate=!1;for(var b=0;b<this.children.length;b++)this.children[b].updateMatrixWorld(!0)}clone(m){m===void 0&&(m=new O),m.name=this.name,m.up.copy(this.up),m.position.copy(this.position),m.rotation instanceof E.Vector3&&this.rotation instanceof E.Vector3?m.rotation.copy(this.rotation):m.rotation=this.rotation,m.eulerOrder=this.eulerOrder,m.scale.copy(this.scale),m.rotationAutoUpdate=this.rotationAutoUpdate,m.matrix.copy(this.matrix),m.matrixWorld.copy(this.matrixWorld),m.quaternion.copy(this.quaternion),m.matrixAutoUpdate=this.matrixAutoUpdate,m.matrixWorldNeedsUpdate=this.matrixWorldNeedsUpdate,m.useQuaternion=this.useQuaternion,m.visible=this.visible;for(var b=0;b<this.children.length;b++){var _=this.children[b];m.add(_.clone())}return m}setVisible(m){this.visible=m;for(var b=0;b<this.children.length;b++){var _=this.children[b];_.setVisible(m)}}}class p extends O{constructor(){super(...arguments),this.fog=null,this.overrideMaterial=null,this.matrixAutoUpdate=!1,this.__objects=[],this.__lights=[],this.__objectsAdded=[],this.__objectsRemoved=[]}__addObject(m){if(m instanceof x)this.__lights.indexOf(m)===-1&&this.__lights.push(m),m.target&&m.target.parent===void 0&&this.add(m.target);else if(this.__objects.indexOf(m)===-1){this.__objects.push(m),this.__objectsAdded.push(m);var b=this.__objectsRemoved.indexOf(m);b!==-1&&this.__objectsRemoved.splice(b,1)}for(var _=0;_<m.children.length;_++)this.__addObject(m.children[_])}__removeObject(m){var b;if(m instanceof x)b=this.__lights.indexOf(m),b!==-1&&this.__lights.splice(b,1);else if(b=this.__objects.indexOf(m),b!==-1){this.__objects.splice(b,1),this.__objectsRemoved.push(m);var _=this.__objectsAdded.indexOf(m);_!==-1&&this.__objectsAdded.splice(b,1)}for(var g=0;g<m.children.length;g++)this.__removeObject(m.children[g])}}class x extends O{constructor(m,b=1){super(),this.position=new E.Vector3(0,1,0),this.target=new O,this.castShadow=!1,this.onlyShadow=!1,this.color=new S.Color(m),this.intensity=b}}},"./src/WebGL/core/Projector.ts"(K,C,f){f.r(C),f.d(C,{Projector:()=>w});var E=f("./src/WebGL/math/index.ts");const S=new E.Matrix4;class w{static unprojectVector(p,x){return x.projectionMatrixInverse.getInverse(x.projectionMatrix),S.multiplyMatrices(x.matrixWorld,x.projectionMatrixInverse),p.applyProjection(S)}static projectVector(p,x){return x.matrixWorldInverse.getInverse(x.matrixWorld),S.multiplyMatrices(x.projectionMatrix,x.matrixWorldInverse),p.applyProjection(S)}projectVector(p,x){return w.projectVector(p,x)}unprojectVector(p,x){return w.unprojectVector(p,x)}}},"./src/WebGL/core/Raycaster.ts"(K,C,f){f.r(C),f.d(C,{Raycaster:()=>p,intersectObject:()=>t});var E=f("./src/WebGL/math/index.ts"),S=f("./src/WebGL/shapes/index.ts");const w=(n,o)=>n.distance-o.distance,O=new E.Matrix4;class p{constructor(o,h,d,i){this.precision=1e-4,this.linePrecision=.2,this.ray=new E.Ray(o,h),this.ray.direction.lengthSq()>0&&this.ray.direction.normalize(),this.near=i||0,this.far=d||1/0}set(o,h){this.ray.set(o,h)}setFromCamera(o,h){h.ortho?(this.ray.origin.set(o.x,o.y,(h.near+h.far)/(h.near-h.far)).unproject(h),this.ray.direction.set(0,0,-1).transformDirection(h.matrixWorld)):(this.ray.origin.setFromMatrixPosition(h.matrixWorld),this.ray.direction.set(o.x,o.y,o.z),h.projectionMatrixInverse.getInverse(h.projectionMatrix),O.multiplyMatrices(h.matrixWorld,h.projectionMatrixInverse),this.ray.direction.applyProjection(O),this.ray.direction.sub(this.ray.origin).normalize())}intersectObjects(o,h){for(var d=[],i=0,s=h.length;i<s;i++)t(o,h[i],this,d);return d.sort(w),d}}const x=n=>Math.min(Math.max(n,-1),1);var M=new S.Sphere,m=new S.Cylinder,b=new S.Triangle,_=new E.Vector3,g=new E.Vector3,v=new E.Vector3,r=new E.Vector3,e=new E.Vector3;function t(n,o,h,d){if(e.getPositionFromMatrix(n.matrixWorld),o.intersectionShape===void 0||o.hidden)return d;var i=o.intersectionShape,s=h.linePrecision;s*=n.matrixWorld.getMaxScaleOnAxis();var a=s*s;if(o.boundingSphere!==void 0&&o.boundingSphere instanceof S.Sphere&&(M.copy(o.boundingSphere),M.applyMatrix4(n.matrixWorld),!h.ray.isIntersectionSphere(M)))return d;var c,u,A,L,D,R,P,z,F,B,U,W,I,V;for(c=0,u=i.triangle.length;c<u;c++)if(i.triangle[c]instanceof S.Triangle){if(b.copy(i.triangle[c]),b.applyMatrix4(n.matrixWorld),A=b.getNormal(),L=h.ray.direction.dot(A),L>=0||(_.subVectors(b.a,h.ray.origin),P=A.dot(_)/L,P<0))continue;g.copy(h.ray.direction).multiplyScalar(P).add(h.ray.origin),g.sub(b.a),v.copy(b.b).sub(b.a),r.copy(b.c).sub(b.a);var ee=v.dot(r),te=v.lengthSq(),ae=r.lengthSq();if(W=(te*g.dot(r)-ee*g.dot(v))/(te*ae-ee*ee),W<0||W>1||(U=(g.dot(v)-W*ee)/te,U<0||U>1||U+W>1))continue;d.push({clickable:o,distance:P})}for(c=0,u=i.cylinder.length;c<u;c++)if(i.cylinder[c]instanceof S.Cylinder){if(m.copy(i.cylinder[c]),m.applyMatrix4(n.matrixWorld),_.subVectors(m.c1,h.ray.origin),D=_.dot(m.direction),R=_.dot(h.ray.direction),L=x(h.ray.direction.dot(m.direction)),F=1-L*L,F===0)continue;I=(L*R-D)/F,V=(R-L*D)/F,g.copy(m.direction).multiplyScalar(I).add(m.c1),v.copy(h.ray.direction).multiplyScalar(V).add(h.ray.origin),z=r.subVectors(g,v).lengthSq();var re=m.radius*m.radius;if(z<=re){if(B=(L*D-R)*(L*D-R)-F*(_.lengthSq()-D*D-re),B<=0?W=P=Math.sqrt(z):W=P=(R-L*D-Math.sqrt(B))/F,U=L*W-D,U<0||U*U>m.lengthSq()||W<0)continue;d.push({clickable:o,distance:P})}}for(c=0,u=i.line.length;c<u;c+=2){g.copy(i.line[c]),g.applyMatrix4(n.matrixWorld),v.copy(i.line[c+1]),v.applyMatrix4(n.matrixWorld),r.subVectors(v,g);var fe=r.lengthSq();r.normalize(),_.subVectors(g,h.ray.origin);var q=_.dot(r);R=_.dot(h.ray.direction),L=x(h.ray.direction.dot(r)),F=1-L*L,F!==0&&(I=(L*R-q)/F,V=(R-L*q)/F,g.add(r.multiplyScalar(I)),v.copy(h.ray.direction).multiplyScalar(V).add(h.ray.origin),z=r.subVectors(v,g).lengthSq(),z<a&&I*I<fe&&d.push({clickable:o,distance:V}))}for(c=0,u=i.sphere.length;c<u;c++)if(i.sphere[c]instanceof S.Sphere&&(M.copy(i.sphere[c]),M.applyMatrix4(n.matrixWorld),h.ray.isIntersectionSphere(M))){g.subVectors(M.center,h.ray.origin);var oe=g.dot(h.ray.direction);if(B=oe*oe-(g.lengthSq()-M.radius*M.radius),oe<0)return d;B<=0?P=oe:P=oe-Math.sqrt(B),d.push({clickable:o,distance:P})}return d}},"./src/WebGL/core/Texture.ts"(K,C,f){f.r(C),f.d(C,{Texture:()=>p,TextureIdCount:()=>x});var E=f("./src/WebGL/constants/TextureConstants.ts"),S=f("./src/WebGL/math/index.ts"),w=f("./src/WebGL/core/EventDispatcher.ts"),O=f("./src/WebGL/core/UVMapping.ts");class p extends w.EventDispatcher{constructor(m,b){super(),this.id=x++,this.name="",this.image=m,this.mapping=new O.UVMapping,this.wrapS=E.ClampToEdgeWrapping,this.wrapT=E.ClampToEdgeWrapping,this.anisotropy=1,b?(this.format=E.RFormat,this.type=E.FloatType,this.premultiplyAlpha=!1,this.flipY=!1,this.unpackAlignment=1,this.magFilter=E.NearestFilter,this.minFilter=E.NearestFilter):(this.format=E.RGBAFormat,this.type=E.UnsignedByteType,this.offset=new S.Vector2(0,0),this.repeat=new S.Vector2(1,1),this.premultiplyAlpha=!1,this.flipY=!0,this.unpackAlignment=4,this.magFilter=E.LinearFilter,this.minFilter=E.LinearMipMapLinearFilter),this.needsUpdate=!1,this.onUpdate=null}clone(m=new p){return m.image=this.image,m.mapping=this.mapping,m.wrapS=this.wrapS,m.wrapT=this.wrapT,m.magFilter=this.magFilter,m.minFilter=this.minFilter,m.anisotropy=this.anisotropy,m.format=this.format,m.type=this.type,m.offset.copy(this.offset),m.repeat.copy(this.repeat),m.premultiplyAlpha=this.premultiplyAlpha,m.flipY=this.flipY,m.unpackAlignment=this.unpackAlignment,m}dispose(){this.dispatchEvent({type:"dispose"})}}let x=0},"./src/WebGL/core/UVMapping.ts"(K,C,f){f.r(C),f.d(C,{UVMapping:()=>E});class E{}},"./src/WebGL/core/index.ts"(K,C,f){f.r(C),f.d(C,{EventDispatcher:()=>E.EventDispatcher,Geometry:()=>S.Geometry,GeometryGroup:()=>S.GeometryGroup,GeometryIDCount:()=>S.GeometryIDCount,Light:()=>w.Light,Object3D:()=>w.Object3D,Object3DIDCount:()=>w.Object3DIDCount,Projector:()=>O.Projector,Raycaster:()=>p.Raycaster,Scene:()=>w.Scene,Texture:()=>x.Texture,TextureIdCount:()=>x.TextureIdCount,UVMapping:()=>M.UVMapping,intersectObject:()=>p.intersectObject});var E=f("./src/WebGL/core/EventDispatcher.ts"),S=f("./src/WebGL/core/Geometry.ts"),w=f("./src/WebGL/core/Object3D.ts"),O=f("./src/WebGL/core/Projector.ts"),p=f("./src/WebGL/core/Raycaster.ts"),x=f("./src/WebGL/core/Texture.ts"),M=f("./src/WebGL/core/UVMapping.ts")},"./src/WebGL/index.ts"(K,C,f){f.r(C),f.d(C,{BackSide:()=>E.BackSide,Camera:()=>m.Camera,ClampToEdgeWrapping:()=>E.ClampToEdgeWrapping,Coloring:()=>E.Coloring,Cylinder:()=>M.Cylinder,DoubleSide:()=>E.DoubleSide,EventDispatcher:()=>S.EventDispatcher,FloatType:()=>E.FloatType,Fog:()=>b.Fog,FrontSide:()=>E.FrontSide,Geometry:()=>S.Geometry,GeometryGroup:()=>S.GeometryGroup,GeometryIDCount:()=>S.GeometryIDCount,ImposterMaterial:()=>w.ImposterMaterial,InstancedMaterial:()=>w.InstancedMaterial,Light:()=>S.Light,Line:()=>p.Line,LineBasicMaterial:()=>w.LineBasicMaterial,LineStyle:()=>p.LineStyle,LinearFilter:()=>E.LinearFilter,LinearMipMapLinearFilter:()=>E.LinearMipMapLinearFilter,Material:()=>w.Material,MaterialIdCount:()=>w.MaterialIdCount,Matrix3:()=>O.Matrix3,Matrix4:()=>O.Matrix4,Mesh:()=>p.Mesh,MeshDoubleLambertMaterial:()=>w.MeshDoubleLambertMaterial,MeshLambertMaterial:()=>w.MeshLambertMaterial,MeshOutlineMaterial:()=>w.MeshOutlineMaterial,NearestFilter:()=>E.NearestFilter,Object3D:()=>S.Object3D,Object3DIDCount:()=>S.Object3DIDCount,Projector:()=>S.Projector,Quaternion:()=>O.Quaternion,R32Format:()=>E.R32Format,RFormat:()=>E.RFormat,RGBAFormat:()=>E.RGBAFormat,Ray:()=>O.Ray,Raycaster:()=>S.Raycaster,Renderer:()=>_.Renderer,Scene:()=>S.Scene,ShaderLib:()=>x.ShaderLib,ShaderUtils:()=>x.ShaderUtils,Shading:()=>E.Shading,Sphere:()=>M.Sphere,SphereImposterMaterial:()=>w.SphereImposterMaterial,SphereImposterOutlineMaterial:()=>w.SphereImposterOutlineMaterial,Sprite:()=>p.Sprite,SpriteAlignment:()=>E.SpriteAlignment,SpriteMaterial:()=>w.SpriteMaterial,SpritePlugin:()=>g.SpritePlugin,StickImposterMaterial:()=>w.StickImposterMaterial,StickImposterOutlineMaterial:()=>w.StickImposterOutlineMaterial,Texture:()=>S.Texture,TextureIdCount:()=>S.TextureIdCount,TextureOperations:()=>E.TextureOperations,Triangle:()=>M.Triangle,UVMapping:()=>S.UVMapping,UnsignedByteType:()=>E.UnsignedByteType,Vector2:()=>O.Vector2,Vector3:()=>O.Vector3,VolumetricMaterial:()=>w.VolumetricMaterial,basic:()=>x.basic,clamp:()=>O.clamp,clone:()=>x.clone,conversionMatrix3:()=>O.conversionMatrix3,degToRad:()=>O.degToRad,instanced:()=>x.instanced,intersectObject:()=>S.intersectObject,lambert:()=>x.lambert,lambertdouble:()=>x.lambertdouble,outline:()=>x.outline,screen:()=>x.screen,screenaa:()=>x.screenaa,sphereimposter:()=>x.sphereimposter,sphereimposteroutline:()=>x.sphereimposteroutline,sprite:()=>x.sprite,stickimposter:()=>x.stickimposter,stickimposteroutline:()=>x.stickimposteroutline,volumetric:()=>x.volumetric});var E=f("./src/WebGL/constants/index.ts"),S=f("./src/WebGL/core/index.ts"),w=f("./src/WebGL/materials/index.ts"),O=f("./src/WebGL/math/index.ts"),p=f("./src/WebGL/objects/index.ts"),x=f("./src/WebGL/shaders/index.ts"),M=f("./src/WebGL/shapes/index.ts"),m=f("./src/WebGL/Camera.ts"),b=f("./src/WebGL/Fog.ts"),_=f("./src/WebGL/Renderer.ts"),g=f("./src/WebGL/SpritePlugin.ts")},"./src/WebGL/materials/ImposterMaterial.ts"(K,C,f){f.r(C),f.d(C,{ImposterMaterial:()=>x});var E=f("./src/WebGL/constants/Coloring.ts"),S=f("./src/WebGL/constants/Shading.ts"),w=f("./src/colors.ts"),O=f("./src/WebGL/math/index.ts"),p=f("./src/WebGL/materials/Material.ts");class x extends p.Material{constructor(m){super(),this.color=new w.Color(16777215),this.ambient=new w.Color(1048575),this.emissive=new w.Color(0),this.imposter=!0,this.wrapAround=!1,this.wrapRGB=new O.Vector3(1,1,1),this.map=void 0,this.lightMap=null,this.specularMap=null,this.envMap=null,this.reflectivity=1,this.refractionRatio=.98,this.fog=!0,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.shading=S.Shading.SmoothShading,this.shaderID=null,this.vertexColors=E.Coloring.NoColors,this.skinning=!1,this.setValues(m)}clone(m=new x){return super.clone.call(this,m),m.color.copy(this.color),m.ambient.copy(this.ambient),m.emissive.copy(this.emissive),m.wrapAround=this.wrapAround,m.wrapRGB.copy(this.wrapRGB),m.map=this.map,m.lightMap=this.lightMap,m.specularMap=this.specularMap,m.envMap=this.envMap,m.combine=this.combine,m.reflectivity=this.reflectivity,m.refractionRatio=this.refractionRatio,m.fog=this.fog,m.shading=this.shading,m.shaderID=this.shaderID,m.vertexColors=this.vertexColors,m.skinning=this.skinning,m.morphTargets=this.morphTargets,m.morphNormals=this.morphNormals,m}}},"./src/WebGL/materials/InstancedMaterial.ts"(K,C,f){f.r(C),f.d(C,{InstancedMaterial:()=>x});var E=f("./src/WebGL/constants/Coloring.ts"),S=f("./src/WebGL/constants/Shading.ts"),w=f("./src/colors.ts"),O=f("./src/WebGL/math/index.ts"),p=f("./src/WebGL/materials/Material.ts");class x extends p.Material{constructor(m){super(),this.color=new w.Color(16777215),this.ambient=new w.Color(1048575),this.emissive=new w.Color(0),this.wrapAround=!1,this.wrapRGB=new O.Vector3(1,1,1),this.map=void 0,this.lightMap=null,this.specularMap=null,this.envMap=null,this.reflectivity=1,this.refractionRatio=.98,this.fog=!0,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.shading=S.Shading.SmoothShading,this.shaderID="instanced",this.vertexColors=E.Coloring.NoColors,this.skinning=!1,this.sphere=null,this.setValues(m)}clone(m=new x){return super.clone.call(this,m),m.color.copy(this.color),m.ambient.copy(this.ambient),m.emissive.copy(this.emissive),m.wrapAround=this.wrapAround,m.wrapRGB.copy(this.wrapRGB),m.map=this.map,m.lightMap=this.lightMap,m.specularMap=this.specularMap,m.envMap=this.envMap,m.combine=this.combine,m.reflectivity=this.reflectivity,m.refractionRatio=this.refractionRatio,m.fog=this.fog,m.shading=this.shading,m.shaderID=this.shaderID,m.vertexColors=this.vertexColors,m.skinning=this.skinning,m.morphTargets=this.morphTargets,m.morphNormals=this.morphNormals,m.sphere=this.sphere,m}}},"./src/WebGL/materials/LineBasicMaterial.ts"(K,C,f){f.r(C),f.d(C,{LineBasicMaterial:()=>w});var E=f("./src/colors.ts"),S=f("./src/WebGL/materials/Material.ts");class w extends S.Material{constructor(p){super(),this.color=new E.Color(16777215),this.linewidth=1,this.linecap="round",this.linejoin="round",this.vertexColors=!1,this.fog=!0,this.shaderID="basic",this.setValues(p)}clone(p=new w){return super.clone.call(this,p),p.color.copy(this.color),p}}},"./src/WebGL/materials/Material.ts"(K,C,f){f.r(C),f.d(C,{Material:()=>p,MaterialIdCount:()=>x});var E=f("./src/WebGL/constants/Sides.ts"),S=f("./src/WebGL/core/index.ts"),w=f("./src/WebGL/math/index.ts"),O=f("./src/colors.ts");class p extends S.EventDispatcher{constructor(){super(...arguments),this.id=x++,this.name="",this.side=E.FrontSide,this.opacity=1,this.transparent=!1,this.depthTest=!0,this.depthWrite=!0,this.polygonOffset=!1,this.polygonOffsetFactor=0,this.polygonOffsetUnits=0,this.alphaTest=0,this.visible=!0,this.needsUpdate=!0,this.outline=!1,this.wireframe=!1,this.shaded=!1}setValues(m={}){if(m!==void 0)for(var b in m){var _=m[b];if(_===void 0){console.warn("$3Dmol.Material: '"+b+"' parameter is undefined.");continue}if(b in this){var g=this[b];g instanceof O.Color&&_ instanceof O.Color?g.copy(_):g instanceof O.Color?g.set(_):g instanceof w.Vector3&&_ instanceof w.Vector3?g.copy(_):this[b]=_}}}clone(m=new p){return m.name=this.name,m.side=this.side,m.opacity=this.opacity,m.transparent=this.transparent,m.depthTest=this.depthTest,m.depthWrite=this.depthWrite,m.polygonOffset=this.polygonOffset,m.polygonOffsetFactor=this.polygonOffsetFactor,m.polygonOffsetUnits=this.polygonOffsetUnits,m.alphaTest=this.alphaTest,m.overdraw=this.overdraw,m.visible=this.visible,m}makeShaded(m){this.shaded=!0,this.uniforms&&(this.uniforms.shading={type:"i",value:m},this.uniforms.vWidth={type:"f",value:1},this.uniforms.vHeight={type:"f",value:1})}dispose(){this.dispatchEvent({type:"dispose"})}}let x=0},"./src/WebGL/materials/MeshDoubleLambertMaterial.ts"(K,C,f){f.r(C),f.d(C,{MeshDoubleLambertMaterial:()=>w});var E=f("./src/WebGL/constants/Sides.ts"),S=f("./src/WebGL/materials/MeshLambertMaterial.ts");class w extends S.MeshLambertMaterial{constructor(p){super(p),this.shaderID="lambertdouble",this.side=E.DoubleSide,this.outline=!1}clone(p=new w){return super.clone.call(this,p),p}}},"./src/WebGL/materials/MeshLambertMaterial.ts"(K,C,f){f.r(C),f.d(C,{MeshLambertMaterial:()=>x});var E=f("./src/WebGL/constants/Coloring.ts"),S=f("./src/WebGL/constants/Shading.ts"),w=f("./src/WebGL/materials/Material.ts"),O=f("./src/colors.ts"),p=f("./src/WebGL/math/index.ts");class x extends w.Material{constructor(m){super(),this.color=new O.Color(16777215),this.ambient=new O.Color(1048575),this.emissive=new O.Color(0),this.wrapAround=!1,this.wrapRGB=new p.Vector3(1,1,1),this.map=void 0,this.lightMap=null,this.specularMap=null,this.envMap=null,this.reflectivity=1,this.refractionRatio=.98,this.fog=!0,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.shading=S.Shading.SmoothShading,this.shaderID="lambert",this.vertexColors=E.Coloring.NoColors,this.skinning=!1,this.setValues(m)}clone(m=new x){return super.clone.call(this,m),m.color.copy(this.color),m.ambient.copy(this.ambient),m.emissive.copy(this.emissive),m.wrapAround=this.wrapAround,m.wrapRGB.copy(this.wrapRGB),m.map=this.map,m.lightMap=this.lightMap,m.specularMap=this.specularMap,m.envMap=this.envMap,m.combine=this.combine,m.reflectivity=this.reflectivity,m.refractionRatio=this.refractionRatio,m.fog=this.fog,m.shading=this.shading,m.shaderID=this.shaderID,m.vertexColors=this.vertexColors,m.skinning=this.skinning,m.morphTargets=this.morphTargets,m.morphNormals=this.morphNormals,m}}},"./src/WebGL/materials/MeshOutlineMaterial.ts"(K,C,f){f.r(C),f.d(C,{MeshOutlineMaterial:()=>w});var E=f("./src/colors.ts"),S=f("./src/WebGL/materials/Material.ts");class w extends S.Material{constructor(p){super(),p=p||{},this.fog=!0,this.shaderID="outline",this.wireframe=!1,this.outlineColor=E.CC.color(p.color||new E.Color(0,0,0)),this.outlineWidth=p.width||.1,this.outlinePushback=p.pushback||1,this.outlineMaxPixels=p.maxpixels||0}clone(p=new w){return super.clone.call(this,p),p.fog=this.fog,p.shaderID=this.shaderID,p.wireframe=this.wireframe,p.outlineColor=this.outlineColor,p.outlineWidth=this.outlineWidth,p.outlinePushback=this.outlinePushback,p.outlineMaxPixels=this.outlineMaxPixels,p}}},"./src/WebGL/materials/SphereImposterMaterial.ts"(K,C,f){f.r(C),f.d(C,{SphereImposterMaterial:()=>S});var E=f("./src/WebGL/materials/ImposterMaterial.ts");class S extends E.ImposterMaterial{constructor(O){super(O),this.shaderID="sphereimposter",this.setValues(O)}clone(O=new S){return super.clone.call(this,O),O}}},"./src/WebGL/materials/SphereImposterOutlineMaterial.ts"(K,C,f){f.r(C),f.d(C,{SphereImposterOutlineMaterial:()=>w});var E=f("./src/colors.ts"),S=f("./src/WebGL/materials/ImposterMaterial.ts");class w extends S.ImposterMaterial{constructor(p){super(p),p=p||{},this.shaderID="sphereimposteroutline",this.outlineColor=E.CC.color(p.color||new E.Color(0,0,0)),this.outlineWidth=p.width||.1,this.outlinePushback=p.pushback||1,this.outlineMaxPixels=p.maxpixels||0,this.setValues(p)}clone(p=new w){return super.clone.call(this,p),p.outlineColor=this.outlineColor,p.outlineWidth=this.outlineWidth,p.outlinePushback=this.outlinePushback,p.outlineMaxPixels=this.outlineMaxPixels,p}}},"./src/WebGL/materials/SpriteMaterial.ts"(K,C,f){f.r(C),f.d(C,{SpriteMaterial:()=>x});var E=f("./src/WebGL/constants/SpriteAlignment.ts"),S=f("./src/WebGL/core/Texture.ts"),w=f("./src/colors.ts"),O=f("./src/WebGL/math/index.ts"),p=f("./src/WebGL/materials/Material.ts");class x extends p.Material{constructor(m){super(),this.color=new w.Color(16777215),this.map=new S.Texture,this.useScreenCoordinates=!0,this.fog=!1,this.uvOffset=new O.Vector2(0,0),this.uvScale=new O.Vector2(1,1),this.depthTest=!this.useScreenCoordinates,this.sizeAttenuation=!this.useScreenCoordinates,this.screenOffset=this.screenOffset,this.scaleByViewPort=!this.sizeAttenuation,this.alignment=E.SpriteAlignment.center.clone(),this.setValues(m),m=m||{},m.depthTest===void 0&&(this.depthTest=!this.useScreenCoordinates),m.sizeAttenuation===void 0&&(this.sizeAttenuation=!this.useScreenCoordinates),m.scaleByViewPort===void 0&&(this.scaleByViewPort=!this.sizeAttenuation)}clone(m=new x){return super.clone.call(this,m),m.color.copy(this.color),m.map=this.map,m.useScreenCoordinates=this.useScreenCoordinates,m.screenOffset=this.screenOffset,m.sizeAttenuation=this.sizeAttenuation,m.scaleByViewport=this.scaleByViewPort,m.alignment.copy(this.alignment),m.uvOffset.copy(this.uvOffset),m}}},"./src/WebGL/materials/StickImposterMaterial.ts"(K,C,f){f.r(C),f.d(C,{StickImposterMaterial:()=>S});var E=f("./src/WebGL/materials/ImposterMaterial.ts");class S extends E.ImposterMaterial{constructor(O){super(O),this.shaderID="stickimposter",this.setValues(O)}clone(O=new S){return super.clone.call(this,O),O}}},"./src/WebGL/materials/StickImposterOutlineMaterial.ts"(K,C,f){f.r(C),f.d(C,{StickImposterOutlineMaterial:()=>w});var E=f("./src/colors.ts"),S=f("./src/WebGL/materials/ImposterMaterial.ts");class w extends S.ImposterMaterial{constructor(p={}){super(p),this.shaderID="stickimposteroutline",this.outlineColor=new E.Color(0,0,0),this.outlineWidth=.1,this.outlinePushback=1,this.outlineMaxPixels=0,p.color&&(this.outlineColor=E.CC.color(p.color)),p.width&&(this.outlineWidth=p.width),p.pushback&&(this.outlinePushback=p.pushback),p.maxpixels&&(this.outlineMaxPixels=p.maxpixels),this.setValues(p)}clone(p=new w){return super.clone.call(this,p),p.outlineColor=this.outlineColor,p.outlineWidth=this.outlineWidth,p.outlinePushback=this.outlinePushback,p.outlineMaxPixels=this.outlineMaxPixels,p}}},"./src/WebGL/materials/VolumetricMaterial.ts"(K,C,f){f.r(C),f.d(C,{VolumetricMaterial:()=>O});var E=f("./src/WebGL/constants/Sides.ts"),S=f("./src/colors.ts"),w=f("./src/WebGL/materials/Material.ts");class O extends w.Material{constructor(x){super(),this.transparent=!1,this.volumetric=!0,this.color=new S.Color(16777215),this.transferfn=null,this.map=void 0,this.extent=[],this.maxdepth=100,this.unit=0,this.texmatrix=null,this.transfermin=-1,this.transfermax=1,this.subsamples=5,this.shaderID="volumetric",this.side=E.FrontSide,this.setValues(x)}clone(x=new O){return super.clone.call(this,x),x.transparent=this.transparent,x.volumetric=this.volumetric,x.color=this.color,x.transferfn=this.transferfn,x.map=this.map,x.extent=this.extent,x.maxdepth=this.maxdepth,x.unit=this.unit,x.texmatrix=this.texmatrix,x.transfermin=this.transfermin,x.transfermax=this.transfermax,x.subsamples=this.subsamples,x.shaderID=this.shaderID,x.side=this.side,x}}},"./src/WebGL/materials/index.ts"(K,C,f){f.r(C),f.d(C,{ImposterMaterial:()=>E.ImposterMaterial,InstancedMaterial:()=>S.InstancedMaterial,LineBasicMaterial:()=>w.LineBasicMaterial,Material:()=>O.Material,MaterialIdCount:()=>O.MaterialIdCount,MeshDoubleLambertMaterial:()=>p.MeshDoubleLambertMaterial,MeshLambertMaterial:()=>x.MeshLambertMaterial,MeshOutlineMaterial:()=>M.MeshOutlineMaterial,SphereImposterMaterial:()=>m.SphereImposterMaterial,SphereImposterOutlineMaterial:()=>b.SphereImposterOutlineMaterial,SpriteMaterial:()=>_.SpriteMaterial,StickImposterMaterial:()=>g.StickImposterMaterial,StickImposterOutlineMaterial:()=>v.StickImposterOutlineMaterial,VolumetricMaterial:()=>r.VolumetricMaterial});var E=f("./src/WebGL/materials/ImposterMaterial.ts"),S=f("./src/WebGL/materials/InstancedMaterial.ts"),w=f("./src/WebGL/materials/LineBasicMaterial.ts"),O=f("./src/WebGL/materials/Material.ts"),p=f("./src/WebGL/materials/MeshDoubleLambertMaterial.ts"),x=f("./src/WebGL/materials/MeshLambertMaterial.ts"),M=f("./src/WebGL/materials/MeshOutlineMaterial.ts"),m=f("./src/WebGL/materials/SphereImposterMaterial.ts"),b=f("./src/WebGL/materials/SphereImposterOutlineMaterial.ts"),_=f("./src/WebGL/materials/SpriteMaterial.ts"),g=f("./src/WebGL/materials/StickImposterMaterial.ts"),v=f("./src/WebGL/materials/StickImposterOutlineMaterial.ts"),r=f("./src/WebGL/materials/VolumetricMaterial.ts")},"./src/WebGL/math/Quaternion.ts"(K,C,f){f.r(C),f.d(C,{Quaternion:()=>E});class E{constructor(w,O,p,x){this.x=w||0,this.y=O||0,this.z=p||0,this.w=x!==void 0?x:1}set(w,O,p,x){return this.x=w,this.y=O,this.z=p,this.w=x,this}copy(w){return this.x=w.x,this.y=w.y,this.z=w.z,this.w=w.w,this}conjugate(){return this.x*=-1,this.y*=-1,this.z*=-1,this}inverse(){return this.conjugate().normalize()}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)}lengthxyz(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}normalize(){let w=this.length();return w===0?(this.x=0,this.y=0,this.z=0,this.w=1):(w=1/w,this.x*=w,this.y*=w,this.z*=w,this.w*=w),this}multiply(w){return this.multiplyQuaternions(this,w)}multiplyScalar(w){return this.x*=w,this.y*=w,this.z*=w,this.w*=w,this}multiplyQuaternions(w,O){const p=w.x,x=w.y,M=w.z,m=w.w,b=O.x,_=O.y,g=O.z,v=O.w;return this.x=p*v+m*b+x*g-M*_,this.y=x*v+m*_+M*b-p*g,this.z=M*v+m*g+p*_-x*b,this.w=m*v-p*b-x*_-M*g,this}sub(w){return this.x-=w.x,this.y-=w.y,this.z-=w.z,this.w-=w.w,this}clone(){return new E(this.x,this.y,this.z,this.w)}setFromEuler(w){const O=Math.cos(w.x/2),p=Math.cos(w.y/2),x=Math.cos(w.z/2),M=Math.sin(w.x/2),m=Math.sin(w.y/2),b=Math.sin(w.z/2);return this.x=M*p*x+O*m*b,this.y=O*m*x-M*p*b,this.z=O*p*b+M*m*x,this.w=O*p*x-M*m*b,this}}},"./src/WebGL/math/Vector2.ts"(K,C,f){f.r(C),f.d(C,{Vector2:()=>E});class E{constructor(w,O){this.x=w||0,this.y=O||0}set(w,O){return this.x=w,this.y=O,this}subVectors(w,O){return this.x=w.x-O.x,this.y=w.y-O.y,this}copy(w){return this.x=w.x,this.y=w.y,this}clone(){return new E(this.x,this.y)}}},"./src/WebGL/math/index.ts"(K,C,f){f.r(C),f.d(C,{Matrix3:()=>x.Matrix3,Matrix4:()=>x.Matrix4,Quaternion:()=>E.Quaternion,Ray:()=>x.Ray,Vector2:()=>S.Vector2,Vector3:()=>x.Vector3,clamp:()=>w.clamp,conversionMatrix3:()=>O.conversionMatrix3,degToRad:()=>p.degToRad});var E=f("./src/WebGL/math/Quaternion.ts"),S=f("./src/WebGL/math/Vector2.ts"),w=f("./src/WebGL/math/utils/clamp.ts"),O=f("./src/WebGL/math/utils/conversionMatrix3.ts"),p=f("./src/WebGL/math/utils/degToRad.ts"),x=f("./src/WebGL/math/math.ts")},"./src/WebGL/math/math.ts"(K,C,f){f.r(C),f.d(C,{Matrix3:()=>_,Matrix4:()=>m,Ray:()=>g,Vector3:()=>b});var E=f("./src/WebGL/math/utils/degToRad.ts"),S=f("./src/WebGL/math/utils/clamp.ts"),w,O,p,x,M;class m{constructor(r=1,e=0,t=0,n=0,o=0,h=1,d=0,i=0,s=0,a=0,c=1,u=0,A=0,L=0,D=0,R=1){typeof r<"u"&&typeof r!="number"?this.elements=new Float32Array(r):(this.elements=new Float32Array(16),this.elements[0]=r,this.elements[4]=e,this.elements[8]=t,this.elements[12]=n,this.elements[1]=o,this.elements[5]=h,this.elements[9]=d,this.elements[13]=i,this.elements[2]=s,this.elements[6]=a,this.elements[10]=c,this.elements[14]=u,this.elements[3]=A,this.elements[7]=L,this.elements[11]=D,this.elements[15]=R)}makeScale(r,e,t){throw new Error("Method not implemented.")}set(r,e,t,n,o,h,d,i,s,a,c,u,A,L,D,R){const P=this.elements;return P[0]=r,P[4]=e,P[8]=t,P[12]=n,P[1]=o,P[5]=h,P[9]=d,P[13]=i,P[2]=s,P[6]=a,P[10]=c,P[14]=u,P[3]=A,P[7]=L,P[11]=D,P[15]=R,this}identity(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this}copy(r){const e=r.elements;return this.set(e[0],e[4],e[8],e[12],e[1],e[5],e[9],e[13],e[2],e[6],e[10],e[14],e[3],e[7],e[11],e[15]),this}matrix3FromTopLeft(){const r=this.elements;return new _(r[0],r[4],r[8],r[1],r[5],r[9],r[2],r[6],r[10])}setRotationFromEuler(r,e){const t=this.elements,{x:n,y:o,z:h}=r,d=Math.cos(n),i=Math.sin(n),s=Math.cos(o),a=Math.sin(o),c=Math.cos(h),u=Math.sin(h);if(e===void 0||e==="XYZ"){const A=d*c,L=d*u,D=i*c,R=i*u;t[0]=s*c,t[4]=-s*u,t[8]=a,t[1]=L+D*a,t[5]=A-R*a,t[9]=-i*s,t[2]=R-A*a,t[6]=D+L*a,t[10]=d*s}else console.error(`Error with matrix4 setRotationFromEuler. Order: ${e}`);return this}setRotationFromQuaternion(r){const e=this.elements,{x:t,y:n,z:o,w:h}=r,d=t+t,i=n+n,s=o+o,a=t*d,c=t*i,u=t*s,A=n*i,L=n*s,D=o*s,R=h*d,P=h*i,z=h*s;return e[0]=1-(A+D),e[4]=c-z,e[8]=u+P,e[1]=c+z,e[5]=1-(a+D),e[9]=L-R,e[2]=u-P,e[6]=L+R,e[10]=1-(a+A),this}multiplyMatrices(r,e){const t=r.elements,n=e.elements,o=this.elements,h=t[0],d=t[4],i=t[8],s=t[12],a=t[1],c=t[5],u=t[9],A=t[13],L=t[2],D=t[6],R=t[10],P=t[14],z=t[3],F=t[7],B=t[11],U=t[15],W=n[0],I=n[4],V=n[8],ee=n[12],te=n[1],ae=n[5],re=n[9],fe=n[13],q=n[2],oe=n[6],be=n[10],ge=n[14],Le=n[3],pe=n[7],J=n[11],ce=n[15];return o[0]=h*W+d*te+i*q+s*Le,o[4]=h*I+d*ae+i*oe+s*pe,o[8]=h*V+d*re+i*be+s*J,o[12]=h*ee+d*fe+i*ge+s*ce,o[1]=a*W+c*te+u*q+A*Le,o[5]=a*I+c*ae+u*oe+A*pe,o[9]=a*V+c*re+u*be+A*J,o[13]=a*ee+c*fe+u*ge+A*ce,o[2]=L*W+D*te+R*q+P*Le,o[6]=L*I+D*ae+R*oe+P*pe,o[10]=L*V+D*re+R*be+P*J,o[14]=L*ee+D*fe+R*ge+P*ce,o[3]=z*W+F*te+B*q+U*Le,o[7]=z*I+F*ae+B*oe+U*pe,o[11]=z*V+F*re+B*be+U*J,o[15]=z*ee+F*fe+B*ge+U*ce,this}multiplyScalar(r){const e=this.elements;return e[0]*=r,e[4]*=r,e[8]*=r,e[12]*=r,e[1]*=r,e[5]*=r,e[9]*=r,e[13]*=r,e[2]*=r,e[6]*=r,e[10]*=r,e[14]*=r,e[3]*=r,e[7]*=r,e[11]*=r,e[15]*=r,this}makeTranslation(r,e,t){return this.set(1,0,0,r,0,1,0,e,0,0,1,t,0,0,0,1),this}snap(r){const e=Math.pow(10,4),t=this.elements;for(let n=0;n<16;n++){const o=Math.round(t[n]);o===Math.round(t[n]*e)/e&&(t[n]=o)}return this}transpose(){const r=this.elements;let e;return e=r[1],r[1]=r[4],r[4]=e,e=r[2],r[2]=r[8],r[8]=e,e=r[6],r[6]=r[9],r[9]=e,e=r[3],r[3]=r[12],r[12]=e,e=r[7],r[7]=r[13],r[13]=e,e=r[11],r[11]=r[14],r[14]=e,this}setPosition(r){const e=this.elements;return e[12]=r.x,e[13]=r.y,e[14]=r.z,this}translate(r){const e=this.elements;return e[12]+=r.x,e[13]+=r.y,e[14]+=r.z,this}getInverse(r,e){const t=this.elements,n=r.elements,o=n[0],h=n[4],d=n[8],i=n[12],s=n[1],a=n[5],c=n[9],u=n[13],A=n[2],L=n[6],D=n[10],R=n[14],P=n[3],z=n[7],F=n[11],B=n[15];t[0]=c*R*z-u*D*z+u*L*F-a*R*F-c*L*B+a*D*B,t[4]=i*D*z-d*R*z-i*L*F+h*R*F+d*L*B-h*D*B,t[8]=d*u*z-i*c*z+i*a*F-h*u*F-d*a*B+h*c*B,t[12]=i*c*L-d*u*L-i*a*D+h*u*D+d*a*R-h*c*R,t[1]=u*D*P-c*R*P-u*A*F+s*R*F+c*A*B-s*D*B,t[5]=d*R*P-i*D*P+i*A*F-o*R*F-d*A*B+o*D*B,t[9]=i*c*P-d*u*P-i*s*F+o*u*F+d*s*B-o*c*B,t[13]=d*u*A-i*c*A+i*s*D-o*u*D-d*s*R+o*c*R,t[2]=a*R*P-u*L*P+u*A*z-s*R*z-a*A*B+s*L*B,t[6]=i*L*P-h*R*P-i*A*z+o*R*z+h*A*B-o*L*B,t[10]=h*u*P-i*a*P+i*s*z-o*u*z-h*s*B+o*a*B,t[14]=i*a*A-h*u*A-i*s*L+o*u*L+h*s*R-o*a*R,t[3]=c*L*P-a*D*P-c*A*z+s*D*z+a*A*F-s*L*F,t[7]=h*D*P-d*L*P+d*A*z-o*D*z-h*A*F+o*L*F,t[11]=d*a*P-h*c*P-d*s*z+o*c*z+h*s*F-o*a*F,t[15]=h*c*A-d*a*A+d*s*L-o*c*L-h*s*D+o*a*D;const U=o*t[0]+s*t[4]+A*t[8]+P*t[12];if(U===0){const W="Matrix4.getInverse(): can't invert matrix, determinant is 0";if(e)throw new Error(W);return console.warn(W),this.identity(),this}return this.multiplyScalar(1/U),this}isReflected(){const r=this.elements,e=r[0],t=r[4],n=r[8],o=r[1],h=r[5],d=r[9],i=r[2],s=r[6],a=r[10];return e*h*a+o*s*n+i*t*d-i*h*n-o*t*a-e*s*d<0}scale(r){const e=this.elements,{x:t}=r,{y:n}=r,{z:o}=r;return e[0]*=t,e[4]*=n,e[8]*=o,e[1]*=t,e[5]*=n,e[9]*=o,e[2]*=t,e[6]*=n,e[10]*=o,e[3]*=t,e[7]*=n,e[11]*=o,this}getMaxScaleOnAxis(){const r=this.elements,e=r[0]*r[0]+r[1]*r[1]+r[2]*r[2],t=r[4]*r[4]+r[5]*r[5]+r[6]*r[6],n=r[8]*r[8]+r[9]*r[9]+r[10]*r[10];return Math.sqrt(Math.max(e,Math.max(t,n)))}makeFrustum(r,e,t,n,o,h){const d=this.elements,i=2*o/(e-r),s=2*o/(n-t),a=(e+r)/(e-r),c=(n+t)/(n-t),u=-(h+o)/(h-o),A=-2*h*o/(h-o);return d[0]=i,d[4]=0,d[8]=a,d[12]=0,d[1]=0,d[5]=s,d[9]=c,d[13]=0,d[2]=0,d[6]=0,d[10]=u,d[14]=A,d[3]=0,d[7]=0,d[11]=-1,d[15]=0,this}makePerspective(r,e,t,n){const o=t*Math.tan((0,E.degToRad)(r*.5)),h=-o,d=h*e,i=o*e;return this.makeFrustum(d,i,h,o,t,n)}makeOrthographic(r,e,t,n,o,h){const d=this.elements,i=1/(e-r),s=1/(t-n),a=1/(h-o),c=(e+r)*i,u=(t+n)*s,A=(h+o)*a;return d[0]=2*i,d[4]=0,d[8]=0,d[12]=-c,d[1]=0,d[5]=2*s,d[9]=0,d[13]=-u,d[2]=0,d[6]=0,d[10]=-2*a,d[14]=-A,d[3]=0,d[7]=0,d[11]=0,d[15]=1,this}isEqual(r){const e=r.elements,t=this.elements;return t[0]===e[0]&&t[4]===e[4]&&t[8]===e[8]&&t[12]===e[12]&&t[1]===e[1]&&t[5]===e[5]&&t[9]===e[9]&&t[13]===e[13]&&t[2]===e[2]&&t[6]===e[6]&&t[10]===e[10]&&t[14]===e[14]&&t[3]===e[3]&&t[7]===e[7]&&t[11]===e[11]&&t[15]===e[15]}clone(){const r=this.elements;return new m(r[0],r[4],r[8],r[12],r[1],r[5],r[9],r[13],r[2],r[6],r[10],r[14],r[3],r[7],r[11],r[15])}isIdentity(){const r=this.elements;return r[0]===1&&r[4]===0&&r[8]===0&&r[12]===0&&r[1]===0&&r[5]===1&&r[9]===0&&r[13]===0&&r[2]===0&&r[6]===0&&r[10]===1&&r[14]===0&&r[3]===0&&r[7]===0&&r[11]===0&&r[15]===1}isNearlyIdentity(r){return this.clone().snap(r).isIdentity()}getScale(r){const e=this.elements;return r=r||new b,p.set(e[0],e[1],e[2]),x.set(e[4],e[5],e[6]),M.set(e[8],e[9],e[10]),r.x=p.length(),r.y=x.length(),r.z=M.length(),r}lookAt(r,e,t){const n=this.elements;return M.subVectors(r,e).normalize(),M.length()===0&&(M.z=1),p.crossVectors(t,M).normalize(),p.length()===0&&(M.x+=1e-4,p.crossVectors(t,M).normalize()),x.crossVectors(M,p),n[0]=p.x,n[4]=x.x,n[8]=M.x,n[1]=p.y,n[5]=x.y,n[9]=M.y,n[2]=p.z,n[6]=x.z,n[10]=M.z,this}compose(r,e,t){const n=this.elements;return w.identity(),w.setRotationFromQuaternion(e),O.makeScale(t.x,t.y,t.z),this.multiplyMatrices(w,O),n[12]=r.x,n[13]=r.y,n[14]=r.z,this}}w=new m,O=new m;class b{constructor(r,e,t){this.x=r||0,this.y=e||0,this.z=t||0,this.atomid=void 0}set(r,e,t){return this.x=r,this.y=e,this.z=t,this}copy(r){return this.x=r.x,this.y=r.y,this.z=r.z,this}add(r){return this.x+=r.x,this.y+=r.y,this.z+=r.z,this}addVectors(r,e){return this.x=r.x+e.x,this.y=r.y+e.y,this.z=r.z+e.z,this}multiplyVectors(r,e){return this.x=r.x*e.x,this.y=r.y*e.y,this.z=r.z*e.z,this}sub(r){return this.x-=r.x,this.y-=r.y,this.z-=r.z,this}subVectors(r,e){return this.x=r.x-e.x,this.y=r.y-e.y,this.z=r.z-e.z,this}multiplyScalar(r){return this.x*=r,this.y*=r,this.z*=r,this}divideScalar(r){return r!==0?(this.x/=r,this.y/=r,this.z/=r):(this.x=0,this.y=0,this.z=0),this}max(r){return this.x=Math.max(this.x,r.x),this.y=Math.max(this.y,r.y),this.z=Math.max(this.z,r.z),this}min(r){return this.x=Math.min(this.x,r.x),this.y=Math.min(this.y,r.y),this.z=Math.min(this.z,r.z),this}distanceTo(r){return Math.sqrt(this.distanceToSquared(r))}distanceToSquared(r){const e=this.x-r.x,t=this.y-r.y,n=this.z-r.z;return e*e+t*t+n*n}applyMatrix3(r){const{x:e}=this,{y:t}=this,{z:n}=this,o=r.elements;return this.x=o[0]*e+o[3]*t+o[6]*n,this.y=o[1]*e+o[4]*t+o[7]*n,this.z=o[2]*e+o[5]*t+o[8]*n,this}applyMatrix4(r){const{x:e}=this,{y:t}=this,{z:n}=this,o=r.elements;return this.x=o[0]*e+o[4]*t+o[8]*n+o[12],this.y=o[1]*e+o[5]*t+o[9]*n+o[13],this.z=o[2]*e+o[6]*t+o[10]*n+o[14],this}applyProjection(r){const{x:e}=this,{y:t}=this,{z:n}=this,o=r.elements,h=o[3]*e+o[7]*t+o[11]*n+o[15];return this.x=(o[0]*e+o[4]*t+o[8]*n+o[12])/h,this.y=(o[1]*e+o[5]*t+o[9]*n+o[13])/h,this.z=(o[2]*e+o[6]*t+o[10]*n+o[14])/h,this}applyQuaternion(r){const{x:e}=this,{y:t}=this,{z:n}=this,o=r.x,h=r.y,d=r.z,i=r.w,s={};s.x=2*(t*d-n*h),s.y=2*(n*o-e*d),s.z=2*(e*h-t*o);const a={};return a.x=s.y*d-s.z*h,a.y=s.z*o-s.x*d,a.z=s.x*h-s.y*o,this.x=e+i*s.x+a.x,this.y=t+i*s.y+a.y,this.z=n+i*s.z+a.z,this}negate(){return this.multiplyScalar(-1)}dot(r){return this.x*r.x+this.y*r.y+this.z*r.z}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z}normalize(){return this.divideScalar(this.length())}cross(r){const{x:e}=this,{y:t}=this,{z:n}=this;return this.x=t*r.z-n*r.y,this.y=n*r.x-e*r.z,this.z=e*r.y-t*r.x,this}crossVectors(r,e){return this.x=r.y*e.z-r.z*e.y,this.y=r.z*e.x-r.x*e.z,this.z=r.x*e.y-r.y*e.x,this}equals(r){return this.x==r.x&&this.y==r.y&&this.z==r.z}getPositionFromMatrix(r){return this.x=r.elements[12],this.y=r.elements[13],this.z=r.elements[14],this}setEulerFromRotationMatrix(r,e){const t=r.elements,n=t[0],o=t[4],h=t[8],d=t[5],i=t[9],s=t[6],a=t[10];return e===void 0||e==="XYZ"?(this.y=Math.asin((0,S.clamp)(h,-1,1)),Math.abs(h)<.99999?(this.x=Math.atan2(-i,a),this.z=Math.atan2(-o,n)):(this.x=Math.atan2(s,d),this.z=0)):console.error(`Error with vector's setEulerFromRotationMatrix: Unknown order: ${e}`),this}rotateAboutVector(r,e){r.normalize();const t=Math.cos(e),n=Math.sin(e),o=this.clone().multiplyScalar(t),h=r.clone().cross(this).multiplyScalar(n),d=r.clone().multiplyScalar(r.clone().dot(this)).multiplyScalar(1-t),i=o.add(h).add(d);return this.x=i.x,this.y=i.y,this.z=i.z,this}setFromMatrixPosition(r){const e=r.elements;return this.x=e[12],this.y=e[13],this.z=e[14],this}transformDirection(r){const{x:e}=this,{y:t}=this,{z:n}=this,o=r.elements;return this.x=o[0]*e+o[4]*t+o[8]*n,this.y=o[1]*e+o[5]*t+o[9]*n,this.z=o[2]*e+o[6]*t+o[10]*n,this.normalize()}clone(){return new b(this.x,this.y,this.z)}unproject(r){const e=w;return e.multiplyMatrices(r.matrixWorld,e.getInverse(r.projectionMatrix)),this.applyMatrix4(e)}}p=new b,x=new b,M=new b;class _{constructor(r=1,e=0,t=0,n=0,o=1,h=0,d=0,i=0,s=1){this.elements=new Float32Array(9),this.set(r,e,t,n,o,h,d,i,s)}set(r,e,t,n,o,h,d,i,s){const a=this.elements;return a[0]=r,a[3]=e,a[6]=t,a[1]=n,a[4]=o,a[7]=h,a[2]=d,a[5]=i,a[8]=s,this}identity(){return this.set(1,0,0,0,1,0,0,0,1),this}copy(r){const e=r.elements;this.set(e[0],e[3],e[6],e[1],e[4],e[7],e[2],e[5],e[8])}multiplyScalar(r){const e=this.elements;return e[0]*=r,e[3]*=r,e[6]*=r,e[1]*=r,e[4]*=r,e[7]*=r,e[2]*=r,e[5]*=r,e[8]*=r,this}getInverse3(r){const e=r.elements,t=this.elements;t[0]=e[4]*e[8]-e[5]*e[7],t[3]=e[6]*e[5]-e[3]*e[8],t[6]=e[3]*e[7]-e[6]*e[4],t[1]=e[7]*e[2]-e[1]*e[8],t[4]=e[0]*e[8]-e[6]*e[2],t[7]=e[1]*e[6]-e[0]*e[7],t[2]=e[1]*e[5]-e[2]*e[4],t[5]=e[2]*e[3]-e[0]*e[5],t[8]=e[0]*e[4]-e[1]*e[3];const n=e[0]*t[0]+e[3]*t[1]+e[6]*t[2];return this.multiplyScalar(1/n),this}getInverse(r,e){const t=r.elements,n=this.elements;n[0]=t[10]*t[5]-t[6]*t[9],n[1]=-t[10]*t[1]+t[2]*t[9],n[2]=t[6]*t[1]-t[2]*t[5],n[3]=-t[10]*t[4]+t[6]*t[8],n[4]=t[10]*t[0]-t[2]*t[8],n[5]=-t[6]*t[0]+t[2]*t[4],n[6]=t[9]*t[4]-t[5]*t[8],n[7]=-t[9]*t[0]+t[1]*t[8],n[8]=t[5]*t[0]-t[1]*t[4];const o=t[0]*n[0]+t[1]*n[3]+t[2]*n[6];if(o===0){const h="Matrix3.getInverse(): can't invert matrix, determinant is 0";if(e)throw new Error(h);return console.warn(h),this.identity(),this}return this.multiplyScalar(1/o),this}getDeterminant(){const r=this.elements;return r[0]*r[4]*r[8]+r[1]*r[5]*r[6]+r[2]*r[3]*r[7]-r[2]*r[4]*r[6]-r[1]*r[3]*r[8]-r[0]*r[5]*r[7]}transpose(){let r;const e=this.elements;return r=e[1],e[1]=e[3],e[3]=r,r=e[2],e[2]=e[6],e[6]=r,r=e[5],e[5]=e[7],e[7]=r,this}clone(){const r=this.elements;return new _(r[0],r[3],r[6],r[1],r[4],r[7],r[2],r[5],r[8])}getMatrix4(){const r=this.elements;return new m(r[0],r[3],r[6],0,r[1],r[4],r[7],0,r[2],r[5],r[8],0)}}class g{constructor(r,e){this.origin=r!==void 0?r:new b,this.direction=e!==void 0?e:new b}set(r,e){return this.origin.copy(r),this.direction.copy(e),this}copy(r){return this.origin.copy(r.origin),this.direction.copy(r.direction),this}at(r,e){return(e||new b).copy(this.direction).multiplyScalar(r).add(this.origin)}recast(r){const e=p;return this.origin.copy(this.at(r,e)),this}closestPointToPoint(r,e){const t=e||new b;t.subVectors(r,this.origin);const n=t.dot(this.direction);return t.copy(this.direction).multiplyScalar(n).add(this.origin)}distanceToPoint(r){const e=p,t=e.subVectors(r,this.origin).dot(this.direction);return e.copy(this.direction).multiplyScalar(t).add(this.origin),e.distanceTo(r)}isIntersectionCylinder(){}isIntersectionSphere(r){return this.distanceToPoint(r.center)<=r.radius}isIntersectionPlane(r){return r.normal.dot(this.direction)!==0||r.distanceToPoint(this.origin)===0}distanceToPlane(r){const e=r.normal.dot(this.direction);return e===0?r.distanceToPoint(this.origin)===0?0:void 0:-(this.origin.dot(r.normal)+r.constant)/e}intersectPlane(r,e){const t=this.distanceToPlane(r);if(t!==void 0)return this.at(t,e)}applyMatrix4(r){return this.direction.add(this.origin).applyMatrix4(r),this.origin.applyMatrix4(r),this.direction.sub(this.origin),this}clone(){return new g().copy(this)}}},"./src/WebGL/math/utils/clamp.ts"(K,C,f){f.r(C),f.d(C,{clamp:()=>E});function E(S,w,O){return Math.min(Math.max(S,w),O)}},"./src/WebGL/math/utils/conversionMatrix3.ts"(K,C,f){f.r(C),f.d(C,{conversionMatrix3:()=>S});var E=f("./src/WebGL/math/math.ts");function S(w,O,p,x,M,m){x=x*Math.PI/180,M=M*Math.PI/180,m=m*Math.PI/180;const b=t=>t*t,_=Math.cos(x),g=Math.cos(M),v=Math.cos(m),r=Math.sin(m);return new E.Matrix3(w,O*v,p*g,0,O*r,p*(_-g*v)/r,0,0,p*Math.sqrt(1-b(_)-b(g)-b(v)+2*_*g*v)/r)}},"./src/WebGL/math/utils/degToRad.ts"(K,C,f){f.r(C),f.d(C,{degToRad:()=>S});const E=Math.PI/180;function S(w){return w*E}},"./src/WebGL/objects/Line.ts"(K,C,f){f.r(C),f.d(C,{Line:()=>O,LineStyle:()=>w});var E=f("./src/WebGL/materials/index.ts"),S=f("./src/WebGL/core/index.ts"),w;(function(p){p[p.LineStrip=0]="LineStrip",p[p.LinePieces=1]="LinePieces"})(w||(w={}));class O extends S.Object3D{constructor(x,M=new E.LineBasicMaterial({color:Math.random()*16777215}),m=w.LineStrip){super(),this.geometry=x,this.material=M,this.type=m}clone(x=new O(this.geometry,this.material,this.type)){return super.clone.call(this,x),x}}},"./src/WebGL/objects/Mesh.ts"(K,C,f){f.r(C),f.d(C,{Mesh:()=>S});var E=f("./src/WebGL/core/index.ts");class S extends E.Object3D{constructor(O,p){super(),this.geometry=O,this.material=p}clone(O){return O===void 0&&(O=new S(this.geometry,this.material)),super.clone.call(this,O),O}}},"./src/WebGL/objects/Sprite.ts"(K,C,f){f.r(C),f.d(C,{Sprite:()=>w});var E=f("./src/WebGL/materials/index.ts"),S=f("./src/WebGL/core/index.ts");class w extends S.Object3D{constructor(p=new E.SpriteMaterial){super(),this.material=p,this.rotation3d=this.rotation,this.rotation=0}updateMatrix(){this.matrix.setPosition(this.position),this.rotation3d.set(0,0,this.rotation),this.matrix.setRotationFromEuler(this.rotation3d),(this.scale.x!==1||this.scale.y!==1)&&this.matrix.scale(this.scale),this.matrixWorldNeedsUpdate=!0}clone(p=new w(this.material)){return S.Object3D.prototype.clone.call(this,p),p}}},"./src/WebGL/objects/index.ts"(K,C,f){f.r(C),f.d(C,{Line:()=>E.Line,LineStyle:()=>E.LineStyle,Mesh:()=>S.Mesh,Sprite:()=>w.Sprite});var E=f("./src/WebGL/objects/Line.ts"),S=f("./src/WebGL/objects/Mesh.ts"),w=f("./src/WebGL/objects/Sprite.ts")},"./src/WebGL/shaders/ShaderType.ts"(K,C,f){f.r(C)},"./src/WebGL/shaders/index.ts"(K,C,f){f.r(C),f.d(C,{ShaderLib:()=>E.ShaderLib,ShaderUtils:()=>S.ShaderUtils,basic:()=>E.basic,clone:()=>S.clone,instanced:()=>E.instanced,lambert:()=>E.lambert,lambertdouble:()=>E.lambertdouble,outline:()=>E.outline,screen:()=>E.screen,screenaa:()=>E.screenaa,sphereimposter:()=>E.sphereimposter,sphereimposteroutline:()=>E.sphereimposteroutline,sprite:()=>E.sprite,stickimposter:()=>E.stickimposter,stickimposteroutline:()=>E.stickimposteroutline,volumetric:()=>E.volumetric});var E=f("./src/WebGL/shaders/lib/index.ts"),S=f("./src/WebGL/shaders/utils/index.ts");f("./src/WebGL/shaders/ShaderType.ts")},"./src/WebGL/shaders/lib/basic/basic.frag"(K,C,f){f.r(C),f.d(C,{default:()=>E});const E=`uniform mat4 viewMatrix;
uniform float opacity;
uniform vec3 fogColor;
uniform float fogNear;
uniform float fogFar;
varying vec3 vColor;
varying vec4 mvPosition;

//DEFINEFRAGCOLOR
void main() {
    gl_FragColor = vec4( vColor, opacity );
    if(fogNear != fogFar) {
        float depth = -mvPosition.z;
        float fogFactor = smoothstep( fogNear, fogFar, depth );
        gl_FragColor = mix( gl_FragColor, vec4( fogColor, gl_FragColor.w ), fogFactor );
    }
}`},"./src/WebGL/shaders/lib/basic/basic.vert"(K,C,f){f.r(C),f.d(C,{default:()=>E});const E=`uniform mat4 modelViewMatrix;
uniform mat4 projectionMatrix;
uniform mat4 viewMatrix;
uniform mat3 normalMatrix;

attribute vec3 position;
attribute vec3 color;

varying vec3 vColor;
varying vec4 mvPosition;

void main() {

    vColor = color;
    mvPosition = modelViewMatrix * vec4( position, 1.0 );
    gl_Position = projectionMatrix * mvPosition;

}`},"./src/WebGL/shaders/lib/basic/index.ts"(K,C,f){f.r(C),f.d(C,{basic:()=>O});var E=f("./src/WebGL/shaders/lib/basic/uniforms.ts"),S=f("./src/WebGL/shaders/lib/basic/basic.frag"),w=f("./src/WebGL/shaders/lib/basic/basic.vert");const O={vertexShader:w.default.replace("#define GLSLIFY 1",""),fragmentShader:S.default.replace("#define GLSLIFY 1",""),uniforms:E.uniforms}},"./src/WebGL/shaders/lib/basic/uniforms.ts"(K,C,f){f.r(C),f.d(C,{uniforms:()=>S});var E=f("./src/colors.ts");const S={opacity:{type:"f",value:1},fogColor:{type:"c",value:new E.Color(1,1,1)},fogNear:{type:"f",value:1},fogFar:{type:"f",value:2e3}}},"./src/WebGL/shaders/lib/blur/blur.frag"(K,C,f){f.r(C),f.d(C,{default:()=>E});const E=`const float INV_TOTAL_SAMPLES_FACTOR = 1.0 / 9.0;
uniform highp sampler2D inTex;
varying highp vec2 vTexCoords;
    
void main() {
 
 vec2 texelSize = 1.0 / vec2(textureSize(inTex,0));
 float blurred_visibility_factor = 0.0f;
 for (int t = -1; t <= 1; ++t) {
  for (int s = -1; s <= 1; ++s) {
   vec2 offset = vec2(float(s), float(t)) * texelSize;
   blurred_visibility_factor += texture2D(inTex, vTexCoords + offset).r;
  }
 }
    
 gl_FragDepthEXT = blurred_visibility_factor * INV_TOTAL_SAMPLES_FACTOR;
 
}`},"./src/WebGL/shaders/lib/blur/blur.vert"(K,C,f){f.r(C),f.d(C,{default:()=>E});const E=`attribute vec2 vertexPosition;
varying highp vec2 vTexCoords;
const vec2 scale = vec2(0.5, 0.5);

void main() {
   vTexCoords  = vertexPosition * scale + scale; // scale vertex attribute to [0,1] range
   gl_Position = vec4(vertexPosition, 0.0, 1.0);
}
        `},"./src/WebGL/shaders/lib/blur/index.ts"(K,C,f){f.r(C),f.d(C,{blur:()=>O});var E=f("./src/WebGL/shaders/lib/blur/uniforms.ts"),S=f("./src/WebGL/shaders/lib/blur/blur.frag"),w=f("./src/WebGL/shaders/lib/blur/blur.vert");const O={fragmentShader:S.default,vertexShader:w.default,uniforms:E.uniforms}},"./src/WebGL/shaders/lib/blur/uniforms.ts"(K,C,f){f.r(C),f.d(C,{uniforms:()=>E});const E={}},"./src/WebGL/shaders/lib/index.ts"(K,C,f){f.r(C),f.d(C,{ShaderLib:()=>n,basic:()=>E.basic,instanced:()=>S.instanced,lambert:()=>w.lambert,lambertdouble:()=>O.lambertdouble,outline:()=>p.outline,screen:()=>x.screen,screenaa:()=>M.screenaa,sphereimposter:()=>m.sphereimposter,sphereimposteroutline:()=>b.sphereimposteroutline,sprite:()=>_.sprite,stickimposter:()=>g.stickimposter,stickimposteroutline:()=>v.stickimposteroutline,volumetric:()=>r.volumetric});var E=f("./src/WebGL/shaders/lib/basic/index.ts"),S=f("./src/WebGL/shaders/lib/instanced/index.ts"),w=f("./src/WebGL/shaders/lib/lambert/index.ts"),O=f("./src/WebGL/shaders/lib/lambertdouble/index.ts"),p=f("./src/WebGL/shaders/lib/outline/index.ts"),x=f("./src/WebGL/shaders/lib/screen/index.ts"),M=f("./src/WebGL/shaders/lib/screenaa/index.ts"),m=f("./src/WebGL/shaders/lib/sphereimposter/index.ts"),b=f("./src/WebGL/shaders/lib/sphereimposteroutline/index.ts"),_=f("./src/WebGL/shaders/lib/sprite/index.ts"),g=f("./src/WebGL/shaders/lib/stickimposter/index.ts"),v=f("./src/WebGL/shaders/lib/stickimposteroutline/index.ts"),r=f("./src/WebGL/shaders/lib/volumetric/index.ts"),e=f("./src/WebGL/shaders/lib/ssao/index.ts"),t=f("./src/WebGL/shaders/lib/blur/index.ts");const n={basic:E.basic,blur:t.blur,instanced:S.instanced,lambert:w.lambert,lambertdouble:O.lambertdouble,outline:p.outline,screen:x.screen,screenaa:M.screenaa,ssao:e.ssao,sphereimposter:m.sphereimposter,sphereimposteroutline:b.sphereimposteroutline,sprite:_.sprite,stickimposter:g.stickimposter,stickimposteroutline:v.stickimposteroutline,volumetric:r.volumetric}},"./src/WebGL/shaders/lib/instanced/index.ts"(K,C,f){f.r(C),f.d(C,{instanced:()=>O});var E=f("./src/WebGL/shaders/lib/instanced/uniforms.ts"),S=f("./src/WebGL/shaders/lib/instanced/instanced.frag"),w=f("./src/WebGL/shaders/lib/instanced/instanced.vert");const O={fragmentShader:S.default.replace("#define GLSLIFY 1",""),vertexShader:w.default.replace("#define GLSLIFY 1",""),uniforms:E.uniforms}},"./src/WebGL/shaders/lib/instanced/instanced.frag"(K,C,f){f.r(C),f.d(C,{default:()=>E});const E=`uniform mat4 viewMatrix;
uniform float opacity;

uniform vec3 fogColor;
uniform float fogNear;
uniform float fogFar;
#ifdef SHADED
uniform highp sampler2D shading;
#endif
varying vec3 vLightFront;
varying vec3 vColor;
//DEFINEFRAGCOLOR

void main() {

    gl_FragColor = vec4( vec3 ( 1.0 ), opacity );

    #ifndef WIREFRAME
    gl_FragColor.xyz *= vLightFront;
    #endif

#ifdef SHADED
    ivec2 dim = textureSize(shading,0);
    float shadowFactor = texture2D(shading,vec2(gl_FragCoord.x/float(dim.x),gl_FragCoord.y/float(dim.y))).r;
    vColor *= shadowFactor;
#endif
    gl_FragColor = gl_FragColor * vec4( vColor, opacity );
    float depth = gl_FragCoord.z / gl_FragCoord.w;

    float fogFactor = smoothstep( fogNear, fogFar, depth );

    gl_FragColor = mix( gl_FragColor, vec4( fogColor, gl_FragColor.w ), fogFactor );

}


`},"./src/WebGL/shaders/lib/instanced/instanced.vert"(K,C,f){f.r(C),f.d(C,{default:()=>E});const E=`

uniform mat4 modelViewMatrix;
uniform mat4 projectionMatrix;
uniform mat4 viewMatrix;
uniform mat3 normalMatrix;
uniform vec3 directionalLightColor[ 1 ];
uniform vec3 directionalLightDirection[ 1 ];

attribute vec3 offset;
attribute vec3 position;
attribute vec3 normal;
attribute vec3 color;
attribute float radius;

varying vec3 vColor;
varying vec3 vLightFront;

void main() {

    vColor = color;

    vec3 objectNormal = normal;
    vec3 transformedNormal = normalMatrix * objectNormal;
    vec4 mvPosition = modelViewMatrix * vec4( position * radius + offset, 1.0 );

    vLightFront = vec3( 0.0 );

    transformedNormal = normalize( transformedNormal );

    vec4 lDirection = viewMatrix * vec4( directionalLightDirection[ 0 ], 0.0 );
    vec3 dirVector = normalize( lDirection.xyz );
    float dotProduct = dot( transformedNormal, dirVector );
    vec3 directionalLightWeighting = vec3( max( dotProduct, 0.0 ) );

    vLightFront += directionalLightColor[ 0 ] * directionalLightWeighting;

    gl_Position = projectionMatrix * mvPosition;
}

`},"./src/WebGL/shaders/lib/instanced/uniforms.ts"(K,C,f){f.r(C),f.d(C,{uniforms:()=>S});var E=f("./src/colors.ts");const S={opacity:{type:"f",value:1},fogColor:{type:"c",value:new E.Color(1,1,1)},fogNear:{type:"f",value:1},fogFar:{type:"f",value:2e3},directionalLightColor:{type:"fv",value:[]},directionalLightDirection:{type:"fv",value:[]}}},"./src/WebGL/shaders/lib/lambert/index.ts"(K,C,f){f.r(C),f.d(C,{lambert:()=>O});var E=f("./src/WebGL/shaders/lib/lambert/uniforms.ts"),S=f("./src/WebGL/shaders/lib/lambert/lambert.frag"),w=f("./src/WebGL/shaders/lib/lambert/lambert.vert");const O={fragmentShader:S.default.replace("#define GLSLIFY 1",""),vertexShader:w.default.replace("#define GLSLIFY 1",""),uniforms:E.uniforms}},"./src/WebGL/shaders/lib/lambert/lambert.frag"(K,C,f){f.r(C),f.d(C,{default:()=>E});const E=`uniform mat4 viewMatrix;
uniform float opacity;

uniform vec3 fogColor;
uniform float fogNear;
uniform float fogFar;
#ifdef SHADED
uniform highp sampler2D shading;
#endif
varying vec3 vLightFront;
varying vec3 vColor;
varying vec4 mvPosition;


//DEFINEFRAGCOLOR

void main() {

    gl_FragColor = vec4( vec3 ( 1.0 ), opacity );

    #ifndef WIREFRAME
    gl_FragColor.xyz *= vLightFront;
    #endif
#ifdef SHADED
    ivec2 dim = textureSize(shading,0);
    float shadowFactor = texture2D(shading,vec2(gl_FragCoord.x/float(dim.x),gl_FragCoord.y/float(dim.y))).r;
    vColor *= shadowFactor;
#endif
    gl_FragColor = gl_FragColor * vec4( vColor, opacity );

    if(fogNear != fogFar) {
        float depth = -mvPosition.z;
        float fogFactor = smoothstep( fogNear, fogFar, depth );
        gl_FragColor = mix( gl_FragColor, vec4( fogColor, gl_FragColor.w ), fogFactor );
    }

}`},"./src/WebGL/shaders/lib/lambert/lambert.vert"(K,C,f){f.r(C),f.d(C,{default:()=>E});const E=`
uniform mat4 modelViewMatrix;
uniform mat4 projectionMatrix;
uniform mat4 viewMatrix;
uniform mat3 normalMatrix;
uniform vec3 directionalLightColor[ 1 ];
uniform vec3 directionalLightDirection[ 1 ];

attribute vec3 position;
attribute vec3 normal;
attribute vec3 color;

varying vec3 vColor;
varying vec3 vLightFront;
varying vec4 mvPosition;

void main() {

    vColor = color;

    vec3 objectNormal = normal;
    vec3 transformedNormal = normalMatrix * objectNormal;
    mvPosition = modelViewMatrix * vec4( position, 1.0 );

    vLightFront = vec3( 0.0 );

    transformedNormal = normalize( transformedNormal );

    vec4 lDirection = viewMatrix * vec4( directionalLightDirection[ 0 ], 0.0 );
    vec3 dirVector = normalize( lDirection.xyz );
    float dotProduct = dot( transformedNormal, dirVector );
    vec3 directionalLightWeighting = vec3( max( dotProduct, 0.0 ) );

    vLightFront += directionalLightColor[ 0 ] * directionalLightWeighting;

    gl_Position = projectionMatrix * mvPosition;
}`},"./src/WebGL/shaders/lib/lambert/uniforms.ts"(K,C,f){f.r(C),f.d(C,{uniforms:()=>S});var E=f("./src/colors.ts");const S={opacity:{type:"f",value:1},fogColor:{type:"c",value:new E.Color(1,1,1)},fogNear:{type:"f",value:1},fogFar:{type:"f",value:2e3},directionalLightColor:{type:"fv",value:[]},directionalLightDirection:{type:"fv",value:[]}}},"./src/WebGL/shaders/lib/lambertdouble/index.ts"(K,C,f){f.r(C),f.d(C,{lambertdouble:()=>O});var E=f("./src/WebGL/shaders/lib/lambertdouble/uniforms.ts"),S=f("./src/WebGL/shaders/lib/lambertdouble/lambertdouble.frag"),w=f("./src/WebGL/shaders/lib/lambertdouble/lambertdouble.vert");const O={fragmentShader:S.default.replace("#define GLSLIFY 1",""),vertexShader:w.default.replace("#define GLSLIFY 1",""),uniforms:E.uniforms}},"./src/WebGL/shaders/lib/lambertdouble/lambertdouble.frag"(K,C,f){f.r(C),f.d(C,{default:()=>E});const E=`
#ifdef SHADED
uniform highp sampler2D shading;
#endif

uniform mat4 viewMatrix;
uniform float opacity;

uniform vec3 fogColor;
uniform float fogNear;
uniform float fogFar;

varying vec3 vLightFront;
varying vec3 vLightBack;

varying vec3 vColor;
varying vec4 mvPosition;

//DEFINEFRAGCOLOR

void main() {

    gl_FragColor = vec4( vec3 ( 1.0 ), opacity );

    #ifndef WIREFRAME
    if ( gl_FrontFacing )
       gl_FragColor.xyz *= vLightFront;
    else
       gl_FragColor.xyz *= vLightBack;
    #endif

    vec3 color = vColor;
#ifdef SHADED
    ivec2 dim = textureSize(shading,0);
    float shadowFactor = texture2D(shading,vec2(gl_FragCoord.x/float(dim.x),gl_FragCoord.y/float(dim.y))).r;
    color *= shadowFactor;
#endif
    gl_FragColor = gl_FragColor * vec4( color, opacity );

    if(fogNear != fogFar) {
        float depth = -mvPosition.z;
        float fogFactor = smoothstep( fogNear, fogFar, depth );
        gl_FragColor = mix( gl_FragColor, vec4( fogColor, gl_FragColor.w ), fogFactor );
    }

}


`},"./src/WebGL/shaders/lib/lambertdouble/lambertdouble.vert"(K,C,f){f.r(C),f.d(C,{default:()=>E});const E=`

uniform mat4 modelViewMatrix;
uniform mat4 projectionMatrix;
uniform mat4 viewMatrix;
uniform mat3 normalMatrix;
uniform vec3 directionalLightColor[ 1 ];
uniform vec3 directionalLightDirection[ 1 ];

attribute vec3 position;
attribute vec3 normal;
attribute vec3 color;

varying vec3 vColor;
varying vec3 vLightFront;
varying vec3 vLightBack;
varying vec4 mvPosition;

void main() {

    vColor = color;

    vec3 objectNormal = normal;
    vec3 transformedNormal = normalMatrix * objectNormal;
    mvPosition = modelViewMatrix * vec4( position, 1.0 );

    vLightFront = vec3( 0.0 );
    vLightBack = vec3( 0.0 );

    transformedNormal = normalize( transformedNormal );

    vec4 lDirection = viewMatrix * vec4( directionalLightDirection[ 0 ], 0.0 );
    vec3 dirVector = normalize( lDirection.xyz );
    float dotProduct = dot( transformedNormal, dirVector );
    vec3 directionalLightWeighting = vec3( max( dotProduct, 0.0 ) );
    vec3 directionalLightWeightingBack = vec3( max( -dotProduct, 0.0 ) );

    vLightFront += directionalLightColor[ 0 ] * directionalLightWeighting;
    vLightBack += directionalLightColor[ 0 ] * directionalLightWeightingBack;

    gl_Position = projectionMatrix * mvPosition;
}

`},"./src/WebGL/shaders/lib/lambertdouble/uniforms.ts"(K,C,f){f.r(C),f.d(C,{uniforms:()=>S});var E=f("./src/colors.ts");const S={opacity:{type:"f",value:1},fogColor:{type:"c",value:new E.Color(1,1,1)},fogNear:{type:"f",value:1},fogFar:{type:"f",value:2e3},directionalLightColor:{type:"fv",value:[]},directionalLightDirection:{type:"fv",value:[]}}},"./src/WebGL/shaders/lib/outline/index.ts"(K,C,f){f.r(C),f.d(C,{outline:()=>O});var E=f("./src/WebGL/shaders/lib/outline/uniforms.ts"),S=f("./src/WebGL/shaders/lib/outline/outline.frag"),w=f("./src/WebGL/shaders/lib/outline/outline.vert");const O={fragmentShader:S.default.replace("#define GLSLIFY 1",""),vertexShader:w.default.replace("#define GLSLIFY 1",""),uniforms:E.uniforms}},"./src/WebGL/shaders/lib/outline/outline.frag"(K,C,f){f.r(C),f.d(C,{default:()=>E});const E=`

uniform float opacity;
uniform vec3 outlineColor;
uniform vec3 fogColor;
uniform float fogNear;
uniform float fogFar;

varying vec4 mvPosition;
//DEFINEFRAGCOLOR

void main() {
    gl_FragColor = vec4( outlineColor, 1 );

    if(fogNear != fogFar) {
        float depth = -mvPosition.z;
        float fogFactor = smoothstep( fogNear, fogFar, depth );
        gl_FragColor = mix( gl_FragColor, vec4( fogColor, gl_FragColor.w ), fogFactor );
    }
}


`},"./src/WebGL/shaders/lib/outline/outline.vert"(K,C,f){f.r(C),f.d(C,{default:()=>E});const E=`

uniform mat4 modelViewMatrix;
uniform mat4 projectionMatrix;
uniform float outlineWidth;
uniform float outlinePushback;
uniform float vWidth;
uniform float vHeight;
uniform float outlineMaxPixels;

attribute vec3 position;
attribute vec3 normal;
attribute vec3 color;

varying vec4 mvPosition;

void main() {

    vec4 norm = modelViewMatrix*vec4(normalize(normal),0.0);
    mvPosition = modelViewMatrix * vec4( position, 1.0 );
    mvPosition.xy += norm.xy*outlineWidth;
    vec4 outpos = projectionMatrix * mvPosition;

    if(outlineMaxPixels > 0.0) {
        vec4 unadjusted = projectionMatrix*modelViewMatrix * vec4( position, 1.0 );
        float w = outpos.w;
        //normalize homogeneous coords
        unadjusted /= unadjusted.w;
        outpos /= outpos.w;
        vec2 diff = outpos.xy-unadjusted.xy;
        //put into pixels
        diff.x *= vWidth;
        diff.y *= vHeight;
        if ( length(diff) > outlineMaxPixels) {
            vec2 ndiff = normalize(diff)*outlineMaxPixels;
            ndiff.x /= vWidth;
            ndiff.y /= vHeight;
            outpos.xy = unadjusted.xy;
            outpos.xy += ndiff;
        }
        outpos *= w; //if I don't do this things blow up
    }
    gl_Position = outpos;
    mvPosition.z -= outlinePushback; //go backwards in model space
    vec4 pushpos = projectionMatrix*mvPosition; //project to get z in projection space, I'm probably missing some simple math to do the same thing..
    gl_Position.z = gl_Position.w*pushpos.z/pushpos.w;
}

`},"./src/WebGL/shaders/lib/outline/uniforms.ts"(K,C,f){f.r(C),f.d(C,{uniforms:()=>S});var E=f("./src/colors.ts");const S={opacity:{type:"f",value:1},outlineColor:{type:"c",value:new E.Color(0,0,0)},fogColor:{type:"c",value:new E.Color(1,1,1)},fogNear:{type:"f",value:1},fogFar:{type:"f",value:2e3},outlineWidth:{type:"f",value:.1},outlinePushback:{type:"f",value:1},outlineMaxPixels:{type:"f",value:0}}},"./src/WebGL/shaders/lib/screen/index.ts"(K,C,f){f.r(C),f.d(C,{screen:()=>O});var E=f("./src/WebGL/shaders/lib/screen/uniforms.ts"),S=f("./src/WebGL/shaders/lib/screen/screen.frag"),w=f("./src/WebGL/shaders/lib/screen/screen.vert");const O={fragmentShader:S.default.replace("#define GLSLIFY 1",""),vertexShader:w.default.replace("#define GLSLIFY 1",""),uniforms:E.uniforms}},"./src/WebGL/shaders/lib/screen/screen.frag"(K,C,f){f.r(C),f.d(C,{default:()=>E});const E=`uniform sampler2D colormap;
varying highp vec2 vTexCoords;
uniform vec2 dimensions;
//DEFINEFRAGCOLOR
void main (void) {
   gl_FragColor = texture2D(colormap, vTexCoords);

   //gl_FragColor.g = gl_FragColor.b =  gl_FragColor.r; //debug shading 
}
        `},"./src/WebGL/shaders/lib/screen/screen.vert"(K,C,f){f.r(C),f.d(C,{default:()=>E});const E=`attribute vec2 vertexPosition;
varying highp vec2 vTexCoords;
const vec2 scale = vec2(0.5, 0.5);

void main() {
   vTexCoords  = vertexPosition * scale + scale; // scale vertex attribute to [0,1] range
   gl_Position = vec4(vertexPosition, 0.0, 1.0);
}
        `},"./src/WebGL/shaders/lib/screen/uniforms.ts"(K,C,f){f.r(C),f.d(C,{uniforms:()=>E});const E={}},"./src/WebGL/shaders/lib/screenaa/index.ts"(K,C,f){f.r(C),f.d(C,{screenaa:()=>O});var E=f("./src/WebGL/shaders/lib/screenaa/uniforms.ts"),S=f("./src/WebGL/shaders/lib/screenaa/screenaa.frag"),w=f("./src/WebGL/shaders/lib/screenaa/screenaa.vert");const O={fragmentShader:S.default.replace("#define GLSLIFY 1",""),vertexShader:w.default.replace("#define GLSLIFY 1",""),uniforms:E.uniforms}},"./src/WebGL/shaders/lib/screenaa/screenaa.frag"(K,C,f){f.r(C),f.d(C,{default:()=>E});const E=`
        
precision highp float;
precision highp int;
precision highp sampler2D;

uniform sampler2D tColor;
varying highp vec2 vTexCoords;

// adapted from https://github.com/kosua20/Rendu
// MIT License Copyright (c) 2017 Simon Rodriguez
// by way of molstar (https://github.com/molstar/molstar/blob/master/src/mol-gl/shader/fxaa.frag.ts)

#define QUALITY(q) ((q) < 5 ? 1.0 : ((q) > 5 ? ((q) < 10 ? 2.0 : ((q) < 11 ? 4.0 : 8.0)) : 1.5))

float rgb2luma(vec3 rgb){
    return sqrt(dot(rgb, vec3(0.299, 0.587, 0.114)));
}

float sampleLuma(vec2 uv) {
    return rgb2luma(texture2D(tColor, uv).rgb);
}

float sampleLuma(vec2 uv, float uOffset, float vOffset) {
    uv += vec2(uOffset, vOffset);
    return sampleLuma(uv);
}

//DEFINEFRAGCOLOR
void main(void) {
    ivec2 dim = textureSize(tColor,0);
    vec2 dimensions = vec2(float(dim.x),float(dim.y));
    vec2 inverseScreenSize = vec2(1.0 / dimensions.x, 1.0 / dimensions.y);
    vec2 coords = vTexCoords;

    vec4 colorCenter = texture2D(tColor, coords);
    float dEdgeThresholdMin = 0.0312;
    float dEdgeThresholdMax = 0.125;
    int dIterations = 12;
    float dSubpixelQuality = 0.3;

    // Luma at the current fragment
    float lumaCenter = rgb2luma(colorCenter.rgb);

    // Luma at the four direct neighbours of the current fragment.
    float lumaDown = sampleLuma(coords, 0.0, -inverseScreenSize.y);
    float lumaUp = sampleLuma(coords, 0.0, inverseScreenSize.y);
    float lumaLeft = sampleLuma(coords, -inverseScreenSize.x, 0.0);
    float lumaRight = sampleLuma(coords, inverseScreenSize.x, 0.0);

    // Find the maximum and minimum luma around the current fragment.
    float lumaMin = min(lumaCenter, min(min(lumaDown, lumaUp), min(lumaLeft, lumaRight)));
    float lumaMax = max(lumaCenter, max(max(lumaDown, lumaUp), max(lumaLeft, lumaRight)));

    // Compute the delta.
    float lumaRange = lumaMax - lumaMin;

    // If the luma variation is lower that a threshold (or if we are in a really dark area),
    // we are not on an edge, don't perform any AA.
    if (lumaRange < max(dEdgeThresholdMin, lumaMax * dEdgeThresholdMax)) {
        gl_FragColor = colorCenter;
        return;
    }

    // Query the 4 remaining corners lumas.
    float lumaDownLeft = sampleLuma(coords, -inverseScreenSize.x, -inverseScreenSize.y);
    float lumaUpRight = sampleLuma(coords, inverseScreenSize.x, inverseScreenSize.y);
    float lumaUpLeft = sampleLuma(coords, -inverseScreenSize.x, inverseScreenSize.y);
    float lumaDownRight = sampleLuma(coords, inverseScreenSize.x, -inverseScreenSize.y);

    // Combine the four edges lumas (using intermediary variables for future computations
    // with the same values).
    float lumaDownUp = lumaDown + lumaUp;
    float lumaLeftRight = lumaLeft + lumaRight;

    // Same for corners
    float lumaLeftCorners = lumaDownLeft + lumaUpLeft;
    float lumaDownCorners = lumaDownLeft + lumaDownRight;
    float lumaRightCorners = lumaDownRight + lumaUpRight;
    float lumaUpCorners = lumaUpRight + lumaUpLeft;

    // Compute an estimation of the gradient along the horizontal and vertical axis.
    float edgeHorizontal = abs(-2.0 * lumaLeft + lumaLeftCorners) + abs(-2.0 * lumaCenter + lumaDownUp) * 2.0 + abs(-2.0 * lumaRight + lumaRightCorners);
    float edgeVertical = abs(-2.0 * lumaUp + lumaUpCorners) + abs(-2.0 * lumaCenter + lumaLeftRight) * 2.0 + abs(-2.0 * lumaDown + lumaDownCorners);

    // Is the local edge horizontal or vertical ?
    bool isHorizontal = (edgeHorizontal >= edgeVertical);

    // Choose the step size (one pixel) accordingly.
    float stepLength = isHorizontal ? inverseScreenSize.y : inverseScreenSize.x;

    // Select the two neighboring texels lumas in the opposite direction to the local edge.
    float luma1 = isHorizontal ? lumaDown : lumaLeft;
    float luma2 = isHorizontal ? lumaUp : lumaRight;
    // Compute gradients in this direction.
    float gradient1 = luma1 - lumaCenter;
    float gradient2 = luma2 - lumaCenter;

    // Which direction is the steepest ?
    bool is1Steepest = abs(gradient1) >= abs(gradient2);

    // Gradient in the corresponding direction, normalized.
    float gradientScaled = 0.25 * max(abs(gradient1), abs(gradient2));

    // Average luma in the correct direction.
    float lumaLocalAverage = 0.0;
    if(is1Steepest){
        // Switch the direction
        stepLength = -stepLength;
        lumaLocalAverage = 0.5 * (luma1 + lumaCenter);
    } else {
        lumaLocalAverage = 0.5 * (luma2 + lumaCenter);
    }

    // Shift UV in the correct direction by half a pixel.
    vec2 currentUv = coords;
    if(isHorizontal){
        currentUv.y += stepLength * 0.5;
    } else {
        currentUv.x += stepLength * 0.5;
    }

    // Compute offset (for each iteration step) in the right direction.
    vec2 offset = isHorizontal ? vec2(inverseScreenSize.x, 0.0) : vec2(0.0, inverseScreenSize.y);
    // Compute UVs to explore on each side of the edge, orthogonally.
    // The QUALITY allows us to step faster.
    vec2 uv1 = currentUv - offset * QUALITY(0);
    vec2 uv2 = currentUv + offset * QUALITY(0);

    // Read the lumas at both current extremities of the exploration segment,
    // and compute the delta wrt to the local average luma.
    float lumaEnd1 = sampleLuma(uv1);
    float lumaEnd2 = sampleLuma(uv2);
    lumaEnd1 -= lumaLocalAverage;
    lumaEnd2 -= lumaLocalAverage;

    // If the luma deltas at the current extremities is larger than the local gradient,
    // we have reached the side of the edge.
    bool reached1 = abs(lumaEnd1) >= gradientScaled;
    bool reached2 = abs(lumaEnd2) >= gradientScaled;
    bool reachedBoth = reached1 && reached2;

    // If the side is not reached, we continue to explore in this direction.
    if(!reached1){
        uv1 -= offset * QUALITY(1);
    }
    if(!reached2){
        uv2 += offset * QUALITY(1);
    }

    // If both sides have not been reached, continue to explore.
    if(!reachedBoth){
        for(int i = 2; i < dIterations; i++){
            // If needed, read luma in 1st direction, compute delta.
            if(!reached1){
                lumaEnd1 = sampleLuma(uv1);
                lumaEnd1 = lumaEnd1 - lumaLocalAverage;
            }
            // If needed, read luma in opposite direction, compute delta.
            if(!reached2){
                lumaEnd2 = sampleLuma(uv2);
                lumaEnd2 = lumaEnd2 - lumaLocalAverage;
            }
            // If the luma deltas at the current extremities is larger than the local gradient,
            // we have reached the side of the edge.
            reached1 = abs(lumaEnd1) >= gradientScaled;
            reached2 = abs(lumaEnd2) >= gradientScaled;
            reachedBoth = reached1 && reached2;

            // If the side is not reached, we continue to explore in this direction,
            // with a variable quality.
            if(!reached1){
                uv1 -= offset * QUALITY(i);
            }
            if(!reached2){
                uv2 += offset * QUALITY(i);
            }

            // If both sides have been reached, stop the exploration.
            if(reachedBoth){
                break;
            }
        }
    }

    // Compute the distances to each side edge of the edge (!).
    float distance1 = isHorizontal ? (coords.x - uv1.x) : (coords.y - uv1.y);
    float distance2 = isHorizontal ? (uv2.x - coords.x) : (uv2.y - coords.y);

    // In which direction is the side of the edge closer ?
    bool isDirection1 = distance1 < distance2;
    float distanceFinal = min(distance1, distance2);

    // Thickness of the edge.
    float edgeThickness = (distance1 + distance2);

    // Is the luma at center smaller than the local average ?
    bool isLumaCenterSmaller = lumaCenter < lumaLocalAverage;

    // If the luma at center is smaller than at its neighbour,
    // the delta luma at each end should be positive (same variation).
    bool correctVariation1 = (lumaEnd1 < 0.0) != isLumaCenterSmaller;
    bool correctVariation2 = (lumaEnd2 < 0.0) != isLumaCenterSmaller;

    // Only keep the result in the direction of the closer side of the edge.
    bool correctVariation = isDirection1 ? correctVariation1 : correctVariation2;

    // UV offset: read in the direction of the closest side of the edge.
    float pixelOffset = - distanceFinal / edgeThickness + 0.5;

    // If the luma variation is incorrect, do not offset.
    float finalOffset = correctVariation ? pixelOffset : 0.0;

    // Sub-pixel shifting
    // Full weighted average of the luma over the 3x3 neighborhood.
    float lumaAverage = (1.0 / 12.0) * (2.0 * (lumaDownUp + lumaLeftRight) + lumaLeftCorners + lumaRightCorners);
    // Ratio of the delta between the global average and the center luma,
    // over the luma range in the 3x3 neighborhood.
    float subPixelOffset1 = clamp(abs(lumaAverage - lumaCenter) / lumaRange, 0.0, 1.0);
    float subPixelOffset2 = (-2.0 * subPixelOffset1 + 3.0) * subPixelOffset1 * subPixelOffset1;
    // Compute a sub-pixel offset based on this delta.
    float subPixelOffsetFinal = subPixelOffset2 * subPixelOffset2 * float(dSubpixelQuality);

    // Pick the biggest of the two offsets.
    finalOffset = max(finalOffset, subPixelOffsetFinal);

    // Compute the final UV coordinates.
    vec2 finalUv = coords;
    if(isHorizontal){
        finalUv.y += finalOffset * stepLength;
    } else {
        finalUv.x += finalOffset * stepLength;
    }

    // Read the color at the new UV coordinates, and use it.
    gl_FragColor = texture2D(tColor, finalUv);
}        

/* old fxaa implementation
uniform highp sampler2D colormap;
varying highp vec2 vTexCoords;


// Basic FXAA implementation based on the code on geeks3d.com 
#define FXAA_REDUCE_MIN (1.0/ 128.0)
#define FXAA_REDUCE_MUL (1.0 / 8.0)
#define FXAA_SPAN_MAX 8.0


vec4 applyFXAA(vec2 fragCoord, highp sampler2D tex)
{
    vec4 color;
    ivec2 dim = textureSize(tex,0);
    vec2 dimensions = vec2(float(dim.x),float(dim.y));
    vec2 inverseVP = vec2(1.0 / dimensions.x, 1.0 / dimensions.y);
    vec4 rgbNW = texture2D(tex, fragCoord + vec2(-1.0, -1.0) * inverseVP);
    vec4 rgbNE = texture2D(tex, fragCoord + vec2(1.0, -1.0) * inverseVP);
    vec4 rgbSW = texture2D(tex, fragCoord + vec2(-1.0, 1.0) * inverseVP);
    vec4 rgbSE = texture2D(tex, fragCoord + vec2(1.0, 1.0) * inverseVP);
    vec4 rgbM  = texture2D(tex, fragCoord );
    vec3 luma = vec3(0.299, 0.587, 0.114);
    float lumaNW = dot(rgbNW.xyz, luma);
    float lumaNE = dot(rgbNE.xyz, luma);
    float lumaSW = dot(rgbSW.xyz, luma);
    float lumaSE = dot(rgbSE.xyz, luma);
    float lumaM  = dot(rgbM.xyz,  luma);
    float lumaMin = min(lumaM, min(min(lumaNW, lumaNE), min(lumaSW, lumaSE)));
    float lumaMax = max(lumaM, max(max(lumaNW, lumaNE), max(lumaSW, lumaSE)));

    vec2 dir;
    dir.x = -((lumaNW + lumaNE) - (lumaSW + lumaSE));
    dir.y =  ((lumaNW + lumaSW) - (lumaNE + lumaSE));

    float dirReduce = max((lumaNW + lumaNE + lumaSW + lumaSE) *
                        (0.25 * FXAA_REDUCE_MUL), FXAA_REDUCE_MIN);

    float rcpDirMin = 1.0 / (min(abs(dir.x), abs(dir.y)) + dirReduce);
    dir = min(vec2(FXAA_SPAN_MAX, FXAA_SPAN_MAX),
            max(vec2(-FXAA_SPAN_MAX, -FXAA_SPAN_MAX),
            dir * rcpDirMin)) * inverseVP;

    vec4 rgbA = 0.5 * (
        texture2D(tex, fragCoord + dir * (1.0 / 3.0 - 0.5)) +
        texture2D(tex, fragCoord  + dir * (2.0 / 3.0 - 0.5)));
    vec4 rgbB = rgbA * 0.5 + 0.25 * (
        texture2D(tex, fragCoord  + dir * -0.5) +
        texture2D(tex, fragCoord  + dir * 0.5));

    float lumaB = dot(rgbB.xyz, luma);
    if ((lumaB < lumaMin) || (lumaB > lumaMax))
        color = rgbA;
    else
        color = rgbB;

    return color;
}


//DEFINEFRAGCOLOR
void main (void) {
    ivec2 dim = textureSize(colormap,0);

  gl_FragColor = applyFXAA(vTexCoords, colormap);
}
        
*/`},"./src/WebGL/shaders/lib/screenaa/screenaa.vert"(K,C,f){f.r(C),f.d(C,{default:()=>E});const E=`attribute vec2 vertexPosition;
varying highp vec2 vTexCoords;
const vec2 scale = vec2(0.5, 0.5);

void main() {
   vTexCoords  = vertexPosition * scale + scale; // scale vertex attribute to [0,1] range
   gl_Position = vec4(vertexPosition, 0.0, 1.0);
}
        `},"./src/WebGL/shaders/lib/screenaa/uniforms.ts"(K,C,f){f.r(C),f.d(C,{uniforms:()=>E});const E={}},"./src/WebGL/shaders/lib/sphereimposter/index.ts"(K,C,f){f.r(C),f.d(C,{sphereimposter:()=>O});var E=f("./src/WebGL/shaders/lib/sphereimposter/uniforms.ts"),S=f("./src/WebGL/shaders/lib/sphereimposter/sphereimposter.frag"),w=f("./src/WebGL/shaders/lib/sphereimposter/sphereimposter.vert");const O={vertexShader:w.default.replace("#define GLSLIFY 1",""),fragmentShader:S.default.replace("#define GLSLIFY 1",""),uniforms:E.uniforms}},"./src/WebGL/shaders/lib/sphereimposter/sphereimposter.frag"(K,C,f){f.r(C),f.d(C,{default:()=>E});const E=`
uniform mat4 viewMatrix;
uniform float opacity;
uniform mat4 projectionMatrix;

uniform vec3 fogColor;
uniform float fogNear;
uniform float fogFar;
uniform float uDepth;
uniform vec3 directionalLightColor[ 1 ];

varying vec3 vColor;
varying vec2 mapping;
varying float rval;
varying vec3 vLight;
varying vec3 center;

#ifdef SHADED
uniform highp sampler2D shading;
#endif

//DEFINEFRAGCOLOR

void main() {
    float lensqr = dot(mapping,mapping);
    float rsqr = rval*rval;
    if(lensqr > rsqr)
       discard;
    float z = sqrt(rsqr-lensqr);
    vec3 cameraPos = center+ vec3(mapping.x,mapping.y,z);
    vec4 clipPos = projectionMatrix * vec4(cameraPos, 1.0);
    float ndcDepth = clipPos.z / clipPos.w;
    gl_FragDepthEXT = ((gl_DepthRange.diff * ndcDepth) + gl_DepthRange.near + gl_DepthRange.far) / 2.0;
    vec3 norm = normalize(vec3(mapping.x,mapping.y,z));
    float dotProduct = dot( norm, vLight );
    vec3 directionalLightWeighting = vec3( max( dotProduct, 0.0 ) );
    vec3 vLight = directionalLightColor[ 0 ] * directionalLightWeighting;
    vec3 color = vLight*vColor;
#ifdef SHADED
    ivec2 dim = textureSize(shading,0);
    float shadowFactor = texture2D(shading,vec2(gl_FragCoord.x/float(dim.x),gl_FragCoord.y/float(dim.y))).r;
    color *= shadowFactor;
#endif    
    gl_FragColor = vec4(color, opacity*opacity );

    if(fogNear != fogFar) {
        float depth = -cameraPos.z;
        float fogFactor = smoothstep( fogNear, fogFar, depth );
        gl_FragColor = mix( gl_FragColor, vec4( fogColor, gl_FragColor.w ), fogFactor );
    }
     
}

`},"./src/WebGL/shaders/lib/sphereimposter/sphereimposter.vert"(K,C,f){f.r(C),f.d(C,{default:()=>E});const E=`uniform mat4 modelViewMatrix;
uniform mat4 projectionMatrix;
uniform mat4 viewMatrix;
uniform mat3 normalMatrix;
uniform vec3 directionalLightColor[ 1 ];
uniform vec3 directionalLightDirection[ 1 ];

attribute vec3 position;
attribute vec3 normal;
attribute vec3 color;

varying vec2 mapping;
varying vec3 vColor;
varying float rval;
varying vec3 vLight;
varying vec3 center;

void main() {

    vColor = color;
    vec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );
    center = mvPosition.xyz;
    vec4 projPosition = projectionMatrix * mvPosition;
    vec4 adjust = projectionMatrix* vec4(normal,0.0); adjust.z = 0.0; adjust.w = 0.0;
    vec4 lDirection = viewMatrix * vec4( directionalLightDirection[ 0 ], 0.0 );
    vLight = normalize( lDirection.xyz );
    mapping = normal.xy;
    rval = abs(normal.x);
    gl_Position = projPosition+adjust;

}
`},"./src/WebGL/shaders/lib/sphereimposter/uniforms.ts"(K,C,f){f.r(C),f.d(C,{uniforms:()=>S});var E=f("./src/colors.ts");const S={opacity:{type:"f",value:1},fogColor:{type:"c",value:new E.Color(1,1,1)},fogNear:{type:"f",value:1},fogFar:{type:"f",value:2e3},directionalLightColor:{type:"fv",value:[]},directionalLightDirection:{type:"fv",value:[]}}},"./src/WebGL/shaders/lib/sphereimposteroutline/index.ts"(K,C,f){f.r(C),f.d(C,{sphereimposteroutline:()=>O});var E=f("./src/WebGL/shaders/lib/sphereimposteroutline/uniforms.ts"),S=f("./src/WebGL/shaders/lib/sphereimposteroutline/sphereimposteroutline.frag"),w=f("./src/WebGL/shaders/lib/sphereimposteroutline/sphereimposteroutline.vert");const O={fragmentShader:S.default.replace("#define GLSLIFY 1",""),vertexShader:w.default.replace("#define GLSLIFY 1",""),uniforms:E.uniforms}},"./src/WebGL/shaders/lib/sphereimposteroutline/sphereimposteroutline.frag"(K,C,f){f.r(C),f.d(C,{default:()=>E});const E=`

uniform float opacity;
uniform vec3 outlineColor;
uniform vec3 fogColor;
uniform float fogNear;
uniform float fogFar;
uniform mat4 projectionMatrix;
varying vec2 mapping;
varying float rval;
varying vec3 center;

uniform float outlinePushback;

//DEFINEFRAGCOLOR

void main() {
    float lensqr = dot(mapping,mapping);
    float rsqr = rval*rval;
    if(lensqr > rsqr)
       discard;
    float z = sqrt(rsqr-lensqr);
    vec3 cameraPos = center+ vec3(mapping.x,mapping.y,z-outlinePushback);
    vec4 clipPos = projectionMatrix * vec4(cameraPos, 1.0);
    float ndcDepth = clipPos.z / clipPos.w;
    gl_FragDepthEXT = ((gl_DepthRange.diff * ndcDepth) + gl_DepthRange.near + gl_DepthRange.far) / 2.0;
    gl_FragColor = vec4(outlineColor, 1 );

    if(fogNear != fogFar) {
        float depth = -cameraPos.z;
        float fogFactor = smoothstep( fogNear, fogFar, depth );
        gl_FragColor = mix( gl_FragColor, vec4( fogColor, gl_FragColor.w ), fogFactor );
    }
}


`},"./src/WebGL/shaders/lib/sphereimposteroutline/sphereimposteroutline.vert"(K,C,f){f.r(C),f.d(C,{default:()=>E});const E=`

uniform mat4 modelViewMatrix;
uniform mat4 projectionMatrix;
uniform float outlineWidth;
uniform float outlinePushback;
uniform float outlineMaxPixels;
uniform float vWidth;
uniform float vHeight;

attribute vec3 position;
attribute vec3 normal;
attribute vec3 color;

varying vec2 mapping;
varying float rval;
varying vec3 center;

void main() {

    vec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );
    center = mvPosition.xyz;
    vec4 projPosition = projectionMatrix * mvPosition;
    vec2 norm = normal.xy + vec2(sign(normal.x)*outlineWidth,sign(normal.y)*outlineWidth);

    vec4 adjust = projectionMatrix* vec4(norm,normal.z,1.0); 
    mapping = norm.xy;
    rval = abs(norm.x);
    gl_Position = projPosition+vec4(adjust.xy,0.0,0.0);

    if(outlineMaxPixels > 0.0) {
        vec4 unadjusted = projectionMatrix*vec4(center.x+normal.x, center.y,center.z,1.0); 
        vec4 ccoord = projectionMatrix*vec4(center.xyz,1.0);
        adjust = projectionMatrix* vec4(center.x+norm.x,center.y,center.z,1.0); 
        //subtract center 
        unadjusted.xyz -= ccoord.xyz;
        adjust.xyz -= ccoord.xyz;
        unadjusted /= unadjusted.w;
        adjust /= adjust.w;
        float diff = abs(adjust.x-unadjusted.x);
        diff *= vWidth;
        if(diff > outlineMaxPixels) {
            
            float fixlen = abs(unadjusted.x) + outlineMaxPixels/vWidth;
            //adjsut reval by ratio of lengths
            rval *= fixlen/abs(adjust.x);
        }

    }
}

`},"./src/WebGL/shaders/lib/sphereimposteroutline/uniforms.ts"(K,C,f){f.r(C),f.d(C,{uniforms:()=>S});var E=f("./src/colors.ts");const S={opacity:{type:"f",value:1},outlineColor:{type:"c",value:new E.Color(0,0,0)},fogColor:{type:"c",value:new E.Color(1,1,1)},fogNear:{type:"f",value:1},fogFar:{type:"f",value:2e3},outlineWidth:{type:"f",value:.1},outlinePushback:{type:"f",value:1},outlineMaxPixels:{type:"f",value:0}}},"./src/WebGL/shaders/lib/sprite/index.ts"(K,C,f){f.r(C),f.d(C,{sprite:()=>O});var E=f("./src/WebGL/shaders/lib/sprite/uniforms.ts"),S=f("./src/WebGL/shaders/lib/sprite/sprite.frag"),w=f("./src/WebGL/shaders/lib/sprite/sprite.vert");const O={fragmentShader:S.default.replace("#define GLSLIFY 1",""),vertexShader:w.default.replace("#define GLSLIFY 1",""),uniforms:E.uniforms}},"./src/WebGL/shaders/lib/sprite/sprite.frag"(K,C,f){f.r(C),f.d(C,{default:()=>E});const E=`

uniform vec3 color;
uniform sampler2D map;
uniform float opacity;

uniform vec3 fogColor;
uniform float fogNear;
uniform float fogFar;
uniform float alphaTest;

varying vec2 vUV;
//DEFINEFRAGCOLOR

void main() {

    vec4 texture = texture2D(map, vUV);

    if (texture.a <= alphaTest) discard;

    gl_FragColor = vec4(color * texture.xyz, texture.a * opacity);

    if (fogNear != fogFar) {

        float depth = gl_FragCoord.z / gl_FragCoord.w; //probably wrong
        float fogFactor = smoothstep(fogNear, fogFar, depth);        
        gl_FragColor = mix(gl_FragColor, vec4(fogColor, gl_FragColor.w), fogFactor);
    }
}

`},"./src/WebGL/shaders/lib/sprite/sprite.vert"(K,C,f){f.r(C),f.d(C,{default:()=>E});const E=`

uniform int useScreenCoordinates;
uniform vec3 screenPosition;
uniform mat4 modelViewMatrix;
uniform mat4 projectionMatrix;
uniform float rotation;
uniform vec2 scale;
uniform vec2 alignment;
uniform vec2 uvOffset;
uniform vec2 uvScale;

attribute vec2 position;
attribute vec2 uv;

varying vec2 vUV;

void main() {

    vUV = uvOffset + uv * uvScale;

    vec2 alignedPosition = position + alignment;

    vec2 rotatedPosition;
    rotatedPosition.x = ( cos(rotation) * alignedPosition.x - sin(rotation) * alignedPosition.y ) * scale.x;
    rotatedPosition.y = ( sin(rotation) * alignedPosition.x + cos(rotation) * alignedPosition.y ) * scale.y;

    vec4 finalPosition;

    if(useScreenCoordinates != 0) {
        finalPosition = vec4(screenPosition.xy + rotatedPosition, screenPosition.z, 1.0);
    }

    else {
        finalPosition = projectionMatrix * modelViewMatrix * vec4(0.0, 0.0, 0.0, 1.0); finalPosition /= finalPosition.w;
        finalPosition.xy += rotatedPosition; 
    }

    gl_Position = finalPosition;

}

`},"./src/WebGL/shaders/lib/sprite/uniforms.ts"(K,C,f){f.r(C),f.d(C,{uniforms:()=>E});const E={}},"./src/WebGL/shaders/lib/ssao/index.ts"(K,C,f){f.r(C),f.d(C,{ssao:()=>O});var E=f("./src/WebGL/shaders/lib/ssao/uniforms.ts"),S=f("./src/WebGL/shaders/lib/ssao/ssao.frag"),w=f("./src/WebGL/shaders/lib/ssao/ssao.vert");const O={fragmentShader:S.default,vertexShader:w.default,uniforms:E.uniforms}},"./src/WebGL/shaders/lib/ssao/ssao.frag"(K,C,f){f.r(C),f.d(C,{default:()=>E});const E=`uniform sampler2D depthmap;
varying highp vec2 vTexCoords;
uniform float vWidth;
uniform float vHeight;
uniform float total_strength;
uniform float radius;
uniform mat4 projinv;
uniform mat4 projectionMatrix;

//code for pseudorandom vector from chatgpt
float hash(vec3 p) {
    p = fract(p * vec3(0.1031, 0.1030, 0.0973));
    p += dot(p, p.yzx + 33.33);
    return fract((p.x + p.y) * p.z);
}

// Generate a pseudorandom vec3 from a seed vec3
vec3 pseudorandomVec3(vec3 seed) {
    vec3 randomVec;
    randomVec.x = hash(seed);
    randomVec.y = hash(seed + vec3(1.0, 0.0, 17.1));
    randomVec.z = hash(seed + vec3(0.0, 13.23, 0.0));
    return randomVec;
}

void main(void)
{   
   const float base = 0.2;
   const float area = 0.75;
   const int cycles = 1;

   const int samples = 64;
   vec3 sample_sphere[64] = vec3[](
      vec3(0.091258,-0.510164,0.000000),
      vec3(-0.204347,-0.872967,0.187199),
      vec3(0.009690,-0.263696,-0.110414),
      vec3(0.175208,-0.563987,0.228527),
      vec3(-0.001824,-0.003113,-0.000323),
      vec3(0.411134,-0.719869,-0.261530),
      vec3(-0.074272,-0.377368,0.276290),
      vec3(-0.147773,-0.381587,-0.284529),
      vec3(0.173317,-0.199635,0.063295),
      vec3(-0.186452,-0.199460,0.076965),
      vec3(0.143985,-0.308160,-0.307687),
      vec3(0.053194,-0.148286,0.169589),
      vec3(-0.547656,-0.486476,-0.317378),
      vec3(0.020804,-0.015092,-0.004574),
      vec3(-0.038006,-0.043165,0.054059),
      vec3(-0.094795,-0.443908,-0.731525),
      vec3(0.547552,-0.396466,0.461477),
      vec3(-0.176886,-0.089989,0.007315),
      vec3(0.074401,-0.048840,-0.074039),
      vec3(-0.008240,-0.075697,0.178197),
      vec3(-0.307880,-0.185053,-0.368943),
      vec3(0.309520,-0.108483,0.041646),
      vec3(-0.773478,-0.292946,0.538166),
      vec3(0.184487,-0.231594,-0.820065),
      vec3(0.207318,-0.100531,0.361797),
      vec3(-0.173306,-0.037737,-0.055289),
      vec3(0.548102,-0.105342,-0.253237),
      vec3(-0.119342,-0.043907,0.285162),
      vec3(-0.270247,-0.087861,-0.751357),
      vec3(0.449312,-0.039777,0.236146),
      vec3(-0.743773,-0.036095,0.196056),
      vec3(0.148819,-0.004300,-0.231448),
      vec3(0.008773,0.000809,0.051047),
      vec3(-0.461467,0.027390,-0.357386),
      vec3(0.169626,0.013338,-0.014053),
      vec3(-0.043786,0.007095,0.047331),
      vec3(0.004821,0.140371,-0.988260),
      vec3(0.092402,0.023994,0.101860),
      vec3(-0.295335,0.061530,-0.027372),
      vec3(0.024903,0.007537,-0.018901),
      vec3(-0.081463,0.125402,0.447794),
      vec3(-0.397119,0.231805,-0.631062),
      vec3(0.163853,0.059014,0.044905),
      vec3(-0.495220,0.214357,0.254139),
      vec3(0.306123,0.373687,-0.825715),
      vec3(0.021665,0.026737,0.053220),
      vec3(-0.208231,0.117129,-0.098685),
      vec3(0.139749,0.080968,-0.043086),
      vec3(-0.153599,0.182814,0.262090),
      vec3(-0.159673,0.496777,-0.743568),
      vec3(0.134797,0.117152,0.095753),
      vec3(-0.155626,0.120533,0.019395),
      vec3(0.042311,0.054462,-0.049709),
      vec3(0.001257,0.031288,0.034468),
      vec3(-0.002271,0.003199,-0.002304),
      vec3(0.662104,0.717307,0.033854),
      vec3(-0.373100,0.576021,0.308274),
      vec3(0.024233,0.231316,-0.173688),
      vec3(0.161311,0.420217,0.234273),
      vec3(-0.045248,0.078031,-0.010411),
      vec3(0.167453,0.376942,-0.094872),
      vec3(-0.056194,0.433247,0.173218),
      vec3(-0.016224,0.123149,-0.035569),
      vec3(0.067127,0.407641,0.028479)
   );

   float depth = texture2D(depthmap, vTexCoords).r;
   if(depth == 1.0) {
      discard;
   }

   vec4 screen_position = vec4(vTexCoords, depth,1.0);
   vec4 pos = projinv*screen_position;
   pos /= pos.w;
   vec3 position = pos.xyz;

   //approximate the normal from the depth map; I find this simpler
   //than trying to recompute the exact normal within every possible object shader

   //pixel offset positions in screen space
   ivec2 dim = textureSize(depthmap,0);
   vec2 offset1 = vec2(0.0,1.0/float(dim.y));
   vec2 offset2 = vec2(1.0/float(dim.x),0.0);
   float depth1 = texture2D(depthmap, vTexCoords + offset1).r;
   float depth2 = texture2D(depthmap, vTexCoords + offset2).r;
   
   vec3 p1 = vec3(screen_position.xy+offset1, depth1 - depth);
   vec3 p2 = vec3(screen_position.xy+offset2, depth2 - depth);

   //convert to model space
   vec4 pos1 = projinv*vec4(p1,1);
   pos1 /= pos1.w;
   vec4 pos2 = projinv*vec4(p2,1);
   pos2 /= pos2.w;

   vec3 normal = normalize(cross(pos1.xyz-position, pos2.xyz-position)); //model normal, important we normalize in model space

   //pseudo random number

   float occlusion = 0.0;
   for(int c = 0; c < cycles; c++) {
   vec3 random = normalize(pseudorandomVec3(position+float(c)));
   for(int i=0; i < samples; i++) {

      vec3 ray = radius * reflect(sample_sphere[i],random);
      vec3 hemi_ray = position + sign(dot(ray,normal)) * ray; //model space
      vec4 hemi_screen = projectionMatrix*vec4(hemi_ray,1.0);
      hemi_screen /= hemi_screen.w;
      
      float occ_depth = texture2D(depthmap, clamp(hemi_screen.xy,0.0,1.0)).r;
      float difference = hemi_screen.z - occ_depth;
      
      occlusion += step(0.0, difference) * (1.0-smoothstep(0.0, area, difference));
   }
   }
   float ao = 1.0 - total_strength * occlusion * (1.0 / float(cycles*samples));
   gl_FragDepthEXT = clamp(ao+base,0.0,1.0);

}`},"./src/WebGL/shaders/lib/ssao/ssao.vert"(K,C,f){f.r(C),f.d(C,{default:()=>E});const E=`attribute vec2 vertexPosition;
varying highp vec2 vTexCoords;
const vec2 scale = vec2(0.5, 0.5);

void main() {
   vTexCoords  = vertexPosition * scale + scale; // scale vertex attribute to [0,1] range
   gl_Position = vec4(vertexPosition, 0.0, 1.0);
}
        `},"./src/WebGL/shaders/lib/ssao/uniforms.ts"(K,C,f){f.r(C),f.d(C,{uniforms:()=>E});const E={total_strength:{type:"f",value:1},radius:{type:"f",value:5},projinv:{type:"mat4",value:[]}}},"./src/WebGL/shaders/lib/stickimposter/index.ts"(K,C,f){f.r(C),f.d(C,{stickimposter:()=>x});var E=f("./src/WebGL/shaders/lib/stickimposter/uniforms.ts"),S=f("./src/WebGL/shaders/lib/stickimposter/stickimposterFragmentShader.partial.frag"),w=f("./src/WebGL/shaders/lib/stickimposter/stickimposter.partial.frag"),O=f("./src/WebGL/shaders/lib/stickimposter/stickimposter.vert");const x={fragmentShader:[S.default,w.default].join(`
`),vertexShader:O.default,uniforms:E.uniforms}},"./src/WebGL/shaders/lib/stickimposter/stickimposter.partial.frag"(K,C,f){f.r(C),f.d(C,{default:()=>E});const E=`    float dotProduct = dot( norm, vLight );
    vec3 light = vec3( max( dotProduct, 0.0 ) );
    color *= light;
#ifdef SHADED
    ivec2 dim = textureSize(shading,0);
    float shadowFactor = texture2D(shading,vec2(gl_FragCoord.x/float(dim.x),gl_FragCoord.y/float(dim.y))).r;
    color *= shadowFactor;
#endif    
    gl_FragColor = vec4(color, opacity*opacity );
    if(fogNear != fogFar) {
        float depth = -qi.z;
        float fogFactor = smoothstep( fogNear, fogFar, depth );
        gl_FragColor = mix( gl_FragColor, vec4( fogColor, gl_FragColor.w ), fogFactor );
    }
}`},"./src/WebGL/shaders/lib/stickimposter/stickimposter.vert"(K,C,f){f.r(C),f.d(C,{default:()=>E});const E=`

uniform mat4 modelViewMatrix;
uniform mat4 projectionMatrix;
uniform mat4 viewMatrix;
uniform mat3 normalMatrix;
uniform vec3 directionalLightColor[ 1 ];
uniform vec3 directionalLightDirection[ 1 ];

attribute vec3 position;
attribute vec3 normal;
attribute vec3 color;
attribute float radius;

varying vec3 vColor;
varying vec3 vLight;
varying vec3 cposition;
varying vec3 p1;
varying vec3 p2;
varying float r;

void main() {

    vColor = color; vColor.z = abs(vColor.z); //z indicates which vertex and so would vary
    r = abs(radius);
    vec4 to = modelViewMatrix*vec4(normal, 1.0); //normal is other point of cylinder
    vec4 pt = modelViewMatrix*vec4(position, 1.0);
    vec4 mvPosition = pt;
    p1 = pt.xyz; p2 = to.xyz;
    vec3 norm = to.xyz-pt.xyz;
    float mult = 1.1; //slop to account for perspective of sphere
    if(length(p1) > length(p2)) { //billboard at level of closest point
       mvPosition = to;
    }
    vec3 n = normalize(mvPosition.xyz);
    bool isperspective = (projectionMatrix[3][3] == 0.0);
//intersect with the plane defined by the camera looking at the billboard point
    if(color.z >= 0.0) { //p1
       if(isperspective) { //perspective
         vec3 pnorm = normalize(p1);
         float t = dot(mvPosition.xyz-p1,n)/dot(pnorm,n);
         mvPosition.xyz = p1+t*pnorm; 
       } else { //orthographic
         mvPosition.xyz = p1;
       }
    } else {
      if(isperspective) { //perspective
         vec3 pnorm = normalize(p2);
         float t = dot(mvPosition.xyz-p2,n)/dot(pnorm,n);
         mvPosition.xyz = p2+t*pnorm;
       } else { //orthographic
         mvPosition.xyz = p2;
       } 
       mult *= -1.0;
    }

    if(isperspective) { //perspective
      vec3 cr = normalize(cross(mvPosition.xyz,norm))*radius;
      vec3 doublecr = normalize(cross(mvPosition.xyz,cr))*radius;
      mvPosition.xyz +=  mult*(cr + doublecr).xyz;
    } else {
      vec3 cr = normalize(cross(vec3(0.0,0.0,-1.0),norm))*radius;
      vec3 doublecr = normalize(cross(vec3(0.0,0.0,-1.0),cr))*radius;
      mvPosition.xyz +=  mult*(cr + doublecr).xyz;     
    }

    cposition = mvPosition.xyz;
    gl_Position = projectionMatrix * mvPosition;
    vec4 lDirection = viewMatrix * vec4( directionalLightDirection[ 0 ], 0.0 );
    vLight = normalize( lDirection.xyz )*directionalLightColor[0]; //not really sure this is right, but color is always white so..
}

`},"./src/WebGL/shaders/lib/stickimposter/stickimposterFragmentShader.partial.frag"(K,C,f){f.r(C),f.d(C,{default:()=>E});const E=`uniform float opacity;
uniform mat4 projectionMatrix;

uniform vec3 fogColor;
uniform float fogNear;
uniform float fogFar;

varying vec3 vLight;
varying vec3 vColor;
varying vec3 cposition;
varying vec3 p1;
varying vec3 p2;
varying float r;

#ifdef SHADED
uniform highp sampler2D shading;
#endif

//DEFINEFRAGCOLOR

//cylinder-ray intersection testing taken from http://mrl.nyu.edu/~dzorin/cg05/lecture12.pdf
//also useful: http://stackoverflow.com/questions/9595300/cylinder-impostor-in-glsl
//with a bit more care (caps) this could be a general cylinder imposter (see also outline)
void main() {
    vec3 color = abs(vColor);
    vec3 pos = cposition;
    vec3 p = pos; //ray point
    vec3 v = vec3(0.0,0.0,-1.0); //ray normal - orthographic
    if(projectionMatrix[3][3] == 0.0) v = normalize(pos); //ray normal - perspective
    vec3 pa = p1; //cyl start
    vec3 va = normalize(p2-p1); //cyl norm
    vec3 tmp1 = v-(dot(v,va)*va);
    vec3 deltap = p-pa;
    float A = dot(tmp1,tmp1);
    if(A == 0.0) discard;
    vec3 tmp2 = deltap-(dot(deltap,va)*va);
    float B = 2.0*dot(tmp1, tmp2);
    float C = dot(tmp2,tmp2)-r*r;
//quadratic equation!
    float det = (B*B) - (4.0*A*C);
    if(det < 0.0) discard;
    float sqrtDet = sqrt(det);
    float posT = (-B+sqrtDet)/(2.0*A);
    float negT = (-B-sqrtDet)/(2.0*A);
    float intersectionT = min(posT,negT);
    vec3 qi = p+v*intersectionT;
    float dotp1 = dot(va,qi-p1);
    float dotp2 = dot(va,qi-p2);
    vec3 norm;
    if( dotp1 < 0.0 || dotp2 > 0.0) { //(p-c)^2 + 2(p-c)vt +v^2+t^2 - r^2 = 0
       vec3 cp;
       if( dotp1 < 0.0) {  
//        if(vColor.x < 0.0 ) discard; //color sign bit indicates if we should cap or not
        cp = p1;
       } else {
//          if(vColor.y < 0.0 ) discard;
          cp = p2;
       }
       vec3 diff = p-cp;
       A = dot(v,v);
       B = dot(diff,v)*2.0;
       C = dot(diff,diff)-r*r;
       det = (B*B) - (4.0*C);
       if(det < 0.0) discard;
       sqrtDet = sqrt(det);
       posT = (-B+sqrtDet)/(2.0);
       negT = (-B-sqrtDet)/(2.0);
       float t = min(posT,negT);
       qi = p+v*t; 
       norm = normalize(qi-cp); 
    } else {
       norm = normalize(qi-(dotp1*va + p1));
    }
    vec4 clipPos = projectionMatrix * vec4(qi, 1.0);
    float ndcDepth = clipPos.z / clipPos.w;
    float depth = ((gl_DepthRange.diff * ndcDepth) + gl_DepthRange.near + gl_DepthRange.far) / 2.0;
    gl_FragDepthEXT = depth;`},"./src/WebGL/shaders/lib/stickimposter/uniforms.ts"(K,C,f){f.r(C),f.d(C,{uniforms:()=>S});var E=f("./src/colors.ts");const S={opacity:{type:"f",value:1},fogColor:{type:"c",value:new E.Color(1,1,1)},fogNear:{type:"f",value:1},fogFar:{type:"f",value:2e3},directionalLightColor:{type:"fv",value:[]},directionalLightDirection:{type:"fv",value:[]}}},"./src/WebGL/shaders/lib/stickimposteroutline/index.ts"(K,C,f){f.r(C),f.d(C,{stickimposteroutline:()=>x});var E=f("./src/WebGL/shaders/lib/stickimposteroutline/uniforms.ts"),S=f("./src/WebGL/shaders/lib/stickimposter/stickimposterFragmentShader.partial.frag"),w=f("./src/WebGL/shaders/lib/stickimposteroutline/stickimposteroutline.partial.frag"),O=f("./src/WebGL/shaders/lib/stickimposteroutline/stickimposteroutline.vert");const x={fragmentShader:S.default+w.default,vertexShader:O.default,uniforms:E.uniforms}},"./src/WebGL/shaders/lib/stickimposteroutline/stickimposteroutline.partial.frag"(K,C,f){f.r(C),f.d(C,{default:()=>E});const E=`
    gl_FragColor = vec4(color, opacity*opacity );
    if(fogNear != fogFar) {
        float depth = -qi.z;
        float fogFactor = smoothstep( fogNear, fogFar, depth );
        gl_FragColor = mix( gl_FragColor, vec4( fogColor, gl_FragColor.w ), fogFactor );
    }
}`},"./src/WebGL/shaders/lib/stickimposteroutline/stickimposteroutline.vert"(K,C,f){f.r(C),f.d(C,{default:()=>E});const E=`

uniform mat4 modelViewMatrix;
uniform mat4 projectionMatrix;
uniform mat4 viewMatrix;
uniform mat3 normalMatrix;
uniform vec3 directionalLightColor[ 1 ];
uniform vec3 directionalLightDirection[ 1 ];
uniform vec3 outlineColor;
uniform float outlineWidth;
uniform float outlinePushback;
uniform float outlineMaxPixels;
uniform float vWidth;
uniform mat4 projinv;


attribute vec3 position;
attribute vec3 normal;
attribute vec3 color;
attribute float radius;

varying vec3 vColor;
varying vec3 vLight;
varying vec3 cposition;
varying vec3 p1;
varying vec3 p2;
varying float r;

void main() {

    vColor = outlineColor;
    float rad = radius+sign(radius)*outlineWidth;
    r = abs(rad);

    vec4 to = modelViewMatrix*vec4(normal, 1.0); //normal is other point of cylinder
    vec4 pt = modelViewMatrix*vec4(position, 1.0);
//pushback
    float scale = 1.0;
    if(projectionMatrix[3][3] != 0.0) { //orthographic
        to.z -= outlinePushback;
        pt.z -= outlinePushback;
    } else { //perspective
        vec4 midbefore = pt;
        if(length(to.xyz) < length(pt)) {
            midbefore = to;
        }
        vec4 midafter = midbefore;
        midafter.xyz += normalize(midbefore.xyz)*outlinePushback;

        to.xyz += normalize(to.xyz)*outlinePushback;
        pt.xyz += normalize(pt.xyz)*outlinePushback;

        //figure out a scaling factor for radius to account for perspective setback
        vec4 midbeforer = vec4(midbefore.x+rad,midbefore.y, midbefore.z, midbefore.w);
        vec4 midafterr = vec4(midafter.x+rad,midafter.y, midafter.z, midafter.w);

        vec4 mb = projectionMatrix*midbefore;
        vec4 mbr = projectionMatrix*midbeforer;
        vec4 ma = projectionMatrix*midafter;
        vec4 mar = projectionMatrix*midafterr;
        mb /= mb.w;
        mbr /= mbr.w;
        ma /= ma.w;
        mar /= mar.w;
        scale = abs((mbr.x-mb.x)/(mar.x-ma.x));
        rad *= scale;
        r = abs(rad);
    }
    vec4 mvPosition = pt;
    p1 = pt.xyz; p2 = to.xyz;
    vec3 norm = to.xyz-pt.xyz;
    float mult = 1.1; //slop to account for perspective of sphere
    if(length(p1) > length(p2)) { //billboard at level of closest point
       mvPosition = to;
    }

    vec3 n = normalize(mvPosition.xyz);
//intersect with the plane defined by the camera looking at the billboard point
    if(color.z >= 0.0) { //p1
       vec3 pnorm = normalize(p1);
       float t = dot(mvPosition.xyz-p1,n)/dot(pnorm,n);
       mvPosition.xyz = p1+t*pnorm;
    } else {
       vec3 pnorm = normalize(p2);
       float t = dot(mvPosition.xyz-p2,n)/dot(pnorm,n);
       mvPosition.xyz = p2+t*pnorm;
       mult *= -1.0;
    }

    if(outlineMaxPixels > 0.0) {
        vec4 cpos = mvPosition;
        vec4 unadjusted = projectionMatrix*vec4(cpos.x+abs(scale*radius), cpos.y,cpos.z,cpos.w); 
        vec4 ccoord = projectionMatrix*cpos;
        vec4 adjust = projectionMatrix*vec4(cpos.x+r,cpos.y,cpos.z,cpos.w); 
        unadjusted /= unadjusted.w;
        adjust /= adjust.w;
        unadjusted.xyz -= ccoord.xyz/ccoord.w;
        adjust.xyz -= ccoord.xyz/ccoord.w;
        float diff = abs(adjust.x-unadjusted.x);
        diff *= vWidth; //this should now be in pixels
        if(diff > outlineMaxPixels) {
            float fixlen = abs(unadjusted.x) + outlineMaxPixels/vWidth; 
            vec4 pcoord = ccoord;
            pcoord.x += fixlen*pcoord.w;
            vec4 altc = projinv*pcoord;
            r= abs(altc.x-cpos.x);
        }
    }

    vec3 cr = normalize(cross(mvPosition.xyz,norm))*rad;
    vec3 doublecr = normalize(cross(mvPosition.xyz,cr))*rad;
    mvPosition.xy +=  mult*(cr + doublecr).xy;
    cposition = mvPosition.xyz;
    gl_Position = projectionMatrix * mvPosition;
    vLight = vec3(1.0,1.0,1.0);
}

`},"./src/WebGL/shaders/lib/stickimposteroutline/uniforms.ts"(K,C,f){f.r(C),f.d(C,{uniforms:()=>S});var E=f("./src/colors.ts");const S={opacity:{type:"f",value:1},fogColor:{type:"c",value:new E.Color(1,1,1)},fogNear:{type:"f",value:1},fogFar:{type:"f",value:2e3},outlineColor:{type:"c",value:new E.Color(0,0,0)},outlineWidth:{type:"f",value:.1},outlinePushback:{type:"f",value:1},outlineMaxPixels:{type:"f",value:0},projinv:{type:"mat4",value:[]}}},"./src/WebGL/shaders/lib/volumetric/index.ts"(K,C,f){f.r(C),f.d(C,{volumetric:()=>O});var E=f("./src/WebGL/shaders/lib/volumetric/uniforms.ts"),S=f("./src/WebGL/shaders/lib/volumetric/volumetric.frag"),w=f("./src/WebGL/shaders/lib/volumetric/volumetric.vert");const O={fragmentShader:S.default.replace("#define GLSLIFY 1",""),vertexShader:w.default.replace("#define GLSLIFY 1",""),uniforms:E.uniforms}},"./src/WebGL/shaders/lib/volumetric/uniforms.ts"(K,C,f){f.r(C),f.d(C,{uniforms:()=>S});var E=f("./src/colors.ts");const S={opacity:{type:"f",value:1},fogColor:{type:"c",value:new E.Color(1,1,1)},fogNear:{type:"f",value:1},fogFar:{type:"f",value:2e3},data:{type:"i",value:3},colormap:{type:"i",value:4},depthmap:{type:"i",value:5},step:{type:"f",value:1},maxdepth:{type:"f",value:100},subsamples:{type:"f",value:5},textmat:{type:"mat4",value:[]},projinv:{type:"mat4",value:[]},transfermin:{type:"f",value:-.2},transfermax:{type:"f",value:.2}}},"./src/WebGL/shaders/lib/volumetric/volumetric.frag"(K,C,f){f.r(C),f.d(C,{default:()=>E});const E=`
uniform highp sampler3D data;
uniform highp sampler2D colormap;
uniform highp sampler2D depthmap;


uniform mat4 textmat;
uniform mat4 projinv;
uniform mat4 projectionMatrix;

uniform float step;
uniform float subsamples;
uniform float maxdepth;
uniform float transfermin;
uniform float transfermax;
in  vec4 mvPosition;
out vec4 color;
void main(void) {

   vec4 pos = mvPosition;
   bool seengood = false;
   float i = 0.0;
   color = vec4(1,1,1,0);
   float increment = 1.0/subsamples;
   float maxsteps = (maxdepth*subsamples/step);
//there's probably a better way to do this..
//calculate farthest possible point in model coordinates
   vec4 maxpos = vec4(pos.x,pos.y,pos.z-maxdepth,1.0);
// convert to projection
   maxpos = projectionMatrix*maxpos;
   vec4 startp = projectionMatrix*pos;
// homogonize
   maxpos /= maxpos.w;
   startp /= startp.w;
//take x,y from start and z from max
   maxpos = vec4(startp.x,startp.y,maxpos.z,1.0);
//convert back to model space
   maxpos = projinv*maxpos;
   maxpos /= maxpos.w;
   float incr = step/subsamples;
//get depth from depthmap
//startp is apparently [-1,1]
   vec2 tpos = startp.xy/2.0+0.5;
   float depth = texture(depthmap, tpos).r;
//compute vector between start and end
   vec4 direction = maxpos-pos;
   for( i = 0.0; i <= maxsteps; i++) {
      vec4 pt = (pos+(i/maxsteps)*direction);
      vec4 ppt = projectionMatrix*pt;
      float ptdepth = ppt.z/ppt.w;
      ptdepth = ((gl_DepthRange.diff * ptdepth) + gl_DepthRange.near + gl_DepthRange.far) / 2.0;
      if(ptdepth > depth) break;
      pt = textmat*pt;
//       pt /= pt.w;
      if(pt.x >= -0.01 && pt.y >= -0.01 && pt.z >= -0.01 && pt.x <= 1.01 && pt.y <= 1.01 && pt.z <= 1.01) {
         seengood = true;
      } else if(seengood) {
         break;
      }
      if( pt.x < -0.01 || pt.x > 1.01 || pt.y < -0.01 || pt.y > 1.01 || pt.z < -0.01 || pt.z > 1.01  ){
          color.a = 0.0;
          continue;
      }
      else {
         float val = texture(data, pt.zyx).r;
         if(isinf(val)) continue; //masked out
         float cval = (val-transfermin)/(transfermax-transfermin); //scale to texture 0-1 range
         vec4 val_color = texture(colormap, vec2(cval,0.5));
         color.rgb = color.rgb*color.a + (1.0-color.a)*val_color.a*val_color.rgb;
         color.a += (1.0 - color.a) * val_color.a; 
         if(color.a > 0.0) color.rgb /= color.a;
//          color = vec4(pt.x, pt.y, pt.z, 1.0);
      }
//       color = vec4(pt.x, pt.y, pt.z, 0.0)
    }
}

        `},"./src/WebGL/shaders/lib/volumetric/volumetric.vert"(K,C,f){f.r(C),f.d(C,{default:()=>E});const E=`uniform mat4 modelViewMatrix;
uniform mat4 projectionMatrix;
uniform mat4 viewMatrix;

in vec3 position;
out vec4 mvPosition;
void main() {

    mvPosition = modelViewMatrix * vec4( position, 1.0 );
    gl_Position = projectionMatrix*mvPosition;
}
`},"./src/WebGL/shaders/utils/clone.ts"(K,C,f){f.r(C),f.d(C,{clone:()=>S});var E=f("./src/colors.ts");function S(w){let O={};for(const x in w){O[x]={},O[x].type=w[x].type;var p=w[x].value;p instanceof E.Color?O[x].value=p.clone():typeof p=="number"?O[x].value=p:p instanceof Array?O[x].value=[]:console.error("Error copying shader uniforms from ShaderLib: unknown type for uniform")}return O}},"./src/WebGL/shaders/utils/index.ts"(K,C,f){f.r(C),f.d(C,{ShaderUtils:()=>S,clone:()=>E.clone});var E=f("./src/WebGL/shaders/utils/clone.ts");const S={clone:E.clone}},"./src/WebGL/shapes/Cylinder.ts"(K,C,f){f.r(C),f.d(C,{Cylinder:()=>w});var E=f("./src/WebGL/math/index.ts");let S=new E.Vector3;class w{constructor(p=new E.Vector3,x=new E.Vector3,M=0){this.c1=p,this.c2=x,this.radius=M,this.direction=new E.Vector3().subVectors(this.c2,this.c1).normalize()}copy(p){return this.c1.copy(p.c1),this.c2.copy(p.c2),this.direction.copy(p.direction),this.radius=p.radius,this}lengthSq(){return S.subVectors(this.c2,this.c1).lengthSq()}applyMatrix4(p){return this.direction.add(this.c1).applyMatrix4(p),this.c1.applyMatrix4(p),this.c2.applyMatrix4(p),this.direction.sub(this.c1).normalize(),this.radius=this.radius*p.getMaxScaleOnAxis(),this}}},"./src/WebGL/shapes/Sphere.ts"(K,C,f){f.r(C),f.d(C,{Sphere:()=>S});var E=f("./src/WebGL/math/index.ts");class S{constructor(O={x:0,y:0,z:0},p=0){this.center=new E.Vector3(O.x,O.y,O.z),this.radius=p}set(O,p){return this.center.copy(O),this.radius=p,this}copy(O){return this.center.copy(O.center),this.radius=O.radius,this}applyMatrix4(O){return this.center.applyMatrix4(O),this.radius=this.radius*O.getMaxScaleOnAxis(),this}translate(O){return this.center.add(O),this}equals(O){return O.center.equals(this.center)&&O.radius===this.radius}clone(){return new S().copy(this)}}},"./src/WebGL/shapes/Triangle.ts"(K,C,f){f.r(C),f.d(C,{Triangle:()=>w});var E=f("./src/WebGL/math/index.ts");const S=new E.Vector3;class w{constructor(p=new E.Vector3,x=new E.Vector3,M=new E.Vector3){this.a=p,this.b=x,this.c=M}copy(p){return this.a.copy(p.a),this.b.copy(p.b),this.c.copy(p.c),this}applyMatrix4(p){return this.a.applyMatrix4(p),this.b.applyMatrix4(p),this.c.applyMatrix4(p),this}getNormal(){var p=this.a.clone();return p.sub(this.b),S.subVectors(this.c,this.b),p.cross(S),p.normalize(),p}}},"./src/WebGL/shapes/index.ts"(K,C,f){f.r(C),f.d(C,{Cylinder:()=>S.Cylinder,Sphere:()=>E.Sphere,Triangle:()=>w.Triangle});var E=f("./src/WebGL/shapes/Sphere.ts"),S=f("./src/WebGL/shapes/Cylinder.ts"),w=f("./src/WebGL/shapes/Triangle.ts")},"./src/autoload.ts"(K,C,f){f.r(C),f.d(C,{autoinit:()=>p,autoload:()=>m,processing_autoinit:()=>x,viewers:()=>M});var E=f("./src/GLViewer.ts"),S=f("./src/ProteinSurface4.ts"),w=f("./src/utilities.ts"),O=f("./src/colors.ts"),p=!1,x=!1,M={};function m(b,_){var g,v,r;if(document.querySelector(".viewer_3Dmoljs")!=null&&(p=!0),p){x=!0,b=b??null;var e=0;document.querySelectorAll(".viewer_3Dmoljs").forEach(t=>{var n=[],o=[],h="";t.style.position=="static"&&(t.style.position="relative");var d=null;if(r=null,t.dataset.pdb)n.push("https://files.rcsb.org/view/"+t.dataset.pdb+".pdb"),o.push("pdb");else if(t.dataset.cid)o.push("sdf"),n.push("https://pubchem.ncbi.nlm.nih.gov/rest/pug/compound/cid/"+t.dataset.cid+"/SDF?record_type=3d");else if(t.dataset.href||t.dataset.url){if(t.dataset.href?h=t.dataset.href:h=t.dataset.url,n.push(h),r=h.substring(h.lastIndexOf(".")+1),r=="gz"){let pe=h.substring(0,h.lastIndexOf(".")).lastIndexOf(".");r=h.substring(pe+1)}o.push(r);var i=h.substring(h.lastIndexOf("/")+1,h.lastIndexOf("."));i=="/"&&(i=h.substring(h.lastIndexOf("/")+1)),t.dataset[o[o.length-1]]=i}let s=t.dataset;for(g in s)g.substring(0,3)==="pdb"&&g!=="pdb"?(n.push("https://files.rcsb.org/view/"+s[g]+".pdb"),o.push("pdb")):g.substring(0,4)==="href"&&g!=="href"?(h=s[g],n.push(h),o.push(h.substring(h.lastIndexOf(".")+1))):g.substring(0,3)==="cid"&&g!=="cid"&&(n.push("https://pubchem.ncbi.nlm.nih.gov/rest/pug/compound/cid/"+s[g]+"/SDF?record_type=3d"),o.push("sdf"));var a={};t.dataset.options&&(a=(0,w.specStringToObject)(t.dataset.options));var c=O.CC.color(t.dataset.backgroundcolor),u=t.dataset.backgroundalpha;u=u==null?1:parseFloat(u);var A={line:{}};t.dataset.style&&(A=(0,w.specStringToObject)(t.dataset.style));var L={};t.dataset.select&&(L=(0,w.specStringToObject)(t.dataset.select));var D=[],R=[],P=[],z={},F=null,B=t.dataset,U=/style(.+)/,W=/surface(.*)/,I=/labelres(.*)/,V=[];for(v in B)Object.prototype.hasOwnProperty.call(B,v)&&V.push(v);for(V.sort(),g=0;g<V.length;g++){v=V[g];var ee=U.exec(v),te,ae,re;ee&&(te="select"+ee[1],ae=(0,w.specStringToObject)(B[te]),re=(0,w.specStringToObject)(B[v]),D.push([ae,re])),ee=W.exec(v),ee&&(te="select"+ee[1],ae=(0,w.specStringToObject)(B[te]),re=(0,w.specStringToObject)(B[v]),R.push([ae,re])),ee=I.exec(v),ee&&(te="select"+ee[1],ae=(0,w.specStringToObject)(B[te]),re=(0,w.specStringToObject)(B[v]),P.push([ae,re])),v=="zoomto"&&(z=(0,w.specStringToObject)(B[v])),v=="spin"&&(F=(0,w.specStringToObject)(B[v]))}var fe=function(pe){for(pe.setStyle(L,A),d&&d.createSelectionAndStyle(L,A),g=0;g<D.length;g++){let J=D[g][0]||{},ce=D[g][1]||{line:{}};pe.setStyle(J,ce),d&&d.createSelectionAndStyle(L,A)}for(g=0;g<R.length;g++){let J=R[g][0]||{},ce=R[g][1]||{};d?pe.addSurface(S.SurfaceType.VDW,ce,J,J).then(Fe=>{d.loadSurface("VDW",J,ce,Fe)}):pe.addSurface(S.SurfaceType.VDW,ce,J,J)}for(g=0;g<P.length;g++){let J=P[g][0]||{},ce=P[g][1]||{};pe.addResLabels(J,ce)}pe.render(),pe.zoomTo(z),F&&pe.spin(F.axis,F.speed)};let q=b;try{var oe=(0,w.specStringToObject)(t.dataset.config)||{};oe.backgroundColor===void 0&&(oe.backgroundColor=c),oe.backgroundAlpha===void 0&&(oe.backgroundAlpha=u),q==null?q=M[t.id||e++]=(0,E.createViewer)(t,oe):(q.setBackgroundColor(c,u),q.setConfig(oe),d&&d.initiateUI()),t.dataset.ui&&$3Dmol.StateManager&&(d=new $3Dmol.StateManager(q))}catch(pe){console.log(pe),t.textContent="WebGL appears to be disabled."}if(n.length!=0){let pe=0,J=((ce,Me)=>function(Fe){h=n[pe];var ze=ce.dataset.type||ce.dataset.datatype||o[pe];if(Me.addModel(Fe,ze,a),d){var Be=ce.dataset[o[pe]];d.setModelTitle(Be)}pe+=1,pe<n.length?(0,w.get)(n[pe]).then(J):(fe(Me),ce.dataset.callback&&(0,w.makeFunction)(ce.dataset.callback)(Me),x=!1,_&&_(Me))})(t,q);r&&r.endsWith("gz")?(0,w.getbin)(n[0]).then(J):(0,w.get)(n[0]).then(J)}else{if(t.dataset.element){var be="#"+t.dataset.element,ge=document.querySelector(be),Le=ge?ge.textContent:"";r=t.dataset.type||t.dataset.datatype,q.addModel(Le,r,a)}fe(q),t.dataset.callback&&(0,w.makeFunction)(t.dataset.callback)(q),x=!1,_&&_(q)}})}}document.onreadystatechange=()=>{document.readyState==="complete"&&m()}},"./src/colors.ts"(K,C,f){f.r(C),f.d(C,{CC:()=>S,Color:()=>E,builtinColorSchemes:()=>b,chains:()=>m,elementColors:()=>x,htmlColors:()=>w,residues:()=>M,ssColors:()=>O});class E{constructor(g,v,r){return this.r=0,this.g=0,this.b=0,arguments.length>1&&typeof g=="number"?(this.r=g||0,this.g=v||0,this.b=r||0,this):this.set(g||0)}set(g){return g instanceof E?g.clone():(typeof g=="number"?this.setHex(g):typeof g=="object"&&(this.r=(g==null?void 0:g.r)||0,this.g=(g==null?void 0:g.g)||0,this.b=(g==null?void 0:g.b)||0),this)}setHex(g){return g=Math.floor(g),this.r=(g>>16&255)/255,this.g=(g>>8&255)/255,this.b=(g&255)/255,this}getHex(){var g=Math.round(this.r*255),v=Math.round(this.g*255),r=Math.round(this.b*255);return g<<16|v<<8|r}clone(){return new E(this.r,this.g,this.b)}copy(g){return this.r=g.r,this.g=g.g,this.b=g.b,this}scaled(){var g={};return g.r=Math.round(this.r*255),g.g=Math.round(this.g*255),g.b=Math.round(this.b*255),g.a=1,g}}class S{static color(g){if(!g)return S.cache[0];if(g instanceof E)return g;if(typeof g=="number"&&typeof S.cache[g]<"u")return S.cache[g];if(g&&Array.isArray(g))return g.map(S.color);let v=S.getHex(g),r=new E(v);return S.cache[v]=r,r}static getHex(g){if(Array.isArray(g))return g.map(S.getHex);if(typeof g=="string"){let v=g;if(!isNaN(parseInt(v)))return parseInt(v);if(v=v.trim(),v.length==4&&v[0]=="#"&&(v="#"+v[1]+v[1]+v[2]+v[2]+v[3]+v[3]),v.length==7&&v[0]=="#")return parseInt(v.substring(1),16);let r=S.rgbRegEx.exec(v);if(r){r[1]!=""&&console.log("WARNING: Opacity value in rgba ignored.  Specify separately as opacity attribute.");let t=0;for(let n=2;n<5;n++){t*=256;let o=r[n].endsWith("%")?255*parseFloat(r[n])/100:parseFloat(r[n]);t+=Math.round(o)}return t}let e=w[v.toLowerCase()];return e!==void 0?e:(console.error("color not found",g.toLowerCase(),w),0)}return g}}S.rgbRegEx=/rgb(a?)\(\s*([^ ,\)\t]+)\s*,\s*([^ ,\)\t]+)\s*,\s*([^ ,\)\t]+)/i,S.cache={0:new E(0)};const w={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgrey:11119017,darkgreen:25600,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,grey:8421504,green:32768,greenyellow:11403055,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgrey:13882323,lightgreen:9498256,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074,b:255,g:32768,r:16711680,c:49087,m:12517567,y:12566272,k:0,w:16777215},O={pyMol:{h:16711680,s:16776960,c:65280},Jmol:{h:16711808,s:16762880,c:16777215}},p={H:16777215,He:16761035,HE:16761035,Li:11674146,LI:11674146,B:65280,C:13158600,N:9408511,O:15728640,F:14329120,Na:255,NA:255,Mg:2263842,MG:2263842,Al:8421520,AL:8421520,Si:14329120,SI:14329120,P:16753920,S:16762930,Cl:65280,CL:65280,Ca:8421520,CA:8421520,Ti:8421520,TI:8421520,Cr:8421520,CR:8421520,Mn:8421520,MN:8421520,Fe:16753920,FE:16753920,Ni:10824234,NI:10824234,Cu:10824234,CU:10824234,Zn:10824234,ZN:10824234,Br:10824234,BR:10824234,Ag:8421520,AG:8421520,I:10494192,Ba:16753920,BA:16753920,Au:14329120,AU:14329120},x={defaultColor:16716947,Jmol:{H:16777215,He:14286847,HE:14286847,Li:13402367,LI:13402367,Be:12779264,BE:12779264,B:16758197,C:9474192,N:3166456,O:16715021,F:9494608,Ne:11789301,NE:11789301,Na:11230450,NA:11230450,Mg:9109248,MG:9109248,Al:12560038,AL:12560038,Si:1578e4,SI:1578e4,P:16744448,S:16777008,Cl:2093087,CL:2093087,Ar:8442339,AR:8442339,K:9388244,Ca:4062976,CA:4062976,Sc:15132390,SC:15132390,Ti:12567239,TI:12567239,V:10921643,Cr:9083335,CR:9083335,Mn:10255047,MN:10255047,Fe:14706227,FE:14706227,Co:15765664,CO:15765664,Ni:5296208,NI:5296208,Cu:13140019,CU:13140019,Zn:8224944,ZN:8224944,Ga:12750735,GA:12750735,Ge:6721423,GE:6721423,As:12419299,AS:12419299,Se:16752896,SE:16752896,Br:10889513,BR:10889513,Kr:6076625,KR:6076625,Rb:7351984,RB:7351984,Sr:65280,SR:65280,Y:9764863,Zr:9756896,ZR:9756896,Nb:7586505,NB:7586505,Mo:5551541,MO:5551541,Tc:3907230,TC:3907230,Ru:2396047,RU:2396047,Rh:687500,RH:687500,Pd:27013,PD:27013,Ag:12632256,AG:12632256,Cd:16767375,CD:16767375,In:10909043,IN:10909043,Sn:6717568,SN:6717568,Sb:10380213,SB:10380213,Te:13924864,TE:13924864,I:9699476,Xe:4366e3,XE:4366e3,Cs:5707663,CS:5707663,Ba:51456,BA:51456,La:7394559,LA:7394559,Ce:16777159,CE:16777159,Pr:14286791,PR:14286791,Nd:13107143,ND:13107143,Pm:10747847,PM:10747847,Sm:9437127,SM:9437127,Eu:6422471,EU:6422471,Gd:4587463,GD:4587463,Tb:3211207,TB:3211207,Dy:2097095,DY:2097095,Ho:65436,HO:65436,Er:58997,ER:58997,Tm:54354,TM:54354,Yb:48952,YB:48952,Lu:43812,LU:43812,Hf:5096191,HF:5096191,Ta:5089023,TA:5089023,W:2200790,Re:2522539,RE:2522539,Os:2516630,OS:2516630,Ir:1528967,IR:1528967,Pt:13684960,PT:13684960,Au:16765219,AU:16765219,Hg:12105936,HG:12105936,Tl:10900557,TL:10900557,Pb:5724513,PB:5724513,Bi:10375093,BI:10375093,Po:11230208,PO:11230208,At:7688005,AT:7688005,Rn:4358806,RN:4358806,Fr:4325478,FR:4325478,Ra:32e3,RA:32e3,Ac:7384058,AC:7384058,Th:47871,TH:47871,Pa:41471,PA:41471,U:36863,Np:33023,NP:33023,Pu:27647,PU:27647,Am:5528818,AM:5528818,Cm:7888099,CM:7888099,Bk:9064419,BK:9064419,Cf:10565332,CF:10565332,Es:11739092,ES:11739092,Fm:11739066,FM:11739066,Md:11734438,MD:11734438,No:12389767,NO:12389767,Lr:13041766,LR:13041766,Rf:13369433,RF:13369433,Db:13697103,DB:13697103,Sg:14221381,SG:14221381,Bh:14680120,BH:14680120,Hs:15073326,HS:15073326,Mt:15400998,MT:15400998},rasmol:p,defaultColors:Object.assign({},p),greenCarbon:Object.assign(Object.assign({},p),{C:65280}),cyanCarbon:Object.assign(Object.assign({},p),{C:65535}),magentaCarbon:Object.assign(Object.assign({},p),{C:16711935}),yellowCarbon:Object.assign(Object.assign({},p),{C:16776960}),whiteCarbon:Object.assign(Object.assign({},p),{C:16777215}),orangeCarbon:Object.assign(Object.assign({},p),{C:16753920}),purpleCarbon:Object.assign(Object.assign({},p),{C:8388736}),blueCarbon:Object.assign(Object.assign({},p),{C:255})},M={amino:{ALA:13158600,ARG:1334015,ASN:56540,ASP:15075850,CYS:15132160,GLN:56540,GLU:15075850,GLY:15461355,HIS:8553170,ILE:1016335,LEU:1016335,LYS:1334015,MET:15132160,PHE:3289770,PRO:14456450,SER:16422400,THR:16422400,TRP:11819700,TYR:3289770,VAL:1016335,ASX:16738740,GLX:16738740},shapely:{ALA:9240460,ARG:124,ASN:16743536,ASP:10485826,CYS:16777072,GLN:16731212,GLU:6684672,GLY:16777215,HIS:7368959,ILE:19456,LEU:4546117,LYS:4671416,MET:12099650,PHE:5459026,PRO:5395026,SER:16740418,THR:12078080,TRP:5195264,TYR:9203788,VAL:16747775,ASX:16711935,GLX:16711935},nucleic:{A:10526975,G:16740464,I:8454143,C:16747595,T:10551200,U:16744576}},m={atom:{A:12636415,B:11599792,C:16761032,D:16777088,E:16761087,F:11596016,G:16765040,H:15761536,I:16113331,J:49151,K:13458524,L:6737322,M:10145074,N:15631086,O:52945,P:65407,Q:3978097,R:139,S:12433259,T:25600,U:8388608,V:8421376,W:8388736,X:32896,Y:12092939,Z:11674146},hetatm:{A:9478351,B:8441752,C:13602992,D:13619056,E:13603023,F:8437952,G:13607008,H:12603504,I:12955267,J:42959,K:11881548,L:5682578,M:9090346,N:12481214,O:46753,P:53103,Q:3447649,R:187,S:10854235,T:37888,U:11534336,V:11579392,W:11534512,X:45232,Y:15250963,Z:12726834}},b={ssPyMol:{prop:"ss",map:O.pyMol},ssJmol:{prop:"ss",map:O.Jmol},Jmol:{prop:"elem",map:x.Jmol},amino:{prop:"resn",map:M.amino},shapely:{prop:"resn",map:M.shapely},nucleic:{prop:"resn",map:M.nucleic},chain:{prop:"chain",map:m.atom},rasmol:{prop:"elem",map:x.rasmol},default:{prop:"elem",map:x.defaultColors},greenCarbon:{prop:"elem",map:x.greenCarbon},chainHetatm:{prop:"chain",map:m.hetatm},cyanCarbon:{prop:"elem",map:x.cyanCarbon},magentaCarbon:{prop:"elem",map:x.magentaCarbon},purpleCarbon:{prop:"elem",map:x.purpleCarbon},whiteCarbon:{prop:"elem",map:x.whiteCarbon},orangeCarbon:{prop:"elem",map:x.orangeCarbon},yellowCarbon:{prop:"elem",map:x.yellowCarbon},blueCarbon:{prop:"elem",map:x.blueCarbon}}},"./src/exporter.js"(K){typeof K.exports=="object"&&(K.exports=window.$3Dmol)},"./src/glcartoon.ts"(K,C,f){f.r(C),f.d(C,{drawCartoon:()=>L,subdivide_spline:()=>m});var E=f("./src/WebGL/math/index.ts"),S=f("./src/WebGL/shapes/index.ts"),w=f("./src/WebGL/index.ts"),O=f("./src/Gradient.ts"),p=f("./src/colors.ts"),x=f("./src/GLDraw.ts"),M=f("./src/utilities.ts");function m(D,R){var P=[],z=D;z=[],z.push(D[0]);var F,B,U,W,I,V,ee,te,ae;for(F=1,B=D.length-1;F<B;F++)if(I=D[F],V=D[F+1],I.smoothen){var re=new E.Vector3((I.x+V.x)/2,(I.y+V.y)/2,(I.z+V.z)/2);re.atom=I.atom,z.push(re)}else z.push(I);for(z.push(D[D.length-1]),F=-1,U=z.length;F<=U-3;F++)if(W=z[F===-1?0:F],I=z[F+1],V=z[F+2],ee=z[F===U-3?U-1:F+3],te=new E.Vector3().subVectors(V,W).multiplyScalar(.5),ae=new E.Vector3().subVectors(ee,I).multiplyScalar(.5),!V.skip)for(var fe=0;fe<R;fe++){var q=1/R*fe,oe=I.x+q*te.x+q*q*(-3*I.x+3*V.x-2*te.x-ae.x)+q*q*q*(2*I.x-2*V.x+te.x+ae.x),be=I.y+q*te.y+q*q*(-3*I.y+3*V.y-2*te.y-ae.y)+q*q*q*(2*I.y-2*V.y+te.y+ae.y),ge=I.z+q*te.z+q*q*(-3*I.z+3*V.z-2*te.z-ae.z)+q*q*q*(2*I.z-2*V.z+te.z+ae.z),Le=new E.Vector3(oe,be,ge);fe<R/2?Le.atom=I.atom:Le.atom=V.atom,P.push(Le)}return P.push(z[z.length-1]),P}const b=.5,_=1.3,g=.8,v=.4,r=.4;function e(D,R,P,z){for(var F,B,U,W,I=0,V=R.length;I<V;I++){W=Math.round(I*(z.length-1)/V),U=p.CC.color(z[W]);var ee=D.updateGeoGroup(2),te=ee.vertexArray,ae=ee.colorArray,re=ee.faceArray;F=ee.vertices,B=F*3,te[B]=R[I].x,te[B+1]=R[I].y,te[B+2]=R[I].z,te[B+3]=P[I].x,te[B+4]=P[I].y,te[B+5]=P[I].z;for(var fe=0;fe<6;++fe)ae[B+3*fe]=U.r,ae[B+1+3*fe]=U.g,ae[B+2+3*fe]=U.b;if(I>0){var q=[F,F+1,F-1,F-2],oe=ee.faceidx;re[oe]=q[0],re[oe+1]=q[1],re[oe+2]=q[3],re[oe+3]=q[1],re[oe+4]=q[2],re[oe+5]=q[3],ee.faceidx+=6}ee.vertices+=2}}function t(D,R,P,z,F,B,U){var W,I,V,ee;if(V=R.length,V<2||R[0].length<2)return;for(W=0;W<V;W++)R[W]=m(R[W],z);if(ee=R[0].length,!F)return e(D,R[0],R[V-1],P);var te,ae,re,fe,q,oe,be=[],ge=[],Le=[];for(I=0;I<V;I++)be.push(.25+1.5*Math.sqrt((V-1)*I-Math.pow(I,2))/(V-1)),ge.push(.5),Le.push(2*(Math.pow(I/V,2)-I/V)+.6);var pe=[];for(I=0;I<V*2-1;I++)pe[I]=[I,I+1,I+1-2*V,I-2*V];pe[V*2-1]=[I,I+1-2*V,I+1-4*V,I-2*V];var J,ce,Me,Fe,ze,Be,Ue,Se,Ie,Re;let Oe=D.updateGeoGroup();for(W=0;W<ee;W++){let Y=D.groups,X=!1;Oe=D.updateGeoGroup(2*V),Y!=D.groups&&W>0&&(W=W-1,X=!0),Be=Math.round(W*(P.length-1)/ee),ze=p.CC.color(P[Be]),q=re,oe=fe,re=[],fe=[],te=[],R[0][W].atom!==void 0&&(Fe=R[0][W].atom,U==="oval"?ae=be:U==="rectangle"?ae=ge:U==="parabola"&&(ae=Le)),ae||(ae=ge);var Ge,Ve;for(I=0;I<V;I++)W<ee-1?Ge=R[I][W+1].clone().sub(R[I][W]):Ge=R[I][W-1].clone().sub(R[I][W]).negate(),I<V-1?Ve=R[I+1][W].clone().sub(R[I][W]):Ve=R[I-1][W].clone().sub(R[I][W]).negate(),te[I]=Ve.cross(Ge).normalize().multiplyScalar(F*ae[I]);for(I=0;I<V;I++)re[I]=R[I][W].clone().add(te[I].clone().negate());for(I=0;I<V;I++)fe[I]=R[I][W].clone().add(te[I]);for(Ue=Oe.vertexArray,Se=Oe.colorArray,Ie=Oe.faceArray,J=Oe.vertices,ce=J*3,I=0;I<V;I++)Ue[ce+3*I+0]=re[I].x,Ue[ce+3*I+1]=re[I].y,Ue[ce+3*I+2]=re[I].z;for(I=0;I<V;I++)Ue[ce+3*I+0+3*V]=fe[V-1-I].x,Ue[ce+3*I+1+3*V]=fe[V-1-I].y,Ue[ce+3*I+2+3*V]=fe[V-1-I].z;for(I=0;I<2*V;++I)Se[ce+3*I+0]=ze.r,Se[ce+3*I+1]=ze.g,Se[ce+3*I+2]=ze.b;if(W>0&&!X){for(I=0;I<V*2;I++)Re=[J+pe[I][0],J+pe[I][1],J+pe[I][2],J+pe[I][3]],Me=Oe.faceidx,Ie[Me]=Re[0],Ie[Me+1]=Re[1],Ie[Me+2]=Re[3],Ie[Me+3]=Re[1],Ie[Me+4]=Re[2],Ie[Me+5]=Re[3],Oe.faceidx+=6;if(Fe.clickable||Fe.hoverable){var j=[];j.push(new S.Triangle(q[0],re[0],re[V-1])),j.push(new S.Triangle(q[0],re[V-1],q[V-1])),j.push(new S.Triangle(q[V-1],re[V-1],fe[V-1])),j.push(new S.Triangle(q[V-1],fe[V-1],oe[V-1])),j.push(new S.Triangle(fe[0],oe[0],oe[V-1])),j.push(new S.Triangle(fe[V-1],fe[0],oe[V-1])),j.push(new S.Triangle(re[0],q[0],oe[0])),j.push(new S.Triangle(fe[0],re[0],oe[0]));for(I in j)Fe.intersectionShape.triangle.push(j[I])}}Oe.vertices+=2*V}for(Ue=Oe.vertexArray,Se=Oe.colorArray,Ie=Oe.faceArray,J=Oe.vertices,ce=J*3,Me=Oe.faceidx,W=0;W<V-1;W++)Re=[W,W+1,2*V-2-W,2*V-1-W],Me=Oe.faceidx,Ie[Me]=Re[0],Ie[Me+1]=Re[1],Ie[Me+2]=Re[3],Ie[Me+3]=Re[1],Ie[Me+4]=Re[2],Ie[Me+5]=Re[3],Oe.faceidx+=6;for(W=0;W<V-1;W++)Re=[J-1-W,J-2-W,J-2*V+W+1,J-2*V+W],Me=Oe.faceidx,Ie[Me]=Re[0],Ie[Me+1]=Re[1],Ie[Me+2]=Re[3],Ie[Me+3]=Re[1],Ie[Me+4]=Re[2],Ie[Me+5]=Re[3],Oe.faceidx+=6}function n(D,R,P,z,F,B){if(!(R.length<2)){var U,W;if(U=R[0],W=R[R.length-1],U=m(U,z),W=m(W,z),!F)return e(D,U,W,P);var I=[],V,ee,te,ae,re,fe=[[0,2,-6,-8],[-4,-2,6,4],[7,-1,-5,3],[-3,5,1,-7]],q,oe,be,ge,Le,pe,J,ce,Me,Fe,ze,Be,Ue,Se,Ie,Re,Oe;for(ce=0,Me=U.length;ce<Me;ce++){if(Le=Math.round(ce*(P.length-1)/Me),ge=p.CC.color(P[Le]),I.push(ee=U[ce]),I.push(ee),I.push(te=W[ce]),I.push(te),ce<Me-1){var Ge=U[ce+1].clone().sub(U[ce]),Ve=W[ce].clone().sub(U[ce]);V=Ve.cross(Ge).normalize().multiplyScalar(F)}for(I.push(ae=U[ce].clone().add(V)),I.push(ae),I.push(re=W[ce].clone().add(V)),I.push(re),ee.atom!==void 0&&(pe=ee.atom),Se=D.updateGeoGroup(8),Ie=Se.vertexArray,Re=Se.colorArray,Oe=Se.faceArray,q=Se.vertices,oe=q*3,Ie[oe]=ee.x,Ie[oe+1]=ee.y,Ie[oe+2]=ee.z,Ie[oe+3]=ee.x,Ie[oe+4]=ee.y,Ie[oe+5]=ee.z,Ie[oe+6]=te.x,Ie[oe+7]=te.y,Ie[oe+8]=te.z,Ie[oe+9]=te.x,Ie[oe+10]=te.y,Ie[oe+11]=te.z,Ie[oe+12]=ae.x,Ie[oe+13]=ae.y,Ie[oe+14]=ae.z,Ie[oe+15]=ae.x,Ie[oe+16]=ae.y,Ie[oe+17]=ae.z,Ie[oe+18]=re.x,Ie[oe+19]=re.y,Ie[oe+20]=re.z,Ie[oe+21]=re.x,Ie[oe+22]=re.y,Ie[oe+23]=re.z,Fe=0;Fe<8;++Fe)Re[oe+3*Fe]=ge.r,Re[oe+1+3*Fe]=ge.g,Re[oe+2+3*Fe]=ge.b;if(ce>0){var j=J!==void 0&&pe!==void 0&&J.serial!==pe.serial;for(Fe=0;Fe<4;Fe++){var Y=[q+fe[Fe][0],q+fe[Fe][1],q+fe[Fe][2],q+fe[Fe][3]];if(be=Se.faceidx,Oe[be]=Y[0],Oe[be+1]=Y[1],Oe[be+2]=Y[3],Oe[be+3]=Y[1],Oe[be+4]=Y[2],Oe[be+5]=Y[3],Se.faceidx+=6,pe.clickable||J.clickable||pe.hoverable||J.hoverable){var X=I[Y[3]].clone(),_e=I[Y[0]].clone(),ue=I[Y[2]].clone(),we=I[Y[1]].clone();if(X.atom=I[Y[3]].atom||null,ue.atom=I[Y[2]].atom||null,_e.atom=I[Y[0]].atom||null,we.atom=I[Y[1]].atom||null,j){var De=X.clone().add(_e).multiplyScalar(.5),G=ue.clone().add(we).multiplyScalar(.5),se=X.clone().add(we).multiplyScalar(.5);Fe%2===0?((J.clickable||J.hoverable)&&(ze=new S.Triangle(De,se,X),Be=new S.Triangle(G,ue,se),Ue=new S.Triangle(se,ue,X),J.intersectionShape.triangle.push(ze),J.intersectionShape.triangle.push(Be),J.intersectionShape.triangle.push(Ue)),(pe.clickable||pe.hoverable)&&(ze=new S.Triangle(_e,we,se),Be=new S.Triangle(we,G,se),Ue=new S.Triangle(_e,se,De),pe.intersectionShape.triangle.push(ze),pe.intersectionShape.triangle.push(Be),pe.intersectionShape.triangle.push(Ue))):((pe.clickable||pe.hoverable)&&(ze=new S.Triangle(De,se,X),Be=new S.Triangle(G,ue,se),Ue=new S.Triangle(se,ue,X),pe.intersectionShape.triangle.push(ze),pe.intersectionShape.triangle.push(Be),pe.intersectionShape.triangle.push(Ue)),(J.clickable||J.hoverable)&&(ze=new S.Triangle(_e,we,se),Be=new S.Triangle(we,G,se),Ue=new S.Triangle(_e,se,De),J.intersectionShape.triangle.push(ze),J.intersectionShape.triangle.push(Be),J.intersectionShape.triangle.push(Ue)))}else(pe.clickable||pe.hoverable)&&(ze=new S.Triangle(_e,we,X),Be=new S.Triangle(we,ue,X),pe.intersectionShape.triangle.push(ze),pe.intersectionShape.triangle.push(Be))}}}Se.vertices+=8,J=pe}var ve=I.length-8;for(Se=D.updateGeoGroup(8),Ie=Se.vertexArray,Re=Se.colorArray,Oe=Se.faceArray,q=Se.vertices,oe=q*3,be=Se.faceidx,ce=0;ce<4;ce++){I.push(I[ce*2]),I.push(I[ve+ce*2]);var Te=I[ce*2],ie=I[ve+ce*2];Ie[oe+6*ce]=Te.x,Ie[oe+1+6*ce]=Te.y,Ie[oe+2+6*ce]=Te.z,Ie[oe+3+6*ce]=ie.x,Ie[oe+4+6*ce]=ie.y,Ie[oe+5+6*ce]=ie.z,Re[oe+6*ce]=ge.r,Re[oe+1+6*ce]=ge.g,Re[oe+2+6*ce]=ge.b,Re[oe+3+6*ce]=ge.r,Re[oe+4+6*ce]=ge.g,Re[oe+5+6*ce]=ge.b}ve+=8,ze=[q,q+2,q+6,q+4],Be=[q+1,q+5,q+7,q+3],Oe[be]=ze[0],Oe[be+1]=ze[1],Oe[be+2]=ze[3],Oe[be+3]=ze[1],Oe[be+4]=ze[2],Oe[be+5]=ze[3],Oe[be+6]=Be[0],Oe[be+7]=Be[1],Oe[be+8]=Be[3],Oe[be+9]=Be[1],Oe[be+10]=Be[2],Oe[be+11]=Be[3],Se.faceidx+=12,Se.vertices+=8}}function o(D,R,P,z,F,B,U){(!U||U==="default")&&(U="rectangle"),U==="edged"?n(D,R,P,z,F):(U==="rectangle"||U==="oval"||U==="parabola")&&t(D,R,P,z,F,B,U)}function h(D){return D&&D.elem==="C"&&D.atom==="CA"}function d(D,R){if(D&&R&&D.chain===R.chain){if(!D.hetflag&&!R.hetflag&&D.reschain===R.reschain&&(D.resi===R.resi||D.resi===R.resi-1))return!0;if(D.resi<R.resi){var P=D.x-R.x,z=D.y-R.y,F=D.z-R.z,B=P*P+z*z+F*F;if(D.atom=="CA"&&R.atom=="CA"&&B<16)return!0;if((D.atom=="P"||R.atom=="P")&&B<64)return!0}}return!1}function i(D,R,P,z,F){if(!(R==null||R.vertices==0)){F&&(R.initTypedArrays(),R.setUpNormals());var B=new w.MeshDoubleLambertMaterial;B.vertexColors=w.Coloring.FaceColors,typeof P=="number"&&P>=0&&P<1&&(B.transparent=!0,B.opacity=P),B.outline=z;var U=new w.Mesh(R,B);D.add(U)}}function s(D,R,P,z,F,B,U,W,I){var V,ee,te,ae,re,fe;if(!(!z||!F||!U)){var q=F.sub(z);q.normalize();var oe=W[I];for(ee=I+1;ee<W.length&&(oe=W[ee],oe.atom!=U.atom);ee++);if(oe=oe?new E.Vector3(oe.x,oe.y,oe.z):new E.Vector3(0,0,0),oe.sub(z),U.ss==="arrow start"){var be=oe.clone().multiplyScalar(.3).cross(F);z.add(be);var ge=oe.clone().cross(q).normalize();q.rotateAboutVector(ge,.43)}for(U.style.cartoon.ribbon?V=U.style.cartoon.thickness||v:U.style.cartoon.width?V=U.style.cartoon.width:U.ss==="c"?U.atom==="P"?V=g:V=b:U.ss==="arrow start"?(V=_,re=!0):U.ss==="arrow end"||U.ss==="h"&&U.style.cartoon.tubes||U.ss==="tube start"?V=b:V=_,B!=null&&q.dot(B)<0&&q.negate(),q.multiplyScalar(V),ee=0;ee<R;ee++)te=-1+ee*2/(R-1),ae=new E.Vector3(z.x+te*q.x,z.y+te*q.y,z.z+te*q.z),ae.atom=U,U.ss==="s"&&(ae.smoothen=!0),D[ee].push(ae);if(re)for(q.multiplyScalar(2),ee=0;ee<R;ee++)te=-1+ee*2/(R-1),ae=new E.Vector3(z.x+te*q.x,z.y+te*q.y,z.z+te*q.z),ae.atom=U,ae.smoothen=!1,ae.skip=!0,D[ee].push(ae);return fe=U.style.cartoon.style||"default",D.style?D.style!=fe&&(console.log("Warning: a cartoon chain's strand-style is ambiguous"),D.style="default"):D.style=fe,(U.ss==="arrow start"||U.ss==="arrow end")&&(U.ss="s"),re}}const a={C:!0,CA:!0,O:!0,P:!0,OP2:!0,O2P:!0,"O5'":!0,"O3'":!0,"C5'":!0,"C2'":!0,"O5*":!0,"O3*":!0,"C5*":!0,"C2*":!0,N1:!0,N3:!0},c={DA:!0,DG:!0,A:!0,G:!0},u={DT:!0,DC:!0,U:!0,C:!0,T:!0},A={DA:!0,DG:!0,A:!0,G:!0,DT:!0,DC:!0,U:!0,C:!0,T:!0};function L(D,R,P,z=10){let F=z,B=z;var U,W,I,V,ee,te,ae,re,fe,q,oe,be,ge,Le,pe,J,ce,Me,Fe=new w.Geometry(!0),ze=new w.Geometry(!0),Be=[],Ue=[],Se=1,Ie=!1,Re={};for(var Oe in O.Gradient.builtinGradients)O.Gradient.builtinGradients.hasOwnProperty(Oe)&&(Re[Oe]=new O.Gradient.builtinGradients[Oe](P[1],P[0]));var Ge=function(Pe,T){return P&&T.color==="spectrum"?T.colorscheme in Re?Re[T.colorscheme].valueToHex(Pe.resi):Re.sinebow.valueToHex(Pe.resi):(0,M.getColorFromStyle)(Pe,T).getHex()};for(re=0;re<F;re++)Ue[re]=[];var Ve=!1,j=!1,Y=[];for(re in R){if(V=R[re],V.elem==="C"&&V.atom==="CA"){var X=d(I,V);X&&V.ss==="s"?Ve=!0:Ve&&(I&&W&&I.style.cartoon.arrows&&W.style.cartoon.arrows&&(I.ss="arrow end",W.ss="arrow start"),Ve=!1),X&&(I.ss==="h"||I.ss=="tube start")&&I.style.cartoon.tubes?!j&&I.ss!="tube start"&&V.style.cartoon.tubes&&(V.ss="tube start",j=!0):j&&(I.ss==="tube start"?I.ss="tube end":W&&W.style.cartoon.tubes&&(W.ss="tube end"),j=!1),W=I,I=V}V&&V.atom in a&&Y.push(V)}j&&I.style.cartoon.tubes&&(I.ss="tube end",j=!1);var _e=function(Pe){Ue[0].length>0&&o(ze,Ue,Be,B,ae,Se,Ue.style);var T=[],de=null;if(Pe){for(re=0;re<F;re++)T[re]=Ue[re][Ue[re].length-1];de=Be[Be.length-1]}for(Ue=[],re=0;re<F;re++)Ue[re]=[];if(Be=[],Pe){for(re=0;re<F;re++)Ue[re].push(T[re]);Be.push(de)}i(D,ze,Se,Ie,!0),i(D,Fe,Se,Ie,!1),ze=new w.Geometry(!0),Fe=new w.Geometry(!0)};I=void 0;let ue=[];for(var we=0;we<Y.length;we++){V=Y[we];var De=V.resn.trim(),G=De in A;if(Se=1,U=V.style.cartoon,I&&I.style.cartoon&&(Se=I.style.cartoon.opacity),I&&I.style.cartoon&&I.style.cartoon.outline&&(Ie=I.style.cartoon.outline),I&&I.style.cartoon&&(!V.style.cartoon||I.style.cartoon.opacity!=V.style.cartoon.opacity)&&_e(I.chain==V.chain),I&&V&&!d(I,V)&&I.chain&&I.chain==V.chain&&!I.hetflag&&!V.hetflag&&I.reschain+1==V.reschain&&ue.push([I,V]),U.style==="trace"){if(!V.hetflag){if(V.elem==="C"&&V.atom==="CA"||G&&V.atom==="P"||V.atom==="BB"){if(te=Ge(V,U),(0,M.isNumeric)(U.thickness)?ae=U.thickness:ae=v,d(I,V))if(te==ee){var se=p.CC.color(te);x.GLDraw.drawCylinder(Fe,I,V,ae,se,2,2)}else{var ve=new E.Vector3().addVectors(I,V).multiplyScalar(.5),Te=p.CC.color(ee),ie=p.CC.color(te);x.GLDraw.drawCylinder(Fe,I,ve,ae,Te,2,0),x.GLDraw.drawCylinder(Fe,ve,V,ae,ie,0,2)}if((V.clickable===!0||V.hoverable)&&V.intersectionShape!==void 0){var ye=new E.Vector3(V.x,V.y,V.z);V.intersectionShape.sphere.push(new S.Sphere(ye,ae))}I=V,ee=te}}}else{if(h(V)||G&&(V.atom==="P"||V.atom.indexOf("O5")==0)){if(Me)if(V.ss==="tube end")Me=!1,ce=new E.Vector3(V.x,V.y,V.z),x.GLDraw.drawCylinder(Fe,J,ce,2,p.CC.color(ee),1,1),V.ss="h";else if(I.chain!=V.chain||I.ss==="tube end")Me=!1,I.ss="h",ce=new E.Vector3(I.x,I.y,I.z),x.GLDraw.drawCylinder(Fe,J,ce,2,p.CC.color(ee),1,1);else continue;if(I&&(!d(I,V)||I.ss==="tube start")){for(I.ss==="tube start"&&(Me=!0,J=new E.Vector3(I.x,I.y,I.z),I.ss="h"),pe&&(be?Le=new E.Vector3().addVectors(I,be).multiplyScalar(.5):Le=new E.Vector3(I.x,I.y,I.z),x.GLDraw.drawCylinder(Fe,Le,pe,r,p.CC.color(pe.color),0,2),s(Ue,F,!0,be,ge,oe,I,Y,we),Be.push(te),Le=null,pe=null),Ue[0].length>0&&o(ze,Ue,Be,B,ae,Se,Ue.style),Ue=[],re=0;re<F;re++)Ue[re]=[];Be=[]}if(I===void 0||I.rescode!=V.rescode||I.resi!=V.resi){if(pe&&I!=null){Le=new E.Vector3().addVectors(I,V).multiplyScalar(.5);var k=Le.clone().sub(pe).multiplyScalar(.02);Le.add(k),x.GLDraw.drawCylinder(Fe,Le,pe,r,p.CC.color(pe.color),0,2),Le=null,pe=null}te=Ge(V,U),Be.push(te),(0,M.isNumeric)(U.thickness)?ae=U.thickness:ae=v,I=V,fe=new E.Vector3(I.x,I.y,I.z),fe.resi=I.resi,ee=te}(V.clickable===!0||V.hoverable===!0)&&(V.intersectionShape===void 0||V.intersectionShape.triangle===void 0)&&(V.intersectionShape={sphere:null,cylinder:[],line:[],triangle:[]})}else I!=null&&(h(I)&&V.atom==="O"||G&&I.atom==="P"&&(V.atom==="OP2"||V.atom==="O2P")||G&&I.atom.indexOf("O5")==0&&V.atom.indexOf("C5")==0)?(q=new E.Vector3(V.x,V.y,V.z),q.resi=V.resi,(V.atom==="OP2"||V.atom==="O2P")&&(ge=new E.Vector3(V.x,V.y,V.z))):G&&V.atom.indexOf("O3")==0?be=new E.Vector3(V.x,V.y,V.z):(V.atom==="N1"&&De in c||V.atom==="N3"&&De in u)&&(pe=new E.Vector3(V.x,V.y,V.z),pe.color=(0,M.getColorFromStyle)(V,U).getHex());q&&fe&&q.resi===fe.resi&&(s(Ue,F,!0,fe,q,oe,I,Y,we),oe=q,fe=null,q=null,Be.push(te))}}pe&&(be?Le=new E.Vector3().addVectors(I,be).multiplyScalar(.5):Le=new E.Vector3(I.x,I.y,I.z),x.GLDraw.drawCylinder(Fe,Le,pe,r,p.CC.color(pe.color),0,2),s(Ue,F,!0,be,ge,oe,I,Y,we),Be.push(te)),_e(!1);var Ce=function(Pe,T){if(Pe.style.cartoon.gapcutoff&&Pe.style.cartoon.gapcutoff==T.style.cartoon.gapcutoff){let he=Pe.style.cartoon.gapcutoff,H=T.resi-Pe.resi;if(H>0&&H<he){let ne=.25,xe=T.x-Pe.x,je=T.y-Pe.y,ke=T.z-Pe.z,Ne=Math.sqrt(xe*xe+je*je+ke*ke),Qe=Ne/(2*H),_t=new E.Vector3(Pe.x,Pe.y,Pe.z),et=Ne/Qe,Ze=new E.Vector3((T.x-Pe.x)/et,(T.y-Pe.y)/et,(T.z-Pe.z)/et);_t.add({x:Ze.x/2,y:Ze.y/2,z:Ze.z/2});let Xe=_t.clone().add(Ze);Ze.multiplyScalar(2);let at=(0,M.extend)({},Pe);for(var de=0;de<H;de++){at.resi+=1;let nt=Ge(at,at.style.cartoon);x.GLDraw.drawCylinder(Fe,_t,Xe,ne,p.CC.color(nt),x.CAP.FLAT,x.CAP.FLAT),_t.add(Ze),Xe.add(Ze)}_e(!1)}}};for(let Pe of ue)Ce(Pe[0],Pe[1])}},"./src/index.ts"(K,C,f){f.r(C),f.d(C,{CAP:()=>E.CAP,CC:()=>E.CC,CONTEXTS_PER_VIEWPORT:()=>E.CONTEXTS_PER_VIEWPORT,Color:()=>E.Color,CustomLinear:()=>E.CustomLinear,Cylinder:()=>E.Cylinder,GLDraw:()=>E.GLDraw,GLModel:()=>E.GLModel,GLShape:()=>E.GLShape,GLViewer:()=>E.GLViewer,GLVolumetricRender:()=>E.GLVolumetricRender,Gradient:()=>E.Gradient,GradientType:()=>E.GradientType,Label:()=>E.Label,LabelCount:()=>E.LabelCount,MarchingCube:()=>E.MarchingCube,MarchingCubeInitializer:()=>E.MarchingCubeInitializer,Matrix3:()=>E.Matrix3,Matrix4:()=>E.Matrix4,Parsers:()=>E.Parsers,PausableTimer:()=>E.PausableTimer,PointGrid:()=>E.PointGrid,ProteinSurface:()=>E.ProteinSurface,Quaternion:()=>E.Quaternion,ROYGB:()=>E.ROYGB,RWB:()=>E.RWB,Ray:()=>E.Ray,Sinebow:()=>E.Sinebow,Sphere:()=>E.Sphere,SurfaceType:()=>E.SurfaceType,Triangle:()=>E.Triangle,Vector2:()=>E.Vector2,Vector3:()=>E.Vector3,VolumeData:()=>E.VolumeData,adjustVolumeStyle:()=>E.adjustVolumeStyle,applyPartialCharges:()=>E.applyPartialCharges,autoinit:()=>E.autoinit,autoload:()=>E.autoload,base64ToArray:()=>E.base64ToArray,bondLength:()=>E.bondLength,builtinColorSchemes:()=>E.builtinColorSchemes,builtinGradients:()=>E.builtinGradients,chains:()=>E.chains,clamp:()=>E.clamp,conversionMatrix3:()=>E.conversionMatrix3,createStereoViewer:()=>E.createStereoViewer,createViewer:()=>E.createViewer,createViewerGrid:()=>E.createViewerGrid,deepCopy:()=>E.deepCopy,degToRad:()=>E.degToRad,download:()=>E.download,drawCartoon:()=>E.drawCartoon,elementColors:()=>E.elementColors,extend:()=>E.extend,get:()=>E.get,getAtomProperty:()=>E.getAtomProperty,getColorFromStyle:()=>E.getColorFromStyle,getElement:()=>E.getElement,getExtent:()=>E.getExtent,getGradient:()=>E.getGradient,getPropertyRange:()=>E.getPropertyRange,getbin:()=>E.getbin,htmlColors:()=>E.htmlColors,inflateString:()=>E.inflateString,isEmptyObject:()=>E.isEmptyObject,isNumeric:()=>E.isNumeric,makeFunction:()=>E.makeFunction,mergeGeos:()=>E.mergeGeos,normalizeValue:()=>E.normalizeValue,partialCharges:()=>E.partialCharges,processing_autoinit:()=>E.processing_autoinit,residues:()=>E.residues,setBondLength:()=>E.setBondLength,setSyncSurface:()=>E.setSyncSurface,specStringToObject:()=>E.specStringToObject,splitMesh:()=>E.splitMesh,ssColors:()=>E.ssColors,subdivide_spline:()=>E.subdivide_spline,syncSurface:()=>E.syncSurface,viewers:()=>E.viewers});var E=f("./src/3Dmol.ts");window&&(window.$3Dmol=C)},"./src/parsers/BCIF.ts"(K,C,f){f.r(C),f.d(C,{BCIF:()=>v});var E=f("./src/utilities.ts"),S=f("./src/parsers/utils/computeSecondaryStructure.ts"),w=f("./src/parsers/utils/processSymmetries.ts"),O=f("./src/parsers/cifutils/category.ts"),p=f("./src/parsers/utils/assignPDBBonds.ts"),x=f("./src/WebGL/index.ts"),M=f("./src/parsers/utils/isEmpty.ts"),m=f("./src/vendor/mmtf.js");class b{constructor(e){if(this.C={},e){let t=e.getField("comp_id"),n=e.getField("atom_id_1"),o=e.getField("atom_id_2"),h=e.getField("value_order");for(let d=0;d<t.length;d++){let i=t[d],s=n[d],a=o[d],c=h[d],u=1;c=="doub"?u=2:c=="trip"&&(u=3),this.C[i]==null&&(this.C[i]={}),this.C[i][s]==null&&(this.C[i][s]={}),this.C[i][a]==null&&(this.C[i][a]={}),this.C[i][s][a]=u,this.C[i][a][s]=u}}}order(e,t,n){return this.C[e]!==void 0&&this.C[e][t]!==void 0&&this.C[e][t][n]!==void 0?this.C[e][t][n]:0}}class _{constructor(e){if(this.C=[],e){let t=e.getField("conn_type_id"),n=e.getField("ptnr1_label_asym_id"),o=e.getField("ptnr1_label_seq_id"),h=e.getField("ptnr1_label_comp_id"),d=e.getField("ptnr1_label_atom_id"),i=e.getField("ptnr2_label_asym_id"),s=e.getField("ptnr2_label_seq_id"),a=e.getField("ptnr2_label_comp_id"),c=e.getField("ptnr2_label_atom_id"),u=e.getField("pdbx_value_order");for(let A=0;A<t.length;A++)if(t[A]=="disulf"||t[A]=="covale"){let L=u?u[A]==""?1:parseInt(u[A]):1;this.C.push([[n[A],o[A],h[A],d[A]],[i[A],s[A],a[A],c[A]],L])}}}}class g{constructor(){this.R={}}add(e){this.R[e.lchain]==null&&(this.R[e.lchain]={}),this.R[e.lchain][e.lresi]==null&&(this.R[e.lchain][e.lresi]={}),this.R[e.lchain][e.lresi][e.lresn]==null&&(this.R[e.lchain][e.lresi][e.lresn]=[]),this.R[e.lchain][e.lresi][e.lresn].push(e),this.R[e.lchain][e.lresi][e.lresn][e.atom]=e}geta([e,t,n,o]){if(this.R[e]!==void 0&&this.R[e][t]!==void 0&&this.R[e][t][n]!==void 0)return this.R[e][t][n][o]}setBonds(e,t){for(let n in this.R)for(let o in this.R[n])for(let h in this.R[n][o]){let d=this.R[n][o][h];for(let i=0;i<d.length;i++)for(let s=i+1;s<d.length;s++){let a=d[i],c=d[s],u=e.order(h,a.atom,c.atom);a.altLoc!=c.altLoc&&a.altLoc!=""&&c.altLoc!=""&&(u=0),u>0&&(a.bonds.push(c.index),c.bonds.push(a.index),a.bondOrder.push(u),c.bondOrder.push(u))}}for(let n of t.C){let o=n[0],h=n[1],d=n[2],i=this.geta(o),s=this.geta(h);i!=null&&s!=null&&(i.bonds.push(s.index),s.bonds.push(i.index),i.bondOrder.push(d),s.bondOrder.push(d))}}}function v(r,e){var t=!e.keepH,n=e.altLoc?e.altLoc:"A",o=!e.noComputeSecondaryStructure;const h=!e.doAssembly,d=e.assignBonds===void 0?!0:e.assignBonds;if(typeof r=="string")try{r=(0,E.base64ToArray)(r)}catch{r=new TextEncoder().encode(r)}else r=new Uint8Array(r);var i=m.decodeMsgpack(r);i==31&&(r=(0,E.inflateString)(r,!1),i=m.decodeMsgpack(r));var s=[],a=s.modelData=[],c=i.dataBlocks.length;if(c==0)return s;e.multimodel||(c=1);for(let u=0;u<c;u++){let A=s.length;const L=[];a.push({symmetries:[]}),s.push([]);const D=i.dataBlocks[u],R=Object.create(null);for(const Re of D.categories)R[Re.name.substr(1)]=(0,O.Category)(Re);let P={},z=R.struct_conf;if(z){let Re=z.getField("conf_type_id"),Oe=z.getField("beg_label_asym_id"),Ge=z.getField("beg_label_seq_id"),Ve=z.getField("end_label_seq_id");for(let j=0;j<Re.length;j++)if(Re[j].startsWith("H")){let Y=Oe[j],X=Ge[j],_e=Ve[j];Y in P||(P[Y]={}),P[Y][X]="h1";for(let ue=X+1;ue<_e;ue++)P[Y][ue]="h";P[Y][_e]="h2"}}let F=R.struct_sheet_range;if(F){let Re=F.getField("id"),Oe=F.getField("beg_label_asym_id"),Ge=F.getField("beg_label_seq_id"),Ve=F.getField("end_label_seq_id");for(let j=0;j<Re.length;j++){let Y=Oe[j],X=Ge[j],_e=Ve[j];Y in P||(P[Y]={}),P[Y][X]="s1";for(let ue=X+1;ue<_e;ue++)P[Y][ue]="s";P[Y][_e]="s2"}}let B=R.pdbx_struct_oper_list,U=B.getField("id");if(U&&!h){let Re=B.getField("matrix[1][1]"),Oe=B.getField("matrix[1][2]"),Ge=B.getField("matrix[1][3]"),Ve=B.getField("matrix[2][1]"),j=B.getField("matrix[2][2]"),Y=B.getField("matrix[2][3]"),X=B.getField("matrix[3][1]"),_e=B.getField("matrix[3][2]"),ue=B.getField("matrix[3][3]"),we=B.getField("vector[1]"),De=B.getField("vector[2]"),G=B.getField("vector[3]");for(let se=0;se<U.length;se++){const ve=new x.Matrix4(Re[se],Oe[se],Ge[se],we[se],Ve[se],j[se],Y[se],De[se],X[se],_e[se],ue[se],G[se]);a[a.length-1].symmetries.push(ve)}}let W=new b(R.chem_comp_bond),I=new g,V=new _(R.struct_conn),ee=R.atom_site,te=ee.rowCount,ae=ee.getField("group_PDB"),re=ee.getField("Cartn_x"),fe=ee.getField("Cartn_y"),q=ee.getField("Cartn_z"),oe=ee.getField("auth_asym_id"),be=ee.getField("label_asym_id"),ge=ee.getField("auth_seq_id"),Le=ee.getField("label_seq_id"),pe=ee.getField("auth_comp_id"),J=ee.getField("label_comp_id"),ce=ee.getField("auth_atom_id"),Me=ee.getField("label_atom_id"),Fe=ee.getField("type_symbol"),ze=ee.getField("B_iso_or_equiv"),Be=ee.getField("id"),Ue=ee.getField("label_alt_id"),Se=ee.getField("pdbx_PDB_model_num"),Ie=Se?Se[0]:0;for(let Re=0;Re<te;Re++){if(ae!==void 0&&ae[Re]==="TER")continue;if(Se&&Se[Re]!=Ie)if(Ie=Se[Re],e.multimodel)e.onemol||(s.push([]),a.push(a[a.length-1]),Ie=Se[Re],I.setBonds(W,V),I=new g);else break;const Oe={};Oe.x=re[Re],Oe.y=fe[Re],Oe.z=q[Re],Oe.chain=oe?oe[Re]:be?be[Re]:void 0,Oe.lchain=be?be[Re]:void 0,Oe.resi=ge?ge[Re]:Le?Le[Re]:void 0,Oe.lresi=Le?Le[Re]:void 0,Oe.resn=pe?pe[Re].trim():J?J[Re].trim():void 0,Oe.lresn=J?J[Re].trim():void 0,Oe.atom=ce?ce[Re].replace(/"/gm,""):Me?Me[Re].replace(/"/gm,""):void 0,Oe.icode=Ue?Ue[Re]:void 0,Oe.altLoc=Oe.icode,Oe.hetflag=!ae||ae[Re]==="HETA"||ae[Re]==="HETATM";let Ge="X";Fe&&(Ge=Fe[Re].replace(/\(?\+?\d+.*/,"")),Oe.elem=Ge[0].toUpperCase()+Ge.substring(1,2).toLowerCase(),ze&&(Oe.b=ze[Re]),!(t&&Oe.elem=="H")&&(Oe.altLoc!=""&&Oe.altLoc!=n&&n!="*"||(Oe.bonds=[],Oe.ss="c",Oe.serial=Be[Re],Oe.model=Ie,Oe.bondOrder=[],Oe.properties={},Oe.index=s[s.length-1].length,L[Oe.serial]=[s.length,Oe.index],s[s.length-1].push(Oe),I.add(Oe)))}if(I.setBonds(W,V),!(0,M.isEmpty)(P))for(let Re=A;Re<s.length;Re++){let Oe=s[Re];for(let Ge=0;Ge<Oe.length;Ge++){const Ve=Oe[Ge];if(Ve!==void 0&&Ve.lchain in P&&Ve.lresi in P[Ve.lchain]){const j=P[Ve.lchain][Ve.lresi];Ve.ss=j[0],j.length>1&&(j[1]=="1"?Ve.ssbegin=!0:j[1]=="2"&&(Ve.ssend=!0))}}}e.multimodel&&u<c-1&&(e.onemol||(s.push([]),a.push({symmetries:[]})))}for(let u=0;u<s.length;u++)d&&!(e.duplicateAssemblyAtoms&&!e.dontConnectDuplicatedAtoms)&&(0,p.assignPDBBonds)(s[u],e),o&&(0,S.computeSecondaryStructure)(s[u],e.hbondCutoff),(0,w.processSymmetries)(a[u].symmetries,s[u],e,a[u].cryst),e.duplicateAssemblyAtoms&&!e.dontConnectDuplicatedAtoms&&d&&(0,p.assignPDBBonds)(s[u],e);return s}},"./src/parsers/CDJSON.ts"(K,C,f){f.r(C),f.d(C,{CDJSON:()=>E});function E(S,w){var O=[[]];typeof S=="string"&&(S=JSON.parse(S));for(var p=S.m,x=p[0].a,M=p[0].b,m=p[0].s,b=w!==void 0&&w.parseStyle!==void 0?w.parseStyle:m!==void 0,_=O[O.length-1].length,g=0;g<x.length;g++){var v=x[g],r={};r.id=v.i,r.x=v.x,r.y=v.y,r.z=v.z||0,r.bonds=[],r.bondOrder=[];var e=v.l||"C";r.elem=e[0].toUpperCase()+e.substring(1).toLowerCase(),r.serial=O[O.length-1].length,b&&(r.style=m[v.s||0]),O[O.length-1].push(r)}for(let t=0;t<M.length;t++){let n=M[t],o=n.b+_,h=n.e+_,d=n.o||1,i=O[O.length-1][o],s=O[O.length-1][h];i.bonds.push(h),i.bondOrder.push(d),s.bonds.push(o),s.bondOrder.push(d)}return O}},"./src/parsers/CIF.ts"(K,C,f){f.r(C),f.d(C,{CIF:()=>x});var E=f("./src/parsers/utils/computeSecondaryStructure.ts"),S=f("./src/parsers/utils/processSymmetries.ts"),w=f("./src/WebGL/index.ts"),O=f("./src/parsers/utils/assignPDBBonds.ts");const p=function(M,m,b,_){return new w.Vector3(m,b,_).applyMatrix3(M)};function x(M,m={}){const b=[],_=!m.doAssembly,g=b.modelData=[],v=m.assignBonds===void 0?!0:m.assignBonds;function r(d,i){const s=[];let a=0,c=0;for(;c<d.length;){for(;d.substring(c,c+i.length)!==i&&c<d.length;)if(d[c]==="'"){for(c++;c<d.length&&d[c]!=="'";)c++;for(;d.substring(c,c+i.length)!==i&&c<d.length;)c++}else if(d[c]==='"'){for(c++;c<d.length&&d[c]!=='"';)c++;c++}else c++;s.push(d.substring(a,c)),a=c=c+i.length}return s}const e=M.split(/\r?\n|\r/),t=[];let n=!1;for(let d=0;d<e.length;d++){var o=e[d].split("#")[0];if(n?o[0]===";"&&(n=!1):o[0]===";"&&(n=!0),n||o!==""){if(!n&&(o=o.trim(),o[0]==="_")){const i=o.split(/\s/)[0].indexOf(".");if(i>-1){let s=o.split("");s[i]="_",o=s.join(""),o=o.substring(0,i)+"_"+o.substring(i+1)}}t.push(o)}}let h=0;for(;h<t.length;){for(;!t[h].startsWith("data_")||t[h]==="data_global";)h++;h++;const d={};for(;h<t.length&&!t[h].startsWith("data_");)if(t[h][0]===void 0)h++;else if(t[h][0]==="_"){const c=t[h].split(/\s/)[0].toLowerCase(),u=d[c]=d[c]||[],A=t[h].substring(t[h].indexOf(c)+c.length);if(A==="")if(h++,t[h][0]===";"){let L=t[h].substring(1);for(h++;t[h]!==";";)L=L+`
`+t[h],h++;u.push(L)}else u.push(t[h]);else u.push(A.trim());h++}else if(t[h].substring(0,5)==="loop_"){h++;const c=[];for(;t[h]===""||t[h][0]==="_";){if(t[h]!==""){let A=t[h].split(/\s/)[0].toLowerCase(),L=d[A]=d[A]||[];c.push(L)}h++}let u=0;for(;h<t.length&&t[h][0]!=="_"&&!t[h].startsWith("loop_")&&!t[h].startsWith("data_");){let A=r(t[h]," ");for(let L=0;L<A.length;L++)A[L]!==""&&(c[u].push(A[L]),u=(u+1)%c.length);h++}}else h++;g.push({symmetries:[]}),b.push([]);const i=d._atom_site_id!==void 0?d._atom_site_id.length:d._atom_site_label.length;let s;if(d._cell_length_a!==void 0){const c=parseFloat(d._cell_length_a),u=parseFloat(d._cell_length_b),A=parseFloat(d._cell_length_c),L=parseFloat(d._cell_angle_alpha)||90,D=parseFloat(d._cell_angle_beta)||90,R=parseFloat(d._cell_angle_gamma)||90;s=(0,w.conversionMatrix3)(c,u,A,L,D,R),g[g.length-1].cryst={a:c,b:u,c:A,alpha:L,beta:D,gamma:R}}for(let c=0;c<i;c++){if(d._atom_site_group_pdb!==void 0&&d._atom_site_group_pdb[c]==="TER")continue;const u={};if(d._atom_site_cartn_x!==void 0)u.x=parseFloat(d._atom_site_cartn_x[c]),u.y=parseFloat(d._atom_site_cartn_y[c]),u.z=parseFloat(d._atom_site_cartn_z[c]);else{const L=p(s,parseFloat(d._atom_site_fract_x[c]),parseFloat(d._atom_site_fract_y[c]),parseFloat(d._atom_site_fract_z[c]));u.x=L.x,u.y=L.y,u.z=L.z}u.chain=d._atom_site_auth_asym_id?d._atom_site_auth_asym_id[c]:d._atom_site_label_asym_id?d._atom_site_label_asym_id[c]:void 0,u.lchain=d._atom_site_label_asym_id?d._atom_site_label_asym_id[c]:void 0,u.resi=d._atom_site_auth_seq_id?parseInt(d._atom_site_auth_seq_id[c]):d._atom_site_label_seq_id?d._atom_site_label_seq_id[c]:void 0,u.resn=d._atom_site_auth_comp_id?d._atom_site_auth_comp_id[c].trim():d._atom_site_label_comp_id?d._atom_site_label_comp_id[c].trim():void 0,u.atom=d._atom_site_auth_atom_id?d._atom_site_auth_atom_id[c].replace(/"/gm,""):d._atom_site_label_atom_id?d._atom_site_label_atom_id[c].replace(/"/gm,""):void 0,u.hetflag=!d._atom_site_group_pdb||d._atom_site_group_pdb[c]==="HETA"||d._atom_site_group_pdb[c]==="HETATM",d._atom_site_b_iso_or_equiv&&(u.b=parseFloat(d._atom_site_b_iso_or_equiv[c]));let A="X";d._atom_site_type_symbol?A=d._atom_site_type_symbol[c].replace(/\(?\+?\d+.*/,""):d._atom_site_label&&(A=d._atom_site_label[c].split("_")[0].replace(/\(?\d+.*/,"")),u.elem=A[0].toUpperCase()+A.substring(1,2).toLowerCase(),u.bonds=[],u.ss="c",u.serial=c,u.bondOrder=[],u.properties={},b[b.length-1].push(u)}if(d._pdbx_struct_oper_list_id!==void 0&&!_)for(let c=0;c<d._pdbx_struct_oper_list_id.length;c++){const u=parseFloat(d["_pdbx_struct_oper_list_matrix[1][1]"][c]),A=parseFloat(d["_pdbx_struct_oper_list_matrix[1][2]"][c]),L=parseFloat(d["_pdbx_struct_oper_list_matrix[1][3]"][c]),D=parseFloat(d["_pdbx_struct_oper_list_vector[1]"][c]),R=parseFloat(d["_pdbx_struct_oper_list_matrix[2][1]"][c]),P=parseFloat(d["_pdbx_struct_oper_list_matrix[2][2]"][c]),z=parseFloat(d["_pdbx_struct_oper_list_matrix[2][3]"][c]),F=parseFloat(d["_pdbx_struct_oper_list_vector[2]"][c]),B=parseFloat(d["_pdbx_struct_oper_list_matrix[3][1]"][c]),U=parseFloat(d["_pdbx_struct_oper_list_matrix[3][2]"][c]),W=parseFloat(d["_pdbx_struct_oper_list_matrix[3][3]"][c]),I=parseFloat(d["_pdbx_struct_oper_list_vector[3]"][c]),V=new w.Matrix4(u,A,L,D,R,P,z,F,B,U,W,I);g[g.length-1].symmetries.push(V)}const a=function(c){const u=c.match("-");c=c.replace(/[-xyz]/g,"");const A=c.split("/");let L,D;return A[1]===void 0?D=1:D=parseInt(A[1]),A[0]===""?L=1:L=parseInt(A[0]),L/D*(u?-1:1)};if(d._symmetry_equiv_pos_as_xyz!==void 0&&!_)for(let c=0;c<d._symmetry_equiv_pos_as_xyz.length;c++){const A=d._symmetry_equiv_pos_as_xyz[c].replace(/["' ]/g,"").split(",").map(function(P){return P.replace(/-/g,"+-")});let L=new w.Matrix4(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1);for(let P=0;P<3;P++){const z=A[P].split("+");for(let F=0;F<z.length;F++){const B=z[F];if(B==="")continue;const U=a(B);B.match("x")?L.elements[P+0]=U:B.match("y")?L.elements[P+4]=U:B.match("z")?L.elements[P+8]=U:L.elements[P+12]=U}}const D=s.getMatrix4(),R=new w.Matrix4().getInverse(D,!0);L=new w.Matrix4().multiplyMatrices(L,R),L=new w.Matrix4().multiplyMatrices(D,L),g[g.length-1].symmetries.push(L)}}for(let d=0;d<b.length;d++)v&&!(m.duplicateAssemblyAtoms&&!m.dontConnectDuplicatedAtoms)&&(0,O.assignPDBBonds)(b[d],m),(0,E.computeSecondaryStructure)(b[d],m.hbondCutoff),(0,S.processSymmetries)(g[d].symmetries,b[d],m,g[d].cryst),m.duplicateAssemblyAtoms&&!m.dontConnectDuplicatedAtoms&&v&&(0,O.assignPDBBonds)(b[d],m);return b}},"./src/parsers/CUBE.ts"(K,C,f){f.r(C),f.d(C,{CUBE:()=>O});var E=f("./src/WebGL/index.ts"),S=f("./src/parsers/utils/assignBonds.ts"),w=f("./src/parsers/utils/anumToSymbol.ts");function O(p,x){x=x||{};const M=[[]];let m=p.split(/\r?\n/);const b=x.assignBonds===void 0?!0:x.assignBonds;if(m.length<6)return M;let _=m[2].replace(/^\s+/,"").replace(/\s+/g," ").split(" ");const g=Math.abs(parseFloat(_[0]));let v={origin:void 0,size:void 0,unit:void 0,matrix4:void 0,matrix:void 0};const r=v.origin=new E.Vector3(parseFloat(_[1]),parseFloat(_[2]),parseFloat(_[3]));_=m[3].replace(/^\s+/,"").replace(/\s+/g," ").split(" "),_=m[3].replace(/^\s+/,"").replace(/\s+/g," ").split(" ");const e=_[0]>0?.529177:1;r.multiplyScalar(e);const t=Math.abs(_[0]),n=new E.Vector3(parseFloat(_[1]),parseFloat(_[2]),parseFloat(_[3])).multiplyScalar(e);_=m[4].replace(/^\s+/,"").replace(/\s+/g," ").split(" ");const o=Math.abs(_[0]),h=new E.Vector3(parseFloat(_[1]),parseFloat(_[2]),parseFloat(_[3])).multiplyScalar(e);_=m[5].replace(/^\s+/,"").replace(/\s+/g," ").split(" ");const d=Math.abs(_[0]),i=new E.Vector3(parseFloat(_[1]),parseFloat(_[2]),parseFloat(_[3])).multiplyScalar(e);if(v.size={x:t,y:o,z:d},v.unit=new E.Vector3(n.x,h.y,i.z),n.y!=0||n.z!=0||h.x!=0||h.z!=0||i.x!=0||i.y!=0){v.matrix4=new E.Matrix4(n.x,h.x,i.x,0,n.y,h.y,i.y,0,n.z,h.z,i.z,0,0,0,0,1);let D=new E.Matrix4().makeTranslation(r.x,r.y,r.z);v.matrix4=v.matrix4.multiplyMatrices(D,v.matrix4),v.matrix=v.matrix4.matrix3FromTopLeft(),v.origin=new E.Vector3(0,0,0),v.unit=new E.Vector3(1,1,1)}M.modelData=[{cryst:v}],m=m.splice(6,g);for(var s=M[M.length-1].length,a=s+m.length,c=s;c<a;++c){var u={};u.serial=c;var A=m[c-s],L=A.replace(/^\s+/,"").replace(/\s+/g," ").split(" ");u.elem=w.anumToSymbol[L[0]],u.x=parseFloat(L[2])*e,u.y=parseFloat(L[3])*e,u.z=parseFloat(L[4])*e,u.hetflag=!0,u.bonds=[],u.bondOrder=[],u.properties={},M[M.length-1].push(u)}if(b)for(let D=0;D<M.length;D++)(0,S.assignBonds)(M[D],x);return M}},"./src/parsers/GRO.ts"(K,C,f){f.r(C),f.d(C,{GRO:()=>w});var E=f("./src/parsers/utils/assignPDBBonds.ts"),S=f("./src/parsers/utils/atomNameToElem.ts");function w(O,p){const x=[],M=O.split(/\r?\n|\r/);for(;M.length>0;){const m=parseInt(M[1]);if(M.length<3||isNaN(m)||m<=0||M.length<m+3)break;const _=[];x.push(_);let g=2;const v=_.length,r=v+m;for(let e=v;e<r;e++){const t=M[g++],n={};n.serial=e,n.atom=t.slice(10,15).trim(),n.elem=(0,S.atomNameToElem)(n.atom,!0),n.x=10*parseFloat(t.slice(20,28)),n.y=10*parseFloat(t.slice(28,36)),n.z=10*parseFloat(t.slice(36,44)),n.resi=parseInt(t.slice(0,5)),n.resn=t.slice(5,10).trim(),n.bonds=[],n.bondOrder=[],n.properties={},t.length>44&&(n.dx=10*parseFloat(t.slice(44,52)),n.dy=10*parseFloat(t.slice(52,60)),n.dz=10*parseFloat(t.slice(60,68))),_[e]=n}if(M.length<=g+3){const t=M[g++].trim().split(/\s+/);if(t.length===3){for(let n=0;n<3;n++)t[n]=(parseFloat(t[n])*10).toString();x.box=t}}M.splice(0,++g)}for(let m=0;m<x.length;m++)(0,E.assignPDBBonds)(x[m],p);return x}},"./src/parsers/LAMMPSTRJ.ts"(K,C,f){f.r(C),f.d(C,{LAMMPSTRJ:()=>w});var E=f("./src/parsers/utils/assignBonds.ts");const S={id:"serial",type:"atom",element:"elem",q:"charge",radius:"radius",x:"x",xu:"x",xs:"x",xsu:"x",y:"y",yu:"y",ys:"y",ysu:"y",z:"z",zu:"z",zs:"z",zsu:"z"};function w(O,p){const x=[],M=O.split(/\r?\n|\r/);let m=0,b=0,_=0;for(;_<M.length-9;){for(var g=_;g<M.length;g++)if(M[g].match(/ITEM: NUMBER OF ATOMS/)&&(b=parseInt(M[g+1])),M[g].match(/ITEM: ATOMS/)){m=g+1;break}const v=M[m-1].replace("ITEM: ATOMS ","").split(" ");x.push([]);for(let r=m;r<m+b;r++){const e={},t={},n=M[r].split(" ");for(let o=0;o<n.length;o++){const h=S[v[o]];h!==void 0&&(h==="serial"?e[h]=parseInt(n[o]):h==="x"||h==="y"||h==="z"?e[h]=parseFloat(n[o]):h==="charge"||h==="radius"?t[h]=parseFloat(n[o]):e[h]=n[o]),e.properties=t,e.bonds=[],e.bondOrder=[]}x[x.length-1][r-m]=e}_=m+b-1}if(p.assignBonds)for(let v=0;v<x.length;v++)(0,E.assignBonds)(x[v],p);return x}},"./src/parsers/MMTF.ts"(K,C,f){f.r(C),f.d(C,{MMTFparser:()=>b});var E=f("./src/utilities.ts"),S=f("./src/WebGL/index.ts"),w=f("./src/parsers/utils/computeSecondaryStructure.ts"),O=f("./src/parsers/utils/processSymmetries.ts"),p=f("./src/vendor/mmtf.js"),x=function(_){return String.fromCharCode.apply(null,_).replace(/\0/g,"")},M=function(_){return _==0||_==2||_==4?"h":_==3?"s":"c"};let m=new Set(["D-SACCHARIDE","D-SACCHARIDE 1,4 AND 1,4 LINKING","D-SACCHARIDE 1,4 AND 1,6 LINKING","L-SACCHARIDE","L-SACCHARIDE 1,4 AND 1,4 LINKING","L-SACCHARIDE 1,4 AND 1,6 LINKING","NON-POLYMER","OTHER","PEPTIDE-LIKE","SACCHARIDE"]);function b(_,g){var v=!g.keepH,r=g.altLoc?g.altLoc:"A",e=!!g.noSecondaryStructure,t=!g.noComputeSecondaryStructure,n=!g.doAssembly,o=g.assemblyIndex?g.assemblyIndex:0;typeof _=="string"?_=(0,E.base64ToArray)(_):_=new Uint8Array(_);var h=p.decode(_),d=[[]],i=d.modelData=[],s=0,a=0,c=0,u=h.secStructList,A=h.bFactorList,L=h.altLocList,D=h.occupancyList,R=h.bondAtomList,P=h.bondOrderList,z=h.numModels;if(z==0)return d;g.multimodel||(z=1);var F,B,U,W,I,V,ee=[];if(!n&&h.bioAssemblyList&&h.bioAssemblyList.length>0){var te=h.bioAssemblyList[o].transformList;for(F=0,V=te.length;F<V;F++){var ae=new S.Matrix4(te[F].matrix);ae.transpose(),ee.push(ae)}}var re=null;if(h.unitCell){var fe=h.unitCell;re={a:fe[0],b:fe[1],c:fe[2],alpha:fe[3],beta:fe[4],gamma:fe[5]}}let q=[];h.entityList.forEach(he=>{he.chainIndexList.forEach(H=>{q[H]=he.type=="polymer"})});var oe=0;for(I=0;I<z;I++){var be=h.chainsPerModel[I],ge=d[d.length-1],Le=[];for(i.push({symmetries:ee,cryst:re}),F=0;F<be;++F){var pe=h.groupsPerChain[s],J=x(h.chainIdList.subarray(s*4,s*4+4));h.chainNameList&&(J=x(h.chainNameList.subarray(s*4,s*4+4)));var ce=a,Me="";for(B=0;B<pe;++B){var Fe=h.groupList[h.groupTypeList[a]],ze=Fe.atomNameList.length,Be=0,Ue=!1,Se=!1;if(u){Be=u[a];var Ie=M(Be);(a==0||Ie!=Me)&&(Ue=!0),Me=Ie;var Re=a+1;(Re>=u.length||M(u[Re]!=Ie))&&(Se=!0)}var Oe=h.groupIdList[a],Ge=Fe.groupName;let he=Fe.chemCompType;var Ve=c;let H=m.has(he)||!q[s];for(U=0;U<ze;++U){var j=Fe.elementList[U];if(v&&j=="H"){c+=1;continue}var Y="";A&&(Y=A[c]);var X="";L&&L[c]&&(X=String.fromCharCode(L[c]));var _e="";if(D&&(_e=D[c]),X!=""&&X!=r&&r!="*"){c+=1;continue}var ue=h.atomIdList[c],we=Fe.atomNameList[U],De=0;Fe.atomChargeList&&(De=Fe.atomChargeList[U]);var G=h.xCoordList[c],se=h.yCoordList[c],ve=h.zCoordList[c];Le[c]=ge.length,ge.push({resn:Ge,x:G,y:se,z:ve,elem:j,hetflag:H,chain:J,resi:Oe,icode:X,rescode:Oe+(X!=" "?"^"+X:""),serial:ue,altLoc:X,index:c,atom:we,bonds:[],ss:M(Be),ssbegin:Ue,ssend:Se,bondOrder:[],properties:{charge:De,occupancy:_e},b:Y}),c+=1}var Te=Fe.bondAtomList;for(U=0,W=Fe.bondOrderList.length;U<W;++U){var ie=Ve+Te[U*2],ye=Ve+Te[U*2+1],k=Fe.bondOrderList[U],Ce=Le[ie],Pe=Le[ye],T=ge[Ce],de=ge[Pe];T&&de&&(T.bonds.push(Pe),T.bondOrder.push(k),de.bonds.push(Ce),de.bondOrder.push(k))}a+=1}for(a=ce,B=0;B<pe;++B)a+=1;s+=1}if(R)for(let he=oe,H=R.length;he<H;he+=2){let ne=R[he],xe=R[he+1],je=P?P[he/2]:1;if(ne>=c){oe=he;break}let ke=Le[ne],Ne=Le[xe],Qe=ge[ke],_t=ge[Ne];Qe&&_t&&(Qe.bonds.push(Ne),Qe.bondOrder.push(je),_t.bonds.push(ke),_t.bondOrder.push(je))}g.multimodel&&(g.onemol||d.push([]))}if(!n)for(let he=0;he<d.length;he++)(0,O.processSymmetries)(i[he].symmetries,d[he],g,i[he].cryst);return t&&!e&&(0,w.computeSecondaryStructure)(d,g.hbondCutoff),d}},"./src/parsers/MOL2.ts"(K,C,f){f.r(C),f.d(C,{MOL2:()=>S});let E={"C.1":"C",C1:"C","C.2":"C",C2:"C","C.3":"C",C3:"C","C.ar":"C",Car:"C","C.cat":"C",Ccat:"C","H.spc":"H",Hspc:"H","H.t3p":"H",Ht3p:"H","N.1":"N",N1:"N","N.2":"N",N2:"N","N.3":"N",N3:"N","N.4":"N",N4:"N","N.am":"N",Nam:"N","N.ar":"N",Nar:"N","N.p13":"N",Np13:"N","O.2":"O",O2:"O","O.3":"O",O3:"O","O.co2":"O",Oco2:"O","O.spc":"O",Ospc:"O","O.t3p":"O",Ot3p:"O","P.3":"P",P3:"P","S.2":"S",S2:"S","S.3":"S",S3:"S","S.o":"S",So:"S","S.o2":"S",So2:"S"};function S(w,O){var p=[[]],x=!1;typeof O.keepH<"u"&&(x=!O.keepH);var M=w.search(/@<TRIPOS>MOLECULE/),m=w.search(/@<TRIPOS>ATOM/);if(M==-1||m==-1)return p;for(var b=w.substring(M).split(/\r?\n|\r/);b.length>0;){var _=[],g=b[2].replace(/^\s+/,"").replace(/\s+/g," ").split(" "),v=parseInt(g[0]),r=0;g.length>1&&(r=parseInt(g[1]));var e=4,t;for(t=3;t<b.length;t++)if(b[t]=="@<TRIPOS>ATOM"){e=t+1;break}var n=p[p.length-1].length,o=n+v,h;for(t=n;t<o;t++){h=b[e++],g=h.replace(/^\s+/,"").replace(/\s+/g," ").split(" ");var d={},i=g[5];if(E[i]!==void 0?i=E[i]:(i=i.split(".")[0],i=i[0].toUpperCase()+i.substring(1).toLowerCase()),d.atom=g[1],d.elem=i,!(d.elem=="H"&&x)){var s=p[p.length-1].length,a=parseInt(g[0]);d.serial=a,d.x=parseFloat(g[2]),d.y=parseFloat(g[3]),d.z=parseFloat(g[4]),d.atom=g[5];var c=parseFloat(g[8]);d.index=s,d.bonds=[],d.bondOrder=[],d.properties={charge:c,partialCharge:c},_[a]=s,p[p.length-1].push(d)}}for(var u=!1;e<b.length;)if(b[e++]=="@<TRIPOS>BOND"){u=!0;break}if(u&&r)for(t=0;t<r;t++){h=b[e++],g=h.replace(/^\s+/,"").replace(/\s+/g," ").split(" ");var A=parseInt(g[1]),L=p[p.length-1][_[A]],D=parseInt(g[2]),R=p[p.length-1][_[D]],P=parseInt(g[3]);isNaN(P)&&(P=1),L!==void 0&&R!==void 0&&(L.bonds.push(_[D]),L.bondOrder.push(P),R.bonds.push(_[A]),R.bondOrder.push(P))}if(O.multimodel){O.onemol||p.push([]),b.splice(0,e),w=b.join(`
`);continue}else break}return p}},"./src/parsers/PDB.ts"(K,C,f){f.r(C),f.d(C,{PDB:()=>S});var E=f("./src/parsers/utils/getSinglePDB.ts");function S(w,O){O=O||{};var p=[],x={};p.modelData=[];for(var M=w.split(/\r?\n|\r/);M.length>0;){var m=(0,E.getSinglePDB)(M,O,x),b=m[0],_=m[1];if(M=m[2],b.length!=0){if(O.multimodel&&O.onemol&&p.length>0)for(var g=p[0].length,v=0;v<b.length;v++){var r=b[v];r.index=v;for(var e=0;e<r.bonds.length;e++)r.bonds[e]+=g;p[0].push(r)}else p.modelData.push(_),p.push(b);if(!O.multimodel)break}}return p}},"./src/parsers/PQR.ts"(K,C,f){f.r(C),f.d(C,{PQR:()=>w});var E=f("./src/parsers/utils/assignPDBBonds.ts"),S=f("./src/parsers/utils/computeSecondaryStructure.ts");function w(O,p){var x=[[]],M=!p.noSecondaryStructure;x.modelData=[{symmetries:[]}];var m=[],b=O.split(/\r?\n|\r/),_;for(let u=0;u<b.length;u++){_=b[u].replace(/^\s*/,"");var g=_.substring(0,6);if(g.indexOf("END")==0)if(p.multimodel){p.onemol||x.push([]);continue}else break;else if(g=="ATOM  "||g=="HETATM"){var v;let A=parseInt(_.substring(6,11)),L=_.substring(12,16).replace(/ /g,""),D=_.substring(17,20).trim(),R=_.substring(21,22),P=parseInt(_.substring(22,26));var r=_.substring(30).trim().split(/\s+/),e=parseFloat(r[0]),t=parseFloat(r[1]),n=parseFloat(r[2]),o=parseFloat(r[3]),h=parseFloat(r[4]),d=L[0];L.length>1&&L[1].toUpperCase()!=L[1]&&(d=L.substring(0,2)),_[0]=="H"?v=!0:v=!1,m[A]=x[x.length-1].length,x[x.length-1].push({resn:D,x:e,y:t,z:n,elem:d,hetflag:v,chain:R,resi:P,serial:A,atom:L,bonds:[],ss:"c",bondOrder:[],properties:{charge:o,partialCharge:o,radius:h},pdbline:_})}else if(g=="CONECT"){var i=parseInt(_.substring(6,11)),s=x[x.length-1][m[i]];for(let A=0;A<4;A++){var a=parseInt(_.substring([11,16,21,26][A],[11,16,21,26][A]+5)),c=x[x.length-1][m[a]];s!==void 0&&c!==void 0&&(s.bonds.push(m[a]),s.bondOrder.push(1))}}}for(let u=0;u<x.length;u++)(0,E.assignPDBBonds)(x[u],p),M&&(0,S.computeSecondaryStructure)(x[u],p.hbondCutoff);return x}},"./src/parsers/PRMTOP.ts"(K,C,f){f.r(C),f.d(C,{PRMTOP:()=>E});function E(S){var w=[],O,p=0,x=S.split(/\r?\n|\r/);if(x.length>0&&x[0].includes("VERSION")){var M=x.filter(function(n){return n.includes("POINTERS")||n.includes("ATOM_NAME")||n.includes("CHARGE")||n.includes("RADII")||n.includes("BONDS_INC_HYDROGEN")||n.includes("BONDS_WITHOUT_HYDROGEN")||n.includes("RESIDUE_LABEL")||n.includes("RESIDUE_POINTER")}),m=r("POINTERS");if(m==-1)return[];var b=e(m),_=parseInt(x[m+1].slice(0,b[1]));let t=parseInt(x[m+2].slice(b[1],b[0]+b[1]));if(isNaN(_)||_<=0)return[];if(m=r("ATOM_NAME"),m==-1)return[];b=e(m);var g=b[0];for(let n=0;n<_/b[0];n++){n==parseInt(_/b[0])&&(g=_%b[0]);for(let o=0;o<g;o++){let h={},d={charge:"",radii:""};h.serial=p,h.x=0,h.y=0,h.z=0,h.atom=x[m+1].slice(b[1]*o,b[1]*(o+1)).trim(),h.elem=x[m+1].slice(b[1]*o,b[1]*o+1).trim(),h.properties=d,h.bonds=[],h.bondOrder=[],h.index=w.length,w.push(h),p++}m++}if(m=r("CHARGE"),m!=-1){b=e(m),p=0,g=b[0];for(let n=0;n<_/b[0];n++){n==parseInt(_/b[0])&&(g=_%b[0]);for(let o=0;o<g;o++)w[p].properties.charge=parseFloat(x[m+1].slice(b[1]*o,b[1]*(o+1))),p++;m++}}m=r("RESIDUE_POINTER");var v=[];if(m!=-1){b=e(m),g=b[0],m+=1;for(let n=0;n<t/b[0];n++){n==parseInt(t/b[0])&&(g=t%b[0]);for(let o=0;o<g;o++)v.push(parseInt(x[m].slice(b[1]*o,b[1]*(o+1))));m++}if(m=r("RESIDUE_LABEL"),m!=-1){let n=[];b=e(m),g=b[0],m+=1;for(let i=0;i<t/b[0];i++){i==parseInt(t/b[0])&&(g=t%b[0]);for(let s=0;s<g;s++)n.push(x[m].slice(b[1]*s,b[1]*(s+1)).trim());m++}let o=0,h=0,d="";v.push(w.length+1);for(let i=0;i<w.length;i++)i+1>=v[o]&&(d=n[o],o+=1,h+=1),w[i].resi=h,w[i].resn=d}}if(m=r("RADII"),m!=-1){b=e(m),p=0,g=b[0];for(let n=0;n<_/b[0];n++){n==parseInt(_/b[0])&&(g=_%b[0]);for(let o=0;o<g;o++)w[p].properties.radii=parseFloat(x[m+1].slice(b[1]*o,b[1]*(o+1))),p++;m++}}if(m=r("BONDS_WITHOUT_HYDROGEN"),m!=-1)for(b=e(m),p=0,g=b[0],m=m+1;!x[m].match(/^%FLAG/);){x[m+1].match(/^%FLAG/)&&(g=_%b[0]);for(let n=0;n<g;n++)p%3==0?O=parseInt(x[m].slice(b[1]*n,b[1]*(n+1))/3):p%3==1&&(w[O].bonds.push(parseInt(x[m].slice(b[1]*n,b[1]*(n+1))/3)),w[O].bondOrder.push(1)),p++;m++}if(m=r("BONDS_INC_HYDROGEN"),m!=-1)for(b=e(m),p=0,g=b[0],m=m+1;!x[m].match(/^%FLAG/);){x[m+1].match(/^%FLAG/)&&(g=_%b[0]);for(let n=0;n<g;n++)p%3==0?O=parseInt(x[m].slice(b[1]*n,b[1]*(n+1))/3):p%3==1&&(w[O].bonds.push(parseInt(x[m].slice(b[1]*n,b[1]*(n+1))/3)),w[O].bonds.push(1)),p++;m++}}else return[];function r(t){var n=x.indexOf(M.filter(function(o){return o.includes(t)})[0]);if(Number.isInteger(n)&&n>0){for(;!x[n].includes("FORMAT");)n++;return n}else return-1}function e(t){var n=x[t].match(/\((\d*)\S*/),o=x[t].match(/[a-zA-Z](\d*)\)\s*/);return o==null&&(o=x[t].match(/[a-zA-Z](\d*)\.\d*\)\s*/)),[parseInt(n[1]),parseInt(o[1])]}return[w]}},"./src/parsers/SDF.ts"(K,C,f){f.r(C),f.d(C,{SDF:()=>w});var E=function(O,p){var x=[[]],M=!1;for(typeof p.keepH<"u"&&(M=!p.keepH);O.length>0&&!(O.length<4);){var m=parseInt(O[3].substring(0,3));if(isNaN(m)||m<=0)break;var b=parseInt(O[3].substring(3,6)),_=4;if(O.length<4+m+b)break;var g=[],v=x[x.length-1].length,r=v+m,e,t;for(e=v;e<r;e++,_++){t=O[_];var n={},o=t.substring(31,34).replace(/ /g,"");n.atom=n.elem=o[0].toUpperCase()+o.substring(1).toLowerCase(),(n.elem!=="H"||!M)&&(n.serial=e,g[e]=x[x.length-1].length,n.x=parseFloat(t.substring(0,10)),n.y=parseFloat(t.substring(10,20)),n.z=parseFloat(t.substring(20,30)),n.hetflag=!0,n.bonds=[],n.bondOrder=[],n.properties={},n.index=x[x.length-1].length,x[x.length-1].push(n))}for(e=0;e<b;e++,_++){t=O[_];var h=g[parseInt(t.substring(0,3))-1+v],d=g[parseInt(t.substring(3,6))-1+v],i=parseFloat(t.substring(6));typeof h<"u"&&typeof d<"u"&&(x[x.length-1][h].bonds.push(d),x[x.length-1][h].bondOrder.push(i),x[x.length-1][d].bonds.push(h),x[x.length-1][d].bondOrder.push(i))}if(p.multimodel){for(p.onemol||x.push([]);O[_]!=="$$$$"&&_<O.length;)_++;O.splice(0,++_)}else break}return x},S=function(O,p){var x=[[]],M=!1;for(typeof p.keepH<"u"&&(M=!p.keepH);O.length>0&&!(O.length<8||!O[4].startsWith("M  V30 BEGIN CTAB")||!O[5].startsWith("M  V30 COUNTS")||O[5].length<14);){var m=O[5].substring(13).match(/\S+/g);if(m.length<2)break;var b=parseInt(m[0]);if(isNaN(b)||b<=0)break;var _=parseInt(m[1]),g=7;if(O.length<8+b+_)break;var v=[],r=x[x.length-1].length,e=r+b,t,n;for(t=r;t<e;t++,g++){n=O[g];var o=n.substring(6).match(/\S+/g);if(o.length>4){var h={},d=o[1].replace(/ /g,"");h.atom=h.elem=d[0].toUpperCase()+d.substring(1).toLowerCase(),(h.elem!=="H"||!M)&&(h.serial=t,v[t]=x[x.length-1].length,h.x=parseFloat(o[2]),h.y=parseFloat(o[3]),h.z=parseFloat(o[4]),h.hetflag=!0,h.bonds=[],h.bondOrder=[],h.properties={},h.index=x[x.length-1].length,x[x.length-1].push(h))}}if(O[g]==="M  V30 END ATOM")g++;else break;if(_!==0&&O[g]==="M  V30 BEGIN BOND")g++;else break;for(t=0;t<_;t++,g++){n=O[g];var i=n.substring(6).match(/\S+/g);if(i.length>3){var s=v[parseInt(i[2])-1+r],a=v[parseInt(i[3])-1+r],c=parseFloat(i[1]);typeof s<"u"&&typeof a<"u"&&(x[x.length-1][s].bonds.push(a),x[x.length-1][s].bondOrder.push(c),x[x.length-1][a].bonds.push(s),x[x.length-1][a].bondOrder.push(c))}}if(p.multimodel){for(p.onemol||x.push([]);O[g]!=="$$$$"&&g<O.length;)g++;O.splice(0,++g)}else break}return x};function w(O,p){var x="V2000",M=O.split(/\r?\n|\r/);return M.length>3&&M[3].length>38&&(x=M[3].substring(34,39)),x==="V2000"?E(M,p):x==="V3000"?S(M,p):[[""]]}},"./src/parsers/VASP.ts"(K,C,f){f.r(C),f.d(C,{VASP:()=>w});var E=f("./src/WebGL/index.ts"),S=f("./src/parsers/utils/assignBonds.ts");function w(O,p={}){var x=[[]],M={};const m=p.assignBonds===void 0?!0:p.assignBonds;var b=O.replace(/^\s+/,"").split(/\r?\n/);if(b.length<3)return x;if(b[1].match(/\d+/))M.length=parseFloat(b[1]);else return console.log("Warning: second line of the vasp structure file must be a number"),x;if(M.length<0)return console.log("Warning: Vasp implementation for negative lattice lengths is not yet available"),x;M.xVec=new Float32Array(b[2].replace(/^\s+/,"").split(/\s+/)),M.yVec=new Float32Array(b[3].replace(/^\s+/,"").split(/\s+/)),M.zVec=new Float32Array(b[4].replace(/^\s+/,"").split(/\s+/));var _=new E.Matrix3(M.xVec[0],M.xVec[1],M.xVec[2],M.yVec[0],M.yVec[1],M.yVec[2],M.zVec[0],M.zVec[1],M.zVec[2]);_.multiplyScalar(M.length),x.modelData=[{symmetries:[],cryst:{matrix:_}}];var g=b[5].trim().split(/\s+/),v=new Int16Array(b[6].trim().split(/\s+/)),r=b[7].trim(),e=!1;if(r.match(/S/)&&(e=!0,r=b[8].trim()),r.toLowerCase()[0]=="c")r="cartesian";else if(r.toLowerCase()[0]=="d")r="direct";else return console.log("Warning: Unknown vasp mode in POSCAR file: mode must be either C(artesian) or D(irect)"),x;if(g.length!=v.length)return console.log("Warning: declaration of atomary species wrong:"),console.log(g),console.log(v),x;e?b.splice(0,9):b.splice(0,8);for(var t=0,n=0,o=g.length;n<o;n++){for(var h=g[n],d=0,i=v[n];d<i;d++){var s=new Float32Array(b[t+d].trim().split(/\s+/)),a={};a.elem=h,r=="cartesian"?(a.x=M.length*s[0],a.y=M.length*s[1],a.z=M.length*s[2]):(a.x=M.length*(s[0]*M.xVec[0]+s[1]*M.yVec[0]+s[2]*M.zVec[0]),a.y=M.length*(s[0]*M.xVec[1]+s[1]*M.yVec[1]+s[2]*M.zVec[1]),a.z=M.length*(s[0]*M.xVec[2]+s[1]*M.yVec[2]+s[2]*M.zVec[2])),a.bonds=[],a.bondOrder=[],x[0].push(a)}t+=v[n]}if(m)for(let c=0;c<x.length;c++)(0,S.assignBonds)(x[c],p);return x}},"./src/parsers/XYZ.ts"(K,C,f){f.r(C),f.d(C,{XYZ:()=>w});var E=f("./src/WebGL/index.ts"),S=f("./src/parsers/utils/assignBonds.ts");function w(O,p){p=p||{};for(var x=[[]],M=p.assignBonds===void 0?!0:p.assignBonds,m=O.trimStart().split(/\r?\n|\r/);m.length>0&&!(m.length<3);){var b=parseInt(m[0]);if(isNaN(b)||b<=0||m.length<b+2)break;var _=/Lattice\s*=\s*["\{\}]([^"\{\}]+)["\{\}]\s*/gi,g=_.exec(m[1]);if(g!=null&&g.length>1){var v=new Float32Array(g[1].split(/\s+/)),r=new E.Matrix3(v[0],v[3],v[6],v[1],v[4],v[7],v[2],v[5],v[8]);x.modelData=[{cryst:{matrix:r}}]}for(var e=2,t=x[x.length-1].length,n=t+b,o=t;o<n;o++){var h=m[e++],d=h.trim().split(/\s+/),i={};i.serial=o;var s=d[0];i.atom=i.elem=s[0].toUpperCase()+s.substring(1,2).toLowerCase(),i.x=parseFloat(d[1]),i.y=parseFloat(d[2]),i.z=parseFloat(d[3]),i.hetflag=!0,i.bonds=[],i.bondOrder=[],i.properties={},x[x.length-1][o]=i,d.length>=7&&(i.dx=parseFloat(d[4]),i.dy=parseFloat(d[5]),i.dz=parseFloat(d[6]))}if(p.multimodel)x.push([]),m.splice(0,e);else break}if(M)for(let c=0;c<x.length;c++)(0,S.assignBonds)(x[c],p);if(p.onemol){var a=x;x=[],x.push(a[0]);for(let c=1;c<a.length;c++){let u=x[0].length;for(let A=0;A<a[c].length;A++){let L=a[c][A];for(let D=0;D<L.bonds.length;D++)L.bonds[D]=L.bonds[D]+u;L.index=x[0].length,L.serial=x[0].length,x[0].push(L)}}}return x}},"./src/parsers/cifutils/category.ts"(K,C,f){f.r(C),f.d(C,{Category:()=>S});var E=f("./src/parsers/cifutils/decoder.ts");function S(w){const O=Object.create(null),p=Object.create(null);for(const x of w.columns)O[x.name]=x;return{rowCount:w.rowCount,name:w.name.substring(1),fieldNames:w.columns.map(x=>x.name),getField(x){const M=O[x];if(M)return p[x]||(p[x]=(0,E.decode)(M.data)),p[x]}}}},"./src/parsers/cifutils/decoder.ts"(K,C,f){f.r(C),f.d(C,{decode:()=>O});var E=f("./src/parsers/cifutils/encoding.ts");const S=new Uint16Array(new Uint8Array([18,52]).buffer)[0]===13330;function w(u,A){const L=new ArrayBuffer(u.length),D=new Uint8Array(L);for(let R=0,P=u.length;R<P;R+=A)for(let z=0;z<A;z++)D[R+A-z-1]=u[R+z];return L}function O(u){let A=u.data;for(let L=u.encoding.length-1;L>=0;L--)A=p(A,u.encoding[L]);return A}function p(u,A){switch(A.kind){case"ByteArray":switch(A.type){case E.Encoding.IntDataType.Uint8:return u;case E.Encoding.IntDataType.Int8:return m(u);case E.Encoding.IntDataType.Int16:return _(u);case E.Encoding.IntDataType.Uint16:return g(u);case E.Encoding.IntDataType.Int32:return v(u);case E.Encoding.IntDataType.Uint32:return r(u);case E.Encoding.FloatDataType.Float32:return e(u);case E.Encoding.FloatDataType.Float64:return t(u);default:throw new Error("unreachable")}case"FixedPoint":return n(u,A);case"IntervalQuantization":return o(u,A);case"RunLength":return h(u,A);case"Delta":return d(u,A);case"IntegerPacking":return a(u,A);case"StringArray":return c(u,A)}}function x(u,A){switch(u){case E.Encoding.IntDataType.Int8:return new Int8Array(A);case E.Encoding.IntDataType.Int16:return new Int16Array(A);case E.Encoding.IntDataType.Int32:return new Int32Array(A);case E.Encoding.IntDataType.Uint8:return new Uint8Array(A);case E.Encoding.IntDataType.Uint16:return new Uint16Array(A);case E.Encoding.IntDataType.Uint32:return new Uint32Array(A);default:return new Int32Array(A)}}function M(u,A){switch(u){case E.Encoding.FloatDataType.Float32:return new Float32Array(A);case E.Encoding.FloatDataType.Float64:return new Float64Array(A);default:return new Float64Array(A)}}function m(u){return new Int8Array(u.buffer,u.byteOffset)}function b(u,A,L){return(u.byteOffset!=0||u.byteLength!=u.buffer.byteLength)&&(u=new Uint8Array(u)),S?new L(u.buffer):new L(w(u,A))}function _(u){return b(u,2,Int16Array)}function g(u){return b(u,2,Uint16Array)}function v(u){return b(u,4,Int32Array)}function r(u){return b(u,4,Uint32Array)}function e(u){return b(u,4,Float32Array)}function t(u){return b(u,8,Float64Array)}function n(u,A){const L=u.length,D=M(A.srcType,L),R=1/A.factor;for(let P=0;P<L;P++)D[P]=R*u[P];return D}function o(u,A){const L=u.length,D=M(A.srcType,L),R=(A.max-A.min)/(A.numSteps-1),P=A.min;for(let z=0;z<L;z++)D[z]=P+R*u[z];return D}function h(u,A){const L=x(A.srcType,A.srcSize);let D=0;for(let R=0,P=u.length;R<P;R+=2){const z=u[R],F=u[R+1];for(let B=0;B<F;++B)L[D++]=z}return L}function d(u,A){const L=u.length,D=x(A.srcType,L);if(!L)return u;D[0]=u[0]+(A.origin|0);for(let R=1;R<L;++R)D[R]=u[R]+D[R-1];return D}function i(u,A){const L=A.byteCount===1?127:32767,D=-L-1,R=u.length,P=new Int32Array(A.srcSize);let z=0,F=0;for(;z<R;){let B=0,U=u[z];for(;U===L||U===D;)B+=U,z++,U=u[z];B+=U,P[F]=B,z++,F++}return P}function s(u,A){const L=A.byteCount===1?255:65535,D=u.length,R=new Int32Array(A.srcSize);let P=0,z=0;for(;P<D;){let F=0,B=u[P];for(;B===L;)F+=B,P++,B=u[P];F+=B,R[z]=F,P++,z++}return R}function a(u,A){return u.length===A.srcSize?u:A.isUnsigned?s(u,A):i(u,A)}function c(u,A){const L=O({encoding:A.offsetEncoding,data:A.offsets}),D=O({encoding:A.dataEncoding,data:u}),R=A.stringData,P=new Array(L.length);P[0]="";for(let B=1,U=L.length;B<U;B++)P[B]=R.substring(L[B-1],L[B]);let z=0;const F=new Array(D.length);for(let B=0,U=D.length;B<U;B++)F[z++]=P[D[B]+1];return F}},"./src/parsers/cifutils/encoding.ts"(K,C,f){f.r(C),f.d(C,{Encoding:()=>S,VERSION:()=>E});const E="0.3.0";var S;(function(w){(function(x){x[x.Int8=1]="Int8",x[x.Int16=2]="Int16",x[x.Int32=3]="Int32",x[x.Uint8=4]="Uint8",x[x.Uint16=5]="Uint16",x[x.Uint32=6]="Uint32"})(w.IntDataType||(w.IntDataType={})),function(x){x[x.Float32=32]="Float32",x[x.Float64=33]="Float64"}(w.FloatDataType||(w.FloatDataType={}));function O(x){let M;return x instanceof Int8Array?M=w.IntDataType.Int8:x instanceof Int16Array?M=w.IntDataType.Int16:x instanceof Int32Array?M=w.IntDataType.Int32:x instanceof Uint8Array?M=w.IntDataType.Uint8:x instanceof Uint16Array?M=w.IntDataType.Uint16:x instanceof Uint32Array?M=w.IntDataType.Uint32:x instanceof Float32Array?M=w.FloatDataType.Float32:x instanceof Float64Array?M=w.FloatDataType.Float64:M=w.IntDataType.Int32,M}w.getDataType=O;function p(x){if(x instanceof Int8Array||x instanceof Int16Array||x instanceof Int32Array)return!0;for(let M=0,m=x.length;M<m;M++)if(M<0)return!1;return!0}w.isSignedIntegerDataType=p})(S||(S={}))},"./src/parsers/index.ts"(K,C,f){f.r(C),f.d(C,{Parsers:()=>n,bondLength:()=>t.bondLength,setBondLength:()=>t.setBondLength});var E=f("./src/parsers/VASP.ts"),S=f("./src/parsers/CUBE.ts"),w=f("./src/parsers/XYZ.ts"),O=f("./src/parsers/SDF.ts"),p=f("./src/parsers/CDJSON.ts"),x=f("./src/parsers/CIF.ts"),M=f("./src/parsers/MOL2.ts"),m=f("./src/parsers/PDB.ts"),b=f("./src/parsers/PQR.ts"),_=f("./src/parsers/MMTF.ts"),g=f("./src/parsers/PRMTOP.ts"),v=f("./src/parsers/GRO.ts"),r=f("./src/parsers/LAMMPSTRJ.ts"),e=f("./src/parsers/BCIF.ts"),t=f("./src/parsers/utils/bondLength.ts");const n={vasp:E.VASP,VASP:E.VASP,cube:S.CUBE,CUBE:S.CUBE,xyz:w.XYZ,XYZ:w.XYZ,sdf:O.SDF,SDF:O.SDF,json:p.CDJSON,cdjson:p.CDJSON,CDJSON:p.CDJSON,mcif:x.CIF,cif:x.CIF,CIF:x.CIF,mol2:M.MOL2,MOL2:M.MOL2,pdb:m.PDB,PDB:m.PDB,pdbqt:m.PDB,PDBQT:m.PDB,pqr:b.PQR,PQR:b.PQR,mmtf:_.MMTFparser,MMTF:_.MMTFparser,prmtop:g.PRMTOP,PRMTOP:g.PRMTOP,gro:v.GRO,GRO:v.GRO,lammpstrj:r.LAMMPSTRJ,LAMMPSTRJ:r.LAMMPSTRJ,bcif:e.BCIF,BCIF:e.BCIF}},"./src/parsers/utils/anumToSymbol.ts"(K,C,f){f.r(C),f.d(C,{anumToSymbol:()=>E});const E={1:"H",2:"He",3:"Li",4:"Be",5:"B",6:"C",7:"N",8:"O",9:"F",10:"Ne",11:"Na",12:"Mg",13:"Al",14:"Si",15:"P",16:"S",17:"Cl",18:"Ar",19:"K",20:"Ca",21:"Sc",22:"Ti",23:"V",24:"Cr",25:"Mn",26:"Fe",27:"Co",28:"Ni",29:"Cu",30:"Zn",31:"Ga",32:"Ge",33:"As",34:"Se",35:"Br",36:"Kr",37:"Rb",38:"Sr",39:"Y",40:"Zr",41:"Nb",42:"Mo",43:"Tc",44:"Ru",45:"Rh",46:"Pd",47:"Ag",48:"Cd",49:"In",50:"Sn",51:"Sb",52:"Te",53:"I",54:"Xe",55:"Cs",56:"Ba",71:"Lu",72:"Hf",73:"Ta",74:"W",75:"Re",76:"Os",77:"Ir",78:"Pt",79:"Au",80:"Hg",81:"Tl",82:"Pb",83:"Bi",84:"Po",85:"At",86:"Rn",87:"Fr",88:"Ra",104:"Rf",105:"Db",106:"Sg",107:"Bh",108:"Hs",109:"Mt",110:"Ds",111:"Rg",112:"Cn",113:"Nh",114:"Fl",115:"Mc",116:"Lv",117:"Ts",118:"Og",57:"La",58:"Ce",59:"Pr",60:"Nd",61:"Pm",62:"Sm",63:"Eu",64:"Gd",65:"Tb",66:"Dy",67:"Ho",68:"Er",69:"Tm",70:"Yb",89:"Ac",90:"Th",91:"Pa",92:"U",93:"Np",94:"Pu",95:"Am",96:"Cm",97:"Bk",98:"Cf",99:"Es",100:"Fm",101:"Md",102:"No"}},"./src/parsers/utils/areConnected.ts"(K,C,f){f.r(C),f.d(C,{areConnected:()=>w});var E=f("./src/parsers/utils/bondLength.ts");const S=new Set(["Na","K","Ca","Mg","Mn","Sr"]);function w(O,p,x){if(x&&x.unboundCations&&(S.has(O.elem)||S.has(p.elem)))return!1;let M=(0,E.bondLength)(O.elem)+(0,E.bondLength)(p.elem);M+=.25,M*=M;let m=O.x-p.x;if(m*=m,m>M)return!1;let b=O.y-p.y;if(b*=b,b>M)return!1;let _=O.z-p.z;if(_*=_,_>M)return!1;const g=m+b+_;return!(isNaN(g)||g<.5||g>M||O.altLoc!==p.altLoc&&O.altLoc.trim()!==""&&p.altLoc.trim()!=="")}},"./src/parsers/utils/assignBackboneHBonds.ts"(K,C,f){f.r(C),f.d(C,{assignBackboneHBonds:()=>E});function E(S,w){const O=w||3.2,p=O*O,x=[];for(let M=0,m=S.length;M<m;M++){S[M].index=M;const b=S[M];!b.hetflag&&(b.atom==="N"||b.atom==="O")&&(x.push(b),b.hbondOther=null,b.hbondDistanceSq=Number.POSITIVE_INFINITY)}x.sort(function(M,m){return M.z-m.z});for(let M=0,m=x.length;M<m;M++){const b=x[M];for(let _=M+1;_<m;_++){const g=x[_],v=g.z-b.z;if(v>O)break;if(g.atom==b.atom)continue;const r=Math.abs(g.y-b.y);if(r>O)continue;const e=Math.abs(g.x-b.x);if(e>O)continue;const t=e*e+r*r+v*v;t>p||g.chain==b.chain&&Math.abs(g.resi-b.resi)<4||(t<b.hbondDistanceSq&&(b.hbondOther=g,b.hbondDistanceSq=t),t<g.hbondDistanceSq&&(g.hbondOther=b,g.hbondDistanceSq=t))}}}},"./src/parsers/utils/assignBonds.ts"(K,C,f){f.r(C),f.d(C,{assignBonds:()=>O});var E=f("./src/parsers/utils/areConnected.ts");const S=[{x:0,y:0,z:1},{x:0,y:1,z:-1},{x:0,y:1,z:0},{x:0,y:1,z:1},{x:1,y:-1,z:-1},{x:1,y:-1,z:0},{x:1,y:-1,z:1},{x:1,y:0,z:-1},{x:1,y:0,z:0},{x:1,y:0,z:1},{x:1,y:1,z:-1},{x:1,y:1,z:0},{x:1,y:1,z:1}],w=4.95;function O(p,x){for(let b=0,_=p.length;b<_;b++)p[b].index||(p[b].index=b);const M={x:{y:{z:[]}}};for(let b=0;b<p.length;b++){const _=p[b],g=Math.floor(_.x/w),v=Math.floor(_.y/w),r=Math.floor(_.z/w);M[g]||(M[g]={}),M[g][v]||(M[g][v]={}),M[g][v][r]||(M[g][v][r]=[]),M[g][v][r].push(_)}function m(b,_){for(let g=0;g<b.length;g++){const v=b[g];for(let r=0;r<_.length;r++){const e=_[r];if((0,E.areConnected)(v,e,x)){const t=v.bonds.indexOf(e.index),n=e.bonds.indexOf(v.index);t===-1&&n===-1?(v.bonds.push(e.index),v.bondOrder.push(1),e.bonds.push(v.index),e.bondOrder.push(1)):t===-1?(v.bonds.push(e.index),v.bondOrder.push(e.bondOrder[n])):n===-1&&(e.bonds.push(v.index),e.bondOrder.push(v.bondOrder[t]))}}}}for(let b in M){const _=parseInt(b);for(let g in M[_]){const v=parseInt(g);for(let r in M[_][v]){const e=parseInt(r),t=M[_][v][e];for(let n=0;n<t.length;n++){const o=t[n];for(let h=n+1;h<t.length;h++){const d=t[h];(0,E.areConnected)(o,d,x)&&o.bonds.indexOf(d.index)==-1&&(o.bonds.push(d.index),o.bondOrder.push(1),d.bonds.push(o.index),d.bondOrder.push(1))}}for(let n=0;n<S.length;n++){const o=S[n];if(!M[_+o.x]||!M[_+o.x][v+o.y]||!M[_+o.x][v+o.y][e+o.z])continue;const h=M[_+o.x][v+o.y][e+o.z];m(t,h)}}}}}},"./src/parsers/utils/assignPDBBonds.ts"(K,C,f){f.r(C),f.d(C,{assignPDBBonds:()=>O});var E=f("./src/parsers/utils/areConnected.ts"),S=f("./src/parsers/utils/assignBonds.ts"),w=f("./src/parsers/utils/standardResidues.ts");function O(p,x){const M=[],m=[];for(let v=0,r=p.length;v<r;v++){const e=p[v];e.index=v,e.hetflag||!w.standardResidues.has(e.resn)?m.push(e):M.push(e)}(0,S.assignBonds)(m,x),M.sort(function(v,r){return v.chain!==r.chain?v.chain<r.chain?-1:1:v.resi-r.resi});let b=-1,_=-1,g;for(let v=0,r=M.length;v<r;v++){const e=M[v];e.resi!==b&&(b=e.resi,g||_++,g=!1),e.reschain=_;for(let t=v+1;t<M.length;t++){const n=M[t];if(n.chain!==e.chain||n.resi-e.resi>1)break;(0,E.areConnected)(e,n,x)&&(e.bonds.indexOf(n.index)===-1&&(e.bonds.push(n.index),e.bondOrder.push(1),n.bonds.push(e.index),n.bondOrder.push(1)),e.resi!==n.resi&&(g=!0))}}}},"./src/parsers/utils/atomNameToElem.ts"(K,C,f){f.r(C),f.d(C,{atomNameToElem:()=>S});var E=f("./src/parsers/utils/bondLength.ts");function S(w,O){let p=w.replace(/ /g,"");return p.length>0&&p[0]==="H"&&p!=="Hg"&&p!=="He"&&p!=="Hf"&&p!=="Hs"&&p!=="Ho"&&(p="H"),p.length>1&&(p=p[0].toUpperCase()+p.substring(1).toLowerCase(),E.bondTable[p]===void 0?p=p[0]:O&&(p==="Ca"||p==="Cd")&&(p="C")),p}},"./src/parsers/utils/bondLength.ts"(K,C,f){f.r(C),f.d(C,{bondLength:()=>S,bondTable:()=>E,setBondLength:()=>w});let E={H:.37,He:.32,Li:1.34,Be:.9,B:.82,C:.77,N:.75,O:.73,F:.71,Ne:.69,Na:1.54,Mg:1.3,Al:1.18,Si:1.11,P:1.06,S:1.02,Cl:.99,Ar:.97,K:1.96,Ca:1.74,Sc:1.44,Ti:1.56,V:1.25,Mn:1.39,Fe:1.25,Co:1.26,Ni:1.21,Cu:1.38,Zn:1.31,Ga:1.26,Ge:1.22,Se:1.16,Br:1.14,Kr:1.1,Rb:2.11,Sr:1.92,Y:1.62,Zr:1.48,Nb:1.37,Mo:1.45,Tc:1.56,Ru:1.26,Rh:1.35,Pd:1.31,Ag:1.53,Cd:1.48,In:1.44,Sn:1.41,Sb:1.38,Te:1.35,I:1.33,Xe:1.3,Cs:2.25,Ba:1.98,Lu:1.6,Hf:1.5,Ta:1.38,W:1.46,Re:1.59,Os:1.44,Ir:1.37,Pt:1.28,Au:1.44,Hg:1.49,Tl:1.48,Pb:1.47,Bi:1.46,Rn:1.45};function S(O){return E[O]||1.6}function w(O,p){p<0&&(p=0),E[O]=p}},"./src/parsers/utils/computeSecondaryStructure.ts"(K,C,f){f.r(C),f.d(C,{computeSecondaryStructure:()=>S});var E=f("./src/parsers/utils/assignBackboneHBonds.ts");function S(w,O){(0,E.assignBackboneHBonds)(w,O);const p={};let x,M,m,b,_,g;for(x=0,M=w.length;x<M;x++)if(_=w[x],p[_.chain]===void 0&&(p[_.chain]=[]),isFinite(_.hbondDistanceSq)){const v=_.hbondOther;p[v.chain]===void 0&&(p[v.chain]=[]),Math.abs(v.resi-_.resi)===4&&(p[_.chain][_.resi]="h")}for(m in p)for(b=1;b<p[m].length-1;b++){const v=p[m][b-1],r=p[m][b+1];g=p[m][b],v=="h"&&v==r&&g!=v&&(p[m][b]=v)}for(x=0,M=w.length;x<M;x++)_=w[x],isFinite(_.hbondDistanceSq)&&p[_.chain][_.resi]!="h"&&_.ss!=="h"&&(p[_.chain][_.resi]="maybesheet");for(let v=0,r=w.length;v<r;v++)if(_=w[v],isFinite(_.hbondDistanceSq)&&p[_.chain][_.resi]=="maybesheet"){let e=_.hbondOther,t=p[e.chain][e.resi];(t=="maybesheet"||t=="s")&&(p[_.chain][_.resi]="s",p[e.chain][e.resi]="s")}for(let v in p){for(let r=1;r<p[v].length-1;r++){const e=p[v][r-1],t=p[v][r+1];g=p[v][r],e=="s"&&e==t&&g!=e&&(p[v][r]=e)}for(let r=0;r<p[v].length;r++){const e=p[v][r];(e=="h"||e=="s")&&p[v][r-1]!=e&&p[v][r+1]!=e&&delete p[v][r]}}for(x=0,M=w.length;x<M;x++)_=w[x],g=p[_.chain][_.resi],delete _.hbondOther,delete _.hbondDistanceSq,!(g===void 0||g==="maybesheet")&&(_.ss=g,p[_.chain][_.resi-1]!=g&&(_.ssbegin=!0),p[_.chain][_.resi+1]!=g&&(_.ssend=!0))}},"./src/parsers/utils/getSinglePDB.ts"(K,C,f){f.r(C),f.d(C,{getSinglePDB:()=>b});var E=f("./src/WebGL/index.ts"),S=f("./src/parsers/utils/atomNameToElem.ts"),w=f("./src/parsers/utils/bondLength.ts"),O=f("./src/parsers/utils/computeSecondaryStructure.ts"),p=f("./src/parsers/utils/isEmpty.ts"),x=f("./src/parsers/utils/processSymmetries.ts"),M=f("./src/parsers/utils/assignPDBBonds.ts"),m=f("./src/parsers/utils/validateBonds.ts");function b(_,g,v){const r=[],e=g.assignBonds===void 0?!0:g.assignBonds,t=!g.keepH,n=!!g.noSecondaryStructure,o=!g.noComputeSecondaryStructure,h=!g.doAssembly,d=g.altLoc?g.altLoc:"A",i={symmetries:[],cryst:void 0};let s,a=[];const c=[];let u;const A={};for(let L=0;L<_.length;L++){u=_[L].replace(/^\s*/,"");const D=u.substring(0,6);let R,P,z;if(D.indexOf("END")===0){if(a=_.slice(L+1),D==="END")for(const F in v)v.hasOwnProperty(F)&&delete v[F];break}else if(D==="ATOM  "||D==="HETATM"){let F,B,U,W,I,V,ee,te,ae,re,fe,q;if(fe=u.substring(16,17),fe!==" "&&fe!==d&&d!=="*"||(re=parseInt(u.substring(6,11)),s=u.substring(12,16).replace(/ /g,""),F=u.substring(17,20).replace(/ /g,""),B=u.substring(21,22),U=parseInt(u.substring(22,26)),W=u.substring(26,27),I=parseFloat(u.substring(30,38)),V=parseFloat(u.substring(38,46)),ee=parseFloat(u.substring(46,54)),q=parseFloat(u.substring(60,68)),ae=u.substring(76,78).replace(/ /g,""),ae===""||w.bondTable[ae]===void 0?ae=(0,S.atomNameToElem)(u.substring(12,14),u[0]=="A"):ae=ae[0].toUpperCase()+ae.substring(1).toLowerCase(),ae==="H"&&t))continue;D[0]=="H"?te=!0:te=!1,c[re]=r.length,r.push({resn:F,x:I,y:V,z:ee,elem:ae,hetflag:te,altLoc:fe,chain:B,resi:U,icode:W,rescode:U+(W!==" "?"^"+W:""),serial:re,atom:s,bonds:[],ss:"c",bondOrder:[],properties:{},b:q,pdbline:u})}else if(D==="SHEET "){R=u.substring(21,22),P=parseInt(u.substring(22,26)),z=parseInt(u.substring(33,37)),R in v||(v[R]={}),v[R][P]="s1";for(let F=P+1;F<z;F++)v[R][F]="s";v[R][z]="s2"}else if(D==="CONECT"){const F=parseInt(u.substring(6,11)),B=c[F],U=r[B],W=[11,16,21,26];for(let I=0;I<4;I++){const V=parseInt(u.substring(W[I],W[I]+5)),ee=c[V];let te=B+":"+ee;const ae=r[ee];if(U!==void 0&&ae!==void 0)if(!A[te])A[te]=1,(U.bonds.length==0||U.bonds[U.bonds.length-1]!==ee)&&(U.bonds.push(ee),U.bondOrder.push(1));else{A[te]+=1;for(let re=0;re<U.bonds.length;re++)if(U.bonds[re]==ee){const fe=A[te];fe>=4?U.bondOrder[re]=1:U.bondOrder[re]=fe}}}}else if(D==="HELIX "){R=u.substring(19,20),P=parseInt(u.substring(21,25)),z=parseInt(u.substring(33,37)),R in v||(v[R]={}),v[R][P]="h1";for(let F=P+1;F<z;F++)v[R][F]="h";v[R][z]="h2"}else if(!h&&D==="REMARK"&&u.substring(13,18)==="BIOMT"){let F,B=new E.Matrix4;for(F=1;F<=3;F++)if(u=_[L].replace(/^\s*/,""),parseInt(u.substring(18,19))==F)B.elements[F-1]=parseFloat(u.substring(23,33)),B.elements[F-1+4]=parseFloat(u.substring(33,43)),B.elements[F-1+8]=parseFloat(u.substring(43,53)),B.elements[F-1+12]=parseFloat(u.substring(53)),L++;else for(;u.substring(13,18)==="BIOMT";)L++,u=_[L].replace(/^\s*/,"");B.elements[3]=0,B.elements[7]=0,B.elements[11]=0,B.elements[15]=1,i.symmetries.push(B),L--}else if(D==="CRYST1"){let F,B,U,W,I,V;F=parseFloat(u.substring(7,15)),B=parseFloat(u.substring(16,24)),U=parseFloat(u.substring(25,33)),W=parseFloat(u.substring(34,40)),I=parseFloat(u.substring(41,47)),V=parseFloat(u.substring(48,54)),i.cryst={a:F,b:B,c:U,alpha:W,beta:I,gamma:V}}else if(D==="ANISOU"){const F=parseInt(u.substring(6,11)),B=c[F],U=r[B];if(U){const W=u.substring(30).trim().split(/\s+/),I={u11:parseInt(W[0]),u22:parseInt(W[1]),u33:parseInt(W[2]),u12:parseInt(W[3]),u13:parseInt(W[4]),u23:parseInt(W[5])};U.uMat=I}}}if((0,m.validateBonds)(r,c),e&&(0,M.assignPDBBonds)(r,g),h||(0,x.processSymmetries)(i.symmetries,r,g,i.cryst),o&&!n&&(0,O.computeSecondaryStructure)(r,g.hbondCutoff),!(0,p.isEmpty)(v))for(let L=0;L<r.length;L++){const D=r[L];if(D!==void 0&&D.chain in v&&D.resi in v[D.chain]){const R=v[D.chain][D.resi];D.ss=R[0],R.length>1&&(R[1]=="1"?D.ssbegin=!0:R[1]=="2"&&(D.ssend=!0))}}return[r,i,a]}},"./src/parsers/utils/isEmpty.ts"(K,C,f){f.r(C),f.d(C,{isEmpty:()=>E});function E(S){for(const w in S)return!1;return!0}},"./src/parsers/utils/processSymmetries.ts"(K,C,f){f.r(C),f.d(C,{processSymmetries:()=>S});var E=f("./src/WebGL/index.ts");function S(w,O,p,x){const M=!p.duplicateAssemblyAtoms,m=O.length;let b=m,_=-1,g=null,v=null;(p.normalizeAssembly||p.wrapAtoms)&&x&&(g=(0,E.conversionMatrix3)(x.a,x.b,x.c,x.alpha,x.beta,x.gamma),v=new E.Matrix3,v.getInverse3(g));let r=function(n){let o=n.clone().applyMatrix3(v);const h=[o.x,o.y,o.z],d=[0,0,0];for(let s=0;s<3;s++){for(;h[s]<-.001;)h[s]+=1,d[s]+=1;for(;h[s]>1.001;)h[s]-=1,d[s]-=1}const i=new E.Vector3(d[0],d[1],d[2]);return i.applyMatrix3(g),i};if(p.normalizeAssembly&&x)for(let n=0;n<w.length;n++){const o=new E.Vector3(0,0,0);for(let d=0;d<m;d++){const i=new E.Vector3(O[d].x,O[d].y,O[d].z);i.applyMatrix4(w[n]),o.add(i)}o.divideScalar(m);const h=r(o);w[n].isNearlyIdentity()&&h.lengthSq()>.001&&(_=n),w[n].translate(h)}if(M){if(w.length>1)for(let n=0;n<O.length;n++){var e=[];for(let o=0;o<w.length;o++)if(!w[o].isNearlyIdentity()){var t=new E.Vector3;t.set(O[n].x,O[n].y,O[n].z),t.applyMatrix4(w[o]),e.push(t)}O[n].symmetries=e}}else{for(let n=0;n<m;n++)O[n].sym=-1;for(let n=0;n<w.length;n++)if(!w[n].isNearlyIdentity()&&_!=n){let o=new E.Vector3;for(let h=0;h<m;h++){const d=[];for(let s=0;s<O[h].bonds.length;s++)d.push(O[h].bonds[s]+b);if(o.set(O[h].x,O[h].y,O[h].z),o.applyMatrix4(w[n]),p.wrapAtoms&&x){let s=r(o);o.add(s)}const i={};for(const s in O[h])i[s]=O[h][s];i.x=o.x,i.y=o.y,i.z=o.z,i.bonds=d,i.sym=n,i.index=O.length,O.push(i)}b=O.length}else for(let o=0;o<m;o++)O[o].sym=n;if(p.wrapAtoms&&x){let n=new E.Vector3;for(let o=0;o<m;o++){n.set(O[o].x,O[o].y,O[o].z);let h=r(n);n.add(h),O[o].x=n.x,O[o].y=n.y,O[o].z=n.z}}if(_>=0){const n=new E.Vector3;for(let o=0;o<m;o++)n.set(O[o].x,O[o].y,O[o].z),n.applyMatrix4(w[_]),O[o].x=n.x,O[o].y=n.y,O[o].z=n.z}w.length=0}}},"./src/parsers/utils/standardResidues.ts"(K,C,f){f.r(C),f.d(C,{standardResidues:()=>E});const E=new Set(["ABU","ACD","ALA","ALB","ALI","ARG","AR0","ASN","ASP","ASX","BAS","CYS","CYH","CYX","CSS","CSH","GLN","GLU","GLX","GLY","HIS","HIE","HID","HIP","HYP","ILE","ILU","LEU","LYS","MET","PCA","PGA","PHE","PR0","PRO","PRZ","SER","THR","TRP","TYR","VAL","A","1MA","C","5MC","OMC","G","1MG","2MG","M2G","7MG","OMG","YG","I","T","U","+U","H2U","5MU","PSU","ACE","F0R","H2O","HOH","WAT"])},"./src/parsers/utils/validateBonds.ts"(K,C,f){f.r(C),f.d(C,{validateBonds:()=>E});function E(S,w){for(let O=0,p=S.length;O<p;O++){const x=S[O];for(let M=0;M<x.bonds.length;M++){const m=x.bonds[M],b=S[m],_=w[x.serial];b&&_&&b.bonds.indexOf(_)<0&&(b.bonds.push(_),b.bondOrder.push(x.bondOrder[M]))}}}},"./src/partialCharges.ts"(K,C,f){f.r(C),f.d(C,{applyPartialCharges:()=>S,partialCharges:()=>E});const E={"ALA:N":-.15,"ALA:CA":.1,"ALA:CB":0,"ALA:C":.6,"ALA:O":-.55,"ARG:N":-.15,"ARG:CA":.1,"ARG:CB":0,"ARG:CG":0,"ARG:CD":.1,"ARG:NE":-.1,"ARG:CZ":.5,"ARG:NH1":.25,"ARG:NH2":.25,"ARG:C":.6,"ARG:O":-.55,"ASN:N":-.15,"ASN:CA":.1,"ASN:CB":0,"ASN:CG":.55,"ASN:OD1":-.55,"ASN:ND2":0,"ASN:C":.6,"ASN:O":-.55,"ASP:N":-.15,"ASP:CA":.1,"ASP:CB":0,"ASP:CG":.14,"ASP:OD1":-.57,"ASP:OD2":-.57,"ASP:C":.6,"ASP:O":-.55,"CYS:N":-.15,"CYS:CA":.1,"CYS:CB":.19,"CYS:SG":-.19,"CYS:C":.6,"CYS:O":-.55,"GLN:N":-.15,"GLN:CA":.1,"GLN:CB":0,"GLN:CG":0,"GLN:CD":.55,"GLN:OE1":-.55,"GLN:NE2":0,"GLN:C":.6,"GLN:O":-.55,"GLU:N":-.15,"GLU:CA":.1,"GLU:CB":0,"GLU:CG":0,"GLU:CD":.14,"GLU:OE1":-.57,"GLU:OE2":-.57,"GLU:C":.6,"GLU:O":-.55,"GLY:N":-.15,"GLY:CA":.1,"GLY:C":.6,"GLY:O":-.55,"HIS:N":-.15,"HIS:CA":.1,"HIS:CB":0,"HIS:CG":.1,"HIS:ND1":-.1,"HIS:CD2":.1,"HIS:NE2":-.4,"HIS:CE1":.3,"HIS:C":.6,"HIS:O":-.55,"ILE:N":-.15,"ILE:CA":.1,"ILE:CB":0,"ILE:CG2":0,"ILE:CG1":0,"ILE:CD":0,"ILE:C":.6,"ILE:O":-.55,"LEU:N":-.15,"LEU:CA":.1,"LEU:CB":0,"LEU:CG":0,"LEU:CD1":0,"LEU:CD2":0,"LEU:C":.6,"LEU:O":-.55,"LYS:N":-.15,"LYS:CA":.1,"LYS:CB":0,"LYS:CG":0,"LYS:CD":0,"LYS:CE":.25,"LYS:NZ":.75,"LYS:C":.6,"LYS:O":-.55,"MET:N":-.15,"MET:CA":.1,"MET:CB":0,"MET:CG":.06,"MET:SD":-.12,"MET:CE":.06,"MET:C":.6,"MET:O":-.55,"PHE:N":-.15,"PHE:CA":.1,"PHE:CB":0,"PHE:CG":0,"PHE:CD1":0,"PHE:CD2":0,"PHE:CE1":0,"PHE:CE2":0,"PHE:CZ":0,"PHE:C":.6,"PHE:O":-.55,"PRO:N":-.25,"PRO:CD":.1,"PRO:CA":.1,"PRO:CB":0,"PRO:CG":0,"PRO:C":.6,"PRO:O":-.55,"SER:N":-.15,"SER:CA":.1,"SER:CB":.25,"SER:OG":-.25,"SER:C":.6,"SER:O":-.55,"THR:N":-.15,"THR:CA":.1,"THR:CB":.25,"THR:OG1":-.25,"THR:CG2":0,"THR:C":.6,"THR:O":-.55,"TRP:N":-.15,"TRP:CA":.1,"TRP:CB":0,"TRP:CG":-.03,"TRP:CD2":.1,"TRP:CE2":-.04,"TRP:CE3":-.03,"TRP:CD1":.06,"TRP:NE1":-.06,"TRP:CZ2":0,"TRP:CZ3":0,"TRP:CH2":0,"TRP:C":.6,"TRP:O":-.55,"TYR:N":-.15,"TYR:CA":.1,"TYR:CB":0,"TYR:CG":0,"TYR:CD1":0,"TYR:CE1":0,"TYR:CD2":0,"TYR:CE2":0,"TYR:CZ":.25,"TYR:OH":-.25,"TYR:C":.6,"TYR:O":-.55,"VAL:N":-.15,"VAL:CA":.1,"VAL:CB":0,"VAL:CG1":0,"VAL:CG2":0,"VAL:C":.6,"VAL:O":-.55};function S(w,O){if((!O||typeof w.partialCharge>"u")&&w.resn&&w.atom){var p=w.resn+":"+w.atom;w.properties.partialCharge=E[p]}}},"./src/specs.ts"(K,C,f){f.r(C)},"./src/utilities.ts"(__unused_webpack_module,__webpack_exports__,__webpack_require__){__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{PausableTimer:()=>PausableTimer,adjustVolumeStyle:()=>adjustVolumeStyle,base64ToArray:()=>base64ToArray,deepCopy:()=>deepCopy,download:()=>download,extend:()=>extend,get:()=>get,getAtomProperty:()=>getAtomProperty,getColorFromStyle:()=>getColorFromStyle,getElement:()=>getElement,getExtent:()=>getExtent,getPropertyRange:()=>getPropertyRange,getbin:()=>getbin,inflateString:()=>inflateString,isEmptyObject:()=>isEmptyObject,isNumeric:()=>isNumeric,makeFunction:()=>makeFunction,mergeGeos:()=>mergeGeos,specStringToObject:()=>specStringToObject});var _Gradient__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./src/Gradient.ts"),_VolumeData__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./src/VolumeData.ts"),_colors__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("./src/colors.ts"),pako__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__("./node_modules/pako/dist/pako.esm.mjs");function extend(K,C){for(var f in C)C.hasOwnProperty(f)&&C[f]!==void 0&&(K[f]=C[f]);return K}function deepCopy(K){let C,f,E;if(K==null)return{};if(typeof K!="object"||K===null)return K;C=Array.isArray(K)?[]:{};for(E in K)f=K[E],C[E]=deepCopy(f);return C}function isNumeric(K){var C=typeof K;return(C==="number"||C==="string")&&!isNaN(K-parseFloat(K))}function isEmptyObject(K){return Object.keys(K).length===0}function makeFunction(callback){return callback&&typeof callback=="string"&&(callback=eval("("+callback+")")),callback&&typeof callback!="function"?(console.warn("Invalid callback provided."),()=>{}):callback}function adjustVolumeStyle(K){K&&(K.volformat&&!(K.voldata instanceof _VolumeData__WEBPACK_IMPORTED_MODULE_1__.VolumeData)&&(K.voldata=new _VolumeData__WEBPACK_IMPORTED_MODULE_1__.VolumeData(K.voldata,K.volformat)),K.volscheme&&(K.volscheme=_Gradient__WEBPACK_IMPORTED_MODULE_0__.Gradient.getGradient(K.volscheme)))}function getExtent(K,C){var f,E,S,w,O,p,x,M,m,b,_=!C;if(f=E=S=9999,w=O=p=-9999,x=M=m=b=0,K.length===0)return[[0,0,0],[0,0,0],[0,0,0]];for(var g=0;g<K.length;g++){var v=K[g];if(!(typeof v>"u"||!isFinite(v.x)||!isFinite(v.y)||!isFinite(v.z))&&(b++,x+=v.x,M+=v.y,m+=v.z,f=f<v.x?f:v.x,E=E<v.y?E:v.y,S=S<v.z?S:v.z,w=w>v.x?w:v.x,O=O>v.y?O:v.y,p=p>v.z?p:v.z,v.symmetries&&_))for(var r=0;r<v.symmetries.length;r++)b++,x+=v.symmetries[r].x,M+=v.symmetries[r].y,m+=v.symmetries[r].z,f=f<v.symmetries[r].x?f:v.symmetries[r].x,E=E<v.symmetries[r].y?E:v.symmetries[r].y,S=S<v.symmetries[r].z?S:v.symmetries[r].z,w=w>v.symmetries[r].x?w:v.symmetries[r].x,O=O>v.symmetries[r].y?O:v.symmetries[r].y,p=p>v.symmetries[r].z?p:v.symmetries[r].z}return[[f,E,S],[w,O,p],[x/b,M/b,m/b]]}function getPropertyRange(K,C){for(var f=Number.POSITIVE_INFINITY,E=Number.NEGATIVE_INFINITY,S=0,w=K.length;S<w;S++){var O=K[S],p=getAtomProperty(O,C);p!=null&&(p<f&&(f=p),p>E&&(E=p))}return!isFinite(f)&&!isFinite(E)?f=E=0:isFinite(f)?isFinite(E)||(E=f):f=E,[f,E]}class PausableTimer{constructor(C,f,E){this.total_time_run=0,this.fn=C,this.arg=E,this.countdown=f,this.start_time=new Date().getTime(),this.ident=setTimeout(C,f,E)}cancel(){clearTimeout(this.ident)}pause(){clearTimeout(this.ident),this.total_time_run=new Date().getTime()-this.start_time}resume(){this.ident=setTimeout(this.fn,Math.max(0,this.countdown-this.total_time_run),this.arg)}}function base64ToArray(K){for(var C=window.atob(K),f=C.length,E=new Uint8Array(f),S=0;S<f;S++)E[S]=C.charCodeAt(S);return E}function getAtomProperty(K,C){var f=null;return K.properties&&typeof K.properties[C]<"u"?f=K.properties[C]:typeof K[C]<"u"&&(f=K[C]),f}function mergeGeos(K,C){var f=C.geometry;f!==void 0&&K.geometryGroups.push(f.geometryGroups[0])}function specStringToObject(K){if(typeof K=="object")return K;if(typeof K>"u"||K==null)return K;try{return JSON.parse(K)}catch{}K=K.replace(/%7E/g,"~");var C=function(_){return isNumeric(_)?Math.floor(parseFloat(_))==parseInt(_)||_.indexOf(".")>=0?parseFloat(_):parseInt(_):_==="true"?!0:_==="false"?!1:_},f={};if(K==="all")return f;for(var E=K.split(";"),S=0;S<E.length;S++){var w=E[S].split(":"),O=w[0],p={},x=w[1];if(x)if(x=x.replace(/~/g,"="),x.indexOf("=")!==-1)for(var M=x.split(","),m=0;m<M.length;m++){var b=M[m].split("=",2);p[b[0]]=C(b[1])}else x.indexOf(",")!==-1?p=x.split(","):p=C(x);f[O]=p}return f}function checkStatus(K){if(!K.ok)throw new Error(`HTTP ${K.status} - ${K.statusText}`);return K}function get(K,C){var f=fetch(K).then(checkStatus).then(E=>E.text());return C?f.then(C):f}function getbin(K,C,f,E){var S;return f=="POST"?S=fetch(K,{method:"POST",body:E}).then(w=>checkStatus(w)).then(w=>w.arrayBuffer()):S=fetch(K).then(w=>checkStatus(w)).then(w=>w.arrayBuffer()),C?S.then(C):S}function download(K,C,f,E){var S="",w="",O="",p=null,x=C.addModel();if(K.indexOf(":")<0&&(K.length==4?K="pdb:"+K:isNaN(K)?K="url:"+K:K="cid:"+K),K.substring(0,5)=="mmtf:"&&(console.warn("WARNING: MMTF now deprecated.  Reverting to bcif."),K="bcif:"+K.slice(5)),K.substring(0,5)==="bcif:")K=K.substring(5).toUpperCase(),O="https://models.rcsb.org/"+K+".bcif.gz",f&&typeof f.noComputeSecondaryStructure>"u"&&(f.noComputeSecondaryStructure=!0),p=new Promise(function(m){getbin(O).then(function(b){x.addMolData(b,"bcif.gz",f),C.zoomTo(),C.render(),m(x)},function(){console.error("fetch of "+O+" failed.")})});else{if(K.substring(0,4)==="pdb:"){if(S="bcif",f&&f.format&&(S=f.format),f&&typeof f.noComputeSecondaryStructure>"u"&&(f.noComputeSecondaryStructure=!0),K=K.substring(4).toUpperCase(),!K.match(/^[1-9][A-Za-z0-9]{3}$/)){alert("Wrong PDB ID");return}S=="bcif"?O="https://models.rcsb.org/"+K.toUpperCase()+".bcif.gz":(w=f&&f.pdbUri?f.pdbUri:"https://files.rcsb.org/view/",O=w+K+"."+S)}else if(K.substring(0,4)=="cid:"){if(S="sdf",K=K.substring(4),!K.match(/^[0-9]+$/)){alert("Wrong Compound ID");return}O="https://pubchem.ncbi.nlm.nih.gov/rest/pug/compound/cid/"+K+"/SDF?record_type=3d"}else K.substring(0,4)=="url:"&&(O=K.substring(4),S=O);var M=function(m){x.addMolData(m,S,f),C.zoomTo(),C.render()};p=new Promise(function(m){S=="bcif"?getbin(O).then(function(b){M(b),m(x)}).catch(function(){w=f&&f.pdbUri?f.pdbUri:"https://files.rcsb.org/view/",O=w+K+".pdb",S="pdb",console.warn("falling back to pdb format"),get(O).then(function(b){M(b),m(x)}).catch(function(b){M(""),m(x),console.error("fetch of "+O+" failed: "+b.statusText)})}):get(O).then(function(b){M(b),m(x)}).catch(function(b){M(""),m(x),console.error("fetch of "+O+" failed: "+b.statusText)})})}return E?(p.then(function(m){E(m)}),x):p}function getColorFromStyle(K,C){let f=C.colorscheme;if(typeof _colors__WEBPACK_IMPORTED_MODULE_2__.builtinColorSchemes[f]<"u")f=_colors__WEBPACK_IMPORTED_MODULE_2__.builtinColorSchemes[f];else if(typeof f=="string"&&f.endsWith("Carbon")){let O=f.substring(0,f.lastIndexOf("Carbon")).toLowerCase();if(typeof _colors__WEBPACK_IMPORTED_MODULE_2__.htmlColors[O]<"u"){let p=Object.assign({},_colors__WEBPACK_IMPORTED_MODULE_2__.elementColors.defaultColors);p.C=_colors__WEBPACK_IMPORTED_MODULE_2__.htmlColors[O],_colors__WEBPACK_IMPORTED_MODULE_2__.builtinColorSchemes[f]={prop:"elem",map:p},f=_colors__WEBPACK_IMPORTED_MODULE_2__.builtinColorSchemes[f]}}let E=K.color;if(typeof C.color<"u"&&C.color!="spectrum"&&(E=C.color),typeof f<"u"){let O,p;if(typeof _colors__WEBPACK_IMPORTED_MODULE_2__.elementColors[f]<"u")f=_colors__WEBPACK_IMPORTED_MODULE_2__.elementColors[f],typeof f[K[f.prop]]<"u"&&(E=f.map[K[f.prop]]);else if(typeof f[K[f.prop]]<"u")E=f.map[K[f.prop]];else if(typeof f.prop<"u"&&typeof f.gradient<"u"){O=f.prop;var S=f.gradient;S instanceof _Gradient__WEBPACK_IMPORTED_MODULE_0__.GradientType||(S=(0,_Gradient__WEBPACK_IMPORTED_MODULE_0__.getGradient)(f));let x=S.range()||[-1,1];p=getAtomProperty(K,O),p!=null&&(E=S.valueToHex(p,x))}else typeof f.prop<"u"&&typeof f.map<"u"?(O=f.prop,p=getAtomProperty(K,O),typeof f.map[p]<"u"&&(E=f.map[p])):typeof C.colorscheme[K.elem]<"u"?E=C.colorscheme[K.elem]:console.warn("Could not interpret colorscheme "+f)}else typeof C.colorfunc<"u"&&(E=C.colorfunc(K));return _colors__WEBPACK_IMPORTED_MODULE_2__.CC.color(E)}function getElement(K){let C=K;return typeof K=="string"?C=document.querySelector("#"+K):typeof K=="object"&&K.get&&(C=K.get(0)),C}function inflateString(K,C=!0){let f;return typeof K=="string"?f=new TextEncoder().encode(K):f=new Uint8Array(K),(0,pako__WEBPACK_IMPORTED_MODULE_3__.inflate)(f,{to:C?"string":null})}},"./src/vendor/mmtf.js"(K,C){(function(f,E){E(C)})(this,function(f){function E(j,Y,X){for(var _e=(j.byteLength,0),ue=X.length;ue>_e;_e++){var we=X.charCodeAt(_e);if(128>we)j.setUint8(Y++,we>>>0&127|0);else if(2048>we)j.setUint8(Y++,we>>>6&31|192),j.setUint8(Y++,we>>>0&63|128);else if(65536>we)j.setUint8(Y++,we>>>12&15|224),j.setUint8(Y++,we>>>6&63|128),j.setUint8(Y++,we>>>0&63|128);else{if(!(1114112>we))throw new Error("bad codepoint "+we);j.setUint8(Y++,we>>>18&7|240),j.setUint8(Y++,we>>>12&63|128),j.setUint8(Y++,we>>>6&63|128),j.setUint8(Y++,we>>>0&63|128)}}}function S(j){for(var Y=0,X=0,_e=j.length;_e>X;X++){var ue=j.charCodeAt(X);if(128>ue)Y+=1;else if(2048>ue)Y+=2;else if(65536>ue)Y+=3;else{if(!(1114112>ue))throw new Error("bad codepoint "+ue);Y+=4}}return Y}function w(j,Y,X){var _e=typeof j;if(_e==="string"){var ue=S(j);if(32>ue)return Y.setUint8(X,160|ue),E(Y,X+1,j),1+ue;if(256>ue)return Y.setUint8(X,217),Y.setUint8(X+1,ue),E(Y,X+2,j),2+ue;if(65536>ue)return Y.setUint8(X,218),Y.setUint16(X+1,ue),E(Y,X+3,j),3+ue;if(4294967296>ue)return Y.setUint8(X,219),Y.setUint32(X+1,ue),E(Y,X+5,j),5+ue}if(j instanceof Uint8Array){var ue=j.byteLength,we=new Uint8Array(Y.buffer);if(256>ue)return Y.setUint8(X,196),Y.setUint8(X+1,ue),we.set(j,X+2),2+ue;if(65536>ue)return Y.setUint8(X,197),Y.setUint16(X+1,ue),we.set(j,X+3),3+ue;if(4294967296>ue)return Y.setUint8(X,198),Y.setUint32(X+1,ue),we.set(j,X+5),5+ue}if(_e==="number"){if(!isFinite(j))throw new Error("Number not finite: "+j);if(Math.floor(j)!==j)return Y.setUint8(X,203),Y.setFloat64(X+1,j),9;if(j>=0){if(128>j)return Y.setUint8(X,j),1;if(256>j)return Y.setUint8(X,204),Y.setUint8(X+1,j),2;if(65536>j)return Y.setUint8(X,205),Y.setUint16(X+1,j),3;if(4294967296>j)return Y.setUint8(X,206),Y.setUint32(X+1,j),5;throw new Error("Number too big 0x"+j.toString(16))}if(j>=-32)return Y.setInt8(X,j),1;if(j>=-128)return Y.setUint8(X,208),Y.setInt8(X+1,j),2;if(j>=-32768)return Y.setUint8(X,209),Y.setInt16(X+1,j),3;if(j>=-2147483648)return Y.setUint8(X,210),Y.setInt32(X+1,j),5;throw new Error("Number too small -0x"+(-j).toString(16).substr(1))}if(j===null)return Y.setUint8(X,192),1;if(_e==="boolean")return Y.setUint8(X,j?195:194),1;if(_e==="object"){var ue,se=0,De=Array.isArray(j);if(De)ue=j.length;else{var G=Object.keys(j);ue=G.length}var se;if(16>ue?(Y.setUint8(X,ue|(De?144:128)),se=1):65536>ue?(Y.setUint8(X,De?220:222),Y.setUint16(X+1,ue),se=3):4294967296>ue&&(Y.setUint8(X,De?221:223),Y.setUint32(X+1,ue),se=5),De)for(var ve=0;ue>ve;ve++)se+=w(j[ve],Y,X+se);else for(var ve=0;ue>ve;ve++){var Te=G[ve];se+=w(Te,Y,X+se),se+=w(j[Te],Y,X+se)}return se}throw new Error("Unknown type "+_e)}function O(j){var Y=typeof j;if(Y==="string"){var X=S(j);if(32>X)return 1+X;if(256>X)return 2+X;if(65536>X)return 3+X;if(4294967296>X)return 5+X}if(j instanceof Uint8Array){var X=j.byteLength;if(256>X)return 2+X;if(65536>X)return 3+X;if(4294967296>X)return 5+X}if(Y==="number"){if(Math.floor(j)!==j)return 9;if(j>=0){if(128>j)return 1;if(256>j)return 2;if(65536>j)return 3;if(4294967296>j)return 5;throw new Error("Number too big 0x"+j.toString(16))}if(j>=-32)return 1;if(j>=-128)return 2;if(j>=-32768)return 3;if(j>=-2147483648)return 5;throw new Error("Number too small -0x"+j.toString(16).substr(1))}if(Y==="boolean"||j===null)return 1;if(Y==="object"){var X,_e=0;if(Array.isArray(j)){X=j.length;for(var ue=0;X>ue;ue++)_e+=O(j[ue])}else{var we=Object.keys(j);X=we.length;for(var ue=0;X>ue;ue++){var De=we[ue];_e+=O(De)+O(j[De])}}if(16>X)return 1+_e;if(65536>X)return 3+_e;if(4294967296>X)return 5+_e;throw new Error("Array or object too long 0x"+X.toString(16))}throw new Error("Unknown type "+Y)}function p(j){var Y=new ArrayBuffer(O(j)),X=new DataView(Y);return w(j,X,0),new Uint8Array(Y)}function x(j,Y,X){return Y?new j(Y.buffer,Y.byteOffset,Y.byteLength/(X||1)):void 0}function M(j){return x(DataView,j)}function m(j){return x(Uint8Array,j)}function b(j){return x(Int8Array,j)}function _(j){return x(Int32Array,j,4)}function g(j){return x(Float32Array,j,4)}function v(j,Y){var X=j.length/2;Y||(Y=new Int16Array(X));for(var _e=0,ue=0;X>_e;++_e,ue+=2)Y[_e]=j[ue]<<8^j[ue+1]<<0;return Y}function r(j,Y){var X=j.length;Y||(Y=new Uint8Array(2*X));for(var _e=M(Y),ue=0;X>ue;++ue)_e.setInt16(2*ue,j[ue]);return m(Y)}function e(j,Y){var X=j.length/4;Y||(Y=new Int32Array(X));for(var _e=0,ue=0;X>_e;++_e,ue+=4)Y[_e]=j[ue]<<24^j[ue+1]<<16^j[ue+2]<<8^j[ue+3]<<0;return Y}function t(j,Y){var X=j.length;Y||(Y=new Uint8Array(4*X));for(var _e=M(Y),ue=0;X>ue;++ue)_e.setInt32(4*ue,j[ue]);return m(Y)}function n(j,Y){var X=j.length;Y||(Y=new Float32Array(X/4));for(var _e=M(Y),ue=M(j),we=0,De=0,G=X/4;G>we;++we,De+=4)_e.setFloat32(De,ue.getFloat32(De),!0);return Y}function o(j,Y,X){var _e=j.length,ue=1/Y;X||(X=new Float32Array(_e));for(var we=0;_e>we;++we)X[we]=j[we]*ue;return X}function h(j,Y,X){var _e=j.length;X||(X=new Int32Array(_e));for(var ue=0;_e>ue;++ue)X[ue]=Math.round(j[ue]*Y);return X}function d(j,Y){var X,_e;if(!Y){var ue=0;for(X=0,_e=j.length;_e>X;X+=2)ue+=j[X+1];Y=new j.constructor(ue)}var we=0;for(X=0,_e=j.length;_e>X;X+=2)for(var De=j[X],G=j[X+1],se=0;G>se;++se)Y[we]=De,++we;return Y}function i(j){if(j.length===0)return new Int32Array;var Y,X,_e=2;for(Y=1,X=j.length;X>Y;++Y)j[Y-1]!==j[Y]&&(_e+=2);var ue=new Int32Array(_e),we=0,De=1;for(Y=1,X=j.length;X>Y;++Y)j[Y-1]!==j[Y]?(ue[we]=j[Y-1],ue[we+1]=De,De=1,we+=2):++De;return ue[we]=j[j.length-1],ue[we+1]=De,ue}function s(j,Y){var X=j.length;Y||(Y=new j.constructor(X)),X&&(Y[0]=j[0]);for(var _e=1;X>_e;++_e)Y[_e]=j[_e]+Y[_e-1];return Y}function a(j,Y){var X=j.length;Y||(Y=new j.constructor(X)),Y[0]=j[0];for(var _e=1;X>_e;++_e)Y[_e]=j[_e]-j[_e-1];return Y}function c(j,Y){var X,_e,ue=j instanceof Int8Array?127:32767,we=-ue-1,De=j.length;if(!Y){var G=0;for(X=0;De>X;++X)j[X]<ue&&j[X]>we&&++G;Y=new Int32Array(G)}for(X=0,_e=0;De>X;){for(var se=0;j[X]===ue||j[X]===we;)se+=j[X],++X;se+=j[X],++X,Y[_e]=se,++_e}return Y}function u(j,Y){var X,_e=32767,ue=-_e-1,we=j.length,De=0;for(X=0;we>X;++X){var G=j[X];G===0?++De:G>0?(De+=Math.ceil(G/_e),G%_e===0&&(De+=1)):(De+=Math.ceil(G/ue),G%ue===0&&(De+=1))}var se=new Int16Array(De),ve=0;for(X=0;we>X;++X){var G=j[X];if(G>=0)for(;G>=_e;)se[ve]=_e,++ve,G-=_e;else for(;ue>=G;)se[ve]=ue,++ve,G-=ue;se[ve]=G,++ve}return se}function A(j,Y){return s(d(j),Y)}function L(j){return i(a(j))}function D(j,Y,X){return o(d(j,_(X)),Y,X)}function R(j,Y){return i(h(j,Y))}function P(j,Y,X){return o(s(j,_(X)),Y,X)}function z(j,Y,X){return a(h(j,Y),X)}function F(j,Y,X){return o(c(j,_(X)),Y,X)}function B(j,Y,X){var _e=c(j,_(X));return P(_e,Y,g(_e))}function U(j,Y,X){return u(z(j,Y))}function W(we){var Y=M(we),X=Y.getInt32(0),_e=Y.getInt32(4),ue=we.subarray(8,12),we=we.subarray(12);return[X,we,_e,ue]}function I(j,Y,X,_e){var ue=new ArrayBuffer(12+_e.byteLength),we=new Uint8Array(ue),De=new DataView(ue);return De.setInt32(0,j),De.setInt32(4,Y),X&&we.set(X,8),we.set(_e,12),we}function V(j){var Y=j.length,X=m(j);return I(2,Y,void 0,X)}function ee(j){var Y=j.length,X=t(j);return I(4,Y,void 0,X)}function te(j,Y){var X=j.length/Y,_e=t([Y]),ue=m(j);return I(5,X,_e,ue)}function ae(j){var Y=j.length,X=t(i(j));return I(6,Y,void 0,X)}function re(j){var Y=j.length,X=t(L(j));return I(8,Y,void 0,X)}function fe(j,Y){var X=j.length,_e=t([Y]),ue=t(R(j,Y));return I(9,X,_e,ue)}function q(j,Y){var X=j.length,_e=t([Y]),ue=r(U(j,Y));return I(10,X,_e,ue)}function oe(j){var Y={};return Ue.forEach(function(X){j[X]!==void 0&&(Y[X]=j[X])}),j.bondAtomList&&(Y.bondAtomList=ee(j.bondAtomList)),j.bondOrderList&&(Y.bondOrderList=V(j.bondOrderList)),Y.xCoordList=q(j.xCoordList,1e3),Y.yCoordList=q(j.yCoordList,1e3),Y.zCoordList=q(j.zCoordList,1e3),j.bFactorList&&(Y.bFactorList=q(j.bFactorList,100)),j.atomIdList&&(Y.atomIdList=re(j.atomIdList)),j.altLocList&&(Y.altLocList=ae(j.altLocList)),j.occupancyList&&(Y.occupancyList=fe(j.occupancyList,100)),Y.groupIdList=re(j.groupIdList),Y.groupTypeList=ee(j.groupTypeList),j.secStructList&&(Y.secStructList=V(j.secStructList)),j.insCodeList&&(Y.insCodeList=ae(j.insCodeList)),j.sequenceIndexList&&(Y.sequenceIndexList=re(j.sequenceIndexList)),Y.chainIdList=te(j.chainIdList,4),j.chainNameList&&(Y.chainNameList=te(j.chainNameList,4)),Y}function be(j){function Y(se){for(var ve={},Te=0;se>Te;Te++){var ie=we();ve[ie]=we()}return ve}function X(se){var ve=j.subarray(De,De+se);return De+=se,ve}function _e(se){var ve=j.subarray(De,De+se);De+=se;var Te=65535;if(se>Te){for(var ie=[],ye=0;ye<ve.length;ye+=Te)ie.push(String.fromCharCode.apply(null,ve.subarray(ye,ye+Te)));return ie.join("")}return String.fromCharCode.apply(null,ve)}function ue(se){for(var ve=new Array(se),Te=0;se>Te;Te++)ve[Te]=we();return ve}function we(){var se,ve,Te=j[De];if(!(128&Te))return De++,Te;if((240&Te)===128)return ve=15&Te,De++,Y(ve);if((240&Te)===144)return ve=15&Te,De++,ue(ve);if((224&Te)===160)return ve=31&Te,De++,_e(ve);if((224&Te)===224)return se=G.getInt8(De),De++,se;switch(Te){case 192:return De++,null;case 194:return De++,!1;case 195:return De++,!0;case 196:return ve=G.getUint8(De+1),De+=2,X(ve);case 197:return ve=G.getUint16(De+1),De+=3,X(ve);case 198:return ve=G.getUint32(De+1),De+=5,X(ve);case 202:return se=G.getFloat32(De+1),De+=5,se;case 203:return se=G.getFloat64(De+1),De+=9,se;case 204:return se=j[De+1],De+=2,se;case 205:return se=G.getUint16(De+1),De+=3,se;case 206:return se=G.getUint32(De+1),De+=5,se;case 208:return se=G.getInt8(De+1),De+=2,se;case 209:return se=G.getInt16(De+1),De+=3,se;case 210:return se=G.getInt32(De+1),De+=5,se;case 217:return ve=G.getUint8(De+1),De+=2,_e(ve);case 218:return ve=G.getUint16(De+1),De+=3,_e(ve);case 219:return ve=G.getUint32(De+1),De+=5,_e(ve);case 220:return ve=G.getUint16(De+1),De+=3,ue(ve);case 221:return ve=G.getUint32(De+1),De+=5,ue(ve);case 222:return ve=G.getUint16(De+1),De+=3,Y(ve);case 223:return ve=G.getUint32(De+1),De+=5,Y(ve)}throw new Error("Unknown type 0x"+Te.toString(16))}var De=0,G=new DataView(j.buffer);return we()}function ge(j,Y,X,_e){switch(j){case 1:return n(Y);case 2:return b(Y);case 3:return v(Y);case 4:return e(Y);case 5:return m(Y);case 6:return d(e(Y),new Uint8Array(X));case 7:return d(e(Y));case 8:return A(e(Y));case 9:return D(e(Y),e(_e)[0]);case 10:return B(v(Y),e(_e)[0]);case 11:return o(v(Y),e(_e)[0]);case 12:return F(v(Y),e(_e)[0]);case 13:return F(b(Y),e(_e)[0]);case 14:return c(v(Y));case 15:return c(b(Y))}}function Le(j,Y){Y=Y||{};var X=Y.ignoreFields,_e={};return Ie.forEach(function(ue){var we=X?X.indexOf(ue)!==-1:!1,De=j[ue];we||De===void 0||(De instanceof Uint8Array?_e[ue]=ge.apply(null,W(De)):_e[ue]=De)}),_e}function pe(j){return String.fromCharCode.apply(null,j).replace(/\0/g,"")}function J(j,Y,X){X=X||{};var _e,ue,we,De,G,se,ve=X.firstModelOnly,Te=Y.onModel,ie=Y.onChain,ye=Y.onGroup,k=Y.onAtom,Ce=Y.onBond,Pe=0,T=0,de=0,he=0,H=0,ne=-1,xe=j.chainNameList,je=j.secStructList,ke=j.insCodeList,Ne=j.sequenceIndexList,Qe=j.atomIdList,_t=j.bFactorList,et=j.altLocList,Ze=j.occupancyList,Xe=j.bondAtomList,at=j.bondOrderList;for(_e=0,ue=j.chainsPerModel.length;ue>_e&&!(ve&&Pe>0);++_e){var nt=j.chainsPerModel[Pe];for(Te&&Te({chainCount:nt,modelIndex:Pe}),we=0;nt>we;++we){var Mt=j.groupsPerChain[T];if(ie){var mt=pe(j.chainIdList.subarray(4*T,4*T+4)),it=null;xe&&(it=pe(xe.subarray(4*T,4*T+4))),ie({groupCount:Mt,chainIndex:T,modelIndex:Pe,chainId:mt,chainName:it})}for(De=0;Mt>De;++De){var tt=j.groupList[j.groupTypeList[de]],qe=tt.atomNameList.length;if(ye){var vt=null;je&&(vt=je[de]);var xt=null;j.insCodeList&&(xt=String.fromCharCode(ke[de]));var At=null;Ne&&(At=Ne[de]),ye({atomCount:qe,groupIndex:de,chainIndex:T,modelIndex:Pe,groupId:j.groupIdList[de],groupType:j.groupTypeList[de],groupName:tt.groupName,singleLetterCode:tt.singleLetterCode,chemCompType:tt.chemCompType,secStruct:vt,insCode:xt,sequenceIndex:At})}for(G=0;qe>G;++G){if(k){var Ct=null;Qe&&(Ct=Qe[he]);var Dt=null;_t&&(Dt=_t[he]);var Pt=null;et&&(Pt=String.fromCharCode(et[he]));var Yt=null;Ze&&(Yt=Ze[he]),k({atomIndex:he,groupIndex:de,chainIndex:T,modelIndex:Pe,atomId:Ct,element:tt.elementList[G],atomName:tt.atomNameList[G],formalCharge:tt.formalChargeList[G],xCoord:j.xCoordList[he],yCoord:j.yCoordList[he],zCoord:j.zCoordList[he],bFactor:Dt,altLoc:Pt,occupancy:Yt})}he+=1}if(Ce){var di=tt.bondAtomList;for(G=0,se=tt.bondOrderList.length;se>G;++G)Ce({atomIndex1:he-qe+di[2*G],atomIndex2:he-qe+di[2*G+1],bondOrder:tt.bondOrderList[G]})}de+=1}T+=1}if(H=ne+1,ne=he-1,Ce&&Xe)for(G=0,se=Xe.length;se>G;G+=2){var ci=Xe[G],ui=Xe[G+1];(ci>=H&&ne>=ci||ui>=H&&ne>=ui)&&Ce({atomIndex1:ci,atomIndex2:ui,bondOrder:at?at[G/2]:null})}Pe+=1}}function ce(j){return p(oe(j))}function Me(j,Y){j instanceof ArrayBuffer&&(j=new Uint8Array(j));var X;return X=j instanceof Uint8Array?be(j):j,Le(X,Y)}function Fe(j,Y,X,_e){function ue(){try{var De=Me(we.response);X(De)}catch(G){_e(G)}}var we=new XMLHttpRequest;we.addEventListener("load",ue,!0),we.addEventListener("error",_e,!0),we.responseType="arraybuffer",we.open("GET",Y+j.toUpperCase()),we.send()}function ze(j,Y,X){Fe(j,Ge,Y,X)}function Be(j,Y,X){Fe(j,Ve,Y,X)}var Ue=["mmtfVersion","mmtfProducer","unitCell","spaceGroup","structureId","title","depositionDate","releaseDate","experimentalMethods","resolution","rFree","rWork","bioAssemblyList","ncsOperatorList","entityList","groupList","numBonds","numAtoms","numGroups","numChains","numModels","groupsPerChain","chainsPerModel"],Se=["xCoordList","yCoordList","zCoordList","groupIdList","groupTypeList","chainIdList","bFactorList","atomIdList","altLocList","occupancyList","secStructList","insCodeList","sequenceIndexList","chainNameList","bondAtomList","bondOrderList"],Ie=Ue.concat(Se),Re="v1.0.1",Oe="//mmtf.rcsb.org/v1.0/",Ge=Oe+"full/",Ve=Oe+"reduced/";f.encode=ce,f.decode=Me,f.traverse=J,f.fetch=ze,f.fetchReduced=Be,f.version=Re,f.fetchUrl=Ge,f.fetchReducedUrl=Ve,f.encodeMsgpack=p,f.encodeMmtf=oe,f.decodeMsgpack=be,f.decodeMmtf=Le})}},__webpack_module_cache__={};function __webpack_require__(K){var C=__webpack_module_cache__[K];if(C!==void 0)return C.exports;if(__webpack_modules__[K]===void 0){var f=new Error("Cannot find module '"+K+"'");throw f.code="MODULE_NOT_FOUND",f}var E=__webpack_module_cache__[K]={exports:{}};return __webpack_modules__[K].call(E.exports,E,E.exports,__webpack_require__),E.exports}__webpack_require__.n=K=>{var C=K&&K.__esModule?()=>K.default:()=>K;return __webpack_require__.d(C,{a:C}),C},__webpack_require__.d=(K,C)=>{for(var f in C)__webpack_require__.o(C,f)&&!__webpack_require__.o(K,f)&&Object.defineProperty(K,f,{enumerable:!0,get:C[f]})},__webpack_require__.o=(K,C)=>Object.prototype.hasOwnProperty.call(K,C),__webpack_require__.r=K=>{typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(K,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(K,"__esModule",{value:!0})},__webpack_require__("./src/index.ts"),__webpack_require__("./src/SurfaceWorker.js");var __webpack_exports__=__webpack_require__("./src/exporter.js");return __webpack_exports__})())})(_3Dmol);var _3DmolExports=_3Dmol.exports;const ControlButton=({icon:K,label:C,active:f,onClick:E})=>jsxDevRuntimeExports.jsxDEV("button",{onClick:E,title:C,className:`p-1.5 rounded-lg transition-all duration-200 ${f?"bg-cyan-500/30 text-cyan-300 shadow-[0_0_8px_rgba(34,211,238,0.3)]":"text-slate-400 hover:text-white hover:bg-white/10"}`,children:jsxDevRuntimeExports.jsxDEV(K,{className:"w-4 h-4"},void 0,!1,{fileName:"/Users/mohammedaashik/Documents/PROJECT/AYACOM/Drug_Forge_HackTheVibe/src/components/Molecule3DViewer.jsx",lineNumber:42,columnNumber:5},void 0)},void 0,!1,{fileName:"/Users/mohammedaashik/Documents/PROJECT/AYACOM/Drug_Forge_HackTheVibe/src/components/Molecule3DViewer.jsx",lineNumber:33,columnNumber:3},void 0),ScienceButton=({icon:K,label:C,active:f,onClick:E,activeColor:S})=>jsxDevRuntimeExports.jsxDEV("button",{onClick:E,title:C,className:`p-2.5 rounded-xl backdrop-blur-md border transition-all duration-200 group relative ${f?"bg-white/10 border-cyan-500/50 shadow-[0_0_15px_rgba(6,182,212,0.3)]":"bg-black/20 border-white/10 hover:bg-white/10"}`,children:[jsxDevRuntimeExports.jsxDEV(K,{className:`w-4 h-4 ${f?S:"text-slate-300"}`},void 0,!1,{fileName:"/Users/mohammedaashik/Documents/PROJECT/AYACOM/Drug_Forge_HackTheVibe/src/components/Molecule3DViewer.jsx",lineNumber:57,columnNumber:5},void 0),jsxDevRuntimeExports.jsxDEV("span",{className:"absolute px-2 py-1 mr-3 text-xs text-white transition-opacity -translate-y-1/2 rounded opacity-0 pointer-events-none right-full top-1/2 bg-black/80 group-hover:opacity-100 whitespace-nowrap",children:C},void 0,!1,{fileName:"/Users/mohammedaashik/Documents/PROJECT/AYACOM/Drug_Forge_HackTheVibe/src/components/Molecule3DViewer.jsx",lineNumber:58,columnNumber:5},void 0)]},void 0,!0,{fileName:"/Users/mohammedaashik/Documents/PROJECT/AYACOM/Drug_Forge_HackTheVibe/src/components/Molecule3DViewer.jsx",lineNumber:48,columnNumber:3},void 0),Molecule3DViewer=({smiles:K,width:C=400,height:f=300,showControls:E=!0,spin:S=!0})=>{var re,fe;const w=reactExports.useRef(null),O=reactExports.useRef(null),p=reactExports.useRef(null),[x,M]=reactExports.useState(!1),[m,b]=reactExports.useState(null),[_,g]=reactExports.useState("stick"),[v,r]=reactExports.useState(!1),[e,t]=reactExports.useState(null),[n,o]=reactExports.useState(S),[h,d]=reactExports.useState(null),[i,s]=reactExports.useState(!1),[a,c]=reactExports.useState(!1),[u,A]=reactExports.useState(!1),L=reactExports.useRef(null),[D,R]=reactExports.useState(null),P=reactExports.useCallback(q=>{switch(q){case"sphere":return{sphere:{scale:.4,colorscheme:"Jmol"}};case"line":return{line:{colorscheme:"Jmol"}};case"stick":default:return{stick:{radius:.15,colorscheme:"Jmol"},sphere:{scale:.25,colorscheme:"Jmol"}}}},[]),z=reactExports.useCallback(()=>{const q=O.current;q&&(q.setStyle({},P(_)),q.removeAllSurfaces(),v&&!i&&q.addSurface(_3DmolExports.SurfaceType.VDW,{opacity:.25,color:"white"}),q.render())},[_,v,i,P]);reactExports.useEffect(()=>{z()},[z]),reactExports.useEffect(()=>{const q=w.current;if(!q)return;const oe=new ResizeObserver(()=>{if(O.current)try{O.current.resize(),O.current.render()}catch{}});return oe.observe(q),()=>oe.disconnect()},[]),reactExports.useEffect(()=>{if(!K||!K.trim())return;let q=!0;return(async()=>{M(!0),b(null),s(!1),c(!1),A(!1),R(null),L.current=null;try{const be="http://localhost:5001",ge=K.trim(),Le=await fetch(`${be}/utils/generate-3d`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({smiles:ge})});if(!Le.ok){const ce=await Le.json().catch(()=>({}));throw new Error(ce.error||ce.detail||`Server error ${Le.status}`)}const pe=await Le.json();if(!q)return;if(p.current=pe.mol_block,O.current)try{O.current.resize()}catch{}if(!O.current&&w.current){if(await(async()=>{for(let Fe=0;Fe<5;Fe++){await new Promise(Be=>requestAnimationFrame(Be));let ze=w.current.getBoundingClientRect();if(ze.width>0&&ze.height>0){const Be=w.current;return Be.style.width=ze.width+"px",Be.style.height=ze.height+"px",!0}if(Fe===2){const Be=typeof C=="number"?C:400,Ue=typeof f=="number"?f:300;w.current.style.width=Be+"px",w.current.style.height=Ue+"px"}await new Promise(Be=>setTimeout(Be,100))}})(),!q)return;const Me=w.current.getBoundingClientRect();if(Me.width===0||Me.height===0)throw console.error("[3DViewer] Container still has zero dimensions:",Me),new Error("Container has zero dimensions - cannot create WebGL viewer");O.current=_3DmolExports.createViewer(w.current,{backgroundColor:"#111827"})}const J=O.current;if(!J)throw new Error("Viewer failed to initialize");if(J.clear(),J.removeAllSurfaces(),J.removeAllShapes(),J.removeAllLabels(),J.addModel(pe.mol_block,"sdf"),pe.charges)try{const ce=J.getModel().selectedAtoms({});ce.length===pe.charges.length&&ce.forEach((Me,Fe)=>{Me.properties||(Me.properties={}),Me.properties.charge=pe.charges[Fe]})}catch{}J.setHoverable({},!0,ce=>{var ze,Be,Ue,Se;if(!q)return;const Me=(ze=ce.properties)==null?void 0:ze.charge;t({elem:ce.elem,serial:ce.serial,x:(Be=ce.x)==null?void 0:Be.toFixed(2),y:(Ue=ce.y)==null?void 0:Ue.toFixed(2),z:(Se=ce.z)==null?void 0:Se.toFixed(2),charge:Me!=null?Me.toFixed(3):null});const Fe=Me!=null?`${ce.elem} (${Me>=0?"+":""}${Me.toFixed(2)})`:ce.elem;J.addLabel(Fe,{position:ce,backgroundColor:"rgba(0,0,0,0.7)",fontColor:"white",fontSize:12,borderRadius:4}),J.render()},ce=>{q&&(t(null),J.removeAllLabels(),J.render())}),J.setStyle({},P(_)),J.resize(),J.zoomTo(),J.render(),S&&(J.spin("y",.5),o(!0)),q&&d(pe)}catch(be){console.error("[3DViewer] Error:",be),q&&b("Could not generate 3D structure")}finally{q&&M(!1)}})(),()=>{if(q=!1,O.current){try{O.current.spin(!1),O.current.clear()}catch{}O.current=null}}},[K]),reactExports.useEffect(()=>{var oe,be;const q=O.current;!q||!h||(q.removeAllShapes(),q.removeAllSurfaces(),v&&!i&&q.addSurface(_3DmolExports.SurfaceType.VDW,{opacity:.25,color:"white"}),i&&((oe=h.charges)!=null&&oe.length)&&q.addSurface(_3DmolExports.SurfaceType.VDW,{opacity:.6,colorscheme:{prop:"charge",gradient:"rwb",min:-.5,max:.5}}),a&&((be=h.features)!=null&&be.length)&&h.features.forEach(ge=>{let Le="gray";ge.family==="Donor"&&(Le="#00ff00"),ge.family==="Acceptor"&&(Le="#a020f0"),ge.family==="Aromatic"&&(Le="#ffa500"),q.addSphere({center:{x:ge.x,y:ge.y,z:ge.z},radius:1,color:Le,alpha:.4})}),u?q.setClickable({},!0,ge=>{const Le=L.current;if(!Le)L.current=ge,q.addSphere({center:{x:ge.x,y:ge.y,z:ge.z},radius:.35,color:"#facc15",alpha:.8}),q.addLabel(`${ge.elem}${ge.serial}`,{position:ge,backgroundColor:"#facc15",fontColor:"black",fontSize:11,borderRadius:4}),q.render();else{const pe=ge.x-Le.x,J=ge.y-Le.y,ce=ge.z-Le.z,Me=Math.sqrt(pe*pe+J*J+ce*ce);q.addCylinder({start:{x:Le.x,y:Le.y,z:Le.z},end:{x:ge.x,y:ge.y,z:ge.z},radius:.05,color:"#facc15",fromCap:!0,toCap:!0}),q.addLabel(`${Me.toFixed(2)} `,{position:{x:(Le.x+ge.x)/2,y:(Le.y+ge.y)/2,z:(Le.z+ge.z)/2},backgroundColor:"rgba(0,0,0,0.8)",fontColor:"#facc15",fontSize:13,borderRadius:4}),q.addSphere({center:{x:ge.x,y:ge.y,z:ge.z},radius:.35,color:"#facc15",alpha:.8}),R({dist:Me.toFixed(2),a1:`${Le.elem}${Le.serial}`,a2:`${ge.elem}${ge.serial}`}),q.render(),L.current=null}}):(q.setClickable({},!1),R(null),L.current=null),q.render())},[i,a,u,h,v]);const F=reactExports.useCallback(()=>{s(q=>!q),i||r(!1)},[i]),B=reactExports.useCallback(()=>{c(q=>!q)},[]),U=reactExports.useCallback(()=>{A(q=>!q)},[]),W=reactExports.useCallback(()=>{const q=O.current;if(!q)return;const oe=q.pngURI(),be=document.createElement("a");be.href=oe,be.download=`molecule-${(K==null?void 0:K.slice(0,12))||"capture"}.png`,be.click()},[K]),I=reactExports.useCallback(()=>{const q=O.current;q&&(n?(q.spin(!1),o(!1)):(q.spin("y",.5),o(!0)))},[n]),V=reactExports.useCallback(()=>{const q=O.current;q&&(q.zoomTo(),q.render(),n&&q.spin("y",.5))},[n]),ee=typeof C=="number"?`${C}px`:C,te=typeof f=="number"?`${f}px`:f,ae=((re=h==null?void 0:h.charges)==null?void 0:re.length)>0||((fe=h==null?void 0:h.features)==null?void 0:fe.length)>0;return jsxDevRuntimeExports.jsxDEV("div",{className:"relative",style:{width:ee,height:te,display:"flex"},children:[jsxDevRuntimeExports.jsxDEV("div",{ref:w,className:`flex-1 rounded-xl border border-white/10 shadow-inner ${u?"cursor-crosshair":"cursor-move"}`,style:{position:"relative",backgroundColor:"#111827",minWidth:0,minHeight:0}},void 0,!1,{fileName:"/Users/mohammedaashik/Documents/PROJECT/AYACOM/Drug_Forge_HackTheVibe/src/components/Molecule3DViewer.jsx",lineNumber:499,columnNumber:7},void 0),E&&!x&&!m&&K&&jsxDevRuntimeExports.jsxDEV("div",{className:"absolute bottom-3 left-1/2 -translate-x-1/2 z-30 flex items-center gap-1 px-2 py-1.5 rounded-xl bg-black/40 backdrop-blur-md border border-white/10 shadow-lg",children:[jsxDevRuntimeExports.jsxDEV(ControlButton,{icon:Box,label:"Stick",active:_==="stick",onClick:()=>g("stick")},void 0,!1,{fileName:"/Users/mohammedaashik/Documents/PROJECT/AYACOM/Drug_Forge_HackTheVibe/src/components/Molecule3DViewer.jsx",lineNumber:510,columnNumber:11},void 0),jsxDevRuntimeExports.jsxDEV(ControlButton,{icon:Circle,label:"Sphere",active:_==="sphere",onClick:()=>g("sphere")},void 0,!1,{fileName:"/Users/mohammedaashik/Documents/PROJECT/AYACOM/Drug_Forge_HackTheVibe/src/components/Molecule3DViewer.jsx",lineNumber:511,columnNumber:11},void 0),jsxDevRuntimeExports.jsxDEV(ControlButton,{icon:Minus,label:"Line",active:_==="line",onClick:()=>g("line")},void 0,!1,{fileName:"/Users/mohammedaashik/Documents/PROJECT/AYACOM/Drug_Forge_HackTheVibe/src/components/Molecule3DViewer.jsx",lineNumber:512,columnNumber:11},void 0),jsxDevRuntimeExports.jsxDEV("div",{className:"w-px h-5 mx-1 bg-white/20"},void 0,!1,{fileName:"/Users/mohammedaashik/Documents/PROJECT/AYACOM/Drug_Forge_HackTheVibe/src/components/Molecule3DViewer.jsx",lineNumber:513,columnNumber:11},void 0),jsxDevRuntimeExports.jsxDEV(ControlButton,{icon:Layers,label:"Surface",active:v,onClick:()=>r(q=>!q)},void 0,!1,{fileName:"/Users/mohammedaashik/Documents/PROJECT/AYACOM/Drug_Forge_HackTheVibe/src/components/Molecule3DViewer.jsx",lineNumber:514,columnNumber:11},void 0),jsxDevRuntimeExports.jsxDEV(ControlButton,{icon:n?Pause:Play,label:n?"Stop Spin":"Start Spin",active:n,onClick:I},void 0,!1,{fileName:"/Users/mohammedaashik/Documents/PROJECT/AYACOM/Drug_Forge_HackTheVibe/src/components/Molecule3DViewer.jsx",lineNumber:515,columnNumber:11},void 0),jsxDevRuntimeExports.jsxDEV(ControlButton,{icon:Camera,label:"Screenshot",active:!1,onClick:W},void 0,!1,{fileName:"/Users/mohammedaashik/Documents/PROJECT/AYACOM/Drug_Forge_HackTheVibe/src/components/Molecule3DViewer.jsx",lineNumber:516,columnNumber:11},void 0),jsxDevRuntimeExports.jsxDEV(ControlButton,{icon:RefreshCw,label:"Reset View",active:!1,onClick:V},void 0,!1,{fileName:"/Users/mohammedaashik/Documents/PROJECT/AYACOM/Drug_Forge_HackTheVibe/src/components/Molecule3DViewer.jsx",lineNumber:517,columnNumber:11},void 0)]},void 0,!0,{fileName:"/Users/mohammedaashik/Documents/PROJECT/AYACOM/Drug_Forge_HackTheVibe/src/components/Molecule3DViewer.jsx",lineNumber:509,columnNumber:9},void 0),E&&!x&&!m&&K&&ae&&jsxDevRuntimeExports.jsxDEV("div",{className:"absolute z-30 flex flex-col gap-2 top-4 right-4",children:[jsxDevRuntimeExports.jsxDEV(ScienceButton,{icon:Zap,label:"Electrostatics",active:i,onClick:F,activeColor:"text-rose-400"},void 0,!1,{fileName:"/Users/mohammedaashik/Documents/PROJECT/AYACOM/Drug_Forge_HackTheVibe/src/components/Molecule3DViewer.jsx",lineNumber:524,columnNumber:11},void 0),jsxDevRuntimeExports.jsxDEV(ScienceButton,{icon:Magnet,label:"Pharmacophores",active:a,onClick:B,activeColor:"text-emerald-400"},void 0,!1,{fileName:"/Users/mohammedaashik/Documents/PROJECT/AYACOM/Drug_Forge_HackTheVibe/src/components/Molecule3DViewer.jsx",lineNumber:525,columnNumber:11},void 0),jsxDevRuntimeExports.jsxDEV(ScienceButton,{icon:Ruler,label:"Measure Distance",active:u,onClick:U,activeColor:"text-amber-400"},void 0,!1,{fileName:"/Users/mohammedaashik/Documents/PROJECT/AYACOM/Drug_Forge_HackTheVibe/src/components/Molecule3DViewer.jsx",lineNumber:526,columnNumber:11},void 0)]},void 0,!0,{fileName:"/Users/mohammedaashik/Documents/PROJECT/AYACOM/Drug_Forge_HackTheVibe/src/components/Molecule3DViewer.jsx",lineNumber:523,columnNumber:9},void 0),i&&E&&jsxDevRuntimeExports.jsxDEV("div",{className:"absolute z-30 p-3 text-xs text-white border bottom-14 left-4 bg-black/60 backdrop-blur-md rounded-xl border-white/10",children:[jsxDevRuntimeExports.jsxDEV("div",{className:"mb-2 font-bold",children:"Surface Charge (ESP)"},void 0,!1,{fileName:"/Users/mohammedaashik/Documents/PROJECT/AYACOM/Drug_Forge_HackTheVibe/src/components/Molecule3DViewer.jsx",lineNumber:533,columnNumber:11},void 0),jsxDevRuntimeExports.jsxDEV("div",{className:"w-24 h-2 rounded-full bg-gradient-to-r from-red-500 via-white to-blue-500"},void 0,!1,{fileName:"/Users/mohammedaashik/Documents/PROJECT/AYACOM/Drug_Forge_HackTheVibe/src/components/Molecule3DViewer.jsx",lineNumber:534,columnNumber:11},void 0),jsxDevRuntimeExports.jsxDEV("div",{className:"flex justify-between mt-1 text-[10px] text-slate-300",children:[jsxDevRuntimeExports.jsxDEV("span",{children:[""," Neg"]},void 0,!0,{fileName:"/Users/mohammedaashik/Documents/PROJECT/AYACOM/Drug_Forge_HackTheVibe/src/components/Molecule3DViewer.jsx",lineNumber:536,columnNumber:13},void 0),jsxDevRuntimeExports.jsxDEV("span",{children:["","+ Pos"]},void 0,!0,{fileName:"/Users/mohammedaashik/Documents/PROJECT/AYACOM/Drug_Forge_HackTheVibe/src/components/Molecule3DViewer.jsx",lineNumber:537,columnNumber:13},void 0)]},void 0,!0,{fileName:"/Users/mohammedaashik/Documents/PROJECT/AYACOM/Drug_Forge_HackTheVibe/src/components/Molecule3DViewer.jsx",lineNumber:535,columnNumber:11},void 0)]},void 0,!0,{fileName:"/Users/mohammedaashik/Documents/PROJECT/AYACOM/Drug_Forge_HackTheVibe/src/components/Molecule3DViewer.jsx",lineNumber:532,columnNumber:9},void 0),a&&E&&jsxDevRuntimeExports.jsxDEV("div",{className:"absolute z-30 p-3 text-xs text-white border bottom-14 left-4 bg-black/60 backdrop-blur-md rounded-xl border-white/10",children:[jsxDevRuntimeExports.jsxDEV("div",{className:"mb-2 font-bold",children:"Binding Features"},void 0,!1,{fileName:"/Users/mohammedaashik/Documents/PROJECT/AYACOM/Drug_Forge_HackTheVibe/src/components/Molecule3DViewer.jsx",lineNumber:545,columnNumber:11},void 0),jsxDevRuntimeExports.jsxDEV("div",{className:"flex flex-col gap-1",children:[jsxDevRuntimeExports.jsxDEV("div",{className:"flex items-center",children:[jsxDevRuntimeExports.jsxDEV("span",{className:"w-2 h-2 mr-2 bg-green-500 rounded-full"},void 0,!1,{fileName:"/Users/mohammedaashik/Documents/PROJECT/AYACOM/Drug_Forge_HackTheVibe/src/components/Molecule3DViewer.jsx",lineNumber:547,columnNumber:48},void 0)," H-Bond Donor"]},void 0,!0,{fileName:"/Users/mohammedaashik/Documents/PROJECT/AYACOM/Drug_Forge_HackTheVibe/src/components/Molecule3DViewer.jsx",lineNumber:547,columnNumber:13},void 0),jsxDevRuntimeExports.jsxDEV("div",{className:"flex items-center",children:[jsxDevRuntimeExports.jsxDEV("span",{className:"w-2 h-2 mr-2 bg-purple-500 rounded-full"},void 0,!1,{fileName:"/Users/mohammedaashik/Documents/PROJECT/AYACOM/Drug_Forge_HackTheVibe/src/components/Molecule3DViewer.jsx",lineNumber:548,columnNumber:48},void 0)," H-Bond Acceptor"]},void 0,!0,{fileName:"/Users/mohammedaashik/Documents/PROJECT/AYACOM/Drug_Forge_HackTheVibe/src/components/Molecule3DViewer.jsx",lineNumber:548,columnNumber:13},void 0),jsxDevRuntimeExports.jsxDEV("div",{className:"flex items-center",children:[jsxDevRuntimeExports.jsxDEV("span",{className:"w-2 h-2 mr-2 bg-orange-500 rounded-full"},void 0,!1,{fileName:"/Users/mohammedaashik/Documents/PROJECT/AYACOM/Drug_Forge_HackTheVibe/src/components/Molecule3DViewer.jsx",lineNumber:549,columnNumber:48},void 0)," Aromatic Ring"]},void 0,!0,{fileName:"/Users/mohammedaashik/Documents/PROJECT/AYACOM/Drug_Forge_HackTheVibe/src/components/Molecule3DViewer.jsx",lineNumber:549,columnNumber:13},void 0)]},void 0,!0,{fileName:"/Users/mohammedaashik/Documents/PROJECT/AYACOM/Drug_Forge_HackTheVibe/src/components/Molecule3DViewer.jsx",lineNumber:546,columnNumber:11},void 0)]},void 0,!0,{fileName:"/Users/mohammedaashik/Documents/PROJECT/AYACOM/Drug_Forge_HackTheVibe/src/components/Molecule3DViewer.jsx",lineNumber:544,columnNumber:9},void 0),u&&E&&jsxDevRuntimeExports.jsxDEV("div",{className:"absolute z-30 px-3 py-2 text-xs text-white border top-4 left-4 bg-black/60 backdrop-blur-md rounded-xl border-amber-500/30",children:[jsxDevRuntimeExports.jsxDEV("div",{className:"flex items-center gap-1 mb-1 font-bold text-amber-400",children:[jsxDevRuntimeExports.jsxDEV(Ruler,{className:"w-3 h-3"},void 0,!1,{fileName:"/Users/mohammedaashik/Documents/PROJECT/AYACOM/Drug_Forge_HackTheVibe/src/components/Molecule3DViewer.jsx",lineNumber:558,columnNumber:13},void 0)," Measure Mode"]},void 0,!0,{fileName:"/Users/mohammedaashik/Documents/PROJECT/AYACOM/Drug_Forge_HackTheVibe/src/components/Molecule3DViewer.jsx",lineNumber:557,columnNumber:11},void 0),D?jsxDevRuntimeExports.jsxDEV("div",{className:"font-mono",children:[D.a1,"  ",D.a2,":"," ",jsxDevRuntimeExports.jsxDEV("span",{className:"font-bold text-amber-300",children:[D.dist," "]},void 0,!0,{fileName:"/Users/mohammedaashik/Documents/PROJECT/AYACOM/Drug_Forge_HackTheVibe/src/components/Molecule3DViewer.jsx",lineNumber:563,columnNumber:15},void 0)]},void 0,!0,{fileName:"/Users/mohammedaashik/Documents/PROJECT/AYACOM/Drug_Forge_HackTheVibe/src/components/Molecule3DViewer.jsx",lineNumber:561,columnNumber:13},void 0):jsxDevRuntimeExports.jsxDEV("div",{className:"text-slate-400",children:"Click two atoms to measure"},void 0,!1,{fileName:"/Users/mohammedaashik/Documents/PROJECT/AYACOM/Drug_Forge_HackTheVibe/src/components/Molecule3DViewer.jsx",lineNumber:566,columnNumber:13},void 0)]},void 0,!0,{fileName:"/Users/mohammedaashik/Documents/PROJECT/AYACOM/Drug_Forge_HackTheVibe/src/components/Molecule3DViewer.jsx",lineNumber:556,columnNumber:9},void 0),e&&E&&!u&&jsxDevRuntimeExports.jsxDEV("div",{className:"absolute top-3 right-3 z-30 px-3 py-1.5 rounded-lg bg-black/50 backdrop-blur-md border border-white/10 text-xs text-slate-200 font-mono",children:[e.elem," #",e.serial,e.charge!=null&&jsxDevRuntimeExports.jsxDEV("span",{className:parseFloat(e.charge)>=0?" text-blue-400":" text-rose-400",children:[" ","(",parseFloat(e.charge)>=0?"+":"",e.charge,")"]},void 0,!0,{fileName:"/Users/mohammedaashik/Documents/PROJECT/AYACOM/Drug_Forge_HackTheVibe/src/components/Molecule3DViewer.jsx",lineNumber:576,columnNumber:13},void 0),jsxDevRuntimeExports.jsxDEV("span",{className:"text-slate-500",children:[" ","(",e.x,", ",e.y,", ",e.z,")"]},void 0,!0,{fileName:"/Users/mohammedaashik/Documents/PROJECT/AYACOM/Drug_Forge_HackTheVibe/src/components/Molecule3DViewer.jsx",lineNumber:580,columnNumber:11},void 0)]},void 0,!0,{fileName:"/Users/mohammedaashik/Documents/PROJECT/AYACOM/Drug_Forge_HackTheVibe/src/components/Molecule3DViewer.jsx",lineNumber:573,columnNumber:9},void 0),x&&jsxDevRuntimeExports.jsxDEV("div",{className:"absolute inset-0 z-10 flex items-center justify-center rounded-xl",style:{backgroundColor:"rgba(0,0,0,0.3)",pointerEvents:"none"},children:jsxDevRuntimeExports.jsxDEV(Loader2,{className:"w-8 h-8 text-cyan-400 animate-spin"},void 0,!1,{fileName:"/Users/mohammedaashik/Documents/PROJECT/AYACOM/Drug_Forge_HackTheVibe/src/components/Molecule3DViewer.jsx",lineNumber:592,columnNumber:11},void 0)},void 0,!1,{fileName:"/Users/mohammedaashik/Documents/PROJECT/AYACOM/Drug_Forge_HackTheVibe/src/components/Molecule3DViewer.jsx",lineNumber:588,columnNumber:9},void 0),m&&!x&&jsxDevRuntimeExports.jsxDEV("div",{className:"absolute inset-0 z-20 flex flex-col items-center justify-center p-4 text-sm text-center text-rose-400",children:[jsxDevRuntimeExports.jsxDEV(AlertTriangle,{className:"w-6 h-6 mb-2 opacity-80"},void 0,!1,{fileName:"/Users/mohammedaashik/Documents/PROJECT/AYACOM/Drug_Forge_HackTheVibe/src/components/Molecule3DViewer.jsx",lineNumber:599,columnNumber:11},void 0),jsxDevRuntimeExports.jsxDEV("span",{children:m},void 0,!1,{fileName:"/Users/mohammedaashik/Documents/PROJECT/AYACOM/Drug_Forge_HackTheVibe/src/components/Molecule3DViewer.jsx",lineNumber:600,columnNumber:11},void 0)]},void 0,!0,{fileName:"/Users/mohammedaashik/Documents/PROJECT/AYACOM/Drug_Forge_HackTheVibe/src/components/Molecule3DViewer.jsx",lineNumber:598,columnNumber:9},void 0),!K&&!x&&jsxDevRuntimeExports.jsxDEV("div",{className:"absolute inset-0 flex items-center justify-center text-sm text-slate-400",children:"Waiting for molecule..."},void 0,!1,{fileName:"/Users/mohammedaashik/Documents/PROJECT/AYACOM/Drug_Forge_HackTheVibe/src/components/Molecule3DViewer.jsx",lineNumber:606,columnNumber:9},void 0)]},void 0,!0,{fileName:"/Users/mohammedaashik/Documents/PROJECT/AYACOM/Drug_Forge_HackTheVibe/src/components/Molecule3DViewer.jsx",lineNumber:497,columnNumber:5},void 0)};export{Atom as A,Molecule3DViewer as M,Play as P,RotateCcw as R};
